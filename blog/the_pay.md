### 一次重复支付引发的思考

项目中在手动支付的基础上做了自动支付的功能,定时查询未支付的订单对其进行打款支付

就这样, 一次灾难来了, 在测试的时候, 把数据库中订单标记为支付失败, 手动发起重新支付后, 发现账户服务在3秒内收到了2次重复打款, 排查发现手动支付和自动支付前后执行

账户服务只做了简单限流, 对同一用户打款处理未完成逻辑时不允许再次对其支付, 但是3秒内足够触发对两次同一支付了

支付是一个很敏感的业务, 不能忍受任何一次重复支付

