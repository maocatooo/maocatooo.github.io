<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>GPT-5 æ–°ç‰¹æ€§ä¸åº”ç”¨</title>
    <link href="/2025/08/11/blog/ai/llm/gpt-5/"/>
    <url>/2025/08/11/blog/ai/llm/gpt-5/</url>
    
    <content type="html"><![CDATA[<h3 id="gpt-5">gpt-5:</h3><p><a href="https://platform.openai.com/docs/guides/latest-model?reasoning-effort-mode=responses#prompting-guidance">https://platform.openai.com/docs/guides/latest-model?reasoning-effort-mode=responses#prompting-guidance</a><br><a href="https://cookbook.openai.com/examples/gpt-5/gpt-5_new_params_and_tools#4-minimal-reasoning">https://cookbook.openai.com/examples/gpt-5/gpt-5_new_params_and_tools#4-minimal-reasoning</a></p><h4 id="ç¼“å­˜-æ—§æ¦‚å¿µ">ç¼“å­˜(æ—§æ¦‚å¿µ):</h4><p><a href="https://platform.openai.com/docs/guides/prompt-caching">https://platform.openai.com/docs/guides/prompt-caching</a></p><p>OpenAI ä¼šå°† API è¯·æ±‚è·¯ç”±åˆ°æœ€è¿‘å¤„ç†è¿‡ç›¸åŒæç¤ºçš„æœåŠ¡å™¨ä¸Šï¼Œä»è€Œä»¥æ¯”ä»å¤´å¼€å§‹å¤„ç†æ›´ä½çš„æˆæœ¬å’Œæ›´å¿«çš„é€Ÿåº¦å®Œæˆè¯·æ±‚ã€‚è¿™ç§æ–¹æ³•å¯å°†å»¶è¿Ÿé™ä½é«˜è¾¾ 80%ï¼Œæˆæœ¬é™ä½é«˜è¾¾ 75%</p><p>å½“æç¤ºè¯è¾¾åˆ°æˆ–è¶…è¿‡ 1024 ä¸ª token æ—¶ï¼Œç¼“å­˜å°†è‡ªåŠ¨å¯ç”¨ã€‚å½“å‘èµ· API è¯·æ±‚æ—¶ï¼Œå°†å‘ç”Ÿä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li>ç¼“å­˜è·¯ç”±ï¼š<ul><li>è¯·æ±‚ä¼šæ ¹æ®æç¤ºè¯åˆå§‹å‰ç¼€çš„å“ˆå¸Œå€¼è¢«è·¯ç”±åˆ°ç‰¹å®šæœºå™¨ã€‚å“ˆå¸Œé€šå¸¸ä½¿ç”¨å‰ 256 ä¸ª tokenï¼Œä½†å…·ä½“é•¿åº¦å¯èƒ½å› æ¨¡å‹è€Œå¼‚ã€‚</li><li>å¦‚æœæä¾›äº†prompt_cache_keyå‚æ•°ï¼Œå®ƒå°†ä¸å‰ç¼€å“ˆå¸Œå€¼ç»“åˆä½¿ç”¨ï¼Œä»è€Œå…è®¸å½±å“è·¯ç”±å¹¶æé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚å½“å¤šä¸ªè¯·æ±‚å…±äº«è¾ƒé•¿çš„å…¬å…±å‰ç¼€æ—¶ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºæœ‰ç›Šã€‚</li><li>å¦‚æœé’ˆå¯¹ç›¸åŒå‰ç¼€å’Œ prompt_cache_key ç»„åˆçš„è¯·æ±‚è¶…è¿‡ä¸€å®šé¢‘ç‡ï¼ˆçº¦æ¯åˆ†é’Ÿ 15 æ¬¡ï¼‰ï¼Œéƒ¨åˆ†è¯·æ±‚å¯èƒ½ä¼šæº¢å‡ºå¹¶è¢«è·¯ç”±åˆ°å…¶ä»–æœºå™¨ï¼Œä»è€Œé™ä½ç¼“å­˜æ•ˆç‡ã€‚</li></ul></li><li>ç¼“å­˜æŸ¥æ‰¾ï¼šç³»ç»Ÿä¼šæ£€æŸ¥æ‰€é€‰æœºå™¨ä¸Šçš„ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨æç¤ºè¯çš„åˆå§‹éƒ¨åˆ†ï¼ˆå‰ç¼€ï¼‰ã€‚</li><li>ç¼“å­˜å‘½ä¸­ï¼šå¦‚æœæ‰¾åˆ°åŒ¹é…çš„å‰ç¼€ï¼Œç³»ç»Ÿå°†ä½¿ç”¨ç¼“å­˜ç»“æœã€‚è¿™å°†æ˜¾è‘—é™ä½å»¶è¿Ÿå¹¶å‡å°‘æˆæœ¬ã€‚</li><li>ç¼“å­˜æœªå‘½ä¸­ï¼šå¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„å‰ç¼€ï¼Œç³»ç»Ÿå°†å¤„ç†å®Œæ•´æç¤ºè¯ï¼Œå¹¶åœ¨è¯¥æœºå™¨ä¸Šç¼“å­˜å…¶å‰ç¼€ï¼Œä¾›åç»­è¯·æ±‚ä½¿ç”¨ã€‚<br>å·²ç¼“å­˜çš„å‰ç¼€é€šå¸¸åœ¨è¿ç»­ 5 åˆ° 10 åˆ†é’Ÿæ— æ´»åŠ¨åå¤±æ•ˆã€‚ä½†åœ¨éé«˜å³°æ—¶æ®µï¼Œç¼“å­˜å¯èƒ½æœ€é•¿ä¿ç•™ä¸€å°æ—¶ã€‚</li></ul><h4 id="è®°å¿†-æ—§æ¦‚å¿µ-ï¼š">è®°å¿†(æ—§æ¦‚å¿µ)ï¼š</h4><p><a href="https://help.openai.com/en/collections/8471548-memory">https://help.openai.com/en/collections/8471548-memory</a><br><a href="https://www.tomsguide.com/ai/chatgpt-5-features-heres-the-5-upgrades-i-would-try-first">https://www.tomsguide.com/ai/chatgpt-5-features-heres-the-5-upgrades-i-would-try-first</a></p><h4 id="æ€§æ ¼">æ€§æ ¼:</h4><p><a href="https://help.openai.com/en/articles/11899719-customizing-your-chatgpt-personality">https://help.openai.com/en/articles/11899719-customizing-your-chatgpt-personality</a></p><p><strong>è®°å¿†å’Œæ€§æ ¼éƒ½æ˜¯åœ¨GPTè‡ªå®¶çš„åº”ç”¨ä¸­ä½¿ç”¨çš„</strong></p><h3 id="æ¨¡å‹">æ¨¡å‹</h3><table><thead><tr><th>æ¨¡å‹</th><th>ç‰¹ç‚¹</th><th>å‚æ•°</th><th></th></tr></thead><tbody><tr><td>GPT-5</td><td>åœ¨å„ä¸ªé¢†åŸŸè¿›è¡Œç¼–ç ã€æ¨ç†å’Œä»£ç†ä»»åŠ¡çš„æ——èˆ°æ¨¡å‹</td><td>400,000 context window <br />128,000 max output tokens  <br /> May 31, 2024 knowledge cutoff <br /> Reasoning token support</td><td></td></tr><tr><td>GPT-5 mini</td><td>ä¸€ä¸ªæ›´å¿«ã€æ›´å…·æˆæœ¬æ•ˆç›Šçš„ç‰ˆæœ¬ã€‚éå¸¸é€‚åˆå®šä¹‰æ˜ç¡®çš„ä»»åŠ¡å’Œç²¾ç¡®çš„æç¤ºã€‚</td><td>400,000 context window <br />128,000 max output tokens  <br /> May 31, 2024 knowledge cutoff <br /> Reasoning token support</td><td></td></tr><tr><td>GPT-5 nano</td><td>æœ€å¿«ã€æœ€ç»æµçš„ GPT-5 ç‰ˆæœ¬ã€‚éå¸¸é€‚åˆæ‘˜è¦å’Œåˆ†ç±»ä»»åŠ¡</td><td>400,000 context window <br />128,000 max output tokens  <br /> May 31, 2024 knowledge cutoff <br /> Reasoning token support</td><td></td></tr></tbody></table><h3 id="ä»·æ ¼å¯¹æ¯”">ä»·æ ¼å¯¹æ¯”</h3><table><thead><tr><th>æ¨¡å‹</th><th>è¾“å…¥</th><th>ç¼“å­˜</th><th>è¾“å‡º</th></tr></thead><tbody><tr><td>GPT-5</td><td>$1.25</td><td>$0.13</td><td>$10.00</td></tr><tr><td>GPT-5 mini</td><td>$0.25</td><td>$0.03</td><td>$2.00</td></tr><tr><td>GPT-5 nano</td><td>$0.05</td><td>$0.01</td><td>$0.40</td></tr><tr><td>GPT-4o</td><td>$2.50</td><td>$1.25</td><td>$10.00</td></tr><tr><td>GPT-4.1</td><td>$2.00</td><td>$0.50</td><td>$8.00</td></tr><tr><td>o3-mini</td><td>$1.10</td><td>$0.55</td><td>$4.40</td></tr></tbody></table><h2 id="æ¥å£è°ƒç”¨æ–°å‚æ•°">æ¥å£è°ƒç”¨æ–°å‚æ•°</h2><h3 id="1-verbosity-å‚æ•°">1.  <code>verbosity</code> å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>client = OpenAI()<br><span class="hljs-keyword">for</span> verbosity <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;low&quot;</span>, <span class="hljs-string">&quot;medium&quot;</span>, <span class="hljs-string">&quot;high&quot;</span>]:<br>    response = client.responses.create(<br>        model=<span class="hljs-string">&quot;gpt-5-mini&quot;</span>,<br>        <span class="hljs-built_in">input</span>=<span class="hljs-string">&quot;å†™ä¸€é¦–å…³äºä¸€ä¸ªç”·å­©å’Œä»–çš„ç¬¬ä¸€åªå® ç‰©ç‹—çš„è¯—&quot;</span>,<br>        text=&#123;<span class="hljs-string">&quot;verbosity&quot;</span>: verbosity&#125;<br>    )<br></code></pre></td></tr></table></figure><p>å¯ä»¥åœ¨ä¸æ”¹å˜åº•å±‚æç¤ºè¯çš„æƒ…å†µä¸‹ï¼Œç¨³å®šåœ°åŒæ—¶è°ƒæ•´æ¨¡å‹è¾“å‡ºçš„é•¿åº¦å’Œæ·±åº¦ï¼Œå¹¶ä¸”ä¿æŒæ­£ç¡®æ€§å’Œæ¨ç†è´¨é‡ã€‚</p><p>low: ç®€æ´çš„ç”¨æˆ·ä½“éªŒï¼Œæ–‡å­—æœ€å°‘<br>medium(é»˜è®¤å€¼): ç»†èŠ‚ä¸ç®€æ´å¹³è¡¡<br>high: å†…å®¹è¯¦å°½ï¼Œé€‚åˆå®¡æŸ¥ã€æ•™å­¦ã€‚</p><p>æµ‹è¯•ä½¿ç”¨tokenæ¶ˆè€—æ¯”é‡ï¼š<br>low:medium:high â€”  <strong>424:530:1072</strong></p><h3 id="2-è‡ªç”±å½¢å¼å‡½æ•°è°ƒç”¨-Freeform-Function-Calling">2. è‡ªç”±å½¢å¼å‡½æ•°è°ƒç”¨ Freeform Function Calling</h3><h4 id="ç¤ºä¾‹">ç¤ºä¾‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>client = OpenAI()<br><br>response = client.responses.create(<br>    model=<span class="hljs-string">&quot;gpt-5-mini&quot;</span>,<br>    <span class="hljs-built_in">input</span>=<span class="hljs-string">&quot;è¯·ä½¿ç”¨code_execå·¥å…·è®¡ç®— 100 ä»¥å†…çš„è´¨æ•°ä¹‹å’Œã€‚&quot;</span>,<br>    text=&#123;<span class="hljs-string">&quot;format&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>&#125;&#125;,<br>    tools=[<br>        &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;custom&quot;</span>,<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;code_exec&quot;</span>,<br>            <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;Executes arbitrary python code&quot;</span>,<br>        &#125;<br>    ]<br>)<br></code></pre></td></tr></table></figure><p>GPT-5 ä¸­çš„è‡ªç”±å½¢å¼å·¥å…·è°ƒç”¨å…è®¸å°†åŸå§‹æ–‡æœ¬è½½è·â€”â€”ä¾‹å¦‚ Python è„šæœ¬ã€SQL æŸ¥è¯¢æˆ–é…ç½®æ–‡ä»¶â€”â€”ç›´æ¥å‘é€åˆ°è‡ªå®šä¹‰å·¥å…·ï¼Œè€Œæ— éœ€ä½¿ç”¨ JSON å°è£…<br>(æœ¬è´¨å°±æ˜¯å°†ä¸€æ®µæ–‡æœ¬äº¤ç»™å·¥å…·å¤„ç†)</p><h4 id="å¯¹æ¯”function-å·¥å…·-gptä¼šè¿”å›jsonæ ¼å¼æ–‡æœ¬">å¯¹æ¯”function å·¥å…·(gptä¼šè¿”å›jsonæ ¼å¼æ–‡æœ¬)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">tools = [&#123;<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>,<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>,<br>    <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;Get current temperature for provided coordinates in celsius.&quot;</span>,<br>    <span class="hljs-string">&quot;parameters&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>,<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;latitude&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;number&quot;</span>&#125;,<br>            <span class="hljs-string">&quot;longitude&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;number&quot;</span>&#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;required&quot;</span>: [<span class="hljs-string">&quot;latitude&quot;</span>, <span class="hljs-string">&quot;longitude&quot;</span>],<br>        <span class="hljs-string">&quot;additionalProperties&quot;</span>: <span class="hljs-literal">False</span><br>    &#125;,<br>    <span class="hljs-string">&quot;strict&quot;</span>: <span class="hljs-literal">True</span><br>&#125;]<br></code></pre></td></tr></table></figure><h3 id="3-ä¸Šä¸‹æ–‡æ— å…³è¯­æ³•-Contextâ€‘Free-Grammar-CFG">3. ä¸Šä¸‹æ–‡æ— å…³è¯­æ³• Contextâ€‘Free Grammar (CFG)</h3><p>åœ¨custom toolsä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡æ— å…³è¯­æ³• CFG é™åˆ¶è¾“å‡ºï¼Œ ç¡®ä¿è‡ªå®šä¹‰å·¥å…·çš„è¾“å…¥ç¬¦åˆé¢„æœŸã€‚</p><p>â€œsyntaxâ€: â€œlarkâ€<br>â€œsyntaxâ€: â€œregexâ€</p><h4 id="ç¤ºä¾‹-2">ç¤ºä¾‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>client = OpenAI()<br><br>timestamp_grammar_definition = <span class="hljs-string">r&quot;^\d&#123;1&#125;-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01]) (?:[01]\d|2[0-3]):[0-5]\d$&quot;</span><br><br>timestamp_prompt = (<br>    <span class="hljs-string">&quot;Call the timestamp_grammar to save a timestamp for August 7th 2025 at 10AM.&quot;</span><br>)<br><br>response_mssql = client.responses.create(<br>    model=<span class="hljs-string">&quot;gpt-5&quot;</span>,<br>    <span class="hljs-built_in">input</span>=timestamp_prompt,<br>    text=&#123;<span class="hljs-string">&quot;format&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>&#125;&#125;,<br>    tools=[<br>        &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;custom&quot;</span>,<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;timestamp_grammar&quot;</span>,<br>            <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;Saves a timestamp in date + time in 24-hr format.&quot;</span>,<br>            <span class="hljs-string">&quot;format&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;grammar&quot;</span>,<br>                <span class="hljs-string">&quot;syntax&quot;</span>: <span class="hljs-string">&quot;regex&quot;</span>,<br>                <span class="hljs-string">&quot;definition&quot;</span>: timestamp_grammar_definition<br>            &#125;<br>        &#125;,<br>    ],<br>    parallel_tool_calls=<span class="hljs-literal">False</span><br>)<br></code></pre></td></tr></table></figure><h3 id="4-Minimal-Reasoning">4.  Minimal Reasoning</h3><p>Minimal reasoning é€šè¿‡ä½¿ç”¨æå°‘æˆ–ä¸ä½¿ç”¨æ¨ç† token æ¥è¿è¡Œ GPT-5ï¼Œä»¥æœ€å¤§é™åº¦åœ°é™ä½å»¶è¿Ÿå¹¶åŠ å¿«é¦–å­—è¾“å‡ºæ—¶é—´ã€‚é€‚ç”¨äºæ— éœ€è§£é‡Šçš„ç¡®å®šæ€§ã€è½»é‡çº§ä»»åŠ¡ï¼ˆå¦‚ä¿¡æ¯æå–ã€æ ¼å¼åŒ–ã€ç®€çŸ­é‡å†™ã€ç®€å•åˆ†ç±»ï¼‰ã€‚è‹¥ä¸æŒ‡å®š effort å‚æ•°ï¼Œé»˜è®¤ä¸º mediumï¼›å½“æ‚¨ä¼˜å…ˆè€ƒè™‘é€Ÿåº¦è€Œéæ·±å…¥æ¨ç†æ—¶ï¼Œè¯·æ˜¾å¼è®¾ç½®ä¸º minimalã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI<br><br>client = OpenAI()<br><br>prompt = <span class="hljs-string">&quot;Classify sentiment of the review as positive|neutral|negative. Return one word only.&quot;</span> <br><br><br>response = client.responses.create(<br>    model=<span class="hljs-string">&quot;gpt-5&quot;</span>,<br>    <span class="hljs-built_in">input</span>= [&#123; <span class="hljs-string">&#x27;role&#x27;</span>: <span class="hljs-string">&#x27;developer&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>: prompt &#125;, <br>            &#123; <span class="hljs-string">&#x27;role&#x27;</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>: <span class="hljs-string">&#x27;The food that the restaurant was great! I recommend it to everyone.&#x27;</span> &#125;],<br>    reasoning = &#123;<br>        <span class="hljs-string">&quot;effort&quot;</span>: <span class="hljs-string">&quot;minimal&quot;</span><br>    &#125;,<br>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>GPT5</tag>
      
      <tag>OPENAI</tag>
      
      <tag>LLM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼€å‘ä¸­é‡åˆ°çš„ä¸€äº›æœ‰æ„æ€çš„å­—ç¬¦</title>
    <link href="/2025/01/19/blog/article/interesting_character/"/>
    <url>/2025/01/19/blog/article/interesting_character/</url>
    
    <content type="html"><![CDATA[<h2 id="1-â€œÎ¦Ï†â€-è¿™ä¸¤ä¸ªå­—ç¬¦ç«Ÿç„¶â€™ç›¸åŒâ€™">1. â€œÎ¦Ï†â€ è¿™ä¸¤ä¸ªå­—ç¬¦ç«Ÿç„¶â€™ç›¸åŒâ€™</h2><p>åœ¨æ–‡æœ¬æŸ¥æ‰¾å·¥å…·ä¸­,è¿™ä¸¤ä¸ªå­—ç¬¦ç›¸åŒï¼ŒåŸå› ï¼šâ€œÎ¦â€.lower()==â€œÏ†â€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">json.dumps(<span class="hljs-string">&quot;Î¦Ï†&quot;</span>)<br><span class="hljs-string">&#x27;&quot;\\u03a6\u03c6&quot;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="2-len-â€œï½»ï¾â€-2">2. len(â€œï½»ï¾â€) == 2</h2><p>æ—¥è¯­ä¸­æœ‰ä¸€äº›å­—ç¬¦çœ‹ç€æ˜¯ä¸€ä¸ªå­—ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ä¸¤ä¸ª Unicode ç ç‚¹ï¼ˆåŠè§’å‡å+æµŠéŸ³ç¬¦å·ï¼‰</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ€è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨pythonæŠŠå¤šä¸ªpdfåˆå¹¶ä¸ºä¸€ä¸ªpdfæ–‡ä»¶</title>
    <link href="/2025/01/19/blog/python/pdf_merge/"/>
    <url>/2025/01/19/blog/python/pdf_merge/</url>
    
    <content type="html"><![CDATA[<h5 id="å®‰è£…PyPDF2">å®‰è£…PyPDF2</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install PyPDF2<br></code></pre></td></tr></table></figure><h5 id="åˆå¹¶pdfæ–‡ä»¶">åˆå¹¶pdfæ–‡ä»¶</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PyPDF2 <span class="hljs-keyword">import</span> PdfMerger<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">merge_pdfs</span>(<span class="hljs-params">pdf_list, output_file</span>):<br>    merger = PdfMerger()<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">for</span> pdf <span class="hljs-keyword">in</span> pdf_list:<br>            merger.append(pdf)<br>        merger.write(output_file)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PDF æ–‡ä»¶å·²æˆåŠŸåˆå¹¶å¹¶ä¿å­˜ä¸º <span class="hljs-subst">&#123;output_file&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åˆå¹¶è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">finally</span>:<br>        merger.close()<br><br><br>pdf_files = [<span class="hljs-string">&quot;a.pdf&quot;</span>] * <span class="hljs-number">10</span>  <br>output_pdf = <span class="hljs-string">&quot;merged_output.pdf&quot;</span><br>merge_pdfs(pdf_files, output_pdf)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>PDF</tag>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python print() åœ¨ Docker ä¸è¾“å‡º</title>
    <link href="/2024/10/30/Python/DockerPrintNotData/"/>
    <url>/2024/10/30/Python/DockerPrintNotData/</url>
    
    <content type="html"><![CDATA[<p>print è¾“å‡ºæœ‰ç¼“å†²</p><p>è§£å†³åŠæ³•</p><ol><li>Dockerfile <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ENV PYTHONUNBUFFERED=1<br></code></pre></td></tr></table></figure></li><li>docker run <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -e PYTHONUNBUFFERED=1<br></code></pre></td></tr></table></figure></li><li>printä¸­çš„flush=True <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">print(&quot;start&quot;, flush=True)<br></code></pre></td></tr></table></figure></li></ol><p>ä¸€ä¸ªä½¿ç”¨pythonèµ·dockerå®ˆæŠ¤è¿›ç¨‹çš„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">python3 -m http.server 8000</span><br><br> docker run --name test-run -it -d amazonlinux:2023 python3 -m http.server 8000<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AWS S3 ä¸‹è½½æ–‡ä»¶ç¿»å€å ç”¨å†…å­˜</title>
    <link href="/2024/06/25/blog/other/aws_sdk_DownloadLargeObject/"/>
    <url>/2024/06/25/blog/other/aws_sdk_DownloadLargeObject/</url>
    
    <content type="html"><![CDATA[<p>åœ¨aws doc (<a href="https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/example_s3_Scenario_UsingLargeFiles_section.html">https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/example_s3_Scenario_UsingLargeFiles_section.html</a>)ä¸Šé¢æ‰¾çš„ä¸‹è½½å¤§æ–‡ä»¶ç¤ºä¾‹,ç›´æ¥ç²˜è´´è¿è¡Œ,æ²¡é—®é¢˜,æäº¤ä¸Šçº¿</p><p>æºä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// DownloadLargeObject uses a download manager to download an object from a bucket.</span><br><span class="hljs-comment">// The download manager gets the data in parts and writes them to a buffer until all of</span><br><span class="hljs-comment">// the data has been downloaded.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(basics BucketBasics)</span></span> DownloadLargeObject(bucketName <span class="hljs-type">string</span>, objectKey <span class="hljs-type">string</span>) ([]<span class="hljs-type">byte</span>, <span class="hljs-type">error</span>) &#123;<br><span class="hljs-keyword">var</span> partMiBs <span class="hljs-type">int64</span> = <span class="hljs-number">10</span><br>    downloader := manager.NewDownloader(basics.S3Client, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(d *manager.Downloader)</span></span> &#123;<br>d.PartSize = partMiBs * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span><br>&#125;)<br>buffer := manager.NewWriteAtBuffer([]<span class="hljs-type">byte</span>&#123;&#125;)<br>_, err := downloader.Download(context.TODO(), buffer, &amp;s3.GetObjectInput&#123;<br>Bucket: aws.String(bucketName),<br>Key:    aws.String(objectKey),<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Printf(<span class="hljs-string">&quot;Couldn&#x27;t download large object from %v:%v. Here&#x27;s why: %v\n&quot;</span>,<br>bucketName, objectKey, err)<br>&#125;<br><span class="hljs-keyword">return</span> buffer.Bytes(), err<br>&#125;<br></code></pre></td></tr></table></figure><p>åé¢å®¢æˆ·åé¦ˆä¸šåŠ¡ä¸Šä¼ 500Mçš„æ–‡ä»¶,æ¥å£æŠ¥é”™äº†,æŸ¥äº†ä¸€ä¸‹å°±æ˜¯æœåŠ¡é‡å¯äº†,æœ¬åœ°å¤ç°äº†ä¸€ä¸‹å‘ç°ä¸‹è½½è¿™ä¸ª500Mçš„æ–‡ä»¶,ä½¿ç”¨çš„å†…å­˜å´åˆ°äº†2G+,ç›´æ¥å†…å­˜çˆ†æ‰,æœåŠ¡é‡å¯</p><p>æ’æŸ¥äº†ä¸€ä¸‹å‘ç°å°±æ˜¯manager.NewWriteAtBufferè¿™ä¸ªç»“æ„å†…å­˜,åœ¨ä½¿ç”¨åˆ¤æ–­åˆ‡ç‰‡å®¹é‡ä¸è¶³çš„æƒ…å†µä¸‹,ç›´æ¥é‡æ–°æ–°å»ºäº†ä¸€ä¸ªæ–°çš„åˆ‡ç‰‡,æ—§çš„åˆ‡ç‰‡æ²¡æœ‰åŠæ—¶æ¸…ç†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//https://github.com/aws/aws-sdk-go-v2/blob/4ed838eab2a963cb16301501c8b8c3e29dac4c20/feature/s3/manager/types.go#L162</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(b *WriteAtBuffer)</span></span> WriteAt(p []<span class="hljs-type">byte</span>, pos <span class="hljs-type">int64</span>) (n <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>) &#123;<br>pLen := <span class="hljs-built_in">len</span>(p)<br>expLen := pos + <span class="hljs-type">int64</span>(pLen)<br>b.m.Lock()<br><span class="hljs-keyword">defer</span> b.m.Unlock()<br><span class="hljs-keyword">if</span> <span class="hljs-type">int64</span>(<span class="hljs-built_in">len</span>(b.buf)) &lt; expLen &#123;<br><span class="hljs-keyword">if</span> <span class="hljs-type">int64</span>(<span class="hljs-built_in">cap</span>(b.buf)) &lt; expLen &#123;<br><span class="hljs-keyword">if</span> b.GrowthCoeff &lt; <span class="hljs-number">1</span> &#123;<br>b.GrowthCoeff = <span class="hljs-number">1</span><br>&#125;<br>newBuf := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, expLen, <span class="hljs-type">int64</span>(b.GrowthCoeff*<span class="hljs-type">float64</span>(expLen)))<br><span class="hljs-built_in">copy</span>(newBuf, b.buf)<br>b.buf = newBuf<br>&#125;<br>b.buf = b.buf[:expLen]<br>&#125;<br><span class="hljs-built_in">copy</span>(b.buf[pos:], p)<br><span class="hljs-keyword">return</span> pLen, <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è§£å†³åŠæ³•:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">buffer := manager.NewWriteAtBuffer([]<span class="hljs-type">byte</span>&#123;&#125;)<br></code></pre></td></tr></table></figure><p>è·å–S3æ–‡ä»¶çš„size<br>åˆå§‹åŒ–åˆ‡ç‰‡, ç›´æ¥ç»™åˆ°æ–‡ä»¶å¯¹åº”çš„å¤§å°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go">headInput := &amp;s3.HeadObjectInput&#123;<br>Bucket: bucketName,<br>Key:    objectKey,<br>&#125;<br><br>headObject, err := s3c.client.HeadObject(context.TODO(), headInput)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br>buf := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, ptr.ToInt64(headObject.ContentLength))<br>buffer := manager.NewWriteAtBuffer(buf)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>aws</tag>
      
      <tag>s3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL è¯»å†™åˆ†ç¦»</title>
    <link href="/2024/04/27/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/"/>
    <url>/2024/04/27/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/</url>
    
    <content type="html"><![CDATA[<p>ç»ˆäºè¿˜æ˜¯æ¥äº†,è¯»å†™åˆ†ç¦»çš„å‘è¿˜æ˜¯è¢«æˆ‘è¸©åˆ°äº†,å¹´å‰æ¥æ‰‹äº†åŒäº‹çš„ä¸€äº›ä»£ç ,åœ¨ä¸Šé¢ç¼ç¼è¡¥è¡¥,æœ€è¿‘åœ¨è‡ªæµ‹çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªå¥‡æ€ªçš„äº‹å„¿,åˆ›å»ºçš„æ•°æ®æ¨é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—,æœ¬åœ°å¼€å‘ç¯å¢ƒæ˜¯æ²¡æœ‰é—®é¢˜,åˆ°äº†æµ‹è¯•ç¯å¢ƒ,æ¶ˆæ¯é˜Ÿçš„ç»“æ„æ•°æ®ä¸æ­£ç¡®<br>æ’æŸ¥äº†ä¸€ä¸‹å‘ç°æ˜¯<strong>æ•°æ®åº“è¯»å†™åˆ†ç¦»</strong>çš„é—®é¢˜</p><p>æœ¬è´¨å°±æ˜¯,<strong>æ’å…¥çš„æ•°æ®,éœ€è¦ç«‹é©¬æŸ¥è¯¢å‡ºæ¥</strong>è·å–æ’å…¥çš„ä¸»é”®ID,ä¸ºåç»­ä¸šåŠ¡æä¾›å…³è”<br>æœ¬åœ°å¼€å‘ç¯å¢ƒ,è¿æ¥æµ‹è¯•æ•°æ®åº“å»¶æ—¶æ¯”è¾ƒé«˜(100mså¾€ä¸Š)å¤ç°ä¸åˆ°è¿™ä¸ªé—®é¢˜</p><p>å¦‚ä½•è§£å†³è¿™ç§é—®é¢˜ç½‘ä¸Šä¹Ÿæ˜¯ä¸€å¤§å †</p><ol><li>åœ¨å†™åº“ä¸­è¯»æ•°æ®</li><li>ç­‰å¾…è¯»åº“ååŒæ­¥å®Œæ•°æ®å®Œæˆåå†è¿›è¡ŒåŒæ­¥</li></ol><p>è¯»å†™åˆ†ç¦»åŒæ­¥æµç¨‹</p><p>å†™åº“çš„æ“ä½œ</p><ol><li>ä¿®æ”¹å†…å­˜æ•°æ®é¡µ</li><li>è®°å½•redolog</li><li>å†™å…¥binlog<ul><li>ä¸»åº“binlogå‘é€åˆ°ä»èŠ‚ç‚¹</li><li>ä»åº“è®°å½•åˆ°relay log</li><li>ä»åº“ä»relay logè¯»å–logåŒæ­¥æ•°æ®</li></ul></li><li>æäº¤äº‹åŠ¡</li></ol><ul><li><p>å¼‚æ­¥å¤åˆ¶ï¼š</p><ul><li>ä¸»åº“å‘é€binlogå‘é€åˆ°ä»èŠ‚ç‚¹,å°±ç«‹é©¬æäº¤äº‹åŠ¡å“åº”ç”¨æˆ·</li></ul></li><li><p>åŠåŒæ­¥å¤åˆ¶</p><ul><li>ä¸»åº“å‘é€binlogå‘é€åˆ°ä»èŠ‚ç‚¹,è‡³å°‘ç­‰åˆ°ä¸€ä¸ªä»åº“ç¡®è®¤è‡ªå·±æ‰æäº¤äº‹åŠ¡ç„¶åå“åº”ç”¨æˆ·<ul><li>å¹¶ä¸”ä¸èƒ½è§£å†³æŸ¥è¯¢ä»åº“ç«‹é©¬è·å–åˆ°æœŸæœ›çš„æ•°æ®,å› ä¸ºæŸ¥è¯¢çš„ä»åº“å¯èƒ½ä¸æ˜¯å“åº”ä¸»åº“çš„èŠ‚ç‚¹</li></ul></li></ul></li></ul><p>è§£å†³é—®é¢˜çš„åŠæ³•:</p><ol><li>ä¸šåŠ¡ä¸Šå®æ–½ç­‰å¾…,</li><li>å¼•å…¥ç¼“å­˜,æ’å…¥çš„æ•°æ®ç›´æ¥ä»ç¼“å­˜ä¸­è·å–</li><li>æŸ¥è¯¢å‡ºä»åº“æ˜¯ä¸æ˜¯å·²ç»åŒæ­¥ä¸»åº“çš„binlogæœ€æ–°äº‹åŠ¡ä½ç½®ä¿¡æ¯,ä»è€Œå¯ä»¥ç›´æ¥åœ¨ä»åº“æŸ¥è¯¢å‡ºäº‹åŠ¡å˜æ›´çš„æ•°æ®</li></ol><p>å‚è€ƒèµ„æ–™:</p><ul><li><a href="https://www.bilibili.com/video/BV1FH4y1K7rn">https://www.bilibili.com/video/BV1FH4y1K7rn</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AWSä¹‹Step Functions</title>
    <link href="/2024/03/25/blog/other/aws_step_function/"/>
    <url>/2024/03/25/blog/other/aws_step_function/</url>
    
    <content type="html"><![CDATA[<h3 id="Step-Functions">Step Functions</h3><p>å®˜æ–¹æ–‡æ¡£:<a href="https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html">https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html</a></p><p>å…¬å¸ä¸­çš„é¡¹ç›®éœ€è¦ç”¨åˆ°å»¶æ—¶ä»»åŠ¡å»å¤„ç†ä¸šåŠ¡ä¸Šçš„é—®é¢˜,AWSè‡ªå¸¦çš„SQSæ¶ˆæ¯å»¶æ—¶é˜Ÿåˆ—æœ€å¤§çš„å»¶æ—¶æ¶ˆæ¯æ˜¯15åˆ†é’Ÿ,å®Œå…¨ä¸èƒ½æ»¡è¶³æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æˆ–å›ºå®šè¶…è¿‡15åˆ†é’Ÿå»å¤„ç†å»¶æ—¶ä»»åŠ¡</p><p>å› æ­¤,é¢†å¯¼å®‰æ’æˆ‘è°ƒç ”AWS Step Functionsçœ‹çœ‹èƒ½ä¸èƒ½è§£å†³è¿™äº›é—®é¢˜</p><p>Step Functions åŸºäºçŠ¶æ€æœºå’Œä»»åŠ¡ã€‚åœ¨ Step Functions ä¸­ï¼Œå·¥ä½œæµè¢«ç§°ä¸ºçŠ¶æ€æœºï¼Œå®ƒæ˜¯ä¸€ç³»åˆ—äº‹ä»¶é©±åŠ¨çš„æ­¥éª¤ã€‚<br>å·¥ä½œæµç¨‹ä¸­çš„æ¯ä¸ªæ­¥éª¤éƒ½ç§°ä¸ºçŠ¶æ€ã€‚çŠ¶æ€ä»£è¡¨å…¶ä»–AWSæœåŠ¡ï¼ˆä¾‹å¦‚AWS Lambdaï¼‰æ‰§è¡Œçš„å·¥ä½œå•å…ƒã€‚ä»»åŠ¡çŠ¶æ€å¯ä»¥è°ƒç”¨ä»»ä½•AWSæœåŠ¡æˆ–APIä»»åŠ¡</p><p>Step Functions ä¹Ÿæä¾›äº†ç­‰å¾…çŠ¶æ€ä¼ å…¥è‡ªå®šä¹‰æ—¶é—´æ¥æ§åˆ¶ä»»åŠ¡å¤„ç†, ç”¨æ¥åšå»¶æ—¶ä»»åŠ¡ç¡®å®ç¬¦åˆæˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯</p><p>(è™½ç„¶æœ€åæ²¡æœ‰é€‰æ‹©ä½¿ç”¨æ­¤æ–¹æ¡ˆåšå»¶æ—¶ä»»åŠ¡, å› ä¸ºæœ€å¤§çš„æ´»åŠ¨æ•°é‡ä¸Šé™æ˜¯10000 ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„ä¸šåŠ¡é‡å¯¹åº”çš„éœ€æ±‚)</p><h4 id="ä½¿ç”¨-AWS-Step-Functions-åšå»¶æ—¶ä»»åŠ¡">ä½¿ç”¨ AWS Step Functions åšå»¶æ—¶ä»»åŠ¡</h4><p>æµç¨‹æ­¥éª¤</p><ol><li>åˆ›å»ºlambdaå‡½æ•°</li><li>åˆ›å»ºçŠ¶æ€æœºæ·»åŠ å»¶æ—¶ä»»åŠ¡å¹¶ä¸”ç»‘å®šlambdaå‡½æ•°</li><li>æ‰§è¡ŒçŠ¶æ€æœº</li></ol><p>é…ç½®æœ¬åœ°å¼€å‘ç¯å¢ƒ</p><p>å‰ç½®æ¡ä»¶ å®‰è£… aws-cli, sam-cli</p><p>lambda å‡½æ•°</p><ol><li>åˆ›å»ºlambdaå‡½æ•°<br>sam init</li><li>ç¼–è¯‘æ‰“åŒ…<br>sam build</li><li>æœ¬åœ°è¿è¡Œ<br>sam local start-lambda --host 0.0.0.0</li></ol><p>åˆ›å»ºçŠ¶æ€æœºç¯å¢ƒ<br>docker run --name stepfunctions -p 8083:8083 --env-file env.txt amazon/aws-stepfunctions-local</p><p>ç¯å¢ƒå˜é‡env.txt</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">AWS_DEFAULT_REGION</span>=us-east-<span class="hljs-number">1</span><br><span class="hljs-attr">AWS_ACCESS_KEY_ID</span>=<span class="hljs-number">012345678901</span><br><span class="hljs-attr">AWS_SECRET_ACCESS_KEY</span>=<span class="hljs-number">012345678901</span><br><span class="hljs-attr">LAMBDA_ENDPOINT</span>=http://<span class="hljs-number">10.0</span>.<span class="hljs-number">8.246</span>:<span class="hljs-number">3001</span>  <span class="hljs-comment"># æœ¬åœ°è¿è¡Œçš„lambdaå‡½æ•°åœ°å€</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºçŠ¶æ€æœº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> os<br><br>states = &#123;<br>    <span class="hljs-string">&quot;Comment&quot;</span>: <span class="hljs-string">&quot;example&quot;</span>,<br>    <span class="hljs-string">&quot;StartAt&quot;</span>: <span class="hljs-string">&quot;wait_until&quot;</span>,<br>    <span class="hljs-string">&quot;States&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;wait_until&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;Type&quot;</span>: <span class="hljs-string">&quot;Wait&quot;</span>, <span class="hljs-comment"># ç­‰å¾…çŠ¶æ€</span><br>            <span class="hljs-string">&quot;SecondsPath&quot;</span>: <span class="hljs-string">&quot;$.expirydate&quot;</span>, <span class="hljs-comment"># ä»è¾“å…¥ä¸­è·å–å»¶æ—¶æ—¶é—´</span><br>            <span class="hljs-string">&quot;Next&quot;</span>: <span class="hljs-string">&quot;LambdaState&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;LambdaState&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Type&quot;</span>: <span class="hljs-string">&quot;Task&quot;</span>, <span class="hljs-comment"># ä»»åŠ¡çŠ¶æ€</span><br>            <span class="hljs-string">&quot;Resource&quot;</span>: <span class="hljs-string">&quot;arn:aws:states:::lambda:invoke&quot;</span>,<br>            <span class="hljs-string">&quot;OutputPath&quot;</span>: <span class="hljs-string">&quot;$.Payload&quot;</span>, <span class="hljs-comment"># ä»lambdaå‡½æ•°çš„è¿”å›å€¼ä¸­è·å–è¾“å‡º</span><br>            <span class="hljs-string">&quot;Parameters&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;Payload.$&quot;</span>: <span class="hljs-string">&quot;$&quot;</span>, <span class="hljs-comment"># å°†è¾“å…¥ä¼ é€’ç»™lambdaå‡½æ•°</span><br>                <span class="hljs-string">&quot;FunctionName&quot;</span>: <span class="hljs-string">&quot;arn:aws:lambda:us-east-1:function:HelloWorldFunction:$LATEST&quot;</span> <span class="hljs-comment"># lambdaå‡½æ•°çš„arn</span><br>            &#125;,<br>            <span class="hljs-string">&quot;Next&quot;</span>: <span class="hljs-string">&quot;NextState&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;NextState&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Type&quot;</span>: <span class="hljs-string">&quot;Pass&quot;</span>,<br>            <span class="hljs-string">&quot;End&quot;</span>: <span class="hljs-literal">True</span><br>        &#125;<br>    &#125;<br>&#125;<br><br>states_str = (json.dumps(json.dumps(states)))<br><br>cmd = <span class="hljs-string">&quot;aws stepfunctions --endpoint http://localhost:8083 create-state-machine --definition &quot;</span> + states_str + <span class="hljs-string">&quot; --name test --role-arn arn:aws:iam::123456789012:role/DummyRole&quot;</span><br><br>os.system(cmd)<br></code></pre></td></tr></table></figure><p>åˆ é™¤çŠ¶æ€æœº<br>aws stepfunctions --endpoint-url <a href="http://localhost:8083">http://localhost:8083</a> start-execution --state-machine-arn arn:aws:states:us-east-1:123456789012:stateMachine:HelloWorld --input â€œ{&quot;a&quot;:1}â€</p><p>golangæ‰§è¡ŒçŠ¶æ€æœºæ–¹æ³•å¹¶ä¸”ä¼ é€’å‚æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/aws/aws-sdk-go/aws&quot;</span><br><span class="hljs-string">&quot;github.com/aws/aws-sdk-go/aws/session&quot;</span><br><span class="hljs-string">&quot;github.com/aws/aws-sdk-go/service/sfn&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// åˆ›å»º AWS ä¼šè¯</span><br>sess, err := session.NewSession(&amp;aws.Config&#123;<br>Region:   aws.String(<span class="hljs-string">&quot;us-east-1&quot;</span>),             <span class="hljs-comment">// æ›¿æ¢ä¸º AWS åŒºåŸŸ</span><br>Endpoint: aws.String(<span class="hljs-string">&quot;http://localhost:8083&quot;</span>), <span class="hljs-comment">// æ›¿æ¢ä¸º Step Functions æœ¬åœ°ç«¯ç‚¹</span><br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-comment">// åˆ›å»º Step Functions å®¢æˆ·ç«¯</span><br>sfnClient := sfn.New(sess)<br><br><span class="hljs-comment">// å®šä¹‰è¾“å…¥å‚æ•°</span><br>input := <span class="hljs-string">`&#123;&quot;expirydate&quot;:11, &quot;a&quot;:1233333&#125;`</span><br><br><span class="hljs-comment">// æŒ‡å®šçŠ¶æ€æœºçš„ ARN</span><br>stateMachineARN := <span class="hljs-string">&quot;arn:aws:states:us-east-1:123456789012:stateMachine:test&quot;</span><br><br><span class="hljs-comment">// è°ƒç”¨çŠ¶æ€æœº</span><br>result, err := sfnClient.StartExecution(&amp;sfn.StartExecutionInput&#123;<br>Input:           &amp;input,<br>StateMachineArn: &amp;stateMachineARN,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-comment">// æ‰“å°æ‰§è¡Œçš„ ARN</span><br>fmt.Println(<span class="hljs-string">&quot;Execution ARN:&quot;</span>, *result.ExecutionArn)<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>aws</tag>
      
      <tag>Step Functions</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç†¬è¿‡ 2023, 2023 æ€»ç»“</title>
    <link href="/2024/03/24/blog/article/summary_by_2023/"/>
    <url>/2024/03/24/blog/article/summary_by_2023/</url>
    
    <content type="html"><![CDATA[<h4 id="2023å¹´">2023å¹´</h4><p>è¿Ÿåˆ°çš„2023å¹´æ€»ç»“,æ˜¯æ‹–å»¶ç—‡ä¹Ÿæ˜¯å¿™ç¢Œ,å¯¼è‡´ç°åœ¨æ‰å¼€å§‹å›æƒ³2023ä¸€å¹´çš„äº‹æƒ…,2023å¹´å¯¹æˆ‘æ¥è¯´æ˜¯æ®‹é…·çš„ä¸€å¹´,ä¹Ÿæ˜¯æˆ‘å°è±¡æ·±åˆ»çš„ä¸€å¹´,è¿™å¹´æˆ‘æ‹¥äº†ä¸¤åªå–µå’ª,<br>æ¢äº†ä¸¤ä»½å·¥ä½œ,éª‘ç€è¸æ¿è½¦å»åˆ°äº†é™•è¥¿éŸ©åŸå¸‚,è§äº†æœªæ¥è€ä¸ˆ,å¼€å§‹ç„¦è™‘æœªæ¥.</p><h4 id="ç”Ÿæ´»">ç”Ÿæ´»</h4><ul><li>è§äº†æœªæ¥è€ä¸ˆ</li><li>åˆå¸¦äº†ä¸€åªå°çŒ«å›å®¶,åŒæ—¶æ‹¥æœ‰äº†å¤„ç†ä¸å®Œçš„çŒ«æ¯›çƒ¦æ¼</li><li>6æœˆéª‘ç€æˆ‘çš„å°è¸æ¿å»äº†éŸ©åŸ,è·ç¦»è¥¿å®‰ä¸åˆ°300å…¬é‡Œçš„è·¯ç¨‹,ç”¨äº†å…«ä¸ªå¤šå°æ—¶,çœŸçš„å¾ˆå€¼å¾—,æ²¿ç€é»„æ²³ä¸€è·¯çš„é£æ™¯çœŸçš„ç¾å¦‚ç”»</li></ul><h4 id="å·¥ä½œ">å·¥ä½œ</h4><p>23å¹´çš„å·¥ä½œ,çœŸæ˜¯è®©æˆ‘å¾ˆéš¾è¿‡,3æœˆæ…Œå¿™å…¥èŒçš„å…¬å¸,å°ç»„åœ¨9æœˆå›¢é˜Ÿè§£æ•£,ä¸€åˆ‡éƒ½æœ‰é¢„å…†å¯å¾ª,æ€ªæˆ‘æ²¡æœ‰æ“¦äº®çœ¼ç›<br>(é¢è¯•çš„æ—¶å€™ä¸€ä¸ªå…¬å¸åç§°,å‘offerçš„æ—¶å€™åˆæ˜¯å¦å¤–ä¸€å®¶,ç­¾åŠ³åŠ¨åˆåŒåˆæ˜¯å¦å¤–ä¸€å®¶,å‘å·¥èµ„åˆæ¢äº†ä¸€å®¶)<br>9æœˆ,10æœˆå¼€å§‹é¢è¯•,æ²Ÿé€šäº†89å®¶å…¬å¸,æŠ•äº†31åˆ†ç®€å†,é¢è¯•7å®¶,æ‹¿åˆ°4ä¸ªoffer</p><p>å› ä¸ºå·¥ä½œçš„äº‹,æˆ‘å¼€å§‹è¶Šæ¥è¶Šç„¦è™‘,æ—¶ä¸æ—¶å¼€å§‹æ€è€ƒæœªæ¥çš„äº‹æƒ…</p><h4 id="æŠ€æœ¯">æŠ€æœ¯</h4><ul><li>ç¨‹åºå‘˜ä¸‰ä»¶å¥—ä¹‹è®°è´¦,å¼€å‘äº†ä¸€ä¸ªå¾®ä¿¡å°ç¨‹åºè®°è´¦</li><li>ç”¨goå¼€å‘äº†ç”Ÿæˆæ•°æ®åº“ERå›¾çš„å·¥å…·</li><li><a href="https://maocat.cc/2023/03/06/blog/golang/gin_handlefunc">ç”¨åå°„é—­åŒ…äº†ä¸€ä¸‹ Gin çš„ HandlerFunc</a></li></ul><p>2023å¹´,æˆ‘å‘ç°äº†æˆ‘è‡ªå·±æœ€å¤§çš„é—®é¢˜<strong>ç²—å¿ƒ</strong></p><p>2023å¹´,æˆ‘ç»™å®ƒçš„å…³é”®è¯æ˜¯<strong>æ´»ç€</strong>,è¿™å¹´æ²¡æœ‰æ”’ä¸‹é’±,ä¹Ÿç»™æˆ‘å¸¦æ¥äº†ç„¦è™‘</p><h4 id="2024ç›®æ ‡">2024ç›®æ ‡</h4><ul><li>å­¦ä¼šåŒæ‹¼</li><li>é‡æ‹¾java</li><li>æ”¹å˜è‡ªå·±ç²—å¿ƒçš„æ¯›ç—…</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æ€è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vscodeæ‰‹å†Œ</title>
    <link href="/2023/12/01/%E5%9F%BA%E7%A1%80/vscode%E6%89%8B%E5%86%8C/"/>
    <url>/2023/12/01/%E5%9F%BA%E7%A1%80/vscode%E6%89%8B%E5%86%8C/</url>
    
    <content type="html"><![CDATA[<h3 id="ç›®å½•æ ‘çš„å±‚çº§å®Œå…¨é“ºå¼€">ç›®å½•æ ‘çš„å±‚çº§å®Œå…¨é“ºå¼€</h3><p><img src="/asset/%E5%9F%BA%E7%A1%80/images/dir_level.png" alt="ç›®å½•æ ‘çš„å±‚çº§å®Œå…¨é“ºå¼€"></p><h3 id="å±•ç¤ºéšè—çš„æ–‡ä»¶ç›®å½•">å±•ç¤ºéšè—çš„æ–‡ä»¶ç›®å½•</h3><p><img src="/asset/%E5%9F%BA%E7%A1%80/images/unhide.png" alt="å±•ç¤ºéšè—çš„æ–‡ä»¶ç›®å½•"></p>]]></content>
    
    
    
    <tags>
      
      <tag>å‚è€ƒèµ„æ–™</tag>
      
      <tag>vscodeæ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨ langchain åšä¸€ä¸ª prompt å·¥ç¨‹å¸ˆ ğŸ™ˆ</title>
    <link href="/2023/08/01/blog/article/langchain_prompt/"/>
    <url>/2023/08/01/blog/article/langchain_prompt/</url>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/langchain-ai/langchain">langchain</a>æ˜¯ä¸€ä¸ªå¼€å‘ç”±è¯­è¨€æ¨¡å‹é©±åŠ¨çš„åº”ç”¨ç¨‹åºçš„æ¡†æ¶,ç®€å•æ¥è¯´å°±æ˜¯å°†LMMæ‰“åŒ…å±‚åº”ç”¨å±‚é¢çš„å°è£…,ä½¿æ™®é€šå¼€å‘è€…(æ¯”å¦‚æˆ‘)ä¹Ÿèƒ½å¼€å‘AIç›¸å…³çš„åº”ç”¨</p><p>æˆ‘èƒ½æƒ³åˆ°çš„ç›¸å…³åº”ç”¨ï¼š</p><ol><li>èŠå¤©æœºå™¨äºº</li><li>çŸ¥è¯†æ–‡æ¡£é—®ç­”åº“(AIå®¢æœ) <a href="https://github.com/chatchat-space/Langchain-Chatchat">Langchain-Chatchat</a></li><li>æ„å»ºNLPåº”ç”¨ç¨‹åº</li><li>â€¦</li></ol><p>å¦‚æœä½ ä½¿ç”¨è¿‡ ChatGPT å°±ä¼šå‘ç° GPT å›ç­”é—®é¢˜çš„æ—¶å€™å°±ä¼šå¤šè¯´ä¸€äº›å‰åç¼€ç›¸å…³æ— ç”¨çš„ä¸œè¥¿,ä½¿ç”¨ langchain çš„ <strong>prompt template</strong> å°±èƒ½éå¸¸æ–¹ä¾¿çš„é¿å…æ‰è¿™ä¸ªé—®é¢˜</p><p>ä¸€ä¸ªç¤ºä¾‹, ä½¿ç”¨ ExampleSelector å’Œ PromptTemplate åšæç¤ºè¿”å›æ¨¡æ¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.llms <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">from</span> langchain.prompts.example_selector <span class="hljs-keyword">import</span> SemanticSimilarityExampleSelector<br><span class="hljs-keyword">from</span> langchain.output_parsers <span class="hljs-keyword">import</span> ResponseSchema, StructuredOutputParser<br><span class="hljs-keyword">from</span> langchain.embeddings <span class="hljs-keyword">import</span> OpenAIEmbeddings<br><span class="hljs-keyword">from</span> langchain.vectorstores <span class="hljs-keyword">import</span> FAISS<br><span class="hljs-keyword">from</span> langchain.prompts <span class="hljs-keyword">import</span> FewShotPromptTemplate, PromptTemplate<br><br>openai_api_key = <span class="hljs-string">&quot;&#123;&#123;you_openai_api_key&#125;&#125;&quot;</span><br>llm: OpenAI = OpenAI(<br>    openai_proxy=<span class="hljs-string">&quot;127.0.0.1:4780&quot;</span>, <span class="hljs-comment">## è¿™é‡Œæ˜¯ä»£ç†ï¼Œä½ æ‡‚çš„</span><br>    openai_api_key=openai_api_key)<br><br>response_schemas = [<br>    ResponseSchema(name=<span class="hljs-string">&quot;user_input&quot;</span>, description=<span class="hljs-string">&quot;è¿™æ˜¯ç”¨æˆ·çš„è¾“å…¥&quot;</span>),<br>    ResponseSchema(name=<span class="hljs-string">&quot;date&quot;</span>, description=<span class="hljs-string">&quot;è¿™æ˜¯é€šè¿‡ç”¨æˆ·çš„è¾“å…¥å¾—åˆ°çš„æ—¶é—´&quot;</span>)<br>]<br><br>outputParser = StructuredOutputParser.from_response_schemas(response_schemas)<br><br>template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">ç¤ºä¾‹è¾“å…¥:</span><br><span class="hljs-string">&#123;user_input&#125;</span><br><span class="hljs-string">ç¤ºä¾‹è¾“å‡º:</span><br><span class="hljs-string">&#123;output&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>example_prompt = PromptTemplate(<br>    template=template,<br>    input_variables=[<span class="hljs-string">&quot;user_input&quot;</span>, <span class="hljs-string">&quot;output&quot;</span>],<br>)<br><br>examples = [<br>    &#123;<span class="hljs-string">&quot;user_input&quot;</span>: <span class="hljs-string">&quot;ä»Šå¤©æ˜¯2023-08-01,ä»Šå¤©åƒç±³é¥­ç”¨äº†10å…ƒ&quot;</span>,<br>     <span class="hljs-string">&quot;output&quot;</span>: <span class="hljs-string">&quot;&quot;&quot;date:2023-08-01,amount:10, user_input:æ˜¨å¤©æ—©ä¸Šåƒç±³é¥­ç”¨äº†10å…ƒ&quot;&quot;&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;user_input&quot;</span>: <span class="hljs-string">&quot;ä»Šå¤©æ˜¯2023-08-02,æ˜¨å¤©æ—©ä¸Šåƒç±³é¥­ç”¨äº†10.1å…ƒ&quot;</span>,<br>     <span class="hljs-string">&quot;output&quot;</span>: <span class="hljs-string">&quot;&quot;&quot;date:2023-08-01,amount:10.1, user_input:æ˜¨å¤©æ—©ä¸Šåƒç±³é¥­ç”¨äº†10å…ƒ&quot;&quot;&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;user_input&quot;</span>: <span class="hljs-string">&quot;ä»Šå¤©æ˜¯2023-08-03,å‰å¤©æ—©ä¸Šåƒç±³é¥­ç”¨äº†11å…ƒ&quot;</span>,<br>     <span class="hljs-string">&quot;output&quot;</span>: <span class="hljs-string">&quot;&quot;&quot;date:2023-08-01, amount:11, user_input:å‰å¤©æ—©ä¸Šåƒç±³é¥­ç”¨äº†11å…ƒ&quot;&quot;&quot;</span>&#125;,<br>]<br><br>example_selector = SemanticSimilarityExampleSelector.from_examples(<br>    examples=examples,<br>    embeddings=OpenAIEmbeddings(openai_api_key=openai_api_key),<br>    vectorstore_cls=FAISS,<br>    k=<span class="hljs-number">3</span><br>)<br><br>similar_prompt = FewShotPromptTemplate(<br>    example_selector=example_selector,<br>    example_prompt=example_prompt,<br>    prefix=<span class="hljs-string">&quot;æ‚¨å°†ä»ç”¨æˆ·é‚£å¾—åˆ°ä¸€æ®µæ–‡å­—, è§£æç›¸å…³å†…å®¹å¹¶ä¸”è¿”å›ç›¸å…³çš„å†…å®¹&quot;</span>,<br>    suffix=<span class="hljs-string">&quot;ç”¨æˆ·è¾“å…¥:&#123;user_input&#125;\nè§£æç»“æœ:&quot;</span>,<br>    input_variables=[<span class="hljs-string">&quot;user_input&quot;</span>],<br>)<br><br><span class="hljs-built_in">print</span>(similar_prompt.<span class="hljs-built_in">format</span>(user_input=<span class="hljs-string">&quot;ä»Šå¤©æ˜¯2023-08-03,ä»Šå¤©åƒç±³é¥­ç”¨äº†10å…ƒ&quot;</span>))<br><br><span class="hljs-built_in">print</span>(llm(similar_prompt.<span class="hljs-built_in">format</span>(user_input=<span class="hljs-string">&quot;ä»Šå¤©æ˜¯2023-08-01,å‰å¤©åƒç±³é¥­ç”¨äº†3.3å…ƒ&quot;</span>)))<br><br><span class="hljs-comment">## date:2023-07-30, amount:3.3, user_input:å‰å¤©åƒç±³é¥­ç”¨äº†3.3å…ƒ</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>langchain</tag>
      
      <tag>prompt</tag>
      
      <tag>AI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ºä»€ä¹ˆæˆ‘ä»¬æ”¾å¼ƒäº†åŸºäº GraphQL çš„CQRSæ¶æ„</title>
    <link href="/2023/07/13/blog/article/why_donot_use_graphql/"/>
    <url>/2023/07/13/blog/article/why_donot_use_graphql/</url>
    
    <content type="html"><![CDATA[<p>å½“æ¥æ‰‹é¡¹ç›®åï¼Œä¸€å¼€å§‹ Hasura GraphQL ç¡®å®ä¸ºæˆ‘ä»¬æ­å»ºæ•°æ®è¡¨å’Œè¿›è¡Œè¿è¡¨æŸ¥è¯¢æä¾›äº†ä¾¿åˆ©ã€‚åœ¨é¡¹ç›®åˆæœŸï¼Œå®ƒä¼¼ä¹éå¸¸æœ‰å¸å¼•åŠ›ï¼Œèƒ½å¤Ÿè¿…é€Ÿè·å¾—æ‰€éœ€çš„åŸºç¡€æ•°æ®ï¼ŒæŸ¥è¯¢æ¥å£çš„ç¼–å†™é€Ÿåº¦å¿«ï¼Œå‰ç«¯å¯ä»¥æ— ç¼ä½¿ç”¨è·¨åº“è·¨è¡¨æŸ¥è¯¢ã€‚</p><p>ç„¶è€Œï¼Œéšç€é¡¹ç›®çš„è¿›ä¸€æ­¥å¼€å‘ï¼Œä¸€äº›ç»†èŠ‚é—®é¢˜é€æ¸æµ®å‡ºæ°´é¢ï¼Œæˆ‘ä»¬å‘ç° GraphQL å¹¶ä¸é€‚åˆæˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ã€‚æœ‰æ—¶ï¼Œä¸€ä¸ªæŸ¥è¯¢è¯­å¥å¯èƒ½éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ï¼Œè€Œç³»ç»Ÿå¤æ‚åº¦çš„å¢åŠ ç»å¸¸å¯¼è‡´ä»¥å‰çš„æ¥å£éœ€è¦é‡æ„ï¼Œè¿™å¢åŠ äº†å¼€å‘æˆæœ¬ã€‚è¿™è®©æˆ‘ä»¬ä¸ç¦æ€è€ƒï¼ŒGraphQL æ˜¯å¦çœŸçš„èƒ½æé«˜å¼€å‘æ•ˆç‡ã€‚åœ¨é€‰æ‹©ä¸Šå˜å¾—æ›´åŠ å›°éš¾ï¼Œå› ä¸ºç»´æŠ¤å®ƒé€šå¸¸éœ€è¦æ›´å¤šçš„æˆæœ¬ã€‚å› æ­¤ï¼Œæˆ‘å‘é¢†å¯¼æå‡ºäº†æ”¾å¼ƒ GraphQL çš„å»ºè®®ã€‚</p><ol><li><p><strong>äººå‘˜æˆæœ¬å’Œå­¦ä¹ æˆæœ¬</strong>ï¼šåœ¨ Hasura GraphQL åˆå§‹é˜¶æ®µï¼Œåç«¯é…ç½®äº†åŸºç¡€æŸ¥è¯¢è¯­å¥ï¼Œä½†å‰ç«¯ä»éœ€æ·»åŠ ç»†èŠ‚ã€‚è¿™å¯¼è‡´åç«¯å¼€å‘äººå‘˜ä¸æ–­è·Ÿåœ¨å‰ç«¯äººå‘˜åé¢ï¼Œå‰ç«¯äººå‘˜ä¹Ÿéœ€è¦å­¦ä¹  GraphQL çŸ¥è¯†, è¿™ä½¿å¾—å‰åç«¯åœ¨ä»»åŠ¡å¼€å‘æ—¶æ˜¯ç´§å¯†è€¦åˆçš„ï¼Œæœ¬æ¥åªç”¨å®šä¹‰å¥½å¼€å‘æ–‡æ¡£ï¼Œå°±èƒ½è¿›è¡Œå¹¶è¡Œå¼€å‘äº†ã€‚</p></li><li><p><strong>ä¸šåŠ¡å¤æ‚åº¦</strong>ï¼šåœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œé€šå¸¸ä¼šå‡ºç°ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ï¼Œè¿™äº›éœ€æ±‚ä¸ä»…é¢„æ–™ä¹‹å¤–ï¼Œè€Œä¸”è¶…å‡ºäº†å¸¸è§„èŒƒå›´ï¼Œéœ€è¦ç‰¹æ®Šæ¡ä»¶æŸ¥è¯¢å’Œå­—æ®µè¿‡æ»¤ã€‚ä¾‹å¦‚ï¼ŒåŸºäºæ ‘çŠ¶æ•°æ®è¡¨è¿›è¡Œç‰¹æ®Šå¤„ç†æŸ¥è¯¢ï¼Œè¿™åœ¨ GraphQL ä¸­å¾ˆéš¾å®ç°ï¼Œå› ä¸º GraphQL æ˜¯åŸºäºæ•°æ®è¡¨è€Œä¸æ˜¯ä¸šåŠ¡çš„ã€‚è¿™å¯èƒ½éœ€è¦åœ¨æ•°æ®åº“å±‚é¢ç¼–å†™å¤§é‡å‡½æ•°æ¥è§£å†³ï¼Œè¿›ä¸€æ­¥å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚å¹¶ä¸”ä¸šåŠ¡ä¸æ˜¯ä¸€æˆä¸å˜çš„, GraphQL é…ç½®ä¸­çš„ Schema çš„ç»´æŠ¤åˆå¾—å•ç‹¬ç»´æŠ¤</p></li><li><p><strong>æ•°æ®æƒé™æ§åˆ¶</strong>ï¼šHasura GraphQL çš„æƒé™é…ç½®ç¹çï¼Œå¼€å‘äººå‘˜éœ€è¦å¤§é‡æ—¶é—´æ¥è®¾ç½®æƒé™ã€‚éšç€ç³»ç»Ÿè§’è‰²çš„å¢åŠ ï¼Œé…ç½®å˜å¾—æ›´åŠ å¤æ‚ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®é…ç½®æ•°æ®çš„æƒé™ï¼Œå½“å‰ç”¨æˆ·å¯¹è¿™äº›æ•°æ®çš„æŸ¥è¯¢å°†æ— æ³•çœ‹åˆ°ã€‚è™½ç„¶å¯ä»¥é€šè¿‡è§†å›¾æ¥è§£å†³æƒé™é—®é¢˜ï¼Œä½†å¼•å…¥è§†å›¾ä¼šå¸¦æ¥å¯¹å…¶çš„ç»´æŠ¤æˆæœ¬ã€‚</p></li><li><p><strong>é¡¹ç›®å‘å¸ƒé—®é¢˜</strong>ï¼šåœ¨æ­£å¸¸ç³»ç»Ÿä¸­ï¼Œåªéœ€åœ¨å‘å¸ƒå‰ä¿®æ”¹æˆ–æ·»åŠ æ•°æ®åº“æ•°æ®è¡¨ï¼Œé¡¹ç›®å°±å¯ä»¥è½»æ¾ä¸Šçº¿ã€‚ç„¶è€Œï¼Œåœ¨ Hasura GraphQL ä¸­ï¼Œéœ€è¦åœ¨å‘å¸ƒå‰ä¿®æ”¹æ•°æ®åº“æ•°æ®è¡¨ï¼Œå¹¶ç›¸åº”åœ°æ›´æ–° Hasura GraphQL é…ç½®ï¼Œè¿™ä½¿å¾—å‘å¸ƒè¿‡ç¨‹å˜å¾—å¤æ‚ä¸”å®¹æ˜“å‡ºé”™ï¼Œå°¤å…¶åœ¨å¤šä¸ªç³»ç»Ÿç¯å¢ƒä¸‹ã€‚</p></li><li><p><strong>ç¼“å­˜</strong>ï¼šä½¿ç”¨ Hasura GraphQL æ„å‘³ç€å¤±å»äº†å¯¹ç¼“å­˜çš„æ§åˆ¶æƒï¼Œè¿™å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚</p></li><li><p><strong>æ—¥å¿—</strong>ï¼šåœ¨ GraphQL ä¸­ï¼Œä¸åç«¯æ—¥å¿—çš„ç²¾ç»†è¿æ¥å˜å¾—å›°éš¾ï¼Œè¿™ä¼šå¯¼è‡´æ’æŸ¥æ•°æ®é—®é¢˜å˜å¾—å¤æ‚ã€‚</p></li><li><p><strong>èšåˆæ•°æ®</strong>ï¼šåœ¨ç°ä»£ç³»ç»Ÿä¸­ï¼Œé€šå¸¸éœ€è¦å¤„ç†ä¸€äº›ä¸ä¸šåŠ¡æ™ºèƒ½ (BI) ç›¸å…³çš„å†…å®¹ã€‚åœ¨ GraphQL ä¸­ï¼Œèšåˆæ•°æ®å˜å¾—éå¸¸å¤æ‚ï¼Œéœ€è¦åœ¨æ•°æ®åº“å±‚é¢ç¼–å†™å¤§é‡å‡½æ•°æ¥è§£å†³ã€‚ä¸šåŠ¡å¯èƒ½ä¼šä¸æ–­å˜åŒ–ï¼Œå› æ­¤ä¸å¸Œæœ›æ¯æ¬¡éƒ½ä¿®æ”¹æ•°æ®åº“å±‚é¢çš„ä»£ç ï¼Œä½†ç»´æŠ¤å¤šä¸€å¥—çš„æˆæœ¬å¯èƒ½ä¸å¯æ¥å—ã€‚</p></li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œé¡¹ç›®ä¸­All In GraphQLï¼Œæœ‰æ—¶å€™å¹¶ä¸èƒ½æé«˜å¼€å‘æ•ˆç‡ï¼Œåè€Œä¼šå¢åŠ å¼€å‘æˆæœ¬ï¼Œç»´æŠ¤æˆæœ¬ã€‚è¿™ä¹Ÿå¹¶ä¸æ„å‘³ç€ GraphQL ä¸é€‚åˆæ‰€æœ‰é¡¹ç›®ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå¯ä»¥åœ¨æŸäº›åœºæ™¯ä¸‹æé«˜å¼€å‘æ•ˆç‡ã€‚åœ¨é€‰æ‹© GraphQL æ—¶ï¼Œéœ€è¦è€ƒè™‘é¡¹ç›®çš„å¤æ‚åº¦ï¼Œä»¥åŠæ˜¯å¦æœ‰å¿…è¦ä½¿ç”¨ GraphQLã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ€è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¿å‘ä¹‹ grpc metadata ä¸èƒ½å­˜å…¥é ASCll å­—ç¬¦</title>
    <link href="/2023/07/06/blog/article/rpc_meta_header/"/>
    <url>/2023/07/06/blog/article/rpc_meta_header/</url>
    
    <content type="html"><![CDATA[<h3 id="grpc-metadata-ä¸èƒ½å­˜å…¥é-ASCll-å­—ç¬¦">grpc metadata ä¸èƒ½å­˜å…¥é ASCll å­—ç¬¦</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">rpc <span class="hljs-keyword">error</span>: code = Internal desc = header key <span class="hljs-string">&quot;user_name&quot;</span> <span class="hljs-keyword">contains</span> value <span class="hljs-keyword">with</span> non-printable ASCll <span class="hljs-built_in">characters</span><br></code></pre></td></tr></table></figure><p>é¡¹ç›®ä¸­è¿›è¡Œ rpc è°ƒç”¨çš„æ—¶å€™å‡ºç°è¿™ä¸ªé—®é¢˜,é—®é¢˜å¾ˆå®¹æ˜“è¿½è¸ª, å°±æ˜¯åœ¨<br>metadata.AppendToOutgoingContext é‡Œuser_nameå¯¹åº”çš„valueå­˜å…¥ä¸­æ–‡</p><p>åœ¨ grpc æºç ä¸­å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„é™åˆ¶, å¦‚æœéè¦è¿›è¡Œä¸­æ–‡ä¼ è¾“,å¯ä»¥æ·»åŠ åç¼€<code>-bin</code>(ä¾‹å¦‚:<code>user_name-bin</code>), è¡¨ç¤ºå¯¹åº”çš„æ•°æ®é€šè¿‡äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œç¼–ç è§£ç ä¼ è¾“</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go">google.golang.org/grpc/internal/metadata/metadata.<span class="hljs-keyword">go</span>:<span class="hljs-number">90</span><br><span class="hljs-comment">// hasNotPrintable return true if msg contains any characters which are not in %x20-%x7E</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">hasNotPrintable</span><span class="hljs-params">(msg <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br><span class="hljs-comment">// for i that saving a conversion if not using for range</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(msg); i++ &#123;<br><span class="hljs-keyword">if</span> msg[i] &lt; <span class="hljs-number">0x20</span> || msg[i] &gt; <span class="hljs-number">0x7E</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>gRPC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€æ¬¡é‡å¤æ”¯ä»˜å¼•å‘çš„æ€è€ƒ</title>
    <link href="/2023/06/13/blog/article/the_pay/"/>
    <url>/2023/06/13/blog/article/the_pay/</url>
    
    <content type="html"><![CDATA[<p>å¦‚ä½•é¿å…è®¢å•é‡å¤æäº¤å’Œé‡å¤æ”¯ä»˜, åœ¨ç½‘ä¸Šä¸€äº›æ–‡ç« è§†é¢‘éƒ½å¾ˆå¥½çš„è®²å‡ºæ€ä¹ˆé¿å…æ­¤ç±»é—®é¢˜</p><p>ç„¶è€Œé‡å¤æ”¯ä»˜çœŸæ­£å‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Š, å´è¿˜æ˜¯ç„¦å¤´çƒ‚é¢</p><hr><h2 id="å¤ç›˜">å¤ç›˜</h2><ol><li><strong><em>6æœˆ10æ—¥13ç‚¹22åˆ†</em></strong>, ä¸šåŠ¡æ–¹åé¦ˆæ”¯ä»˜ç³»ç»Ÿå¯¹äººå‘˜è‡ªåŠ¨æ‰“æ¬¾æ²¡æœ‰åˆ°è´¦, è®©æ’æŸ¥é—®é¢˜</li><li><strong><em>13ç‚¹36åˆ†</em></strong>, æˆ‘åé¦ˆæ”¯ä»˜æœåŠ¡å‹æ ¹æ²¡æœ‰æ”¶åˆ°æ”¯ä»˜è¯·æ±‚, äº§å“è®©ä¸šåŠ¡æœåŠ¡æ‰‹åŠ¨æŠŠæ”¯ä»˜çŠ¶æ€æ”¹ä¸ºæ”¯ä»˜å¤±è´¥, è¿™æ ·å¯ä»¥åœ¨é¡µé¢ä¸Šæ‰‹åŠ¨æ”¯ä»˜</li><li><strong><em>13ç‚¹36åˆ†-13ç‚¹44åˆ†</em></strong>, ä¸šåŠ¡æœåŠ¡ä¿®æ”¹æ”¯ä»˜çŠ¶æ€å, é‡æ–°æ‰‹åŠ¨æ”¯ä»˜, æˆ‘æŸ¥çœ‹æ—¥å¿—ä¸­å‘ç°è§¦å‘æ”¯ä»˜æ¥å£, ä½†æ˜¯åœ¨<strong>æµæ°´ä¸­ç”Ÿæˆäº†å¯¹åŒä¸€äººçš„ä¸¤ç¬”æ”¯ä»˜æµæ°´</strong>, æˆ‘åé¦ˆå¤§æ¦‚è§¦å‘äº†<strong>é‡å¤æ”¯ä»˜</strong></li></ol><p>ä¸‰æ–¹æ”¯ä»˜apiå·²ç»è¿”å›å¤„ç†ä¸­, æˆ‘ä»¬åªèƒ½çœ¼çççš„çœ‹ç€é’±æ‰“è¿›äººå‘˜æ‰‹ä¸Š,è¿˜å¥½é¢†å¯¼åœ¨äººå‘˜è·Ÿå‰,åŠæ—¶å¤„ç†å†²çº¢äº†è¿™ç¬”æµæ°´</p><hr><h2 id="æ’æŸ¥">æ’æŸ¥</h2><p>è¿½è¸ªäº†ä¸€ä¸‹ä¸šåŠ¡, ä¸šåŠ¡ç³»ç»Ÿæ¯30åˆ†é’Ÿä¼šè§¦å‘ä¸€æ¬¡æ”¯ä»˜ ( ä»˜æ¬¾æ–¹è´¦æˆ·é‡Œçš„é’±å¯èƒ½ä¸è¶³, æ‰€ä»¥éœ€è¦æ¯30åˆ†é’Ÿæ ¡éªŒè´¦æˆ·é’±æ˜¯å¦æ»¡è¶³æ”¯ä»˜ ) , æ°æ°åœ¨<strong>å®šæ—¶ä»»åŠ¡loadè¿›æ”¯ä»˜ä»»åŠ¡å,é¡µé¢åˆè§¦å‘äº†æ‰‹åŠ¨æ”¯ä»˜</strong>, å¯¼è‡´æ‰“æ¬¾é‡å¤</p><hr><h2 id="é˜²çº¿">é˜²çº¿</h2><h3 id="é˜²çº¿ä¹‹å‰">é˜²çº¿ä¹‹å‰</h3><p><strong>æ—¥å¿—</strong>çš„é‡è¦æ€§è¿™æ—¶å€™å°±ä½“ç°å‡ºæ¥äº†, å¥½åœ¨æ—¥å¿—æ˜¯æˆ‘å…¥èŒä»¥æ¥ä¸€ç›´åœ¨æ¨è¿›çš„æµç¨‹, æœ‰æ—¥å¿—å°±èƒ½å¿«é€Ÿå®šä½å¤ç›˜é—®é¢˜</p><h3 id="å‰ç«¯é˜²æŠ–">å‰ç«¯é˜²æŠ–</h3><p>é˜²æœ¬ä¸é˜²æ ¹</p><h3 id="ä»¤ç‰Œæœºåˆ¶">ä»¤ç‰Œæœºåˆ¶</h3><p>æ”¯ä»˜ç³»ç»Ÿä¸‹å‘ä»¤ç‰Œ, åªæœ‰åœ¨ä»¤ç‰Œæœ‰æ•ˆæœŸå†…æ‰èƒ½æ”¯ä»˜, ä»¤ç‰Œåªèƒ½ä½¿ç”¨ä¸€æ¬¡, ä»¤ç‰Œæ— æ•ˆè¿”å›é”™è¯¯</p><h3 id="è®¢å•å·å¤„ç†">è®¢å•å·å¤„ç†</h3><p>ä¸šåŠ¡ç³»ç»Ÿç”Ÿæˆçš„å•å·, æ”¯ä»˜ç³»ç»Ÿé’ˆå¯¹å•å·åšå¹‚ç­‰å¤„ç†, é‡å¤æäº¤ä¼šè¿”å›é”™è¯¯</p><h3 id="é¢„æ”¯ä»˜çŠ¶æ€">é¢„æ”¯ä»˜çŠ¶æ€</h3><p>æ”¯ä»˜ä¸­å¯èƒ½éœ€è¦æ’¤å›ç›¸åº”çš„æ”¯ä»˜ ( é¿å…çœ¼çç~~~ ), å› æ­¤å¯ä»¥è®¾è®¡å¤„äº<strong>3åˆ†é’Ÿ</strong>(åœ¨é£æ§ä¸­å¯é€æ­¥æé«˜)çš„é¢„æ”¯ä»˜çŠ¶æ€, ç³»ç»Ÿæ‰«æé¢„æ”¯ä»˜çŠ¶æ€çš„è®¢å•, å¦‚æœè¶…è¿‡<strong>3åˆ†é’Ÿ</strong>è¿˜å¤„äºé¢„æ”¯ä»˜çŠ¶æ€, å°±å¯¹å…¶è¿›è¡Œæ”¯ä»˜</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ€è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨ Bitwarden_RS æ„å»ºå±äºè‡ªå·±çš„å¯†ç ç®¡ç†å™¨</title>
    <link href="/2023/05/13/blog/article/the_bitwarden/"/>
    <url>/2023/05/13/blog/article/the_bitwarden/</url>
    
    <content type="html"><![CDATA[<h3 id="ç—›ç—›ç—›">ç—›ç—›ç—›</h3><p>ç”Ÿæ´»åœ¨äº’è”ç½‘ä¸Š, è´¦å·å¯†ç çš„è®°å½•çœŸçš„æ˜¯è®©äººå¤´ç–¼çš„é—®é¢˜, å„ç§ç½‘ç«™åº”ç”¨çš„ç™»å½•,ä¸åŒçš„è´¦å·å¯†ç è§„åˆ™,æœ‰æ—¶å€™è¿˜æœ‰åŒä¸€ä¸ªç½‘ç«™åº”ç”¨å¼€äº†å¤šå¥—è´¦å·</p><p>å› æ­¤,å¯†ç ç®¡ç†å™¨é¡ºåŠ¿è€Œå‡º,åªç”¨è®°ä½ä¸€ä¸ªä¸»å¯†ç ,å°±å¯ä»¥ç®¡ç†æ‰€æœ‰çš„è´¦å·å¯†ç </p><p>å¸‚é¢ä¸Šçš„å¯†ç ç®¡ç†å™¨æœ‰å¾ˆå¤š,éå¸¸æœ‰åçš„æœ‰1Password, LastPass, Dashlane, Bitwardenç­‰ç­‰,Vç«™ä¸Šæ¯ä¸ªæœˆéƒ½æœ‰è®¨è®ºè¿™æ–¹é¢çš„å¸–å­</p><p>åºŸè¯å¤šè¯´, åˆ†äº«ä¸€ä¸‹ä¸ªäººæ­å»ºçš„Bitwarden_RSä½¿ç”¨ä½“éªŒ</p><h3 id="Bitwarden-RS">Bitwarden_RS</h3><p>ä¸€ä¸ªdocker-compose.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">vaultwarden:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">vaultwarden/server:latest</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">WEBSOCKET_ENABLED=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SIGNUPS_ALLOWED=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ENABLE_PASSWORD_HINTS=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">SHOW_PASSWORD_HINT=true</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">PASSWORD_HINTS_REQUIRED=false</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;13123:80&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3012:3012&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">~/1ps/data:/data</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br></code></pre></td></tr></table></figure><p>SIGNUPS_ALLOWED=true å¼€å¯æ³¨å†Œ</p><p>ENABLE_PASSWORD_HINTS=true å¼€å¯å¯†ç æç¤º</p><p>SHOW_PASSWORD_HINT=true æ˜¾ç¤ºå¯†ç æç¤º</p><p>æœåŠ¡å™¨æ­å»ºå®Œæˆåœ¨ä½¿ç”¨nginxåä»£, åŠ ä¸ŠåŸŸå, å¥—ä¸ªhttps, å®Œç¾</p><p><strong>ä¸»é¡µ</strong><br><img src="/asset/blog/article/images/image.png" alt=""><br><strong>æ³¨å†Œ</strong><br><img src="/asset/blog/article/images/image1.png" alt=""></p><p><strong>å†…å®¹é¡µ</strong><br><img src="/asset/blog/article/images/image4.png" alt=""></p><p>åº”ç”¨/æ’ä»¶ä¸‹è½½åœ°å€</p><p><a href="https://bitwarden.com/download/">https://bitwarden.com/download/</a></p><p><strong>Chromeæ’ä»¶</strong><br><img src="/asset/blog/article/images/image2.png" alt=""></p><p><strong>å…ˆå†™è‡ªå»ºæœåŠ¡åœ°å€</strong><br><img src="/asset/blog/article/images/image3.png" alt=""></p><p>æ¥ä¸‹æ¥åœ¨å¸¸ç”¨ç½‘ç«™ç™»å½•å°±ä¼šæç¤ºä¿å­˜å¯†ç äº†</p><p>å¼ºçƒˆå¼€å¯å¯†ç å¡«å……</p><p>è¿™æ ·ä¸‹æ¬¡è¿›æ¥ç™»å½•é¡µé¢å°±ä¼šè‡ªåŠ¨å¡«å……è´¦å·å¯†ç äº†,éå¸¸æ»´æ–¹ä¾¿</p>]]></content>
    
    
    
    <tags>
      
      <tag>åˆ†äº«å‘ç°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>&lt;é€†å‘å­¦ä¹ å°è®°ä¹‹request headersè—äº†åŠ å¯†ä¿¡æ¯&gt;axiosæ‹¦æˆªå™¨ä¹‹axios.interceptors.request.use</title>
    <link href="/2023/04/06/blog/python/spider__interceptors_request_use/"/>
    <url>/2023/04/06/blog/python/spider__interceptors_request_use/</url>
    
    <content type="html"><![CDATA[<p>ç½‘ç«™</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">btoa</span>(<span class="hljs-string">&#x27;aHR0cHM6Ly95Z3AuZ2R6d2Z3Lmdvdi5jbi8jLzQ0MDYwMC9qeWdn&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ç½‘ç«™ä¸­æ‰€æœ‰è¯·æ±‚éƒ½å¸¦äº†</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">X-Dgi-Req-App</span><span class="hljs-punctuation">: </span>xxxx<br><span class="hljs-attribute">X-Dgi-Req-Nonce</span><span class="hljs-punctuation">: </span>xxx<br><span class="hljs-attribute">X-Dgi-Req-Signature</span><span class="hljs-punctuation">: </span>xxxxxxx<br><span class="hljs-attribute">X-Dgi-Req-Timestamp</span><span class="hljs-punctuation">: </span>xxx<br><br></code></pre></td></tr></table></figure><p>é”™è¯¯çš„ç­¾åæˆ–è€…æ²¡æœ‰ç­¾åéƒ½ä¼šå‡ºç°é”™è¯¯</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;errcode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">91000</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;errmsg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å‚æ•°ç­¾åå¼‚å¸¸&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>çœ‹çœ‹ç½‘ç«™jsæºç ,ä½¿ç”¨ axios å‘èµ·å“åº”è¯·æ±‚</p><p>å‘é€è¯·æ±‚å‰éƒ½ä¼šè®¾ç½® header æ·»åŠ åŠ å¯†ä¿¡æ¯, åœ¨Sourceé‡Œæœä¸€ä¸‹ interceptors.request.use</p><p>å¾—åˆ°äº†</p><p><img src="/asset/blog/python/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230331173735.png" alt="123"></p><p><code>function u(r)</code> å°±æ˜¯è®¾ç½® header æ·»åŠ åŠ å¯†å‚æ•°çš„æ–¹æ³•</p><p>åŸºæœ¬ä¸Šè¿½ä¸€ä¸‹å°±èƒ½æ‹¿å–åˆ°æƒ³ç”¨çš„ä¸œè¥¿äº†</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gorm ä¸­ä½¿ç”¨ Postgres çš„ json</title>
    <link href="/2023/03/06/blog/article/gorm_pgsql_json/"/>
    <url>/2023/03/06/blog/article/gorm_pgsql_json/</url>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹jsonæ–‡æ¡£ <a href="https://www.postgresql.org/docs/12/functions-json.html">https://www.postgresql.org/docs/12/functions-json.html</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;database/sql/driver&quot;</span><br><span class="hljs-string">&quot;encoding/json&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;gorm.io/driver/postgres&quot;</span><br><span class="hljs-string">&quot;gorm.io/gorm&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> db *gorm.DB<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initPgsql</span><span class="hljs-params">()</span></span> &#123;<br>dsn := <span class="hljs-string">&quot;host=192.168.163.121 user=postgres password=postgres dbname=test port=5432 sslmode=disable TimeZone=Asia/Shanghai&quot;</span><br><span class="hljs-keyword">var</span> err <span class="hljs-type">error</span><br>db, err = gorm.Open(postgres.Open(dsn), &amp;gorm.Config&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// User ç”¨æˆ·</span><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>gorm.Model<br>Name    <span class="hljs-type">string</span><br>Profile Profile <span class="hljs-string">`gorm:&quot;type:json&quot; json:&quot;profile&quot;`</span><br>&#125;<br><br><span class="hljs-comment">// Profile ä¸ªäººä¿¡æ¯</span><br><span class="hljs-keyword">type</span> Profile <span class="hljs-keyword">struct</span> &#123;<br>Email   <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;email&quot;`</span><br>PhoneNo <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;phoneNo&quot;`</span><br>&#125;<br><br><span class="hljs-comment">// Value å®ç°æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p Profile)</span></span> Value() (driver.Value, <span class="hljs-type">error</span>) &#123;<br><span class="hljs-keyword">return</span> json.Marshal(p)<br>&#125;<br><br><span class="hljs-comment">// Scan å®ç°æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(p *Profile)</span></span> Scan(input <span class="hljs-keyword">interface</span>&#123;&#125;) <span class="hljs-type">error</span> &#123;<br><span class="hljs-keyword">return</span> json.Unmarshal(input.([]<span class="hljs-type">byte</span>), p)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>initPgsql()<br>err := db.AutoMigrate(&amp;User&#123;&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>u := User&#123;<br>Name: <span class="hljs-string">&quot;maocat&quot;</span>,<br>Profile: Profile&#123;<br>Email:   <span class="hljs-string">&quot;maocatooo@gmail.com&quot;</span>,<br>PhoneNo: <span class="hljs-string">&quot;18888888888&quot;</span>,<br>&#125;,<br>&#125;<br>db.Save(&amp;u)<br><br>u.Profile.PhoneNo = <span class="hljs-string">&quot;13666666666&quot;</span><br>db.Save(&amp;u)<br><br><span class="hljs-keyword">var</span> u1 User<br><br>db.Debug().<br>Where(gorm.Expr(<span class="hljs-string">&quot;profile-&gt;&gt;&#x27;email&#x27; = ?&quot;</span>, <span class="hljs-string">&quot;maocatooo@gmail.com&quot;</span>)).<br>First(&amp;u1)<br>fmt.Println(u1.Name)<br>fmt.Println(u1.Profile)<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>Gorm</tag>
      
      <tag>Postgres</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç”¨åå°„é—­åŒ…äº†ä¸€ä¸‹ Gin çš„ HandlerFunc, æˆ‘ç»ˆäºå¯ä»¥å¼€å¼€å¿ƒå¿ƒçš„å†™å•å…ƒæµ‹è¯•äº†</title>
    <link href="/2023/03/06/blog/golang/gin_handlefunc/"/>
    <url>/2023/03/06/blog/golang/gin_handlefunc/</url>
    
    <content type="html"><![CDATA[<h3 id="center-ç”¨åå°„é—­åŒ…äº†ä¸€ä¸‹-Gin-çš„-HandlerFunc-æˆ‘ç»ˆäºå¯ä»¥å¼€å¼€å¿ƒå¿ƒçš„å†™å•å…ƒæµ‹è¯•äº†-center"><center> ç”¨åå°„é—­åŒ…äº†ä¸€ä¸‹ Gin çš„ HandlerFunc, æˆ‘ç»ˆäºå¯ä»¥å¼€å¼€å¿ƒå¿ƒçš„å†™å•å…ƒæµ‹è¯•äº† </center></h3><p>ä¸Šå®¶å…¬å¸æ˜¯ç”¨ go-micro å†™ rpc, ç°åœ¨è·‘è¿‡æ¥å†™ gin, å†™å•å…ƒæµ‹è¯•æ„é€ ç”¨ä¾‹å¯å¤ªéº»çƒ¦äº†</p><p>ç”¨åå°„å°è£…äº†ä¸€ä¸‹ï¼Œæˆ‘åˆå›åˆ°å½“åˆå†™å¾®æœåŠ¡çš„å¿«ä¹äº†</p><p>æ²¡æœ‰ç ´åè·¯ç”±ä¹Ÿæ²¡æœ‰ç ´åä¸­é—´ä»¶ï¼Œå°±åŠ äº† req å’Œ resp çš„åå°„å°è£…</p><p>åŸºä½¬é“¾æ¥: <a href="https://github.com/maocatooo/thin/tree/main/gin_handler">https://github.com/maocatooo/thin/tree/main/gin_handler</a></p><p>æ±‚ä¸ª star</p><p>åºŸè¯å¤šè¯´ï¼Œä¸Šä¸ªä¾‹å­</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">go</span> <span class="hljs-built_in">get</span> -<span class="hljs-keyword">u</span> github.<span class="hljs-keyword">com</span>/maocatooo/thin<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;github.com/maocatooo/thin/gin_handler&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Req <span class="hljs-keyword">struct</span> &#123;<br>Name <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Query <span class="hljs-keyword">struct</span> &#123;<br>Name <span class="hljs-type">string</span> <span class="hljs-string">`form:&quot;name&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Resp <span class="hljs-keyword">struct</span> &#123;<br>Code    <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;code&quot;`</span><br>Message <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;message&quot;`</span><br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">GET http://127.0.0.1:8080/ping?name=123</span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Ping</span><span class="hljs-params">(ctx *gin.Context, req *Query, rsp *Resp)</span></span> <span class="hljs-type">error</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;Ping req: %+v \n&quot;</span>, *req)<br><span class="hljs-keyword">if</span> req.Name == <span class="hljs-string">&quot;123&quot;</span> &#123;<br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;err 123&quot;</span>)<br>&#125;<br>rsp.Code = <span class="hljs-number">200</span><br>rsp.Message = req.Name<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-keyword">type</span> A <span class="hljs-keyword">struct</span> &#123;<br>a <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">POST http://127.0.0.1:8080/pong</span><br><span class="hljs-comment">&#123;</span><br><span class="hljs-comment">&quot;name&quot;:&quot;456&quot;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a A)</span></span> Pong(ctx *gin.Context, req *Req, rsp *Resp) <span class="hljs-type">error</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;Pong req: %+v \n&quot;</span>, *req)<br><span class="hljs-keyword">if</span> req.Name == <span class="hljs-string">&quot;123&quot;</span> &#123;<br><span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;123&quot;</span>)<br>&#125;<br>rsp.Code = <span class="hljs-number">200</span><br>rsp.Message = req.Name<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>r := gin.Default()<br>r.GET(<span class="hljs-string">&quot;/ping&quot;</span>, gin_handler.Query(Ping))<br>r.POST(<span class="hljs-string">&quot;/pong&quot;</span>, gin_handler.JSON(A&#123;a: <span class="hljs-string">&quot;a123&quot;</span>&#125;.Pong))<br>_ = r.Run()<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>Gin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è…¾è®¯ä¸€é¢ç»</title>
    <link href="/2023/02/27/%E9%9D%A2%E7%BB%8F/%E9%9D%A2%E7%BB%8F/"/>
    <url>/2023/02/27/%E9%9D%A2%E7%BB%8F/%E9%9D%A2%E7%BB%8F/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢ç»">é¢ç»</h3><p>è…¾è®¯ç¤¾æ‹›ä¸€é¢</p><ul><li>tpcå’ŒudpåŒºåˆ«</li><li>tcpå¦‚ä½•ä¿è¯å¯é ä¼ è¾“</li><li>ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹</li><li>å››æ¬¡æŒ¥æ‰‹</li><li>TIME_WAIT ä¸ºä»€ä¹ˆè¦ç­‰å¾…2MSL</li><li>Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿« (å¤šä¸ªæƒ…å†µ)</li><li>Redis çƒ­key</li><li>Redis å’Œ MongoDBåŒºåˆ«</li><li>MySQL æ•°æ®åº“SQLæ‰§è¡Œæµç¨‹</li><li>MySQL èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼• åŒºåˆ«</li><li>MySQL å›è¡¨</li><li>MySQL ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ</li><li>è´Ÿè´£æœåŠ¡çš„QPS</li><li>å»ºç«‹ç´¢å¼•å, å¦‚ä½•ä¼˜åŒ–SQL</li><li>ä¸€ä¸ªäº¿çš„ç”¨æˆ·ä¿¡æ¯è¡¨å¦‚ä½•åˆ†åº“åˆ†è¡¨</li><li>Kafka é‡å¹³è¡¡</li><li>Golang GMP</li><li>Golang STWæ—¶æœº</li><li>Golang é¡¹ç›®ç”¨é‡åˆ°å†…å­˜å˜å¤§æƒ…å†µï¼Œå¦‚ä½•è°ƒè¯•</li><li>Golang é€ƒé€¸åˆ†æ (å¤šä¸ªæƒ…å†µ)</li><li>20åˆ†é’Ÿç®—æ³•ï¼ˆä¸¤ä¸ªé“¾è¡¨ç›¸åŠ  <a href="https://leetcode.cn/problems/lMSNwu/%EF%BC%89">https://leetcode.cn/problems/lMSNwu/ï¼‰</a></li></ul><p>é¢è¯•å®˜è¯„ä»·ï¼ŒåŸºç¡€ä¸å¥½ï¼Œä¸­é—´ä»¶åº•å±‚åŸç†ç†è§£ä¸å¤Ÿæ·±å…¥</p>]]></content>
    
    
    
    <tags>
      
      <tag>é¢ç»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†è§ 2022, 2022 æ€»ç»“</title>
    <link href="/2023/02/01/blog/article/summary_by_2022/"/>
    <url>/2023/02/01/blog/article/summary_by_2022/</url>
    
    <content type="html"><![CDATA[<h4 id="2022å¹´">2022å¹´</h4><p>2022å¹´, å› ä¸ºç–«æƒ…ä¸€æœˆè¢«å°åˆ°è¿‡å¹´,ä¸­é—´æ–­æ–­ç»­ç»­ä¹Ÿæ˜¯å› ä¸ºç–«æƒ…è¢«å°åœ¨å®¶é‡Œå‡ æ¬¡,12æœˆæ”¾å¼€ä¹Ÿæ˜¯è¿…é€Ÿçš„é˜³äº†,å› ä¸ºå…¬å¸æ˜¯å†…ç½‘å¼€å‘,ä¸”ä¸èƒ½è¿œç¨‹åŠå…¬,å¯¼è‡´è¢«å°åœ¨å®¶çš„æ—¶é—´åªèƒ½ä»å‘¨å†…æ™šä¸Šã€å‘¨æœ«æ¥è¡¥,ä¹Ÿæ˜¯è®©æˆ‘çœŸæ­£ä½“ä¼šåˆ°äº†ä»€ä¹ˆæ˜¯996</p><p>2022å¹´9æœˆè€æ¿æ„å¤–å»ä¸–, 12æœˆè€æ¿å¨˜æ·±å¤œçªç„¶æ¬ç©ºå…¬å¸æœºæˆ¿, å¯¼è‡´é¡ºåˆ©å¤±ä¸š</p><h4 id="å·¥ä½œ">å·¥ä½œ</h4><ol><li>æ‹¿åˆ°äº†2021å¹´å…¬å¸ä¼˜ç§€å‘˜å·¥ä¹‹ä¸€, ç®—æ˜¯å¯¹2021çš„äº¤ä»£</li><li>å®Œå–„äº†å…¬å¸ Golang ç«¯ Core, Plugin ä»£ç åº“, å°è£…äº†å¾ˆå¤šä¸šåŠ¡åŠŸèƒ½, æ¡†æ¶åº“</li><li>ç€æ‰‹å¼€å‘äº†ç®€æ˜“ç‰ˆåŸºäºGitLab Apiçš„DevOpsç³»ç»Ÿ, ç”¨æ¥å¿«é€Ÿå‘å¸ƒç‰ˆæœ¬</li></ol><p>å¾…å®Œå–„:<br>ä¸šåŠ¡ä¸Šæ²¡æœ‰åŠæ—¶å¤šæ²Ÿé€šé—®é¢˜, å¯¼è‡´éƒ¨åˆ†åŠŸèƒ½å¤šæ¬¡è¿”å·¥,</p><h4 id="æŠ€æœ¯">æŠ€æœ¯</h4><ol><li>åˆ©ç”¨ç–«æƒ…å°åœ¨å®¶çš„æ—¶é—´å­¦ä¹ äº†K8SåŸºç¡€,<a href="http://xn--K3Smaocat-pb6nnd28d7dn36ajvz2w0a23e260j93wb5qmi77esqua.cc">å¹¶ä¸”åœ¨è‰¯å¿ƒäº‘ä¸Šç”¨K3Sé•œåƒéƒ¨ç½²äº†maocat.cc</a></li><li>å…¥é—¨äº†Kafka, ä¹Ÿæ˜¯å…ˆç”¨ä¸Š, å†æ·±å…¥</li><li>æ‰“ç®—å¼€æºå±äºè‡ªå·±çš„ Golang tool package</li></ol><p>ä¹‹å‰å¥—è·¯äº‘æ²¡æœ‰ç»­è´¹,å¯¼è‡´è‡ªå»ºçš„blogæ²¡æœ‰å¤‡ä»½æ•°æ®,å¿ƒç—›,äºæ˜¯æš‚æ—¶ä½¿ç”¨gitbookæ¥å†™blog,é¡ºä¾¿è®°ä¸€äº›ç¬”è®°</p><p>å› ä¸ºå…¨å¹´éƒ½åœ¨996, å…¬å¸ä¹Ÿæ˜¯å†…ç½‘å¼€å‘, å¯¼è‡´æ²¡æœ‰å¤ªå¤šæ—¶é—´å»å­¦ä¹ ã€æ¥è§¦æŠ€æœ¯(éƒ½æ˜¯å€Ÿå£/dog)</p><h4 id="ç”Ÿæ´»">ç”Ÿæ´»</h4><ol><li>ç»ˆäºé¢†å…»äº†ä¸€åªçŒ«å’ª(æˆ‘ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰çˆ±å¿ƒçš„ç”·äººäº†)</li><li>æ‹¿åˆ°æ‘©æ‰˜è½¦é©¾ç…§</li><li>å¨è‰ºå¤§å¹…åº¦å¢é•¿, å·²ç»å¯ä»¥è‡ªå·±åšé¢é£Ÿäº†</li></ol><p>2022å¹´æ³¨å®šå¯’å†¬, å¸Œæœ›æ–°çš„ä¸€å¹´èƒ½äº‹äº‹é¡ºåˆ©</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ€è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang å†…å­˜ç®¡ç†</title>
    <link href="/2023/01/07/golang/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    <url>/2023/01/07/golang/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="å †å†…å­˜">å †å†…å­˜</h2><p>arena(64MB) -&gt; 8192 page(8KB)</p><p>span -&gt; N page(ä¸€ä¸ªspanåŒ…å«å¤šä¸ªpage)-&gt; M å†…å­˜å—(ä¸€ä¸ªspanç­‰åˆ†Mä¸ªå†…å­˜å—)</p><p>Go è¯­è¨€çš„å†…å­˜ç®¡ç†æ¨¡å—ä¸­ä¸€å…±åŒ…å« 67 ç§è·¨åº¦ç±»<br>spanclass1 - 8B<br>â€¦<br>spanclass67 - 32KB</p><p>spanclass 0 è¡¨ç¤ºå¤§äº32KBçš„å¤§å—å†…å­˜</p><ul><li>å¾®å¯¹è±¡ (0, 16B) â€” å…ˆä½¿ç”¨å¾®å‹åˆ†é…å™¨ï¼Œå†ä¾æ¬¡å°è¯•çº¿ç¨‹ç¼“å­˜ã€ä¸­å¿ƒç¼“å­˜å’Œå †åˆ†é…å†…å­˜ï¼›</li><li>å°å¯¹è±¡ [16B, 32KB] â€” ä¾æ¬¡å°è¯•ä½¿ç”¨çº¿ç¨‹ç¼“å­˜ã€ä¸­å¿ƒç¼“å­˜å’Œå †åˆ†é…å†…å­˜ï¼›</li><li>å¤§å¯¹è±¡ (32KB, +âˆ) â€” ç›´æ¥åœ¨å †ä¸Šåˆ†é…å†…å­˜</li></ul><h3 id="å †æ ˆå†…å­˜">å †æ ˆå†…å­˜</h3><p>ç¨‹åºä¸­çš„æ•°æ®å’Œå˜é‡éƒ½ä¼šè¢«åˆ†é…åˆ°ç¨‹åºæ‰€åœ¨çš„è™šæ‹Ÿå†…å­˜ä¸­, å†…å­˜ç©ºé—´åŒ…å«ä¸¤ä¸ªé‡è¦åŒºåŸŸï¼šæ ˆåŒºï¼ˆStackï¼‰å’Œå †åŒºï¼ˆHeapï¼‰ã€‚</p><p>æ ˆçš„å­˜å–é€Ÿåº¦æ¯”å †è¦å¿«, ä½†æ˜¯ç¼ºä¹çµæ´»æ€§, æ ˆä¸­æ•°æ®å¤§å°å’Œç”Ÿå‘½å‘¨æœŸæ˜¯ç¡®å®šçš„å®šçš„, å‡½æ•°è°ƒç”¨çš„å‚æ•°ã€è¿”å›å€¼ä»¥åŠå±€éƒ¨å˜é‡å¤§éƒ½ä¼šè¢«åˆ†é…åˆ°æ ˆä¸Š, è¿™éƒ¨åˆ†å†…å­˜ä¼šç”±ç¼–è¯‘å™¨è¿›è¡Œç®¡ç†</p><p>ä¸åŒç¼–ç¨‹è¯­è¨€ä½¿ç”¨ä¸åŒçš„æ–¹æ³•ç®¡ç†å †åŒºçš„å†…å­˜, C++ ç­‰ç¼–ç¨‹è¯­è¨€ä¼šç”±å·¥ç¨‹å¸ˆä¸»åŠ¨ç”³è¯·å’Œé‡Šæ”¾å†…å­˜, Go ä»¥åŠ Java ç­‰ç¼–ç¨‹è¯­è¨€ä¼šç”±å·¥ç¨‹å¸ˆå’Œç¼–è¯‘å™¨å…±åŒç®¡ç†, å †ä¸­çš„å¯¹è±¡ç”±å†…å­˜åˆ†é…å™¨åˆ†é…å¹¶ç”±åƒåœ¾æ”¶é›†å™¨å›æ”¶, ç¼ºç‚¹æ˜¯å†…å­˜åˆ†é…ç®¡ç†ä¼šå ç”¨èµ„æº, é€Ÿåº¦æ…¢, è€Œä¸”ä¼šå‡ºç°å†…å­˜ç¢ç‰‡å’Œï¼ˆå †ï¼‰å†…å­˜æº¢å‡º</p><p>å †ä¸Šæ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šé€šè¿‡è°ƒç”¨ runtime.newobject å‡½æ•°åˆ†é…å†…å­˜, è¯¥å‡½æ•°ä¼šè°ƒç”¨</p><h3 id="é€ƒé€¸åˆ†æ">é€ƒé€¸åˆ†æ</h3><p>åœ¨ç¼–è¯‘å™¨ä¼˜åŒ–ä¸­, é€ƒé€¸åˆ†ææ˜¯ç”¨æ¥å†³å®šæŒ‡é’ˆåŠ¨æ€ä½œç”¨åŸŸçš„æ–¹æ³•ã€‚Go è¯­è¨€çš„ç¼–è¯‘å™¨ä½¿ç”¨é€ƒé€¸åˆ†æå†³å®šå“ªäº›å˜é‡åº”è¯¥åœ¨æ ˆä¸Šåˆ†é…, å“ªäº›å˜é‡åº”è¯¥åœ¨å †ä¸Šåˆ†é…, å…¶ä¸­åŒ…æ‹¬ä½¿ç”¨ newã€make å’Œå­—é¢é‡ç­‰æ–¹æ³•éšå¼åˆ†é…çš„å†…å­˜, Go è¯­è¨€çš„é€ƒé€¸åˆ†æéµå¾ªä»¥ä¸‹ä¸¤ä¸ªä¸å˜æ€§ï¼š</p><ul><li>æŒ‡å‘æ ˆå¯¹è±¡çš„æŒ‡é’ˆä¸èƒ½å­˜åœ¨äºå †ä¸­ï¼›</li><li>æŒ‡å‘æ ˆå¯¹è±¡çš„æŒ‡é’ˆä¸èƒ½åœ¨æ ˆå¯¹è±¡å›æ”¶åå­˜æ´»ï¼›</li></ul><p>å˜é‡æ˜¯å¦ä¼šè¢«å‡½æ•°å¤–éƒ¨å¼•ç”¨å†³å®šäº†å †æ ˆå†…å­˜çš„åˆ†é…, å¦‚æœå¤–éƒ¨æ²¡æœ‰å¼•ç”¨, é‚£ä¹ˆå¯¹è±¡ä¼˜å…ˆåˆ›å»ºåœ¨æ ˆå†…å­˜, å¦‚æœå¤–éƒ¨ç¡®å®šäº†å¼•ç”¨, é‚£ä¹ˆå¯¹è±¡å¿…å®šä¼šåˆ›å»ºåœ¨å †å†…å­˜, ç¼–è¯‘å™¨å¹¶ä¸èƒ½ç¡®å®šæ˜¯å¦ä¼šè¢«å¤–éƒ¨å¼•ç”¨, é‚£ä¹ˆä¹Ÿä¼šåˆ›å»ºåœ¨å †å†…å­˜ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">go build -gcflags &quot;-m -l&quot; common.go<br>go tool compile -S common.go<br></code></pre></td></tr></table></figure><h4 id="åœºæ™¯">åœºæ™¯</h4><ol><li><p>å‡½æ•°è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆ</p></li><li><p>æ ˆç©ºé—´ä¸è¶³</p></li><li><p>å˜é‡å¤§å°ä¸ç¡®å®š, å¦‚åˆ›å»º åˆ‡ç‰‡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">a := <span class="hljs-number">10</span><br>l := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, a)<br></code></pre></td></tr></table></figure></li><li><p>ç©ºæ¥å£ç±»å‹ï¼Œå‡½æ•°å‚æ•°æ˜¯ç©ºæ¥å£ç±»å‹</p></li><li><p>é—­åŒ…å‡½æ•°</p></li></ol><h3 id="åƒåœ¾å›æ”¶">åƒåœ¾å›æ”¶</h3><h1>STW</h1><p>éšç€ç”¨æˆ·ç¨‹åºç”³è¯·è¶Šæ¥è¶Šå¤šçš„å†…å­˜, ç³»ç»Ÿä¸­çš„åƒåœ¾ä¹Ÿé€æ¸å¢å¤šï¼›å½“ç¨‹åºçš„å†…å­˜å ç”¨è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶, æ•´ä¸ªåº”ç”¨ç¨‹åºå°±ä¼šå…¨éƒ¨æš‚åœ, åƒåœ¾æ”¶é›†å™¨ä¼šæ‰«æå·²ç»åˆ†é…çš„æ‰€æœ‰å¯¹è±¡å¹¶å›æ”¶ä¸å†ä½¿ç”¨çš„å†…å­˜ç©ºé—´, å½“è¿™ä¸ªè¿‡ç¨‹ç»“æŸå, ç”¨æˆ·ç¨‹åºæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œ, å‡ºç°äº†æš‚åœç¨‹åºï¼ˆStop the world, STWï¼‰é—®é¢˜</p><h4 id="æ ‡è®°æ¸…é™¤">æ ‡è®°æ¸…é™¤</h4><p>æ ‡è®°æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•æ˜¯æœ€å¸¸è§çš„åƒåœ¾æ”¶é›†ç®—æ³•, æ ‡è®°æ¸…é™¤æ”¶é›†å™¨æ˜¯è·Ÿè¸ªå¼åƒåœ¾æ”¶é›†å™¨, å…¶æ‰§è¡Œè¿‡ç¨‹å¯ä»¥åˆ†æˆæ ‡è®°ï¼ˆMarkï¼‰å’Œæ¸…é™¤ï¼ˆSweepï¼‰ä¸¤ä¸ªé˜¶æ®µï¼š</p><ul><li>æ ‡è®°é˜¶æ®µ â€” ä»æ ¹å¯¹è±¡å‡ºå‘æŸ¥æ‰¾å¹¶æ ‡è®°å †ä¸­æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼›</li><li>æ¸…é™¤é˜¶æ®µ â€” éå†å †ä¸­çš„å…¨éƒ¨å¯¹è±¡, å›æ”¶æœªè¢«æ ‡è®°çš„åƒåœ¾å¯¹è±¡å¹¶å°†å›æ”¶çš„å†…å­˜åŠ å…¥ç©ºé—²é“¾è¡¨</li></ul><h3 id="ä¸‰è‰²æŠ½è±¡">ä¸‰è‰²æŠ½è±¡</h3><p>ä¸ºäº†è§£å†³åŸå§‹æ ‡è®°æ¸…é™¤ç®—æ³•å¸¦æ¥çš„é•¿æ—¶é—´STW, å¤šæ•°ç°ä»£çš„è¿½è¸ªå¼åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šå®ç°ä¸‰è‰²æ ‡è®°ç®—æ³•çš„å˜ç§ä»¥ç¼©çŸ­ STW çš„æ—¶é—´ã€‚ä¸‰è‰²æ ‡è®°ç®—æ³•å°†ç¨‹åºä¸­çš„å¯¹è±¡åˆ†æˆç™½è‰²ã€é»‘è‰²å’Œç°è‰²ä¸‰ç±»4ï¼š</p><ul><li>ç™½è‰²å¯¹è±¡ â€” æ½œåœ¨çš„åƒåœ¾, å…¶å†…å­˜å¯èƒ½ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼›</li><li>é»‘è‰²å¯¹è±¡ â€” æ´»è·ƒçš„å¯¹è±¡, åŒ…æ‹¬ä¸å­˜åœ¨ä»»ä½•å¼•ç”¨å¤–éƒ¨æŒ‡é’ˆçš„å¯¹è±¡ä»¥åŠä»æ ¹å¯¹è±¡å¯è¾¾çš„å¯¹è±¡ï¼›</li><li>ç°è‰²å¯¹è±¡ â€” æ´»è·ƒçš„å¯¹è±¡, å› ä¸ºå­˜åœ¨æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¤–éƒ¨æŒ‡é’ˆ, åƒåœ¾æ”¶é›†å™¨ä¼šæ‰«æè¿™äº›å¯¹è±¡çš„å­å¯¹è±¡ï¼›</li></ul><p>åœ¨åƒåœ¾æ”¶é›†å™¨å¼€å§‹å·¥ä½œæ—¶, ç¨‹åºä¸­ä¸å­˜åœ¨ä»»ä½•çš„é»‘è‰²å¯¹è±¡, åƒåœ¾æ”¶é›†çš„æ ¹å¯¹è±¡ä¼šè¢«æ ‡è®°æˆç°è‰², åƒåœ¾æ”¶é›†å™¨åªä¼šä»ç°è‰²å¯¹è±¡é›†åˆä¸­å–å‡ºå¯¹è±¡å¼€å§‹æ‰«æ, å½“ç°è‰²é›†åˆä¸­ä¸å­˜åœ¨ä»»ä½•å¯¹è±¡æ—¶, æ ‡è®°é˜¶æ®µå°±ä¼šç»“æŸ</p><p>ä¸‰è‰²æ ‡è®°åƒåœ¾æ”¶é›†å™¨çš„å·¥ä½œåŸç†å¾ˆç®€å•, å½’çº³æˆä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä»ç°è‰²å¯¹è±¡çš„é›†åˆä¸­é€‰æ‹©ä¸€ä¸ªç°è‰²å¯¹è±¡å¹¶å°†å…¶æ ‡è®°æˆé»‘è‰²ï¼›</li><li>å°†é»‘è‰²å¯¹è±¡æŒ‡å‘çš„æ‰€æœ‰å¯¹è±¡éƒ½æ ‡è®°æˆç°è‰², ä¿è¯è¯¥å¯¹è±¡å’Œè¢«è¯¥å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ï¼›</li><li>é‡å¤ä¸Šè¿°ä¸¤ä¸ªæ­¥éª¤ç›´åˆ°å¯¹è±¡å›¾ä¸­ä¸å­˜åœ¨ç°è‰²å¯¹è±¡ï¼›</li></ul><p><img src="/asset/golang/images/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4.png" alt="sanse"></p><p><img src="/asset/golang/images/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A42.png" alt="sanse"><br>å› ä¸ºç”¨æˆ·ç¨‹åºå¯èƒ½åœ¨æ ‡è®°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¿®æ”¹å¯¹è±¡çš„æŒ‡é’ˆ, æ‰€ä»¥ä¸‰è‰²æ ‡è®°æ¸…é™¤ç®—æ³•æœ¬èº«æ˜¯ä¸å¯ä»¥å¹¶å‘æˆ–è€…å¢é‡æ‰§è¡Œçš„, å®ƒä»ç„¶éœ€è¦ STW, åœ¨å¦‚ä¸‹æ‰€ç¤ºçš„ä¸‰è‰²æ ‡è®°è¿‡ç¨‹ä¸­, ç”¨æˆ·ç¨‹åºå»ºç«‹äº†ä» A å¯¹è±¡åˆ° D å¯¹è±¡çš„å¼•ç”¨, ä½†æ˜¯å› ä¸ºç¨‹åºä¸­å·²ç»ä¸å­˜åœ¨ç°è‰²å¯¹è±¡äº†, æ‰€ä»¥ D å¯¹è±¡ä¼šè¢«åƒåœ¾æ”¶é›†å™¨é”™è¯¯åœ°å›æ”¶</p><p><img src="/asset/golang/images/%E4%B8%89%E8%89%B2%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A43.png" alt="sanse"><br>æœ¬æ¥ä¸åº”è¯¥è¢«å›æ”¶çš„å¯¹è±¡å´è¢«å›æ”¶äº†, è¿™åœ¨å†…å­˜ç®¡ç†ä¸­æ˜¯éå¸¸ä¸¥é‡çš„é”™è¯¯, æˆ‘ä»¬å°†è¿™ç§é”™è¯¯ç§°ä¸ºæ‚¬æŒ‚æŒ‡é’ˆ, å³æŒ‡é’ˆæ²¡æœ‰æŒ‡å‘ç‰¹å®šç±»å‹çš„åˆæ³•å¯¹è±¡, å½±å“äº†å†…å­˜çš„å®‰å…¨æ€§, æƒ³è¦å¹¶å‘æˆ–è€…å¢é‡åœ°æ ‡è®°å¯¹è±¡è¿˜æ˜¯éœ€è¦ä½¿ç”¨å±éšœæŠ€æœ¯</p><h3 id="å±éšœæŠ€æœ¯">å±éšœæŠ€æœ¯</h3><p>å†…å­˜å±éšœæŠ€æœ¯æ˜¯ä¸€ç§å±éšœæŒ‡ä»¤, å®ƒå¯ä»¥è®© CPU æˆ–è€…ç¼–è¯‘å™¨åœ¨æ‰§è¡Œå†…å­˜ç›¸å…³æ“ä½œæ—¶éµå¾ªç‰¹å®šçš„çº¦æŸ, ç›®å‰å¤šæ•°çš„ç°ä»£å¤„ç†å™¨éƒ½ä¼šä¹±åºæ‰§è¡ŒæŒ‡ä»¤ä»¥æœ€å¤§åŒ–æ€§èƒ½, ä½†æ˜¯è¯¥æŠ€æœ¯èƒ½å¤Ÿä¿è¯å†…å­˜æ“ä½œçš„é¡ºåºæ€§, åœ¨å†…å­˜å±éšœå‰æ‰§è¡Œçš„æ“ä½œä¸€å®šä¼šå…ˆäºå†…å­˜å±éšœåæ‰§è¡Œçš„æ“ä½œ</p><p>æƒ³è¦åœ¨å¹¶å‘æˆ–è€…å¢é‡çš„æ ‡è®°ç®—æ³•ä¸­ä¿è¯æ­£ç¡®æ€§, æˆ‘ä»¬éœ€è¦è¾¾æˆä»¥ä¸‹ä¸¤ç§ä¸‰è‰²ä¸å˜æ€§ï¼ˆTri-color invariantï¼‰ä¸­çš„ä¸€ç§ï¼š</p><ul><li>å¼ºä¸‰è‰²ä¸å˜æ€§ â€” é»‘è‰²å¯¹è±¡ä¸ä¼šæŒ‡å‘ç™½è‰²å¯¹è±¡, åªä¼šæŒ‡å‘ç°è‰²å¯¹è±¡æˆ–è€…é»‘è‰²å¯¹è±¡ï¼›</li><li>å¼±ä¸‰è‰²ä¸å˜æ€§ â€” é»‘è‰²å¯¹è±¡æŒ‡å‘çš„ç™½è‰²å¯¹è±¡å¿…é¡»åŒ…å«ä¸€æ¡ä»ç°è‰²å¯¹è±¡ç»ç”±å¤šä¸ªç™½è‰²å¯¹è±¡çš„å¯è¾¾è·¯å¾„</li></ul><h4 id="æ’å…¥å†™å±éšœ">æ’å…¥å†™å±éšœ</h4><p><img src="/asset/golang/images/%E6%8F%92%E5%85%A5%E5%86%99%E5%B1%8F%E9%9A%9C.png" alt="æ’å…¥å†™å±éšœ"></p><p>æ’å…¥å†™å±éšœ, åœ¨ä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨å’Œç”¨æˆ·ç¨‹åºäº¤æ›¿è¿è¡Œçš„åœºæ™¯ä¸­ä¼šå‡ºç°å¦‚ä¸Šå›¾æ‰€ç¤ºçš„æ ‡è®°è¿‡ç¨‹ï¼š</p><ul><li>åƒåœ¾æ”¶é›†å™¨å°†æ ¹å¯¹è±¡æŒ‡å‘ A å¯¹è±¡æ ‡è®°æˆé»‘è‰²å¹¶å°† A å¯¹è±¡æŒ‡å‘çš„å¯¹è±¡ B æ ‡è®°æˆç°è‰²ï¼›</li><li>ç”¨æˆ·ç¨‹åºä¿®æ”¹ A å¯¹è±¡çš„æŒ‡é’ˆ, å°†åŸæœ¬æŒ‡å‘ B å¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘ C å¯¹è±¡, è¿™æ—¶è§¦å‘å†™å±éšœå°† C å¯¹è±¡æ ‡è®°æˆç°è‰²ï¼›</li><li>åƒåœ¾æ”¶é›†å™¨ä¾æ¬¡éå†ç¨‹åºä¸­çš„å…¶ä»–ç°è‰²å¯¹è±¡, å°†å®ƒä»¬åˆ†åˆ«æ ‡è®°æˆé»‘è‰²</li></ul><p>æ’å…¥å†™å±éšœæ˜¯ä¸€ç§ç›¸å¯¹ä¿å®ˆçš„å±éšœæŠ€æœ¯, å®ƒä¼šå°†æœ‰å­˜æ´»å¯èƒ½çš„å¯¹è±¡éƒ½æ ‡è®°æˆç°è‰²ä»¥æ»¡è¶³å¼ºä¸‰è‰²ä¸å˜æ€§ã€‚åœ¨å¦‚ä¸Šæ‰€ç¤ºçš„åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­, å®é™…ä¸Šä¸å†å­˜æ´»çš„ B å¯¹è±¡æœ€åæ²¡æœ‰è¢«å›æ”¶ï¼›è€Œå¦‚æœæˆ‘ä»¬åœ¨ç¬¬äºŒå’Œç¬¬ä¸‰æ­¥ä¹‹é—´å°†æŒ‡å‘ C å¯¹è±¡çš„æŒ‡é’ˆæ”¹å›æŒ‡å‘ B, åƒåœ¾æ”¶é›†å™¨ä»ç„¶è®¤ä¸º C å¯¹è±¡æ˜¯å­˜æ´»çš„, è¿™äº›è¢«é”™è¯¯æ ‡è®°çš„åƒåœ¾å¯¹è±¡åªæœ‰åœ¨ä¸‹ä¸€ä¸ªå¾ªç¯æ‰ä¼šè¢«å›æ”¶ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">writePointer(slot, ptr)<br>    shade(*slot)<br>    *slot = ptr<br></code></pre></td></tr></table></figure><p>æ’å…¥å¼å†™å±éšœè™½ç„¶å®ç°éå¸¸ç®€å•å¹¶ä¸”ä¹Ÿèƒ½ä¿è¯å¼ºä¸‰è‰²ä¸å˜æ€§, ä½†æ˜¯å®ƒä¹Ÿæœ‰æ˜æ˜¾çš„ç¼ºç‚¹ã€‚å› ä¸ºæ ˆä¸Šçš„å¯¹è±¡åœ¨åƒåœ¾æ”¶é›†ä¸­ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯æ ¹å¯¹è±¡, æ‰€ä»¥ä¸ºäº†ä¿è¯å†…å­˜çš„å®‰å…¨, Dijkstra å¿…é¡»ä¸ºæ ˆä¸Šçš„å¯¹è±¡å¢åŠ å†™å±éšœæˆ–è€…åœ¨æ ‡è®°é˜¶æ®µå®Œæˆé‡æ–°å¯¹æ ˆä¸Šçš„å¯¹è±¡è¿›è¡Œæ‰«æ, è¿™ä¸¤ç§æ–¹æ³•å„æœ‰å„çš„ç¼ºç‚¹, å‰è€…ä¼šå¤§å¹…åº¦å¢åŠ å†™å…¥æŒ‡é’ˆçš„é¢å¤–å¼€é”€, åè€…é‡æ–°æ‰«ææ ˆå¯¹è±¡æ—¶éœ€è¦æš‚åœç¨‹åº, åƒåœ¾æ”¶é›†ç®—æ³•çš„è®¾è®¡è€…éœ€è¦åœ¨è¿™ä¸¤è€…ä¹‹å‰åšå‡ºæƒè¡¡</p><h4 id="åˆ é™¤å†™å±éšœ">åˆ é™¤å†™å±éšœ</h4><p><img src="/asset/golang/images/%E5%88%A0%E9%99%A4%E5%86%99%E5%B1%8F%E9%9A%9C.png" alt="åˆ é™¤å†™å±éšœ"></p><p>å‡è®¾æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ Yuasa æå‡ºçš„åˆ é™¤å†™å±éšœ, åœ¨ä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨å’Œç”¨æˆ·ç¨‹åºäº¤æ›¿è¿è¡Œçš„åœºæ™¯ä¸­ä¼šå‡ºç°å¦‚ä¸Šå›¾æ‰€ç¤ºçš„æ ‡è®°è¿‡ç¨‹ï¼š</p><p>åƒåœ¾æ”¶é›†å™¨å°†æ ¹å¯¹è±¡æŒ‡å‘ A å¯¹è±¡æ ‡è®°æˆé»‘è‰²å¹¶å°† A å¯¹è±¡æŒ‡å‘çš„å¯¹è±¡ B æ ‡è®°æˆç°è‰²ï¼›</p><ul><li>ç”¨æˆ·ç¨‹åºå°† A å¯¹è±¡åŸæœ¬æŒ‡å‘ B çš„æŒ‡é’ˆæŒ‡å‘ C, è§¦å‘åˆ é™¤å†™å±éšœ, ä½†æ˜¯å› ä¸º B å¯¹è±¡å·²ç»æ˜¯ç°è‰²çš„, æ‰€ä»¥ä¸åšæ”¹å˜ï¼›</li><li>ç”¨æˆ·ç¨‹åºå°† B å¯¹è±¡åŸæœ¬æŒ‡å‘ C çš„æŒ‡é’ˆåˆ é™¤, è§¦å‘åˆ é™¤å†™å±éšœ, ç™½è‰²çš„ C å¯¹è±¡è¢«æ¶‚æˆç°è‰²ï¼›</li><li>åƒåœ¾æ”¶é›†å™¨ä¾æ¬¡éå†ç¨‹åºä¸­çš„å…¶ä»–ç°è‰²å¯¹è±¡, å°†å®ƒä»¬åˆ†åˆ«æ ‡è®°æˆé»‘è‰²</li></ul><p>å› ä¸ºå¢é‡å’Œå¹¶å‘ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ä¸ç”¨æˆ·ç¨‹åºäº¤æ›¿è¿è¡Œ, æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨å±éšœæŠ€æœ¯ä¿è¯åƒåœ¾æ”¶é›†çš„æ­£ç¡®æ€§ï¼›ä¸æ­¤åŒæ—¶, åº”ç”¨ç¨‹åºä¹Ÿä¸èƒ½ç­‰åˆ°å†…å­˜æº¢å‡ºæ—¶è§¦å‘åƒåœ¾æ”¶é›†, å› ä¸ºå½“å†…å­˜ä¸è¶³æ—¶, åº”ç”¨ç¨‹åºå·²ç»æ— æ³•åˆ†é…å†…å­˜, è¿™ä¸ç›´æ¥æš‚åœç¨‹åºæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«, å¢é‡å’Œå¹¶å‘çš„åƒåœ¾æ”¶é›†éœ€è¦æå‰è§¦å‘å¹¶åœ¨å†…å­˜ä¸è¶³å‰å®Œæˆæ•´ä¸ªå¾ªç¯, é¿å…ç¨‹åºçš„é•¿æ—¶é—´æš‚åœ</p><h4 id="æ··åˆå†™å±éšœ">æ··åˆå†™å±éšœ</h4><p>åœ¨ Go è¯­è¨€ v1.7 ç‰ˆæœ¬ä¹‹å‰, è¿è¡Œæ—¶ä¼šä½¿ç”¨ Dijkstra æ’å…¥å†™å±éšœä¿è¯å¼ºä¸‰è‰²ä¸å˜æ€§, ä½†æ˜¯è¿è¡Œæ—¶å¹¶æ²¡æœ‰åœ¨æ‰€æœ‰çš„åƒåœ¾æ”¶é›†æ ¹å¯¹è±¡ä¸Šå¼€å¯æ’å…¥å†™å±éšœã€‚å› ä¸ºåº”ç”¨ç¨‹åºå¯èƒ½åŒ…å«æˆç™¾ä¸Šåƒçš„ Goroutine, è€Œåƒåœ¾æ”¶é›†çš„æ ¹å¯¹è±¡ä¸€èˆ¬åŒ…æ‹¬å…¨å±€å˜é‡å’Œæ ˆå¯¹è±¡, å¦‚æœè¿è¡Œæ—¶éœ€è¦åœ¨å‡ ç™¾ä¸ª Goroutine çš„æ ˆä¸Šéƒ½å¼€å¯å†™å±éšœ, ä¼šå¸¦æ¥å·¨å¤§çš„é¢å¤–å¼€é”€, æ‰€ä»¥ Go å›¢é˜Ÿåœ¨å®ç°ä¸Šé€‰æ‹©äº†åœ¨æ ‡è®°é˜¶æ®µå®Œæˆæ—¶æš‚åœç¨‹åºã€å°†æ‰€æœ‰æ ˆå¯¹è±¡æ ‡è®°ä¸ºç°è‰²å¹¶é‡æ–°æ‰«æ, åœ¨æ´»è·ƒ Goroutine éå¸¸å¤šçš„ç¨‹åºä¸­, é‡æ–°æ‰«æçš„è¿‡ç¨‹éœ€è¦å ç”¨ 10 ~ 100ms çš„æ—¶é—´ã€‚</p><p>Go è¯­è¨€åœ¨ v1.8 ç»„åˆ Dijkstra æ’å…¥å†™å±éšœå’Œ Yuasa åˆ é™¤å†™å±éšœæ„æˆäº†å¦‚ä¸‹æ‰€ç¤ºçš„æ··åˆå†™å±éšœ, è¯¥å†™å±éšœä¼šå°†è¢«è¦†ç›–çš„å¯¹è±¡æ ‡è®°æˆç°è‰²å¹¶åœ¨å½“å‰æ ˆæ²¡æœ‰æ‰«ææ—¶å°†æ–°å¯¹è±¡ä¹Ÿæ ‡è®°æˆç°è‰²</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">writePointer(slot, ptr):<br>    shade(*slot)<br>    <span class="hljs-keyword">if</span> current stack is grey:<br>        shade(ptr)<br>    *slot = ptr<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ç§»é™¤æ ˆçš„é‡æ‰«æè¿‡ç¨‹, é™¤äº†å¼•å…¥æ··åˆå†™å±éšœä¹‹å¤–, åœ¨åƒåœ¾æ”¶é›†çš„æ ‡è®°é˜¶æ®µ, æˆ‘ä»¬è¿˜éœ€è¦å°†åˆ›å»ºçš„æ‰€æœ‰æ–°å¯¹è±¡éƒ½æ ‡è®°æˆé»‘è‰², é˜²æ­¢æ–°åˆ†é…çš„æ ˆå†…å­˜å’Œå †å†…å­˜ä¸­çš„å¯¹è±¡è¢«é”™è¯¯åœ°å›æ”¶, å› ä¸ºæ ˆå†…å­˜åœ¨æ ‡è®°é˜¶æ®µæœ€ç»ˆéƒ½ä¼šå˜ä¸ºé»‘è‰², æ‰€ä»¥ä¸å†éœ€è¦é‡æ–°æ‰«ææ ˆç©ºé—´</p><h3 id="gcè§¦å‘æ—¶æœº">gcè§¦å‘æ—¶æœº</h3><ul><li>å†…å­˜åˆ†é…é‡è¾¾åˆ°é˜ˆå€¼:â€” å †å†…å­˜çš„åˆ†é…è¾¾åˆ°è¾¾æ§åˆ¶å™¨è®¡ç®—çš„è§¦å‘å †å¤§å°ï¼›</li><li>å®šæ—¶è§¦å‘ï¼šâ€” å¦‚æœä¸€å®šæ—¶é—´å†…æ²¡æœ‰è§¦å‘, å°±ä¼šè§¦å‘æ–°çš„å¾ªç¯, è¯¥å‡ºå‘æ¡ä»¶ç”± runtime.forcegcperiod å˜é‡æ§åˆ¶, é»˜è®¤ä¸º 2 åˆ†é’Ÿï¼›</li><li>æ‰‹åŠ¨è§¦å‘ï¼š<strong>runtime.GC</strong> ç”¨æˆ·ç¨‹åºæ‰‹åŠ¨è§¦å‘åƒåœ¾æ”¶é›†</li></ul><h4 id="Go-GCå¦‚ä½•å·¥ä½œ">Go GCå¦‚ä½•å·¥ä½œ</h4><p>Golang GCçš„å¤§éƒ¨åˆ†å¤„ç†æ˜¯å’Œç”¨æˆ·ä»£ç å¹¶è¡Œçš„, GCæœŸé—´ç”¨æˆ·ä»£ç å¯èƒ½ä¼šæ”¹å˜æŸäº›å¯¹è±¡çš„çŠ¶æ€, å¦‚ä½•å®ç°å¹¶è¡Œå‘¢ï¼Ÿ</p><ol><li><p>Markï¼š</p><p>Mark Prepareï¼šåˆå§‹åŒ–GCä»»åŠ¡, åŒ…æ‹¬å¼€å¯å†™å±éšœï¼ˆwrite barrierï¼‰å’Œè¾…åŠ©GCï¼ˆmutator assistï¼‰, ç»Ÿè®¡rootå¯¹è±¡çš„ä»»åŠ¡æ•°é‡ç­‰, è¿™ä¸ªè¿‡ç¨‹éœ€è¦STWã€‚</p><p>GC Drainsï¼šæ‰«ææ‰€æœ‰rootå¯¹è±¡, åŒ…æ‹¬å…¨å±€æŒ‡é’ˆå’Œgoroutineï¼ˆGï¼‰æ ˆä¸Šçš„æŒ‡é’ˆ, æ‰«æå¯¹äºGæ ˆæ—¶éœ€åœæ­¢è¯¥G, å°†å…¶åŠ å…¥æ ‡è®°é˜Ÿåˆ—ï¼ˆç°è‰²é˜Ÿåˆ—ï¼‰, å¹¶å¾ªç¯å¤„ç†ç°è‰²é˜Ÿåˆ—çš„å¯¹è±¡, ç›´åˆ°ç°è‰²å¯¹è±¡ä¸ºç©º, è¯¥è¿‡ç¨‹åå°å¹¶è¡Œæ‰§è¡Œã€‚</p></li><li><p>Mark Terminationï¼šå®Œæˆæ ‡è®°å·¥ä½œ, éœ€è¦é‡æ–°æ‰«æå…¨å±€æŒ‡é’ˆå’Œæ ˆ, å› ä¸ºMarkå’Œç”¨æˆ·ç¨‹åºæ˜¯å¹¶è¡Œçš„, æ‰€ä»¥åœ¨è¯¥è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰æ–°çš„å¯¹è±¡åˆ†é…å’ŒæŒ‡é’ˆèµ‹å€¼, è¿™ä¸ªæ—¶å€™å°±éœ€è¦é€šè¿‡å†™å±éšœè®°å½•ä¸‹æ¥, é‡æ–°æ‰«æå†æ£€æŸ¥ä¸€ä¸‹ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯ä¼šSTWçš„ã€‚</p></li><li><p>Sweepï¼šæŒ‰ç…§æ ‡è®°ç»“æœå›æ”¶æ‰€æœ‰çš„ç™½è‰²å¯¹è±¡, è¯¥è¿‡ç¨‹åå°å¹¶è¡Œæ‰§è¡Œã€‚</p></li><li><p>Sweep Terminationï¼šå¯¹æœªæ‰«æçš„èŒƒå›´è¿›è¡Œæ‰«æ, åªæœ‰ä¸Šä¸€è½®GCçš„æ¸…æ‰«å·¥ä½œå®Œæˆæ‰å¯ä»¥å¼€å§‹æ–°çš„ä¸€è½®GCã€‚</p></li></ol><h4 id="è¾…åŠ©GC">è¾…åŠ©GC</h4><p>Golangå®é™…æ˜¯æŠŠç”¨æˆ·ä»£ç â€“&gt;å¤§æ®µGCâ€”&gt;ç”¨æˆ·ä»£ç åˆ†æ•£ä¸ºç”¨æˆ·ä»£ç â€”&gt;å°æ®µGCâ€”&gt;ç”¨æˆ·ä»£ç â€”&gt;å°æ®µGCâ€”&gt;ç”¨æˆ·ä»£ç ,</p><p>å¦‚æœGCé€Ÿåº¦è·Ÿä¸ä¸Šåˆ†é…é€Ÿåº¦, ä¼šæŠŠç”¨æˆ·é€»è¾‘æš‚åœ, åŒæ—¶ä¼šæŠŠç”¨æˆ·çº¿ç¨‹æŠ¢å è¿‡æ¥åŠ å…¥åˆ°åƒåœ¾å›æ”¶é‡Œé¢åŠ å¿«åƒåœ¾å›æ”¶é€Ÿåº¦ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang ä¸€äº›é¢˜ç›®</title>
    <link href="/2023/01/06/golang/%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/"/>
    <url>/2023/01/06/golang/%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h3 id="golangä¸­åˆ†ä¸ºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹">golangä¸­åˆ†ä¸ºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹</h3><ul><li>å€¼ç±»å‹åˆ†åˆ«æœ‰ï¼šintç³»åˆ—ã€floatç³»åˆ—ã€boolã€stringã€æ•°ç»„å’Œç»“æ„ä½“</li><li>å¼•ç”¨ç±»å‹æœ‰ï¼šæŒ‡é’ˆã€sliceåˆ‡ç‰‡ã€ç®¡é“channelã€æ¥å£interfaceã€mapã€å‡½æ•°ç­‰</li><li>å€¼ç±»å‹çš„ç‰¹ç‚¹æ˜¯ï¼šå˜é‡ç›´æ¥å­˜å‚¨å€¼, å†…å­˜é€šå¸¸åœ¨æ ˆä¸­åˆ†é…</li><li>å¼•ç”¨ç±»å‹çš„ç‰¹ç‚¹æ˜¯ï¼šå˜é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªåœ°å€, è¿™ä¸ªåœ°å€å¯¹åº”çš„ç©ºé—´é‡Œæ‰æ˜¯çœŸæ­£å­˜å‚¨çš„å€¼, å†…å­˜é€šå¸¸åœ¨å †ä¸­åˆ†é…</li></ul><h3 id="æ•°ç»„å’Œåˆ‡ç‰‡çš„åŒºåˆ«">æ•°ç»„å’Œåˆ‡ç‰‡çš„åŒºåˆ«</h3><p>æ•°ç»„æ˜¯å®šé•¿çš„, æ•°ç»„æ˜¯å€¼ç±»å‹<br>åˆ‡ç‰‡æ˜¯ä¸å®šé•¿çš„, æ˜¯å¼•ç”¨ç±»å‹, ä¸”éœ€è¦é€šè¿‡makeæ¥åˆå§‹åŒ–, å¦åˆ™æ˜¯nil</p><h3 id="makeå’Œnew">makeå’Œnew</h3><ul><li>make çš„ä½œç”¨æ˜¯åˆå§‹åŒ–å†…ç½®çš„æ•°æ®ç»“æ„, ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨å‰é¢æåˆ°çš„åˆ‡ç‰‡ã€å“ˆå¸Œè¡¨å’Œ Channel</li><li>new çš„ä½œç”¨æ˜¯æ ¹æ®ä¼ å…¥çš„ç±»å‹åˆ†é…ä¸€ç‰‡å†…å­˜ç©ºé—´å¹¶è¿”å›æŒ‡å‘è¿™ç‰‡å†…å­˜ç©ºé—´çš„æŒ‡é’ˆ</li></ul><h3 id="æ–¹æ³•å€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€…çš„åŒºåˆ«">æ–¹æ³•å€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€…çš„åŒºåˆ«</h3><ul><li>å¦‚æœæ–¹æ³•çš„æ¥å—è€…æ˜¯æŒ‡é’ˆç±»å‹ï¼Œæ— è®ºè°ƒç”¨è€…æ˜¯å¯¹è±¡è¿˜æ˜¯å¯¹è±¡æŒ‡é’ˆ, ä¿®æ”¹çš„éƒ½æ˜¯å¯¹è±¡æœ¬èº«ï¼Œä¼šå½±å“è°ƒç”¨è€…;</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(o *obj)</span></span> method()<br></code></pre></td></tr></table></figure><ul><li>å¦‚æœæ–¹æ³•çš„æ¥å—è€…æ˜¯æŒ‡é’ˆç±»å‹ï¼Œæ— è®ºè°ƒç”¨è€…æ˜¯å¯¹è±¡è¿˜æ˜¯å¯¹è±¡æŒ‡é’ˆ, ä¿®æ”¹çš„éƒ½æ˜¯å¯¹è±¡æœ¬èº«ï¼Œä¼šå½±å“è°ƒç”¨è€…;</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(o obj)</span></span> method()<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨æŒ‡é’ˆç±»å‹çš„ç†ç”±<ul><li>å¸Œæœ›ä¿®æ”¹è°ƒç”¨è€…çš„å€¼</li><li>é¿å…æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶å¤åˆ¶è¯¥å€¼ï¼Œåœ¨å€¼çš„ç±»å‹ä¸ºå¤§å‹ç»“æ„ä½“æ—¶ï¼Œä½¿ç”¨æŒ‡é’ˆä¼šæ›´åŠ é«˜æ•ˆ</li></ul></li></ul><h3 id="Goå‡½æ•°è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆæ˜¯å¦å®‰å…¨">Goå‡½æ•°è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆæ˜¯å¦å®‰å…¨</h3><p>å‡½æ•°å±€éƒ¨å˜é‡çš„æŒ‡é’ˆè¿”å›ï¼Œgoç¼–è¯‘å™¨ä¼šè¿›è¡Œé€ƒé€¸åˆ†æï¼Œå¦‚æœå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸè¶…å‡ºè¯¥å‡½æ•°ï¼Œåˆ™ä¸ä¼šå°†å†…å­˜åˆ†é…åœ¨æ ˆä¸Šï¼Œè€Œæ˜¯åˆ†é…åœ¨å †ä¸Š</p><h3 id="sliceæ‰©å®¹æœºåˆ¶">sliceæ‰©å®¹æœºåˆ¶</h3><ul><li>å¦‚æœå½“å‰åˆ‡ç‰‡çš„é•¿åº¦å°äº 1024 å°±ä¼šå°†å®¹é‡ç¿»å€ï¼›</li><li>å¦‚æœå½“å‰åˆ‡ç‰‡çš„é•¿åº¦å¤§äº 1024 å°±ä¼šæ¯æ¬¡å¢åŠ  25% çš„å®¹é‡, ç›´åˆ°æ–°å®¹é‡å¤§äºæœŸæœ›å®¹é‡ï¼›</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang slice</title>
    <link href="/2023/01/05/golang/slice/"/>
    <url>/2023/01/05/golang/slice/</url>
    
    <content type="html"><![CDATA[<h3 id="æ•°ç»„">æ•°ç»„</h3><p>æ•°ç»„æ˜¯ç”±ç›¸åŒç±»å‹å…ƒç´ çš„é›†åˆç»„æˆçš„æ•°æ®ç»“æ„, è®¡ç®—æœºä¼šä¸ºæ•°ç»„åˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜æ¥ä¿å­˜å…¶ä¸­çš„å…ƒç´ </p><p>æ•°ç»„æ˜¯å®šé•¿çš„, å¿…é¡»æŒ‡å®šé•¿åº¦æˆ–æ»¡è¶³ç¼–è¯‘å™¨å¯¹æ•°ç»„å¤§å°çš„æ¨å¯¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><br>arr1 := [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>arr2 := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="åˆ‡ç‰‡">åˆ‡ç‰‡</h3><p>åˆ‡ç‰‡ç±»å‹çš„å£°æ˜æ–¹å¼ä¸æ•°ç»„æœ‰ä¸€äº›ç›¸ä¼¼, ä¸è¿‡ç”±äºåˆ‡ç‰‡çš„é•¿åº¦æ˜¯åŠ¨æ€çš„, æ‰€ä»¥å£°æ˜æ—¶åªéœ€è¦æŒ‡å®šåˆ‡ç‰‡ä¸­çš„å…ƒç´ ç±»å‹</p><p>æ•°æ®ç»“æ„</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> SliceHeader <span class="hljs-keyword">struct</span> &#123;<br>Data <span class="hljs-type">uintptr</span><br>Len  <span class="hljs-type">int</span><br>Cap  <span class="hljs-type">int</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>Data æ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ;</p><p>Data æ˜¯ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´, è¿™ç‰‡å†…å­˜ç©ºé—´å¯ä»¥ç”¨äºå­˜å‚¨åˆ‡ç‰‡ä¸­çš„å…¨éƒ¨å…ƒç´ , æ•°ç»„ä¸­çš„å…ƒç´ åªæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µ, åº•å±‚å­˜å‚¨å…¶å®éƒ½æ˜¯è¿ç»­çš„, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†åˆ‡ç‰‡ç†è§£æˆä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´åŠ ä¸Šé•¿åº¦ä¸å®¹é‡çš„æ ‡è¯†</p></li><li><p>Len æ˜¯å½“å‰åˆ‡ç‰‡çš„é•¿åº¦ï¼›</p></li><li><p>Cap æ˜¯å½“å‰åˆ‡ç‰‡çš„å®¹é‡, å³ Data æ•°ç»„çš„å¤§å°,</p></li></ul><p>ç¨‹åºåœ¨è¿è¡ŒåŒºé—´å¯ä»¥ä¿®æ”¹å®ƒçš„é•¿åº¦å’ŒèŒƒå›´ã€‚å½“åˆ‡ç‰‡åº•å±‚çš„æ•°ç»„é•¿åº¦ä¸è¶³æ—¶å°±ä¼šè§¦å‘æ‰©å®¹, åˆ‡ç‰‡æŒ‡å‘çš„æ•°ç»„å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–, ä¸è¿‡åœ¨ä¸Šå±‚çœ‹æ¥åˆ‡ç‰‡æ˜¯æ²¡æœ‰å˜åŒ–çš„, ä¸Šå±‚åªéœ€è¦ä¸åˆ‡ç‰‡æ‰“äº¤é“ä¸éœ€è¦å…³å¿ƒæ•°ç»„çš„å˜åŒ–</p><h4 id="æ‰©å®¹">æ‰©å®¹</h4><p>åœ¨åˆ†é…å†…å­˜ç©ºé—´ä¹‹å‰éœ€è¦å…ˆç¡®å®šæ–°çš„åˆ‡ç‰‡å®¹é‡, è¿è¡Œæ—¶æ ¹æ®åˆ‡ç‰‡çš„å½“å‰å®¹é‡é€‰æ‹©ä¸åŒçš„ç­–ç•¥è¿›è¡Œæ‰©å®¹ï¼š</p><ul><li>å¦‚æœæœŸæœ›å®¹é‡å¤§äºå½“å‰å®¹é‡çš„ä¸¤å€å°±ä¼šä½¿ç”¨æœŸæœ›å®¹é‡ï¼›</li><li>å¦‚æœå½“å‰åˆ‡ç‰‡çš„é•¿åº¦å°äº 1024 å°±ä¼šå°†å®¹é‡ç¿»å€ï¼›</li><li>å¦‚æœå½“å‰åˆ‡ç‰‡çš„é•¿åº¦å¤§äº 1024 å°±ä¼šæ¯æ¬¡å¢åŠ  25% çš„å®¹é‡, ç›´åˆ°æ–°å®¹é‡å¤§äºæœŸæœ›å®¹é‡ï¼›</li></ul><h4 id="copy">copy</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">slicecopy</span><span class="hljs-params">(to, fm slice, width <span class="hljs-type">uintptr</span>)</span></span> <span class="hljs-type">int</span> &#123;<br><span class="hljs-keyword">if</span> fm.<span class="hljs-built_in">len</span> == <span class="hljs-number">0</span> || to.<span class="hljs-built_in">len</span> == <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>&#125;<br>n := fm.<span class="hljs-built_in">len</span><br><span class="hljs-keyword">if</span> to.<span class="hljs-built_in">len</span> &lt; n &#123;<br>n = to.<span class="hljs-built_in">len</span><br>&#125;<br><span class="hljs-keyword">if</span> width == <span class="hljs-number">0</span> &#123;<br><span class="hljs-keyword">return</span> n<br>&#125;<br>...<br><br>size := <span class="hljs-type">uintptr</span>(n) * width<br><span class="hljs-keyword">if</span> size == <span class="hljs-number">1</span> &#123;<br>*(*<span class="hljs-type">byte</span>)(to.array) = *(*<span class="hljs-type">byte</span>)(fm.array)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// runtime.memmove å°†æ•´å—å†…å­˜çš„å†…å®¹æ‹·è´åˆ°ç›®æ ‡çš„å†…å­˜åŒºåŸŸä¸­</span><br>memmove(to.array, fm.array, size)<br>&#125;<br><span class="hljs-keyword">return</span> n<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang mutex</title>
    <link href="/2023/01/03/golang/mutex/"/>
    <url>/2023/01/03/golang/mutex/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒ ï¼š</p><p><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-sync-primitives">https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-sync-primitives</a></p><p><a href="https://www.bilibili.com/video/BV1hv411x7we">https://www.bilibili.com/video/BV1hv411x7we</a></p><h4 id="mutex">mutex</h4><p>sync.Mutex ç”±ä¸¤ä¸ªå­—æ®µ state å’Œ sema ç»„æˆã€‚å…¶ä¸­ state è¡¨ç¤ºå½“å‰äº’æ–¥é”çš„çŠ¶æ€, è€Œ sema æ˜¯ç”¨äºæ§åˆ¶é”çŠ¶æ€çš„ä¿¡å·é‡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-keyword">type</span> Mutex <span class="hljs-keyword">struct</span> &#123;<br>    state <span class="hljs-type">int32</span><br>    sema  <span class="hljs-type">uint32</span><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/asset/golang/images/mutex.png" alt="mutex"></p><p>state æœ€ä½ä¸‰ä½è¡¨ç¤ºmutexLocked, mutexWoken,  mutexStarving</p><ul><li>mutexLocked è¡¨ç¤ºäº’æ–¥é”çš„é”å®šçŠ¶æ€ï¼›</li><li>mutexWoken â€” è¡¨ç¤ºä»æ­£å¸¸æ¨¡å¼è¢«ä»å”¤é†’ï¼›</li><li>mutexStarving â€” å½“å‰çš„äº’æ–¥é”è¿›å…¥é¥¥é¥¿çŠ¶æ€ï¼›</li></ul><p>å…¶ä½™ä½ç½®è¡¨ç¤ºå½“å‰äº’æ–¥é”ä¸Šç­‰å¾…çš„ Goroutine ä¸ªæ•°</p><h4 id="æ­£å¸¸æ¨¡å¼">æ­£å¸¸æ¨¡å¼</h4><p>ä¸€ä¸ªå°è¯•åŠ é”çš„Goroutineä¼šå…ˆè‡ªæ—‹å‡ æ¬¡, å°è¯•é€šè¿‡åŸå­æ“ä½œè·å–é”, è‹¥è·å–ä¸åˆ°é”, å°±é€šè¿‡ä¿¡å·é‡æ’é˜Ÿç­‰å¾…(å…ˆè¿›å…ˆå‡º),<br>å½“é”é‡Šæ”¾æ˜¯, ç¬¬ä¸€ä¸ªæ’é˜Ÿç­‰å¾…çš„Goroutineä¼šè¢«å”¤é†’, ä¸å¤„äºè‡ªæ—‹çŠ¶æ€,ä¸”æ²¡æœ‰åœ¨æ’é˜Ÿçš„Goroutineäº‰å–é”, è¢«å”¤é†’çš„Goroutineæ²¡æœ‰è·å–é”ä¼šè¿”å›é˜Ÿåˆ—æ’åœ¨ç¬¬ä¸€ä½,å½“ä¸€ä¸ªGoroutineå¤„äºç­‰å¾…æ—¶é•¿è¶…è¿‡1ms,å½“å‰çŠ¶æ€åˆ‡æ¢ä¸ºé¥¥é¥¿çŠ¶æ€</p><h4 id="é¥¥é¥¿æ¨¡å¼">é¥¥é¥¿æ¨¡å¼</h4><p>mutexçš„æ‰€æœ‰æƒç›´æ¥ä»æ‰§è¡ŒUnlockçš„Goroutineäº¤ç»™ç­‰å¾…é˜Ÿåˆ—å¤´éƒ¨çš„Goroutine, åæ¥è€…ä¸ä¼šè‡ªæ—‹ä¸”ä¸ä¼šå°è¯•è·å¾—é”, ç›´æ¥åœ¨é˜Ÿåˆ—æ’é˜Ÿç­‰å¾…è·å–é”</p><p>åˆ‡æ¢æ­£å¸¸æ¨¡å¼ï¼š</p><ul><li>å½“ç­‰å¾…è€…è·å–é”ä¹‹å, ä¸”ç­‰å¾…æ—¶é•¿å°äº1ms</li><li>å½“å‰ç­‰å¾…è€…æ˜¯é˜Ÿåˆ—ç§æœ€åä¸€ä¸ªè·å–é”çš„Goroutine</li></ul><h5 id="ä¸ºä»€ä¹ˆéœ€è¦è‡ªæ—‹">ä¸ºä»€ä¹ˆéœ€è¦è‡ªæ—‹</h5><p>é¿å…é¢‘ç¹çš„æŒ‚èµ·, å”¤é†’Goroutineå¸¦æ¥çš„å¼€é”€</p><h5 id="ä¸ºä»€ä¹ˆç­‰å¾…éœ€è¦å’Œè‡ªæ—‹äº‰å–-ä¸ºä»€ä¹ˆè‡ªæ—‹çš„Goroutineäº‰å–é”æ›´æœ‰ä¼˜åŠ¿">ä¸ºä»€ä¹ˆç­‰å¾…éœ€è¦å’Œè‡ªæ—‹äº‰å–/ä¸ºä»€ä¹ˆè‡ªæ—‹çš„Goroutineäº‰å–é”æ›´æœ‰ä¼˜åŠ¿</h5><p>å¤„äºè‡ªæ—‹çš„Goroutineæ­£åœ¨CPUä¸Šè¿è¡Œ, å¯ä»¥é¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢, å¤„äºè‡ªæ—‹çš„Goroutineå¯èƒ½æœ‰å¾ˆå¤šä¸ª, é˜Ÿåˆ—ç§è¢«å”¤é†’çš„Goroutineåªæœ‰ä¸€ä¸ª, æ‰€ä»¥è¢«å”¤é†’çš„Goroutineå¤§æ¦‚ç‡æ‹¿ä¸åˆ°é”</p><h4 id="è§¦å‘è‡ªæ—‹çš„æ¡ä»¶">è§¦å‘è‡ªæ—‹çš„æ¡ä»¶</h4><ol><li><p>é”å·²ç»è¢«å ç”¨ï¼Œä¸”é”ä¸å¤„äºé¥¥é¥¿çŠ¶æ€</p></li><li><p>ç´¯è®¡çš„è‡ªæ—‹æ¬¡æ•°ï¼Œå°äºæœ€å¤§è‡ªæ—‹æ¬¡æ•°ï¼ˆactive_spin=4ï¼‰</p></li><li><p>cpu æ ¸æ•°å¤§äº1</p></li><li><p>æœ‰ç©ºé—²çš„P</p></li><li><p>å½“å‰ goroutine é”æŒ‚è½½çš„Pä¸‹ï¼Œæœ¬åœ°è¿è¡ŒGé˜Ÿåˆ—ä¸ºç©º</p></li></ol><p>sync.Mutex æœ‰ä¸¤ç§æ¨¡å¼</p><ul><li>æ­£å¸¸æ¨¡å¼å’Œé¥¥é¥¿æ¨¡å¼ã€‚</li></ul><p>æˆ‘ä»¬éœ€è¦åœ¨è¿™é‡Œå…ˆäº†è§£æ­£å¸¸æ¨¡å¼å’Œé¥¥é¥¿æ¨¡å¼éƒ½æ˜¯ä»€ä¹ˆä»¥åŠå®ƒä»¬æœ‰ä»€ä¹ˆæ ·çš„å…³ç³»</p><p>åœ¨æ­£å¸¸æ¨¡å¼ä¸‹, é”çš„ç­‰å¾…è€…ä¼šæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºè·å–é”ã€‚ä½†æ˜¯åˆšè¢«å”¤èµ·çš„ Goroutine ä¸æ–°åˆ›å»ºçš„ Goroutine ç«äº‰æ—¶, å¤§æ¦‚ç‡ä¼šè·å–ä¸åˆ°é”, ä¸ºäº†å‡å°‘è¿™ç§æƒ…å†µçš„å‡ºç°, ä¸€æ—¦ Goroutine è¶…è¿‡ 1ms æ²¡æœ‰è·å–åˆ°é”, å®ƒå°±ä¼šå°†å½“å‰äº’æ–¥é”åˆ‡æ¢é¥¥é¥¿æ¨¡å¼, é˜²æ­¢éƒ¨åˆ† Goroutine è¢«ã€é¥¿æ­»ã€</p><p>åœ¨é¥¥é¥¿æ¨¡å¼ä¸­, äº’æ–¥é”ä¼šç›´æ¥äº¤ç»™ç­‰å¾…é˜Ÿåˆ—æœ€å‰é¢çš„ Goroutineã€‚æ–°çš„ Goroutine åœ¨è¯¥çŠ¶æ€ä¸‹ä¸èƒ½è·å–é”ã€ä¹Ÿä¸ä¼šè¿›å…¥è‡ªæ—‹çŠ¶æ€, å®ƒä»¬åªä¼šåœ¨é˜Ÿåˆ—çš„æœ«å°¾ç­‰å¾…ã€‚å¦‚æœä¸€ä¸ª Goroutine è·å¾—äº†äº’æ–¥é”å¹¶ä¸”å®ƒåœ¨é˜Ÿåˆ—çš„æœ«å°¾æˆ–è€…å®ƒç­‰å¾…çš„æ—¶é—´å°‘äº 1ms, é‚£ä¹ˆå½“å‰çš„äº’æ–¥é”å°±ä¼šåˆ‡æ¢å›æ­£å¸¸æ¨¡å¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang makeå’Œnew</title>
    <link href="/2023/01/02/golang/make_new/"/>
    <url>/2023/01/02/golang/make_new/</url>
    
    <content type="html"><![CDATA[<ul><li>make çš„ä½œç”¨æ˜¯åˆå§‹åŒ–å†…ç½®çš„æ•°æ®ç»“æ„, ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨å‰é¢æåˆ°çš„åˆ‡ç‰‡ã€å“ˆå¸Œè¡¨å’Œ Channel</li><li>new çš„ä½œç”¨æ˜¯æ ¹æ®ä¼ å…¥çš„ç±»å‹åˆ†é…ä¸€ç‰‡å†…å­˜ç©ºé—´å¹¶è¿”å›æŒ‡å‘è¿™ç‰‡å†…å­˜ç©ºé—´çš„æŒ‡é’ˆ</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang map</title>
    <link href="/2023/01/02/golang/map/"/>
    <url>/2023/01/02/golang/map/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒ ï¼š</p><p><a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/">https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/</a></p><p><a href="https://www.bilibili.com/video/BV1Sp4y1U7dJ">https://www.bilibili.com/video/BV1Sp4y1U7dJ</a></p><p>mapæ˜¯ä¸€å †é”®å€¼å¯¹çš„æœªæ’åºé›†åˆ</p><p>hashmap ä¼šå­˜åœ¨å“ˆå¸Œå†²çª</p><p>è§£å†³ hash å†²çªåŠæ³•ï¼š</p><ul><li>å¼€æ”¾å¯»å€æ³•<ul><li>çº¿æ€§æ¢æµ‹æ³•ï¼šå‘åä¾æ¬¡æ¢æµ‹å¯ä»¥å­˜æ”¾çš„ä½ç½®, ç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼ˆæœ€åæƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦O(n)ï¼‰</li><li>äºŒæ¬¡çº¿æ€§æ¢æµ‹ï¼šå½“å‰keyå­˜åœ¨è¯¥åœ°å€ååç§»é‡ä¸ºï¼ˆ1,2,3â€¦ï¼‰çš„äºŒæ¬¡æ–¹åœ°å€å¤„</li><li>åŒé‡æ•£åˆ—ï¼šå¯¹hashå€¼ä½¿ç”¨å¤šç»„æ•£åˆ—å‡½æ•°é‡æ–°è®¡ç®—ä½ç½®, ç›´åˆ°æ‰¾åˆ°ç©ºé—²ä½ç½®ä¸ºæ­¢</li></ul></li><li>æ‹‰é“¾æ³•: æ¯ä¸ªä½ç½®å¯¹åº”ä¸€ä¸ªé“¾è¡¨, æŸ¥æ‰¾keyæ‰€åœ¨çš„é“¾è¡¨, ç„¶ååœ¨é“¾è¡¨é¡ºåºæŸ¥æ‰¾ä½ç½®</li></ul><p>golang mapä½¿ç”¨æ”¹è¿›çš„æ‹‰é“¾æ³•è§£å†³å†²çª</p><p>mapçš„åº•å±‚æ˜¯é€šè¿‡hmapï¼ˆhashmapï¼‰æ¥å®ç°çš„</p><p>mapåº•å±‚æ•°æ®ç»“æ„</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs golang"><br><span class="hljs-keyword">type</span> hmap <span class="hljs-keyword">struct</span> &#123;<br>count     <span class="hljs-type">int</span> <span class="hljs-comment">//è¡¨ç¤ºå½“å‰å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ æ•°é‡ï¼›</span><br>flags     <span class="hljs-type">uint8</span><br>B         <span class="hljs-type">uint8</span> <span class="hljs-comment">//è¡¨ç¤ºå½“å‰å“ˆå¸Œè¡¨æŒæœ‰çš„ buckets æ•°é‡, ä½†æ˜¯å› ä¸ºå“ˆå¸Œè¡¨ä¸­æ¡¶çš„æ•°é‡éƒ½ 2 çš„å€æ•°, æ‰€ä»¥è¯¥å­—æ®µä¼šå­˜å‚¨å¯¹æ•°, ä¹Ÿå°±æ˜¯ len(buckets) == 2^Bï¼›</span><br>noverflow <span class="hljs-type">uint16</span><br>hash0     <span class="hljs-type">uint32</span> <span class="hljs-comment">//æ˜¯å“ˆå¸Œçš„ç§å­, å®ƒèƒ½ä¸ºå“ˆå¸Œå‡½æ•°çš„ç»“æœå¼•å…¥éšæœºæ€§, è¿™ä¸ªå€¼åœ¨åˆ›å»ºå“ˆå¸Œè¡¨æ—¶ç¡®å®š, å¹¶åœ¨è°ƒç”¨å“ˆå¸Œå‡½æ•°æ—¶ä½œä¸ºå‚æ•°ä¼ å…¥ï¼›</span><br><br>buckets    unsafe.Pointer <br>oldbuckets unsafe.Pointer <span class="hljs-comment">// å“ˆå¸Œåœ¨æ‰©å®¹æ—¶ç”¨äºä¿å­˜ä¹‹å‰ buckets </span><br>nevacuate  <span class="hljs-type">uintptr</span> <span class="hljs-comment">// æ¸è¿›å¼æ‰©å®¹ä¸‹ä¸€ä¸ªéœ€è¦è¿ç§»çš„æ—§æ¡¶çš„ç¼–å·</span><br><br>extra *mapextra  <span class="hljs-comment">//è®°å½•çš„æ˜¯æº¢å‡ºæ¡¶çš„ç›¸å…³ä¿¡æ¯</span><br>&#125;<br><br><span class="hljs-keyword">type</span> mapextra <span class="hljs-keyword">struct</span> &#123;<br>overflow    *[]*bmap<br>oldoverflow *[]*bmap<br>nextOverflow *bmap<br>&#125;<br><br><span class="hljs-keyword">type</span> bmap <span class="hljs-keyword">struct</span> &#123;<br>    topbits  [<span class="hljs-number">8</span>]<span class="hljs-type">uint8</span><br>    keys     [<span class="hljs-number">8</span>]keytype<br>    values   [<span class="hljs-number">8</span>]valuetype<br>    pad      <span class="hljs-type">uintptr</span><br>    overflow <span class="hljs-type">uintptr</span> <span class="hljs-comment">// æŒ‡å‘æº¢å‡ºçš„æ¡¶</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>hmap<br><img src="/asset/golang/images/hmap.png" alt="hmap"></p><p>bmap<br><img src="/asset/golang/images/bmap.png" alt="bmap"></p><p>å¦‚æœå“ˆå¸Œè¡¨è¦åˆ†é…çš„æ¡¶çš„æ•°ç›®å¤§äº2^4, å°±è®¤ä¸ºä¼šä½¿ç”¨åˆ°æº¢å‡ºæ¡¶çš„å‡ ç‡æ¯”è¾ƒå¤§, å°±ä¼šé¢„åˆ†é…2^(B-4)ä¸ªæº¢å‡ºæ¡¶, æº¢å‡ºæ¡¶å’Œå¸¸è§„æ¡¶åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­çš„</p><p>map æ‰©å®¹çš„è´Ÿè½½å› å­æ˜¯6.5</p><p><code>Load factor = count/(2^B)</code></p><p>è´Ÿè½½å› å­è¶…è¿‡6.5ä¼šè§¦å‘<strong>ç¿»å€æ‰©å®¹</strong></p><p>å¦‚æœè´Ÿè½½å› å­æ²¡æœ‰è¶…æ ‡, ä½¿ç”¨çš„æº¢å‡ºæ¡¶è¿‡å¤š, è§¦å‘<strong>ç­‰é‡æ‰©å®¹</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">B</span> &lt;= <span class="hljs-number">15</span>, noverflow(æº¢å‡ºæ¡¶) &gt;= <span class="hljs-number">2</span>^B<br><span class="hljs-attribute">B</span> &gt; <span class="hljs-number">15</span>, noverflow(æº¢å‡ºæ¡¶) &gt;= <span class="hljs-number">2</span>^<span class="hljs-number">15</span><br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦ç­‰é‡æ‰©å®¹, å› ä¸ºè´Ÿè½½å› å­è¿‡ä½, ä¹Ÿå°±æ˜¯countå¤ªä½, è¡¨ç¤ºå¤§é‡è¿›è¡Œäº†åˆ é™¤æ“ä½œ, ç­‰é‡æ‰©å®¹å¯ä»¥ä½¿æ­£å¸¸æ¡¶å’Œæº¢å‡ºæ¡¶ä¸­çš„å…ƒç´ å¯ä»¥åˆå¹¶, ä»è€Œå‡å°‘æº¢å‡ºæ¡¶çš„ä½¿ç”¨</p><h3 id="map-æŸ¥æ‰¾è¿‡ç¨‹">map æŸ¥æ‰¾è¿‡ç¨‹</h3><ol><li><p>æ ¹æ®keyå€¼ç®—å‡ºå“ˆå¸Œå€¼</p></li><li><p>å–å“ˆå¸Œå€¼ä½ä½ä¸hmap.Bå–æ¨¡ç¡®å®šbucketä½ç½®</p></li><li><p>å–å“ˆå¸Œå€¼é«˜ä½åœ¨tophashæ•°ç»„ä¸­æŸ¥è¯¢</p></li><li><p>å¦‚æœtophash[i]ä¸­å­˜å‚¨å€¼ä¹Ÿå“ˆå¸Œå€¼ç›¸ç­‰ï¼Œåˆ™å»æ‰¾åˆ°è¯¥bucketä¸­çš„keyå€¼è¿›è¡Œæ¯”è¾ƒ</p></li><li><p>å½“å‰bucketæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç»§ç»­ä»ä¸‹ä¸ªoverflowçš„bucketä¸­æŸ¥æ‰¾ã€‚</p></li><li><p>å¦‚æœå½“å‰å¤„äºæ¬è¿è¿‡ç¨‹ï¼Œåˆ™ä¼˜å…ˆä»oldbucketsæŸ¥æ‰¾</p></li></ol><h3 id="æ’å…¥è¿‡ç¨‹">æ’å…¥è¿‡ç¨‹</h3><ol><li>æ ¹æ®keyå€¼ç®—å‡ºå“ˆå¸Œå€¼</li><li>å–å“ˆå¸Œå€¼ä½ä½ä¸hmap.Bå–æ¨¡ç¡®å®šbucketä½ç½®</li><li>æŸ¥æ‰¾è¯¥keyæ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥æ›´æ–°å€¼</li><li>å¦‚æœæ²¡æ‰¾åˆ°å°†keyï¼Œå°†keyæ’å…¥</li></ol><h3 id="map-çš„keyå¿…é¡»æ˜¯å¯ä»¥æ¯”è¾ƒçš„">map çš„keyå¿…é¡»æ˜¯å¯ä»¥æ¯”è¾ƒçš„</h3>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>codingæ‰‹å†Œ</title>
    <link href="/2023/01/01/%E5%9F%BA%E7%A1%80/coding%E6%89%8B%E5%86%8C/"/>
    <url>/2023/01/01/%E5%9F%BA%E7%A1%80/coding%E6%89%8B%E5%86%8C/</url>
    
    <content type="html"><![CDATA[<h3 id="æ—¶é—´å¤„ç†">æ—¶é—´å¤„ç†</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// è·å–æ¯«ç§’æ—¶é—´æˆ³</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() <br><span class="hljs-comment">// è‡ªå®šä¹‰æ ¼å¼</span><br><span class="hljs-title function_">moment</span>().<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>);<br><span class="hljs-title function_">moment</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>);<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// è·å–æ¯«ç§’æ—¶é—´æˆ³</span><br>time.Now().UnixMilli()<br><span class="hljs-comment">// è‡ªå®šä¹‰æ ¼å¼</span><br>time.Now().Format(<span class="hljs-string">&quot;2006-01-02 15:04:05&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">// è·å–æ¯«ç§’æ—¶é—´æˆ³<br>time.time()<br>// è‡ªå®šä¹‰æ ¼å¼<br>datetime.now().strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>codingæ‰‹å†Œ</tag>
      
      <tag>å‚è€ƒèµ„æ–™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GMP</title>
    <link href="/2022/12/31/golang/gmp/"/>
    <url>/2022/12/31/golang/gmp/</url>
    
    <content type="html"><![CDATA[<p>Go è¯­è¨€çš„åç¨‹ goroutine<br>Go ä¸ºäº†æä¾›æ›´å®¹æ˜“ä½¿ç”¨çš„å¹¶å‘æ–¹æ³•, ä½¿ç”¨äº† goroutine å’Œ channelã€‚goroutine æ¥è‡ªåç¨‹çš„æ¦‚å¿µ, è®©ä¸€ç»„å¯å¤ç”¨çš„å‡½æ•°è¿è¡Œåœ¨ä¸€ç»„çº¿ç¨‹ä¹‹ä¸Š, å³ä½¿æœ‰åç¨‹é˜»å¡, è¯¥çº¿ç¨‹çš„å…¶ä»–åç¨‹ä¹Ÿå¯ä»¥è¢« runtime è°ƒåº¦, è½¬ç§»åˆ°å…¶ä»–å¯è¿è¡Œçš„çº¿ç¨‹ä¸Šã€‚æœ€å…³é”®çš„æ˜¯, ç¨‹åºå‘˜çœ‹ä¸åˆ°è¿™äº›åº•å±‚çš„ç»†èŠ‚, è¿™å°±é™ä½äº†ç¼–ç¨‹çš„éš¾åº¦, æä¾›äº†æ›´å®¹æ˜“çš„å¹¶å‘ã€‚</p><p>Go ä¸­, åç¨‹è¢«ç§°ä¸º goroutine, å®ƒéå¸¸è½»é‡, ä¸€ä¸ª goroutine åªå å‡  KB, å¹¶ä¸”è¿™å‡  KB å°±è¶³å¤Ÿ goroutine è¿è¡Œå®Œ, è¿™å°±èƒ½åœ¨æœ‰é™çš„å†…å­˜ç©ºé—´å†…æ”¯æŒå¤§é‡ goroutine, æ”¯æŒäº†æ›´å¤šçš„å¹¶å‘ã€‚è™½ç„¶ä¸€ä¸ª goroutine çš„æ ˆåªå å‡  KB, ä½†å®é™…æ˜¯å¯ä¼¸ç¼©çš„, å¦‚æœéœ€è¦æ›´å¤šå†…å®¹, runtime ä¼šè‡ªåŠ¨ä¸º goroutine åˆ†é…ã€‚</p><p>Goroutine ç‰¹ç‚¹ï¼š</p><p>å ç”¨å†…å­˜æ›´å°ï¼ˆå‡  kbï¼‰<br>è°ƒåº¦æ›´çµæ´» (runtime è°ƒåº¦)</p><p>goroutine åŸºäºGMPè°ƒåº¦æ¨¡å‹å®Œæˆ</p><h3 id="è®¾è®¡åŸç†">è®¾è®¡åŸç†</h3><h4 id="å•çº¿ç¨‹è°ƒåº¦å™¨-0-x">å•çº¿ç¨‹è°ƒåº¦å™¨ 0.x</h4><p>è°ƒåº¦å™¨åªåŒ…å«è¡¨ç¤º Goroutine çš„ G(åç¨‹) å’Œè¡¨ç¤ºçº¿ç¨‹çš„ M(çº¿ç¨‹) ä¸¤ç§ç»“æ„, å…¨å±€ä¹Ÿåªæœ‰ä¸€ä¸ªçº¿ç¨‹</p><h4 id="å¤šçº¿ç¨‹è°ƒåº¦å™¨-1-0">å¤šçº¿ç¨‹è°ƒåº¦å™¨ 1.0</h4><p>å¤šçº¿ç¨‹è°ƒåº¦å™¨å¼•å…¥äº† GOMAXPROCS å˜é‡å¸®åŠ©æˆ‘ä»¬çµæ´»æ§åˆ¶ç¨‹åºä¸­çš„æœ€å¤§å¤„ç†å™¨æ•°, å³æ´»è·ƒçº¿ç¨‹æ•°</p><h4 id="ä»»åŠ¡çªƒå–è°ƒåº¦å™¨-1-1">ä»»åŠ¡çªƒå–è°ƒåº¦å™¨ 1.1</h4><p>åœ¨å¤šçº¿ç¨‹è°ƒåº¦å™¨ä¸Šè¿›è¡Œæ”¹è¿›</p><ul><li>åœ¨å½“å‰çš„ G-M æ¨¡å‹ä¸­å¼•å…¥äº†å¤„ç†å™¨ P, å¢åŠ ä¸­é—´å±‚</li><li>åœ¨å¤„ç†å™¨ P çš„åŸºç¡€ä¸Šå®ç°åŸºäºå·¥ä½œçªƒå–çš„è°ƒåº¦å™¨</li></ul><h4 id="æŠ¢å å¼è°ƒåº¦å™¨-Â·-1-2-è‡³ä»Š">æŠ¢å å¼è°ƒåº¦å™¨ Â· 1.2 ~ è‡³ä»Š</h4><ul><li>åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦å™¨ - 1.2 ~ 1.13<ul><li>é€šè¿‡ç¼–è¯‘å™¨åœ¨å‡½æ•°è°ƒç”¨æ—¶æ’å…¥æŠ¢å æ£€æŸ¥æŒ‡ä»¤, åœ¨å‡½æ•°è°ƒç”¨æ—¶æ£€æŸ¥å½“å‰ Goroutine æ˜¯å¦å‘èµ·äº†æŠ¢å è¯·æ±‚, å®ç°åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦ï¼›</li><li>Goroutine å¯èƒ½ä¼šå› ä¸ºåƒåœ¾å›æ”¶å’Œå¾ªç¯é•¿æ—¶é—´å ç”¨èµ„æºå¯¼è‡´ç¨‹åºæš‚åœï¼›</li></ul></li><li>åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦å™¨ - 1.14 ~ è‡³ä»Š<ul><li>å®ç°<strong>åŸºäºä¿¡å·çš„çœŸæŠ¢å å¼è°ƒåº¦</strong>ï¼›</li><li>åƒåœ¾å›æ”¶åœ¨æ‰«ææ ˆæ—¶ä¼šè§¦å‘æŠ¢å è°ƒåº¦ï¼›</li><li>æŠ¢å çš„æ—¶é—´ç‚¹ä¸å¤Ÿå¤š, è¿˜ä¸èƒ½è¦†ç›–å…¨éƒ¨çš„è¾¹ç¼˜æƒ…å†µï¼›</li></ul></li></ul><p>å¯¹ Go è¯­è¨€å¹¶å‘æ¨¡å‹çš„ä¿®æ”¹æå‡äº†è°ƒåº¦å™¨çš„æ€§èƒ½, ä½†æ˜¯ 1.1 ç‰ˆæœ¬ä¸­çš„è°ƒåº¦å™¨ä»ç„¶ä¸æ”¯æŒæŠ¢å å¼è°ƒåº¦, ç¨‹åºåªèƒ½ä¾é  Goroutine ä¸»åŠ¨è®©å‡º CPU èµ„æºæ‰èƒ½è§¦å‘è°ƒåº¦</p><h5 id="åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦å™¨">åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦å™¨</h5><p>Go è¯­è¨€çš„è°ƒåº¦å™¨åœ¨ 1.2 ç‰ˆæœ¬ä¸­å¼•å…¥åŸºäºåä½œçš„æŠ¢å å¼è°ƒåº¦è§£å†³ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>æŸäº› Goroutine å¯ä»¥é•¿æ—¶é—´å ç”¨çº¿ç¨‹, é€ æˆå…¶å®ƒ Goroutine çš„é¥¥é¥¿</li><li>åƒåœ¾å›æ”¶éœ€è¦æš‚åœæ•´ä¸ªç¨‹åºï¼ˆStop-the-world, STWï¼‰, æœ€é•¿å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´, å¯¼è‡´æ•´ä¸ªç¨‹åºæ— æ³•å·¥ä½œ</li></ul><p>1.2 ç‰ˆæœ¬çš„æŠ¢å å¼è°ƒåº¦è™½ç„¶èƒ½å¤Ÿç¼“è§£è¿™ä¸ªé—®é¢˜, ä½†æ˜¯å®ƒå®ç°çš„æŠ¢å å¼è°ƒåº¦æ˜¯åŸºäºåä½œçš„, åœ¨ä¹‹åå¾ˆé•¿çš„ä¸€æ®µæ—¶é—´é‡Œ Go è¯­è¨€çš„è°ƒåº¦å™¨éƒ½æœ‰ä¸€äº›æ— æ³•è¢«æŠ¢å çš„è¾¹ç¼˜æƒ…å†µ, ä¾‹å¦‚ï¼šfor å¾ªç¯æˆ–è€…åƒåœ¾å›æ”¶é•¿æ—¶é—´å ç”¨çº¿ç¨‹, è¿™äº›é—®é¢˜ä¸­çš„ä¸€éƒ¨åˆ†ç›´åˆ° 1.14 æ‰è¢«åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦è§£å†³</p><h5 id="åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦å™¨">åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦å™¨</h5><p>Go è¯­è¨€åœ¨ 1.14 ç‰ˆæœ¬ä¸­å®ç°äº†éåä½œçš„æŠ¢å å¼è°ƒåº¦, åœ¨å®ç°çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬é‡æ„å·²æœ‰çš„é€»è¾‘å¹¶ä¸º Goroutine å¢åŠ æ–°çš„çŠ¶æ€å’Œå­—æ®µæ¥æ”¯æŒæŠ¢å ã€‚Go å›¢é˜Ÿé€šè¿‡ä¸‹é¢çš„ä¸€ç³»åˆ—æäº¤å®ç°äº†è¿™ä¸€åŠŸèƒ½, æˆ‘ä»¬å¯ä»¥æŒ‰æ—¶é—´é¡ºåºåˆ†æç›¸å…³æäº¤ç†è§£å®ƒçš„å·¥ä½œåŸç†</p><h2 id="è°ƒåº¦å™¨çš„-GMP-æ¨¡å‹">è°ƒåº¦å™¨çš„ GMP æ¨¡å‹</h2><p><img src="/asset/golang/images/GMP.png" alt="gmp"></p><p>Processor,è™šæ‹Ÿå¤„ç†å™¨ï¼ŒMå’ŒGæ‰€éœ€è¦çš„èµ„æºçš„ä¸Šä¸‹æ–‡ï¼Œ ç¨‹åºå¯åŠ¨æ—¶åˆ›å»º, æœ€å¤§ GOMAXPROCS å¯ä»¥è®¾ç½®æ•°é‡,  å®ƒåŒ…å«äº†è¿è¡Œ goroutine çš„èµ„æº, å¦‚æœMæƒ³è¿è¡Œ goroutine, å¿…é¡»å…ˆè·å– P, P ä¸­è¿˜åŒ…å«äº†å¯è¿è¡Œçš„ G é˜Ÿåˆ—ï¼ˆæœ€å¤§256ä¸ªï¼‰,</p><p>M , golang å¯¹ç³»ç»Ÿçº¿ç¨‹çš„å°è£…, çœŸæ­£æ‰§è¡Œä»£ç å¿…é¡»è¦æœ‰çº¿ç¨‹, æ“ä½œç³»ç»Ÿåˆ†é…åˆ°åº”ç”¨ç¨‹åºçš„å†…æ ¸çº¿ç¨‹æ•°, é»˜è®¤æœ€å¤§é‡10000ä¸ª, å¦‚æœæœ‰Mé˜»å¡, ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„M, å¦‚æœMç©ºé—², Mä¼šè¢«å›æ”¶æˆ–è€…ç¡çœ </p><p>æ–°åˆ›å»ºçš„Gä¼˜å…ˆæ”¾åœ¨Pçš„ç­‰å¾…é˜Ÿåˆ—ä¸­, å¦‚æœGæ»¡äº†, æ”¾å…¥åˆ°å…¨å±€çš„ç­‰å¾…é˜Ÿåˆ—ä¸­</p><p>Gçš„çŠ¶æ€</p><pre><code class="hljs">- ç©ºé—²ä¸­ _Gidleåˆšåˆšè¢«åˆ†é…å¹¶ä¸”è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–- ç­‰å¾…è¿è¡Œ _Grunnable æ²¡æœ‰æ‰§è¡Œä»£ç ï¼Œæ²¡æœ‰æ ˆçš„æ‰€æœ‰æƒï¼Œå­˜å‚¨åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­- è¿è¡Œä¸­ _Grunning å¯ä»¥æ‰§è¡Œä»£ç ï¼Œæ‹¥æœ‰æ ˆçš„æ‰€æœ‰æƒï¼Œè¢«èµ‹äºˆäº†å†…æ ¸çº¿ç¨‹ M å’Œå¤„ç†å™¨ P- ç³»ç»Ÿè°ƒç”¨ä¸­ _Gsyscall æ­£åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ‹¥æœ‰æ ˆçš„æ‰€æœ‰æƒï¼Œæ²¡æœ‰æ‰§è¡Œç”¨æˆ·ä»£ç ï¼Œè¢«èµ‹äºˆäº†å†…æ ¸çº¿ç¨‹ M ä½†æ˜¯ä¸åœ¨è¿è¡Œé˜Ÿåˆ—ä¸Š- ç­‰å¾…ä¸­ _Gwaiting ç”±äºè¿è¡Œæ—¶è€Œè¢«é˜»å¡ï¼Œæ²¡æœ‰æ‰§è¡Œç”¨    _Gpreemptedç”±äºæŠ¢å è€Œè¢«é˜»å¡ï¼Œæ²¡æœ‰æ‰§è¡Œç”¨æˆ·ä»£ç å¹¶ä¸”ä¸åœ¨è¿è¡Œé˜Ÿåˆ—ä¸Šï¼Œç­‰å¾…å”¤é†’- æˆ·ä»£ç å¹¶ä¸”ä¸åœ¨è¿è¡Œé˜Ÿåˆ—ä¸Šï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨äº Channel çš„ç­‰å¾…é˜Ÿåˆ—ä¸Š- å·²ç»ˆæ­¢ _Gdeadæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œæ²¡æœ‰æ‰§è¡Œä»£ç ï¼Œå¯èƒ½æœ‰åˆ†é…çš„æ ˆ- _Gcopystackæ ˆæ­£åœ¨è¢«æ‹·è´ï¼Œæ²¡æœ‰æ‰§è¡Œä»£ç ï¼Œä¸åœ¨è¿è¡Œé˜Ÿåˆ—ä¸Š</code></pre><h3 id="è°ƒåº¦ç­–ç•¥">è°ƒåº¦ç­–ç•¥</h3><ul><li><p>å¤ç”¨çº¿ç¨‹</p><ul><li><p>work-stealing</p><p>å½“å‰å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ä¸­ä¸åŒ…å« G æ—¶, è°ƒç”¨ä¼šè§¦å‘å·¥ä½œçªƒå–, åˆ™å»å…¨å±€é˜Ÿåˆ—å·å–ä¸€éƒ¨åˆ†Gï¼Œå¦‚æœå…¨å±€é˜Ÿåˆ—ä¹Ÿæ˜¯ç©ºçš„ï¼Œåˆ™å»å…¶ä»–çš„Pä¸­å·å–ä¸€éƒ¨åˆ†G</p><p>å¤„ç†å™¨æŒæœ‰ä¸€ä¸ªç”±å¯è¿è¡Œçš„ Goroutine ç»„æˆçš„ç¯å½¢çš„è¿è¡Œé˜Ÿåˆ— runq, è¿˜åå‘æŒæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚è°ƒåº¦å™¨åœ¨è°ƒåº¦æ—¶ä¼šä»å¤„ç†å™¨çš„é˜Ÿåˆ—ä¸­é€‰æ‹©é˜Ÿåˆ—å¤´çš„ Goroutine æ”¾åˆ°çº¿ç¨‹ M ä¸Šæ‰§è¡Œ</p><p>åŸºäºå·¥ä½œçªƒå–çš„å¤šçº¿ç¨‹è°ƒåº¦å™¨å°†æ¯ä¸€ä¸ªçº¿ç¨‹ç»‘å®šåˆ°äº†ç‹¬ç«‹çš„ CPU ä¸Š, è¿™äº›çº¿ç¨‹ä¼šè¢«ä¸åŒå¤„ç†å™¨ç®¡ç†, ä¸åŒçš„å¤„ç†å™¨é€šè¿‡å·¥ä½œçªƒå–å¯¹ä»»åŠ¡è¿›è¡Œå†åˆ†é…å®ç°ä»»åŠ¡çš„å¹³è¡¡, ä¹Ÿèƒ½æå‡è°ƒåº¦å™¨å’Œ Go è¯­è¨€ç¨‹åºçš„æ•´ä½“æ€§èƒ½, ä»Šå¤©æ‰€æœ‰çš„ Go è¯­è¨€æœåŠ¡éƒ½å—ç›Šäºè¿™ä¸€æ”¹åŠ¨</p></li><li><p>hand off</p><p>å½“Må¤„ç†çš„G,Gå¤„äºé˜»å¡æ—¶,Mé‡Šæ”¾ç»‘å®šçš„Pï¼ŒæŠŠPè½¬ç§»ç»™å…¶ä»–ç©ºé—²çš„Mæ‰§è¡Œ</p></li></ul></li><li><p>åˆ©ç”¨å¹¶è¡Œ</p><p>GOMAXPROCS è®¾ç½®Pçš„æ•°æ®ï¼Œæœ€å¤šæœ‰GOMAXPROCSä¸ªçº¿ç¨‹åˆ†å¸ƒåœ¨å¤šä¸ªCPUæ‰§è¡Œ</p></li><li><p>æŠ¢å <br>ä¸€ä¸ªGoroutine æœ€å¤šå ç”¨CPU 10ms,é˜²æ­¢å…¶ä»– Goroutine é¥¿æ­»</p></li><li><p>å…¨å±€ G é˜Ÿåˆ—<br>å½“ M æ‰§è¡Œ work-stealing ä¼šè·å–å…¨å±€é˜Ÿåˆ—çš„G</p></li></ul><h3 id="go-func-æ‰§è¡Œæµç¨‹">go func() æ‰§è¡Œæµç¨‹</h3><ol><li>go func() åˆ›å»ºGï¼ŒåŠ å…¥åˆ° P é˜Ÿåˆ—ä¸­</li><li>Gåªèƒ½åœ¨Mä¸­æ‰§è¡Œï¼ŒMå¿…é¡»æŒæœ‰ä¸€ä¸ªPï¼ŒMä¸Pæ˜¯1:1çš„å…³ç³»ï¼ŒMä»Pä¸­å–å‡ºGæ¥æ‰§è¡Œ</li><li>ä¸€ä¸ªMè°ƒåº¦Gæ‰§è¡Œæ˜¯ä¸€ä¸ªå¾ªç¯æœºåˆ¶(è°ƒåº¦-&gt;æ‰§è¡Œ-&gt;é”€æ¯-&gt;è¿”å›-&gt;è°ƒåº¦)</li><li>å¦‚æœGå‘ç”Ÿsyscallæˆ–è€…é˜»å¡ï¼ŒMä¼šé˜»å¡ï¼Œå¦‚æœå½“å‰æœ‰ä¸€äº›Gåœ¨æ‰§è¡Œï¼Œruntimeä¼šæŠŠè¿™ä¸ªMä»Pä¸­æ‘˜é™¤ï¼ˆdetachï¼‰ï¼Œé‡æ–°åˆ›å»ºæˆ–è€…æ‹¿å–ä¸€ä¸ªç©ºé—²çº¿ç¨‹ç”¨æ¥æœåŠ¡P</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang Channel</title>
    <link href="/2022/12/30/golang/channel/"/>
    <url>/2022/12/30/golang/channel/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒ ï¼š</p><p><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-channel">https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-channel</a></p><p><a href="https://www.bilibili.com/video/BV1kh411n79h">https://www.bilibili.com/video/BV1kh411n79h</a></p><p>ä¸è¦é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼è¿›è¡Œé€šä¿¡, è€Œæ˜¯åº”è¯¥é€šè¿‡é€šä¿¡çš„æ–¹å¼å…±äº«å†…å­˜</p><p>Channel æ˜¯ Goroutine ä¹‹é—´çš„é€šä¿¡æ–¹å¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> hchan <span class="hljs-keyword">struct</span> &#123;<br>qcount   <span class="hljs-type">uint</span><br>dataqsiz <span class="hljs-type">uint</span><br>buf      unsafe.Pointer<br>elemsize <span class="hljs-type">uint16</span><br>closed   <span class="hljs-type">uint32</span><br>elemtype *_type<br>sendx    <span class="hljs-type">uint</span><br>recvx    <span class="hljs-type">uint</span><br>recvq    waitq<br>sendq    waitq<br><br>lock mutex<br>&#125;<br><br><span class="hljs-keyword">type</span> waitq <span class="hljs-keyword">struct</span> &#123;<br>first *sudog<br>last  *sudog<br>&#125;<br><br><span class="hljs-keyword">type</span> sudog <span class="hljs-keyword">struct</span> &#123;<br>g *g<br><br>next *sudog<br>prev *sudog<br>elem unsafe.Pointer <span class="hljs-comment">// data element (may point to stack)</span><br><br>acquiretime <span class="hljs-type">int64</span><br>releasetime <span class="hljs-type">int64</span><br>ticket      <span class="hljs-type">uint32</span><br><br>isSelect <span class="hljs-type">bool</span><br><br>success <span class="hljs-type">bool</span><br><br>parent   *sudog <span class="hljs-comment">// semaRoot binary tree</span><br>waitlink *sudog <span class="hljs-comment">// g.waiting list or semaRoot</span><br>waittail *sudog <span class="hljs-comment">// semaRoot</span><br>c        *hchan <span class="hljs-comment">// channel</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>qcount â€” Channel ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼›</li><li>dataqsiz â€” Channel ä¸­çš„å¾ªç¯é˜Ÿåˆ—çš„é•¿åº¦ï¼›</li><li>buf â€” Channel çš„ç¼“å†²åŒºæ•°æ®æŒ‡é’ˆ,æ˜¯ä¸€ä¸ªç¯å½¢é˜Ÿåˆ—ï¼›</li><li>sendx â€” Channel çš„å‘é€æ“ä½œå¤„ç†åˆ°çš„ä½ç½®ï¼›</li><li>recvx â€” Channel çš„æ¥æ”¶æ“ä½œå¤„ç†åˆ°çš„ä½ç½®ï¼›</li><li>elemsize å’Œ elemtype åˆ†åˆ«è¡¨ç¤ºå½“å‰ Channel èƒ½å¤Ÿæ”¶å‘çš„å…ƒç´ ç±»å‹å’Œå¤§å°</li><li>sendq å’Œ recvq å­˜å‚¨äº†å½“å‰ Channel ç”±äºç¼“å†²åŒºç©ºé—´ä¸è¶³è€Œé˜»å¡çš„ Goroutine åˆ—è¡¨</li></ul><h3 id="å‘é€æ•°æ®">å‘é€æ•°æ®</h3><p>åœ¨å‘é€æ•°æ®çš„é€»è¾‘æ‰§è¡Œä¹‹å‰ä¼šå…ˆä¸ºå½“å‰ Channel åŠ é”, é˜²æ­¢å¤šä¸ªçº¿ç¨‹å¹¶å‘ä¿®æ”¹æ•°æ®ã€‚å¦‚æœ Channel å·²ç»å…³é—­, é‚£ä¹ˆå‘è¯¥ Channel å‘é€æ•°æ®æ—¶ä¼šæŠ¥ â€œsend on closed channelâ€ é”™è¯¯å¹¶ä¸­æ­¢ç¨‹åº</p><h4 id="ç›´æ¥å‘é€-æ— ç¼“å†²">ç›´æ¥å‘é€(æ— ç¼“å†²)</h4><p>å¦‚æœç›®æ ‡ Channel æ²¡æœ‰è¢«å…³é—­å¹¶ä¸”å·²ç»æœ‰å¤„äºè¯»ç­‰å¾…çš„ Goroutine, ä¼šä»æ¥æ”¶é˜Ÿåˆ— recvq ä¸­å–å‡ºæœ€å…ˆé™·å…¥ç­‰å¾…çš„ Goroutine å¹¶ç›´æ¥å‘å®ƒå‘é€æ•°æ®</p><h4 id="å‘é€æœ‰ç¼“å†²">å‘é€æœ‰ç¼“å†²</h4><p>åˆ›å»ºçš„ Channel åŒ…å«ç¼“å†²åŒºå¹¶ä¸” Channel ä¸­çš„æ•°æ®æ²¡æœ‰è£…æ»¡, è®¡ç®—å‡ºä¸‹ä¸€ä¸ªå¯ä»¥å­˜å‚¨æ•°æ®çš„ä½ç½®, ç„¶åå°†æ•°æ®æ‹·è´åˆ°ç¯å½¢é˜Ÿåˆ—ä¸­å¯¹åº”çš„ä½ç½®ä¸Š</p><h4 id="é˜»å¡å‘é€">é˜»å¡å‘é€</h4><p>ä¼šåˆ›å»ºä¸€ä¸ªç­‰å¾…ç»“æ„å¹¶å°†å…¶åŠ å…¥ Channel çš„ å‘é€é˜Ÿåˆ—ä¸­, å½“å‰ Goroutine ä¹Ÿä¼šé™·å…¥é˜»å¡, ç­‰å¾…å…¶ä»–çš„åç¨‹ä» Channel æ¥æ”¶æ•°æ®</p><h4 id="ä½¿ç”¨-select-å…³é”®å­—å¯ä»¥å‘-Channel-éé˜»å¡åœ°å‘é€æ¶ˆæ¯">ä½¿ç”¨ select å…³é”®å­—å¯ä»¥å‘ Channel éé˜»å¡åœ°å‘é€æ¶ˆæ¯</h4><p>runtime.selectnbsend()</p><p>æœ¬è´¨ä¸Šæ˜¯åœ¨ chansend() ä¸ŠåŠ äº†åˆ¤æ–­</p><p>###æ¥å—æ¶ˆæ¯</p><ul><li>å½“å­˜åœ¨ç­‰å¾…çš„å‘é€è€…æ—¶, ä»é˜»å¡çš„å‘é€è€…æˆ–è€…ç¼“å†²åŒºä¸­è·å–æ•°æ®</li><li>å½“ç¼“å†²åŒºå­˜åœ¨æ•°æ®æ—¶, ä» Channel çš„ç¼“å†²åŒºä¸­æ¥æ”¶æ•°æ®</li><li>å½“ç¼“å†²åŒºä¸­ä¸å­˜åœ¨æ•°æ®æ—¶, ç­‰å¾…å…¶ä»– Goroutine å‘ Channel å‘é€æ•°æ®</li></ul><h4 id="ç›´æ¥æ¥æ”¶-æ— ç¼“å†²">ç›´æ¥æ¥æ”¶(æ— ç¼“å†²)</h4><p>å°† Channel (sendq)å‘é€é˜Ÿåˆ—ä¸­ Goroutine å­˜å‚¨çš„ elem æ•°æ®æ‹·è´åˆ°ç›®æ ‡å†…å­˜åœ°å€ä¸­</p><h4 id="ç¼“å†²åŒºæœ‰æ•°æ®">ç¼“å†²åŒºæœ‰æ•°æ®</h4><p>å¦‚æœ Channel çš„ sendq å‘é€é˜Ÿåˆ—ä¸­å­˜åœ¨æŒ‚èµ·çš„ Goroutine, ä¼šå°† recvx è·å–ç´¢å¼•æ‰€åœ¨çš„æ•°æ®æ‹·è´åˆ°æ¥æ”¶å˜é‡æ‰€åœ¨çš„å†…å­˜ç©ºé—´ä¸Šå¹¶å°† sendq å‘é€é˜Ÿåˆ—ä¸­ Goroutine çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒº<br>, ç„¶åç›´æ¥è¯»å– recvx è·å–ç´¢å¼•å¯¹åº”çš„æ•°æ®</p><h4 id="ç¼“å†²åŒºæ²¡æœ‰æ•°æ®">ç¼“å†²åŒºæ²¡æœ‰æ•°æ®</h4><p>åˆ›å»ºä¸€ä¸ªç­‰å¾…ç»“æ„å¹¶å°†å…¶åŠ å…¥ Channel çš„æ¥å—é˜Ÿåˆ—ä¸­, å½“å‰ Goroutine é™·å…¥é˜»å¡, ç­‰å¾…è°ƒåº¦å™¨çš„å”¤é†’</p><h4 id="è§¦å‘-Goroutine-è°ƒåº¦çš„ä¸¤ä¸ªæ—¶æœºï¼š">è§¦å‘ Goroutine è°ƒåº¦çš„ä¸¤ä¸ªæ—¶æœºï¼š</h4><ul><li>å½“ Channel ä¸ºç©ºæ—¶ï¼›</li><li>å½“ç¼“å†²åŒºä¸­ä¸å­˜åœ¨æ•°æ®å¹¶ä¸”ä¹Ÿä¸å­˜åœ¨æ•°æ®çš„å‘é€è€…æ—¶</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang å®šæ—¶å™¨ cpu ä½¿ç”¨ç‡è¿‡é«˜çš„é—®é¢˜</title>
    <link href="/2022/09/06/blog/golang/golang_time_cpu/"/>
    <url>/2022/09/06/blog/golang/golang_time_cpu/</url>
    
    <content type="html"><![CDATA[<p>æ—©ä¸Šæ‰“å¼€ç”µè„‘æ‘¸é±¼çš„æ—¶å€™å‘ç°å…¬å¸çš„æµ‹è¯•ç¯å¢ƒçš„ä¸€ä¸ªå¾®æœåŠ¡CPUå•æ ¸å ç”¨ç‡åˆ°äº†99%,å› ä¸ºæ˜¯æ ¸å¿ƒæœåŠ¡,ä¸€ç›´ä»¥ä¸ºæ˜¯å¤„ç†ä¸šåŠ¡é€»è¾‘çš„åŸå› , ä¸‹åˆçš„æ—¶å€™å°±é£™åˆ°äº†199%,è€Œä¸”å¾ˆç¨³å®šçš„ç»´æŒä¸­,å‘ç°ä¸å¯¹åŠ²,å»å…¶ä»–ç¯å¢ƒä¸€çœ‹,æœç„¶è¿™ä¸ªæœåŠ¡çš„CPUå ç”¨ç‡éƒ½ä¸æ­£å¸¸, å¾ˆå¯æƒœæ²¡æœ‰å¯¹è¿™ä¸ªæœåŠ¡å¼€å¯pprof,æ‰¾ä¸åˆ°å…·ä½“åŸå› , çœ‹çœ‹ä»£ç , å¾ˆé¡ºåˆ©æ‰¾åˆ°åŸå› </p><p>çœ‹åˆ°ä»£ç æ—¶ç«‹é©¬æƒ³åˆ°äº†å½“å¹´çœ‹è¿‡ç¾¤ä¸»çš„è¿™ç¯‡<a href="https://xiaorui.cc/archives/5117">blog</a></p><p>åŸå› è¿˜æ˜¯é”æŠ¢å çš„é—®é¢˜</p><p>demo å¦‚ä¸‹</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs golang"><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>     <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">100</span>; i++ &#123;<br>       <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>         timeOut := time.NewTimer(time.Second * <span class="hljs-number">120</span>)<br>         t := time.NewTicker(time.Millisecond * <span class="hljs-number">50</span>)<br>         <span class="hljs-keyword">for</span> &#123;<br>           <span class="hljs-keyword">select</span> &#123;<br>           <span class="hljs-keyword">case</span> &lt;-t.C:<br>              ...check<br>           <span class="hljs-keyword">case</span> &lt;-timeOut.C:<br>             <span class="hljs-keyword">break</span><br>           &#125;<br>         &#125;<br>       &#125;()<br>     &#125;<br>   &#125;()<br> &#125;<br><br></code></pre></td></tr></table></figure><p>ç¨å¾®åŠ å¤§åç¨‹è¿è¡Œç­‰å¾…ä¸€æ®µæ—¶é—´,cpuå ç”¨ç‡æœç„¶ä¸Šæ¥äº†</p><p><img src="/asset/blog/golang/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20221228215317.jpg" alt="cpuå ç”¨ç‡"></p><p>åæ¥é‡æ„äº†è¿™å—ä»£ç ,ä¸åœ¨ä½¿ç”¨time.NewTickeræ‰è§£å†³è¿™ä¸ªé—®é¢˜</p>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PDF</title>
    <link href="/2022/08/04/PDF/pdf/"/>
    <url>/2022/08/04/PDF/pdf/</url>
    
    <content type="html"><![CDATA[<hr><p><a href="https://pan.baidu.com/s/1LC_-Ptl7pxR2jXBKPyLHOg">Goå…«è‚¡æ–‡å¤§å…¨.pdf</a></p><p>æå–ç ï¼šb7ep</p><hr><p><a href="https://pan.baidu.com/s/1SdRD_1xHfVHZpYk2ltE4Lg">Goé¢è¯•é¢˜new.pdf</a></p><p>æå–ç ï¼šo399</p><hr><p><a href="https://pan.baidu.com/s/1amYZ7Je5lqympHgYLWUfag">Kubernetes in Actionä¸­æ–‡ç‰ˆ.pdf</a></p><p>æå–ç ï¼š77r2<br>docker run -d --name etcd-server --publish 2379:2379 --publish 2380:2380 --env ALLOW_NONE_AUTHENTICATION=yes --env ETCD_ADVERTISE_CLIENT_URLS=<a href="http://etcd-server:2379">http://etcd-server:2379</a> bitnami/etcd:latest</p>]]></content>
    
    
    
    <tags>
      
      <tag>PDF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NACOS å®‰è£…</title>
    <link href="/2022/07/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/Nacos/install/"/>
    <url>/2022/07/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/Nacos/install/</url>
    
    <content type="html"><![CDATA[<h4 id="docker-å®‰è£…-NACOS">docker å®‰è£… NACOS</h4><p>NACOS å½“å‰ç‰ˆæœ¬  2.2.2</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>docker <span class="hljs-built_in">run</span> -d -p 8848:8848 -p 9848:9848 -e <span class="hljs-attribute">MODE</span>=standalone \<br>-e <span class="hljs-attribute">PREFER_HOST_MODE</span>=hostname \<br>-e <span class="hljs-attribute">NACOS_AUTH_ENABLE</span>=<span class="hljs-literal">true</span> \<br>-e <span class="hljs-attribute">NACOS_AUTH_IDENTITY_KEY</span>=test \<br>-e <span class="hljs-attribute">NACOS_AUTH_IDENTITY_VALUE</span>=test \<br>-e <span class="hljs-attribute">NACOS_AUTH_TOKEN</span>=MTIzNDU2Nzg5MTIzNDU2Nzg5MTIzNDU2Nzg5MTIzNDU2Nzg5 \<br>-v <span class="hljs-variable">$HOME</span>/nacos/logs:/home/nacos/logs \<br>--restart always --name nacos nacos/nacos-server<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">è®¿é—®åœ°å€ http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8848</span>/nacos<br>é»˜è®¤è´¦å·å¯†ç  <br>nacos<br>nacos<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">æŒ‚è½½è‡ªå®šä¹‰config,éœ€è¦<br><br>-v <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/nacos/</span>config<span class="hljs-regexp">/application.properties:/</span>home<span class="hljs-regexp">/nacos/</span>conf/application.properties \<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>NACOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®æœåŠ¡æ¡†æ¶ go-micro ä½¿ç”¨ Kafka ä½œä¸ºå‘å¸ƒè®¢é˜…çš„ Broker</title>
    <link href="/2022/06/26/blog/golang/go_micro_use_kafka/"/>
    <url>/2022/06/26/blog/golang/go_micro_use_kafka/</url>
    
    <content type="html"><![CDATA[<h3 id="å¾®æœåŠ¡æ¡†æ¶-go-micro-ä½¿ç”¨-Kafka-ä½œä¸ºå‘å¸ƒè®¢é˜…çš„-Broker">å¾®æœåŠ¡æ¡†æ¶ go-micro ä½¿ç”¨ Kafka ä½œä¸ºå‘å¸ƒè®¢é˜…çš„ Broker</h3><p>go-micro é»˜è®¤ä½¿ç”¨httpæœåŠ¡ä½œä¸ºæœåŠ¡ä¸­çš„Broker</p><p>æœåŠ¡é»˜è®¤å¯åŠ¨çš„æ—¶å€™</p><p><img src="/asset/blog/golang/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230226174740.png" alt="http"></p><p>ä½¿ç”¨kafkaå¯åŠ¨<br><img src="/asset/blog/golang/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230226180820.png" alt="kafka"></p><p>httpæœåŠ¡ä½œä¸ºæœåŠ¡ä¸­çš„Brokerï¼Œæœ‰ä¸‰ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼š</p><ol><li><p>ä¸èƒ½æŒä¹…åŒ–å­˜å‚¨</p></li><li><p>ä¸èƒ½å¯¹æœªæ¶ˆè´¹çš„æ•°æ®ï¼Œè¿›è¡Œæ¶ˆè´¹</p></li><li><p>æ¯ä¸ªéœ€è¦å‘é€æ¶ˆæ¯çš„å¾®æœåŠ¡éƒ½ä¼šå¯åŠ¨ä¸€ä¸ª http BrokeræœåŠ¡ï¼Œå¯èƒ½ä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½</p></li></ol><p>broker interface</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Broker <span class="hljs-keyword">interface</span> &#123;<br>Init(...Option) <span class="hljs-type">error</span><br>Options() Options<br>Address() <span class="hljs-type">string</span><br>Connect() <span class="hljs-type">error</span><br>Disconnect() <span class="hljs-type">error</span><br>Publish(topic <span class="hljs-type">string</span>, m *Message, opts ...PublishOption) <span class="hljs-type">error</span><br>Subscribe(topic <span class="hljs-type">string</span>, h Handler, opts ...SubscribeOption) (Subscriber, <span class="hljs-type">error</span>)<br>String() <span class="hljs-type">string</span><br>&#125;<br></code></pre></td></tr></table></figure><p>go-micro pluginä¹Ÿé›†æˆäº† Kafka</p><p>æ¥å—ç«¯æ¥å—æ¶ˆæ¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;github.com/micro/go-micro/v2&quot;</span><br><span class="hljs-string">&quot;github.com/micro/go-micro/v2/metadata&quot;</span><br><span class="hljs-string">&quot;github.com/micro/go-micro/v2/util/log&quot;</span><br>proto <span class="hljs-string">&quot;go14/micro/cmds/pubsub/push/proto&quot;</span><br><br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;github.com/micro/go-micro/v2/broker&quot;</span><br><span class="hljs-string">&quot;github.com/micro/go-plugins/broker/kafka/v2&quot;</span><br>)<br><br><span class="hljs-comment">// Sub ç»“æ„ä½“æ‰€æœ‰èƒ½è¢«æš´éœ²çš„æ–¹æ³•éƒ½ä¼šæ‰§è¡Œæ¶ˆæ¯å¤„ç†çš„é€»è¾‘</span><br><span class="hljs-keyword">type</span> Sub <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Sub)</span></span> Process(ctx context.Context, event *proto.Event) <span class="hljs-type">error</span> &#123;<br>md, _ := metadata.FromContext(ctx)<br>log.Logf(<span class="hljs-string">&quot;[pubsub.1] Received event %+v with metadata %+v\n&quot;</span>, event, md)<br><span class="hljs-comment">// do something with event</span><br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">// func å½¢å¼ä¹Ÿèƒ½å¤„ç†å¯¹åº”çš„event</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">subEv</span><span class="hljs-params">(ctx context.Context, event *proto.Event)</span></span> <span class="hljs-type">error</span> &#123;<br>md, _ := metadata.FromContext(ctx)<br>log.Logf(<span class="hljs-string">&quot;[pubsub.2] Received event %+v with metadata %+v\n&quot;</span>, event, md)<br><span class="hljs-comment">// do something with event</span><br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><br><span class="hljs-comment">// è®¾ç½®DefaultBrokerä¸º kafka çš„ Broker</span><br>broker.DefaultBroker = kafka.NewBroker()<br><span class="hljs-comment">// init kafkaçš„åœ°å€</span><br><span class="hljs-keyword">if</span> err := broker.Init(broker.Addrs(<span class="hljs-string">&quot;192.168.163.121:9092&quot;</span>),); err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Broker Init error: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-comment">// åˆ›å»ºservice</span><br>service := micro.NewService(<br>micro.Name(<span class="hljs-string">&quot;go.micro.srv.pubsub&quot;</span>),<br>micro.Broker(broker.DefaultBroker),<br>)<br><br><span class="hljs-comment">// è®¢é˜…æ¶ˆæ¯</span><br><span class="hljs-keyword">if</span> err := micro.RegisterSubscriber(<span class="hljs-string">&quot;example.topic.pubsub.1&quot;</span>, service.Server(), <span class="hljs-built_in">new</span>(Sub));err !=<span class="hljs-literal">nil</span>&#123;<br>log.Fatalf(<span class="hljs-string">&quot;RegisterSubscriber Init error: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-keyword">if</span> err := micro.RegisterSubscriber(<span class="hljs-string">&quot;example.topic.pubsub.2&quot;</span>, service.Server(), subEv);err !=<span class="hljs-literal">nil</span>&#123;<br>log.Fatalf(<span class="hljs-string">&quot;RegisterSubscriber Init error: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-keyword">if</span> err := service.Run(); err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å‘é€ç«¯å‘é€æ¶ˆæ¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/micro/go-micro/v2/client&quot;</span><br><span class="hljs-string">&quot;strconv&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br><br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;github.com/micro/go-micro/v2&quot;</span><br><span class="hljs-string">&quot;github.com/micro/go-micro/v2/util/log&quot;</span><br>proto <span class="hljs-string">&quot;go14/micro/cmds/pubsub/push/proto&quot;</span><br><br><span class="hljs-string">&quot;github.com/micro/go-micro/v2/broker&quot;</span><br><span class="hljs-string">&quot;github.com/micro/go-plugins/broker/kafka/v2&quot;</span><br>)<br><br><span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendEv</span><span class="hljs-params">(topic <span class="hljs-type">string</span>, p micro.Publisher)</span></span> &#123;<br>t := time.NewTicker(time.Second)<br><br><span class="hljs-keyword">for</span> _ = <span class="hljs-keyword">range</span> t.C &#123;<br><span class="hljs-comment">// åˆ›å»ºæ¶ˆæ¯ç»“æ„</span><br>ev := &amp;proto.Event&#123;<br>Id: strconv.FormatInt(time.Now().Unix(), <span class="hljs-number">10</span>),<br>Timestamp: time.Now().Unix(),<br>Message:   fmt.Sprintf(<span class="hljs-string">&quot;Messaging you all day on %s&quot;</span>, topic),<br>&#125;<br>log.Logf(<span class="hljs-string">&quot;publishing %+v\n&quot;</span>, ev)<br><span class="hljs-comment">// publish æ¶ˆæ¯</span><br><span class="hljs-keyword">if</span> err := p.Publish(context.Background(), ev); err != <span class="hljs-literal">nil</span> &#123;<br>log.Logf(<span class="hljs-string">&quot;error publishing: %v&quot;</span>, err)<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// è®¾ç½®DefaultBrokerä¸º kafka çš„ Broker</span><br>broker.DefaultBroker = kafka.NewBroker()<br><span class="hljs-comment">// init kafkaçš„åœ°å€</span><br><span class="hljs-keyword">if</span> err := broker.Init(broker.Addrs(<span class="hljs-string">&quot;192.168.163.121:9092&quot;</span>),); err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Broker Init error: %v&quot;</span>, err)<br>&#125;<br><br>service := micro.NewService(<br>micro.Name(<span class="hljs-string">&quot;go.micro.cli.pubsub&quot;</span>),<br>)<br><br>_ = service.Client().Init(client.Broker(broker.DefaultBroker))<br><span class="hljs-comment">// create publisher</span><br>pub1 := micro.NewEvent(<span class="hljs-string">&quot;example.topic.pubsub.1&quot;</span>, service.Client())<br>pub2 := micro.NewEvent(<span class="hljs-string">&quot;example.topic.pubsub.2&quot;</span>, service.Client())<br><br><span class="hljs-comment">// pub to topic 1</span><br><span class="hljs-keyword">go</span> sendEv(<span class="hljs-string">&quot;example.topic.pubsub.1&quot;</span>, pub1)<br><span class="hljs-comment">// pub to topic 2</span><br><span class="hljs-keyword">go</span> sendEv(<span class="hljs-string">&quot;example.topic.pubsub.2&quot;</span>, pub2)<br><br><span class="hljs-keyword">select</span> &#123;&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>pubsub.proto</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs proto">syntax = &quot;proto3&quot;;<br>package pubsub;<br>option go_package=&quot;/grpc&quot;;<br>// Example message<br>message Event &#123;<br>  // unique id<br>  string id = 1;<br>  // unix timestamp<br>  int64 timestamp = 2;<br>  // message<br>  string message = 3;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>go-micro</tag>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœåŠ¡å™¨æ—¶é—´å¯¼è‡´æœåŠ¡å´©æºƒ</title>
    <link href="/2022/04/06/blog/article/bug_for_the_server_date/"/>
    <url>/2022/04/06/blog/article/bug_for_the_server_date/</url>
    
    <content type="html"><![CDATA[<h3 id="center-æœåŠ¡å™¨æ—¶é—´å¯¼è‡´æœåŠ¡å´©æºƒ-center"><center>æœåŠ¡å™¨æ—¶é—´å¯¼è‡´æœåŠ¡å´©æºƒ</center></h3><p>æµ‹è¯•åé¦ˆæœ€è¿‘ç‰ˆæœ¬å‘å¸ƒå®Œ,å†…ç½‘æ¼”ç¤ºç¯å¢ƒæœåŠ¡æµ‹è¯•çš„æ—¶å€™,æœåŠ¡å¡é¡¿æ˜ç»†,è®©æˆ‘æ‰¾æ‰¾é—®é¢˜</p><p>çˆ¬åˆ°æœåŠ¡å™¨ä¸Šä¸€çœ‹,æ•°æ®åº“è´Ÿè½½åˆ°äº†20å¤š</p><p>top + iostat ä¸€çœ‹, å¥½å®¶ä¼™, ç£ç›˜IOæ‹‰æ»¡äº†</p><p>å‡è£…åˆ†æä¸€æ³¢å‘ç° mongodump è¿™ä¸ªè¿›ç¨‹åœ¨ top ä¸­æ’ç¬¬ä¸€ä½, åŸæ¥æ˜¯åœ¨å¤‡ä»½æ•°æ®å•Š,å¿™é—®äº†ä¸€ä¸‹é¢†å¯¼, å›å¤è¯´æ²¡æœ‰è¿›è¡Œæ•°æ®å¤‡ä»½</p><p>ä»”ç»†æƒ³äº†ä¸€ä¸‹ crontab é‡Œé¢æœ‰å®šæ—¶æ•°æ®åº“å¤‡ä»½çš„ä»»åŠ¡,å‡Œæ™¨3ç‚¹ä¼šå®šæ—¶å¤‡ä»½æ•°æ®åº“</p><p>æŸ¥çœ‹äº†ä¸€ä¸‹æœåŠ¡å™¨çš„ date å‘ç°æ—¶åŒºæ˜¯æ ‡å‡†æ—¶åŒºå¯¼è‡´å‡Œæ™¨3ç‚¹å¤‡ä»½æ•°æ®å®é™…æ˜¯ä¸Šåˆ11ç‚¹</p><p>æ­¤æ—¶åˆæƒ³èµ·ä¸Šæ¬¡ä¸€ä¸ªé—®é¢˜, æœåŠ¡ç«¯å› ä¸ºæ—¶é—´é—®é¢˜æ ¡éªŒç”¨æˆ· Token æ°¸è¿œæ˜¯è¿‡æœŸçš„,å¯¼è‡´ç”¨æˆ·ä¸€ç›´åœ¨ç”Ÿæˆæ–°çš„Token, è¿›è¡Œæ ¡éªŒ, å‡ åˆ†é’Ÿè°ƒç”¨äº†åå‡ ä¸‡æ¬¡ç”ŸæˆTokenæ¥å£</p><p>ä»¤äººæ„Ÿæ…¨,å¯çœŸæ˜¯æ˜æ˜ä¸€ç‚¹ç‚¹å°é—®é¢˜,å´ç›´æ¥èƒ½æŠŠæœåŠ¡å¼„å´©æºƒ</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ€è€ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kafka æ¶ˆæ¯é˜Ÿåˆ—</title>
    <link href="/2022/03/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/Kafka/"/>
    <url>/2022/03/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/Kafka/</url>
    
    <content type="html"><![CDATA[<h3 id="Kafkaç‰¹ç‚¹ï¼š">Kafkaç‰¹ç‚¹ï¼š</h3><pre><code class="hljs">1 è§£è€¦åˆ æ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†å€Ÿå£, ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…èƒ½å¤Ÿç‹¬ç«‹çš„å®Œæˆè¯»æ“ä½œå’Œå†™æ“ä½œã€‚2 é«˜ååç‡ã€‚å³ä½¿æ˜¯åœ¨å»‰ä»·çš„å•†ç”¨æœºå™¨ä¸Šä¹Ÿèƒ½åšåˆ°å•æœºæ”¯æŒæ¯ç§’100Kæ¡æ¶ˆæ¯çš„ä¼ è¾“3 ä¿¡æ¯ä¼ è¾“å¿«ã€‚ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºOï¼ˆ1ï¼‰çš„æ–¹å¼æä¾›æŒä¹…åŒ–èƒ½åŠ›, å³ä½¿å¯¹TBçº§ä»¥ä¸Šæ•°æ®ä¹Ÿèƒ½ä¿è¯å¸¸æ•°æ—¶é—´çš„è®¿é—®æ€§èƒ½4 å¯æä¾›æŒä¹…åŒ–ã€‚æ¶ˆæ¯å­˜å‚¨åœ¨ä¸­é—´ä»¶ä¸Š, æ•°æ®æŒä¹…åŒ–, ç›´åˆ°å…¨éƒ¨è¢«å¤„ç†å®Œ, é€šè¿‡è¿™ä¸€æ–¹å¼è§„é¿äº†æ•°æ®ä¸¢å¤±çš„é£é™©</code></pre><h3 id="Kafkaé€‚ç”¨åœºæ™¯">Kafkaé€‚ç”¨åœºæ™¯</h3><pre><code class="hljs">æ ¹æ®ä¸Šè¿°åŠŸèƒ½å’Œç‰¹ç‚¹, Kafkaä¸»è¦æœ‰ä»¥ä¸‹ä½¿ç”¨åœºæ™¯ï¼šä¿¡æ¯ç³»ç»Ÿ Messaging ã€‚ åœ¨è¿™ä¸ªé¢†åŸŸä¸­, Kafkaå¸¸å¸¸è¢«æ‹¿æ¥ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œå¯¹æ¯”, å¦‚RabbitMQã€‚ç½‘ç«™æ´»åŠ¨è¿½è¸ª Website Activity Trackingç›‘æ§ Metricsæ—¥å¿—æ”¶é›† Log Aggregationæµå¤„ç† Stream Processingäº‹ä»¶æº¯æº Event Sourcingæäº¤æ—¥å¿— Commit Log</code></pre><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka/images/kafka.jpeg" alt="Kafkaæ¶æ„"></p><h3 id="Kafkaæ¶æ„å›¾">Kafkaæ¶æ„å›¾</h3><pre><code class="hljs">Producer ï¼š æ¶ˆæ¯ç”Ÿäº§è€…, å°±æ˜¯å‘ Kafkaå‘é€æ•°æ® ï¼›Consumer ï¼š æ¶ˆæ¯æ¶ˆè´¹è€…, ä» Kafka broker å–æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼›Consumer Group ï¼ˆCGï¼‰ï¼š æ¶ˆè´¹è€…ç»„, ç”±å¤šä¸ª consumer ç»„æˆã€‚ æ¶ˆè´¹è€…ç»„å†…æ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®, ä¸€ä¸ªåˆ†åŒºåªèƒ½ç”±ä¸€ä¸ªç»„å†…æ¶ˆè´¹è€…æ¶ˆè´¹ï¼›æ¶ˆè´¹è€…ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚ æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½å±äºæŸä¸ªæ¶ˆè´¹è€…ç»„, å³æ¶ˆè´¹è€…ç»„æ˜¯é€»è¾‘ä¸Šçš„ä¸€ä¸ªè®¢é˜…è€…ã€‚Broker ï¼šç»çºªäºº ä¸€å° Kafka æœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ª brokerã€‚ä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ª broker ç»„æˆã€‚ä¸€ä¸ª brokerå¯ä»¥å®¹çº³å¤šä¸ª topicã€‚Topic ï¼š è¯é¢˜, å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé˜Ÿåˆ—,  ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é¢å‘çš„éƒ½æ˜¯ä¸€ä¸ª topicï¼›Partitionï¼š ä¸ºäº†å®ç°æ‰©å±•æ€§, ä¸€ä¸ªéå¸¸å¤§çš„ topic å¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ª brokerï¼ˆå³æœåŠ¡å™¨ï¼‰ä¸Š, ä¸€ä¸ª topic å¯ä»¥åˆ†ä¸ºå¤šä¸ª partition, æ¯ä¸ª partition æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼›å¦‚æœä¸€ä¸ªtopicä¸­çš„partitionæœ‰5ä¸ª, é‚£ä¹ˆtopicçš„å¹¶å‘åº¦ä¸º5.Replicaï¼š å‰¯æœ¬ï¼ˆReplicationï¼‰, ä¸ºä¿è¯é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶,  è¯¥èŠ‚ç‚¹ä¸Šçš„ partition æ•°æ®ä¸ä¸¢å¤±, ä¸” Kafkaä»ç„¶èƒ½å¤Ÿç»§ç»­å·¥ä½œ,  Kafka æä¾›äº†å‰¯æœ¬æœºåˆ¶, ä¸€ä¸ª topic çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‹¥å¹²ä¸ªå‰¯æœ¬, ä¸€ä¸ª leader å’Œè‹¥å¹²ä¸ª followerã€‚Leaderï¼š æ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬çš„â€œä¸»â€, ç”Ÿäº§è€…å‘é€æ•°æ®çš„å¯¹è±¡, ä»¥åŠæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„å¯¹è±¡éƒ½æ˜¯ leaderã€‚Followerï¼š æ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬ä¸­çš„â€œä»â€, å®æ—¶ä» leader ä¸­åŒæ­¥æ•°æ®, ä¿æŒå’Œ leader æ•°æ®çš„åŒæ­¥ã€‚ leader å‘ç”Ÿæ•…éšœæ—¶, æŸä¸ª Follower ä¼šæˆä¸ºæ–°çš„ leaderã€‚Offset ï¼š æ¯ä¸ªConsumer æ¶ˆè´¹çš„ä¿¡æ¯éƒ½ä¼šæœ‰è‡ªå·±çš„åºå·, æˆ‘ä»¬ç§°ä½œå½“å‰é˜Ÿåˆ—çš„offsetã€‚å³æ¶ˆè´¹ç‚¹ä½æ ‡è¯†æ¶ˆè´¹åˆ°çš„ä½ç½®ã€‚æ¯ä¸ªæ¶ˆè´¹ç»„éƒ½ä¼šç»´æŠ¤è®¢é˜…çš„Topic ä¸‹æ¯ä¸ªé˜Ÿåˆ—çš„offset</code></pre><h3 id="å®‰è£…">å®‰è£…</h3><p>é˜¿é‡Œäº‘é•œåƒåœ°å€: <a href="http://mirrors.aliyun.com/apache/kafka/">http://mirrors.aliyun.com/apache/kafka/</a></p><p>ä¸‹è½½ kafka_2.13-3.2.1.tgz</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-comment"># è§£å‹</span><br>tar zxvf kafka_2.<span class="hljs-number">13</span>-<span class="hljs-number">3.2</span>.<span class="hljs-number">1</span>.tgz -C <span class="hljs-regexp">/opt/m</span>odule<br><br><span class="hljs-comment"># è¿è¡Œ</span><br>cd <span class="hljs-regexp">/opt/m</span>odule<br><br><span class="hljs-comment"># å¯åŠ¨zookeeper</span><br>.<span class="hljs-regexp">/bin/</span>zookeeper-server-start.sh  config/zookeeper.properties<br><br><span class="hljs-comment"># åå°å¯åŠ¨</span><br>.<span class="hljs-regexp">/bin/</span>zookeeper-server-start.sh -daemon config/zookeeper.properties <br><br><span class="hljs-comment"># å¯åŠ¨kafka</span><br>.<span class="hljs-regexp">/bin/</span>kafka-server-start.sh config/server.properties<br><br><span class="hljs-comment"># åå°å¯åŠ¨</span><br>.<span class="hljs-regexp">/bin/</span>kafka-server-start.sh -daemon config/server.properties<br><br></code></pre></td></tr></table></figure><h3 id="ä¸€ä¸ª-docker-çš„é›†ç¾¤ä¾‹å­">ä¸€ä¸ª docker çš„é›†ç¾¤ä¾‹å­</h3><p>docker-compose.yaml</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3&quot;</span><br><br><span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">zookeeper</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;bitnami/zookeeper:3.6&#x27;</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">zookeeper</span><br>    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;2181:2181&#x27;</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-comment"># åŒ¿åç™»å½•--å¿…é¡»å¼€å¯</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ALLOW_ANONYMOUS_LOGIN=yes</span><br>      <span class="hljs-comment">#volumes:</span><br>      <span class="hljs-comment">#- ./zookeeper:/bitnami/zookeeper</span><br>    <span class="hljs-comment"># restart: always</span><br><br>  <span class="hljs-attribute">kafka1</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;bitnami/kafka:3.0&#x27;</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">kafka1</span><br>    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;9092:9092&#x27;</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_BROKER_ID=1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_LISTENERS=PLAINTEXT://:9092</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://192.168.2.170:9092</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ALLOW_PLAINTEXT_LISTENER=yes</span><br>    <span class="hljs-comment"># restart: always</span><br>    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span><br><br>  <span class="hljs-attribute">kafka2</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;bitnami/kafka:3.0&#x27;</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">kafka2</span><br>    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;9093:9093&#x27;</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_BROKER_ID=2</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_LISTENERS=PLAINTEXT://:9093</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://192.168.2.170:9093</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ALLOW_PLAINTEXT_LISTENER=yes</span><br>    <span class="hljs-comment"># restart: always</span><br>    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span><br><br>  <span class="hljs-attribute">kafka3</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;bitnami/kafka:3.0&#x27;</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">kafka3</span><br>    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;9094:9094&#x27;</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_BROKER_ID=3</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_LISTENERS=PLAINTEXT://:9094</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://192.168.2.170:9094</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ALLOW_PLAINTEXT_LISTENER=yes</span><br>    <span class="hljs-comment"># restart: always</span><br>    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span><br><br>  <span class="hljs-comment"># Web ç®¡ç†ç•Œé¢ å¦å¤–ä¹Ÿå¯ä»¥ç”¨exporter+prometheus+grafanaçš„æ–¹å¼æ¥ç›‘æ§ https://github.com/danielqsj/kafka_exporter</span><br>  <span class="hljs-attribute">kafka_manager</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;hlebalbau/kafka-manager:latest&#x27;</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">kafka-manager</span><br>    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9022:9000&quot;</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">ZK_HOSTS</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zookeeper:2181&quot;</span><br>    <span class="hljs-comment"># restart: always</span><br>    <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">kafka1</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">kafka2</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">kafka3</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨ AWS-SDK ä¸Šä¼ æ–‡ä»¶åˆ° MinIO</title>
    <link href="/2022/03/06/blog/golang/aws-s3-oss-go/"/>
    <url>/2022/03/06/blog/golang/aws-s3-oss-go/</url>
    
    <content type="html"><![CDATA[<p>å…¬å¸å†…ç½‘ç¯å¢ƒè‡ªå»ºçš„ MinIO ä½œä¸ºå¯¹è±¡å­˜å‚¨,è€Œå¤–ç½‘çš„å¯¹è±¡å­˜å‚¨åˆ™æ˜¯ä½¿ç”¨çš„é˜¿é‡Œäº‘æœåŠ¡</p><p><code>MinIO</code>å’Œ<code>é˜¿é‡Œäº‘</code> éƒ½å…¼å®¹äºšé©¬é€Š(AWS) çš„S3åè®®, ä¸ºæ­¤ä½¿ç”¨ AWS-SDK ä¸Šä¼ æœåŠ¡ç”Ÿæˆçš„æ•°æ®å†…å®¹</p><p>docker åˆ›å»ºä¸€ä¸ª MinIO çš„å®¹å™¨</p><p>MINIO_ROOT_USER å’Œ MINIO_ROOT_PASSWORD å°±æ˜¯ 9001 ç«¯å£çš„ç™»å½•çš„è´¦å·å¯†ç , ä¹Ÿæ˜¯AKå’ŒSK(ä¹Ÿå¯ä»¥è¿›å…¥åå°è‡ªå·±æ›´æ¢)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -p <span class="hljs-number">9000</span>:<span class="hljs-number">9000</span> -p <span class="hljs-number">9001</span>:<span class="hljs-number">9001</span> --name minio1 -v ~<span class="hljs-regexp">/minio/</span>data:<span class="hljs-regexp">/data -e &quot;MINIO_ROOT_USER=AKIAIOSFODNN7EXAMPLE&quot; -e &quot;MINIO_ROOT_PASSWORD=wJalrXUtnFEMI/</span>K7MDENG<span class="hljs-regexp">/bPxRfiCYEXAMPLEKEY&quot; quay.io/mi</span>nio<span class="hljs-regexp">/minio server /</span>data --console-address <span class="hljs-string">&quot;:9001&quot;</span><br><br></code></pre></td></tr></table></figure><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">go</span> <span class="hljs-built_in">get</span> github.<span class="hljs-keyword">com</span>/aws/aws-sdk-go@v1.<span class="hljs-number">44.70</span><br></code></pre></td></tr></table></figure><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;bytes&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/aws/aws-sdk-go/aws&quot;</span><br><span class="hljs-string">&quot;github.com/aws/aws-sdk-go/aws/credentials&quot;</span><br><span class="hljs-string">&quot;github.com/aws/aws-sdk-go/aws/session&quot;</span><br><span class="hljs-string">&quot;github.com/aws/aws-sdk-go/service/s3&quot;</span><br><span class="hljs-string">&quot;github.com/aws/aws-sdk-go/service/s3/s3manager&quot;</span><br>_ <span class="hljs-string">&quot;github.com/aws/aws-sdk-go/service/s3/s3manager&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewSess</span><span class="hljs-params">()</span></span> *session.Session &#123;<br>access_key := <span class="hljs-string">&quot;AKIAIOSFODNN7EXAMPLE&quot;</span><br>secret_key := <span class="hljs-string">&quot;wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY&quot;</span><br>end_point := <span class="hljs-string">&quot;http://192.168.163.121:9000&quot;</span> <span class="hljs-comment">//endpointè®¾ç½®, ä¸è¦åŠ¨</span><br><br><br>sess, err := session.NewSession(&amp;aws.Config&#123;<br>        <span class="hljs-comment">// credentials.NewStaticCredentials è¿™é‡Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯token, åœ¨ä½¿ç”¨ aliyun-sdk æ—¶ä¼šè·å–çš„å¯¹åº”çš„å€¼ </span><br>Credentials:      credentials.NewStaticCredentials(access_key, secret_key, <span class="hljs-string">&quot;&quot;</span>),<br>Endpoint:         aws.String(end_point),<br>Region:           aws.String(<span class="hljs-string">&quot;us-east-1&quot;</span>),<br>DisableSSL:       aws.Bool(<span class="hljs-literal">true</span>),<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">// false ä¼šä½¿ç”¨ virtual-host styleæ–¹å¼,  http://192.168.163.121:9000 -&gt; http://bucket.192.168.163.121:9000</span><br><span class="hljs-comment">// true ä¼šä½¿ç”¨ å¼ºåˆ¶ä½¿ç”¨è·¯å¾„æ–¹å¼,  http://192.168.163.121:9000 -&gt; http://192.168.163.121:9000/bucket</span><br><span class="hljs-comment">*/</span><br>S3ForcePathStyle: aws.Bool(<span class="hljs-literal">true</span>),<br>&#125;)<br><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-keyword">return</span> sess<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><br><br>get_bucket(NewSess())<br>get_file_and_folder(NewSess(), <span class="hljs-string">&quot;test&quot;</span>)<br>getFile(NewSess(), <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;æ–°å»º æ–‡æœ¬æ–‡æ¡£.txt&quot;</span>)<br>uploadFile(NewSess(), <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;æ–°å»º æ–‡æœ¬æ–‡æ¡£1.txt&quot;</span>, <span class="hljs-string">&quot;im data in æ–°å»º æ–‡æœ¬æ–‡æ¡£1.txt&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">exitErrorf</span><span class="hljs-params">(msg <span class="hljs-type">string</span>, args ...<span class="hljs-keyword">interface</span>&#123;&#125;)</span></span> &#123;<br>fmt.Fprintf(os.Stderr, msg+<span class="hljs-string">&quot;&quot;</span>, args...)<br>os.Exit(<span class="hljs-number">1</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">get_bucket</span><span class="hljs-params">(sess *session.Session)</span></span> &#123;<br><br>svc := s3.New(sess)<br>result, err := svc.ListBuckets(<span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>exitErrorf(<span class="hljs-string">&quot;Unable to list buckets, %v&quot;</span>, err)<br>&#125;<br><br>fmt.Println(<span class="hljs-string">&quot;Buckets:&quot;</span>)<br><br><span class="hljs-keyword">for</span> _, b := <span class="hljs-keyword">range</span> result.Buckets &#123;<br>fmt.Printf(<span class="hljs-string">&quot;* %s created on %s&quot;</span>,<br>aws.StringValue(b.Name), aws.TimeValue(b.CreationDate))<br>&#125;<br><br><span class="hljs-keyword">for</span> _, b := <span class="hljs-keyword">range</span> result.Buckets &#123;<br>fmt.Printf(<span class="hljs-string">&quot;\n%s&quot;</span>, aws.StringValue(b.Name))<br>&#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">get_file_and_folder</span><span class="hljs-params">(sess *session.Session, bucket <span class="hljs-type">string</span>)</span></span> &#123;<br><br><br><span class="hljs-comment">// bucketåè·Ÿ, go run ....go bucketname</span><br>fmt.Println()<br>fmt.Println(bucket)<br><br>svc := s3.New(sess)<br><br>params := &amp;s3.ListObjectsInput&#123;<br>Bucket:             aws.String(fmt.Sprint(<span class="hljs-string">&quot;/&quot;</span>, bucket)),<br>Prefix:             aws.String(<span class="hljs-string">&quot;&quot;</span>),<br>&#125;<br>resp, err := svc.ListObjects(params)<br><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>exitErrorf(<span class="hljs-string">&quot;Unable to list items in bucket %q, %v&quot;</span>, bucket, err)<br>&#125;<br><br><span class="hljs-keyword">for</span> _, item := <span class="hljs-keyword">range</span> resp.Contents &#123;<br>fmt.Println(<span class="hljs-string">&quot;Name:         &quot;</span>, *item.Key)<br>fmt.Println(<span class="hljs-string">&quot;Last modified:&quot;</span>, *item.LastModified)<br>fmt.Println(<span class="hljs-string">&quot;Size:         &quot;</span>, *item.Size)<br>fmt.Println(<span class="hljs-string">&quot;Storage class:&quot;</span>, *item.StorageClass)<br>fmt.Println(<span class="hljs-string">&quot;&quot;</span>)<br>&#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getFile</span><span class="hljs-params">(sess *session.Session, bucket, item <span class="hljs-type">string</span>)</span></span> &#123;<br><br><br>file, err := os.Create(item)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>exitErrorf(<span class="hljs-string">&quot;Unable to open file %q, %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-keyword">defer</span> file.Close()<br><br>downloader := s3manager.NewDownloader(sess)<br><br>numBytes, err := downloader.Download(file,<br>&amp;s3.GetObjectInput&#123;<br>Bucket: aws.String(fmt.Sprint(<span class="hljs-string">&quot;/&quot;</span>, bucket)),<br>Key:    aws.String(item),<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>exitErrorf(<span class="hljs-string">&quot;Unable to download item %q, %v&quot;</span>, item, err)<br>&#125;<br><br>fmt.Println(<span class="hljs-string">&quot;Downloaded&quot;</span>, file.Name(), numBytes, <span class="hljs-string">&quot;bytes&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">uploadFile</span><span class="hljs-params">(sess *session.Session, bucket <span class="hljs-type">string</span>, filename, fileData <span class="hljs-type">string</span>)</span></span> &#123;<br><br>uploader := s3manager.NewUploader(sess)<br><br>_, err := uploader.Upload(&amp;s3manager.UploadInput&#123;<br>Bucket: aws.String(fmt.Sprint(<span class="hljs-string">&quot;/&quot;</span>, bucket)),<br>Key: aws.String(filename),<br>Body: bytes.NewReader([]<span class="hljs-type">byte</span>(fileData)),<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-comment">// Print the error and exit.</span><br>exitErrorf(<span class="hljs-string">&quot;Unable to upload %q to %q, %v&quot;</span>, filename, bucket, err)<br>&#125;<br><br>fmt.Printf(<span class="hljs-string">&quot;Successfully uploaded %q to %q &quot;</span>, filename, bucket)<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>MinIO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>etcd è¶…å‡ºç©ºé—´å¯¼è‡´æœåŠ¡æ³¨å†Œä¸æˆåŠŸ</title>
    <link href="/2022/03/06/blog/golang/etcd_space_exceeded/"/>
    <url>/2022/03/06/blog/golang/etcd_space_exceeded/</url>
    
    <content type="html"><![CDATA[<h3 id="center-etcd-è¶…å‡ºç©ºé—´å¯¼è‡´æœåŠ¡æ³¨å†Œä¸æˆåŠŸ-center"><center> etcd è¶…å‡ºç©ºé—´å¯¼è‡´æœåŠ¡æ³¨å†Œä¸æˆåŠŸ</center></h3><p><code>keywordï¼šmvcc: database space exceeded</code></p><p>go-micro ä½¿ç”¨etcdä½œä¸ºæ³¨å†Œä¸­å¿ƒ, å…¬å¸å½“å‰å¤„äºçš„æ˜¯ä¸šåŠ¡å¼€å‘çŠ¶æ€, å‘å¸ƒè®¢é˜…åŠŸèƒ½ä¹Ÿæ˜¯ç›´æ¥åŸºäºgo-micro ä½¿ç”¨etcdæ¥åšæ¶ˆæ¯è½¬å­˜çš„,å¯¼è‡´æ¶ˆæ¯å‘å¸ƒæœ‰å¤§é‡æ¶ˆæ¯æ²¡æœ‰åŠæ—¶å¤„ç†, å †ç§¯ä¸‹æ¥, ç„¶åæ–°æœåŠ¡ä¸èƒ½å†™å…¥æ³¨å†Œä¿¡æ¯åˆ°etcdä¸­</p><p>ä¸Šç½‘æœç´¢äº†ä¸€ä¸‹,å®˜æ–¹æ–‡æ¡£å·²ç»å†™çš„å¾ˆæ¸…æ¥šäº† <a href="https://etcd.io/docs/v3.4/faq/#deployment">https://etcd.io/docs/v3.4/faq/#deployment</a> ,å¤§æ„æ˜¯, ä¸ºäº†é˜²æ­¢æ€§èƒ½ä¸‹é™æˆ–æ— æ„ä¸­ä½¿é”®å€¼å­˜å‚¨è¿‡è½½,etcdå¼ºåˆ¶å°†å¯é…ç½®çš„å­˜å‚¨å¤§å°é…é¢é»˜è®¤è®¾ç½®ä¸º2GB</p><p>è§£å†³åŠæ³•,æ‰§è¡Œä¸‹é¢å‘½ä»¤æ¸…ç©ºç£ç›˜,ç„¶åç­‰å¾…ä¸€æ®µæ—¶é—´å°±è¡Œäº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹è­¦å‘Šä¿¡æ¯</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">etcdctl --endpoints=http://127.0.0.1:2379 alarm list</span><br>  memberID:8630161756594109333 alarm:NOSPACE<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è·å–å½“å‰ç‰ˆæœ¬</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">rev=$(etcdctl --endpoints=http://127.0.0.1:2379 endpoint status --write-out=<span class="hljs-string">&quot;json&quot;</span> | egrep -o <span class="hljs-string">&#x27;&quot;revision&quot;:[0-9]*&#x27;</span> | egrep -o <span class="hljs-string">&#x27;[0-9].*&#x27;</span>)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‹ç¼©æ—§ç‰ˆæœ¬</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">etcdctl --endpoints=http://127.0.0.1:2379 compact <span class="hljs-variable">$rev</span></span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…ç†ç£ç›˜ç¢ç‰‡</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">etcdctl --endpoints=http://127.0.0.1:2379 defrag</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æœ€åéªŒè¯ç©ºé—´æ˜¯å¦é‡Šæ”¾</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">etcdctl endpoint status <span class="hljs-comment"># æƒŠäºº Gå˜æˆäº†M</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æœ€åæ¸…é™¤è­¦å‘Š</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">etcdctl --endpoints=http://127.0.0.1:2379 alarm disarm</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>etcd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨golangä¸­ä½¿ç”¨ NACOS ç®¡ç†é¡¹ç›®çš„é…ç½®æ–‡ä»¶</title>
    <link href="/2022/02/26/blog/golang/nacos_demo_golang/"/>
    <url>/2022/02/26/blog/golang/nacos_demo_golang/</url>
    
    <content type="html"><![CDATA[<h3 id="center-åœ¨golangä¸­ä½¿ç”¨-NACOS-ç®¡ç†é¡¹ç›®çš„é…ç½®æ–‡ä»¶-center"><center> åœ¨golangä¸­ä½¿ç”¨ NACOS ç®¡ç†é¡¹ç›®çš„é…ç½®æ–‡ä»¶ </center></h3><ul><li><a href="../../%E4%B8%AD%E9%97%B4%E4%BB%B6/Nacos/install.md">å®‰è£…Nacos</a></li></ul><p>nacos go</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">go get github.com/nacos-group/nacos-sdk-go/v2@v2.2.1<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/nacos-group/nacos-sdk-go/v2/clients&quot;</span><br><span class="hljs-string">&quot;github.com/nacos-group/nacos-sdk-go/v2/common/constant&quot;</span><br><span class="hljs-string">&quot;github.com/nacos-group/nacos-sdk-go/v2/vo&quot;</span><br>)<br><br><span class="hljs-comment">// NACOS 2.2.2</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><br><span class="hljs-comment">//create clientConfig</span><br>clientConfig := constant.ClientConfig&#123;<br>NamespaceId:         <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-comment">//we can create multiple clients with different namespaceId to support multiple namespace.When namespace is public, fill in the blank string here.</span><br>TimeoutMs:           <span class="hljs-number">500</span>,<br>NotLoadCacheAtStart: <span class="hljs-literal">true</span>,<br>LogDir:              <span class="hljs-string">&quot;.&quot;</span>,<br>CacheDir:            <span class="hljs-string">&quot;.&quot;</span>,<br>LogLevel:            <span class="hljs-string">&quot;debug&quot;</span>,<br>Username:            <span class="hljs-string">&quot;nacos&quot;</span>,<br>Password:            <span class="hljs-string">&quot;nacos&quot;</span>,<br>&#125;<br><br><span class="hljs-comment">// At least one ServerConfig</span><br>serverConfigs := []constant.ServerConfig&#123;<br>&#123;<br>IpAddr:      <span class="hljs-string">&quot;172.25.89.138&quot;</span>,<br>ContextPath: <span class="hljs-string">&quot;/nacos&quot;</span>,<br>Port:        <span class="hljs-number">8848</span>,<br>Scheme:      <span class="hljs-string">&quot;http&quot;</span>,<br>&#125;,<br><span class="hljs-comment">//&#123;</span><br><span class="hljs-comment">//IpAddr:      &quot;console2.nacos.io&quot;,</span><br><span class="hljs-comment">//ContextPath: &quot;/nacos&quot;,</span><br><span class="hljs-comment">//Port:        80,</span><br><span class="hljs-comment">//Scheme:      &quot;http&quot;,</span><br><span class="hljs-comment">//&#125;,</span><br>&#125;<br><br>configClient, err := clients.NewConfigClient(<br>vo.NacosClientParam&#123;<br>ClientConfig:  &amp;clientConfig,<br>ServerConfigs: serverConfigs,<br>&#125;,<br>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-comment">// æ·»åŠ ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br>ok, err := configClient.PublishConfig(vo.ConfigParam&#123;<br>DataId:  <span class="hljs-string">&quot;config_pre.yaml&quot;</span>,<br>Group:   <span class="hljs-string">&quot;DEFAULT_GROUP&quot;</span>,<br>Content: <span class="hljs-string">`ddd:123`</span>,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>fmt.Println(ok)<br><span class="hljs-comment">// æŸ¥æ‰¾é…ç½®æ–‡ä»¶</span><br>data, err := configClient.GetConfig(vo.ConfigParam&#123;<br>DataId: <span class="hljs-string">&quot;config_pre.yaml&quot;</span>,<br>Group:  <span class="hljs-string">&quot;DEFAULT_GROUP&quot;</span>,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>fmt.Println(data)<br><span class="hljs-comment">// ç›‘å¬é…ç½®æ–‡ä»¶å˜åŠ¨</span><br>err = configClient.ListenConfig(vo.ConfigParam&#123;<br>DataId: <span class="hljs-string">&quot;config_pre.yaml&quot;</span>,<br>Group:  <span class="hljs-string">&quot;DEFAULT_GROUP&quot;</span>,<br>OnChange: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(namespace, group, dataId, data <span class="hljs-type">string</span>)</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;group:&quot;</span> + group + <span class="hljs-string">&quot;, dataId:&quot;</span> + dataId + <span class="hljs-string">&quot;, data:&quot;</span> + data)<br>&#125;,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-keyword">select</span> &#123;&#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>NACOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®‰è£… K8s</title>
    <link href="/2022/01/01/K8S/install/"/>
    <url>/2022/01/01/K8S/install/</url>
    
    <content type="html"><![CDATA[<h3 id="kubeadm-å®‰è£…-K8s">kubeadm å®‰è£… K8s</h3><h3 id="å…³é—­é˜²ç«å¢™ï¼š">å…³é—­é˜²ç«å¢™ï¼š</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">systemctl stop firewalld<br><br>systemctl <span class="hljs-built_in">disable</span><span class="hljs-built_in"> firewall</span><br><span class="hljs-built_in"></span><br></code></pre></td></tr></table></figure><h3 id="å…³é—­-selinuxï¼š">å…³é—­ selinuxï¼š</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">sed -i <span class="hljs-string">&#x27;s/enforcing/disabled/&#x27;</span> <span class="hljs-regexp">/etc/</span>selinux/config <span class="hljs-comment"># æ°¸ä¹…</span><br>setenforce <span class="hljs-number">0</span> <span class="hljs-comment"># ä¸´æ—¶</span><br></code></pre></td></tr></table></figure><h3 id="å…³é—­-swapï¼š">å…³é—­ swapï¼š</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">swapoff -a <span class="hljs-comment"># ä¸´æ—¶</span><br>sed -ri <span class="hljs-string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> <span class="hljs-regexp">/etc/</span>fstab <span class="hljs-comment"># æ°¸ä¹…</span><br></code></pre></td></tr></table></figure><h3 id="å°†æ¡¥æ¥çš„-IPv4-æµé‡ä¼ é€’åˆ°-iptables-çš„é“¾ï¼š">å°†æ¡¥æ¥çš„ IPv4 æµé‡ä¼ é€’åˆ° iptables çš„é“¾ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">EOF</span><br>sysctl --system <span class="hljs-comment"># ç”Ÿæ•ˆ</span><br></code></pre></td></tr></table></figure><h3 id="è®¾ç½®hostname">è®¾ç½®hostname</h3><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">node1</span><br></code></pre></td></tr></table></figure><h3 id="æ·»åŠ host">æ·»åŠ host</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">cat &gt;&gt; /etc/hosts &lt;&lt; EOF<br><span class="hljs-number">192.168.223.132</span> node1<br><span class="hljs-number">192.168.223.133</span> node2<br><span class="hljs-number">192.168.223.134</span> node3<br>EOF<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…docker">å®‰è£…docker</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">yum-config-manager --add-repo http:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/docker-ce/</span>linux<span class="hljs-regexp">/centos/</span>docker-ce.repo<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…å¹¶å¯åŠ¨-docker">å®‰è£…å¹¶å¯åŠ¨ docker</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">yum</span> install -y docker-ce-<span class="hljs-number">19</span>.<span class="hljs-number">03</span>.<span class="hljs-number">8</span> docker-ce-cli-<span class="hljs-number">19</span>.<span class="hljs-number">03</span>.<span class="hljs-number">8</span> containerd.io<br><span class="hljs-attribute">systemctl</span> enable docker<br><span class="hljs-attribute">dsystemctl</span> start docker<br><br></code></pre></td></tr></table></figure><h4 id="é˜¿é‡Œäº‘dockeré•œåƒåŠ é€Ÿ">é˜¿é‡Œäº‘dockeré•œåƒåŠ é€Ÿ</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">mkdir -p <span class="hljs-regexp">/etc/</span>docker<br>tee <span class="hljs-regexp">/etc/</span>docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://3p9gqnrv.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>EOF<br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…k8sã€kubeletã€kubeadmã€kubectlï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰">å®‰è£…k8sã€kubeletã€kubeadmã€kubectlï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># é…ç½®K8Sçš„yumæº</span><br>cat &lt;&lt;EOF &gt; <span class="hljs-regexp">/etc/yum</span>.repos.d/kubernetes.repo<br>[kubernetes]<br>name=Kubernetes<br>baseurl=http:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/kubernetes/yum</span><span class="hljs-regexp">/repos/</span>kubernetes-el7-x86_64<br>enabled=<span class="hljs-number">1</span><br>gpgcheck=<span class="hljs-number">0</span><br>repo_gpgcheck=<span class="hljs-number">0</span><br>gpgkey=http:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/kubernetes/yum</span><span class="hljs-regexp">/doc/yum</span>-key.gpg<br>       http:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/kubernetes/yum</span><span class="hljs-regexp">/doc/</span>rpm-package-key.gpg<br>EOF<br><br><span class="hljs-comment"># å¸è½½æ—§ç‰ˆæœ¬</span><br>yum remove -y kubelet kubeadm kubectl<br><br><span class="hljs-comment"># å®‰è£…kubeletã€kubeadmã€kubectl</span><br>yum install -y kubelet-<span class="hljs-number">1.17</span>.<span class="hljs-number">3</span> kubeadm-<span class="hljs-number">1.17</span>.<span class="hljs-number">3</span> kubectl-<span class="hljs-number">1.17</span>.<span class="hljs-number">3</span><br><br><span class="hljs-comment">#å¼€æœºå¯åŠ¨å’Œé‡å¯kubelet</span><br>systemctl enable kubelet &amp;&amp; systemctl start kubelet<br><span class="hljs-comment">##æ³¨æ„, å¦‚æœæ­¤æ—¶æŸ¥çœ‹kubeletçš„çŠ¶æ€, ä»–ä¼šæ— é™é‡å¯, ç­‰å¾…æ¥æ”¶é›†ç¾¤å‘½ä»¤, å’Œåˆå§‹åŒ–ã€‚è¿™ä¸ªæ˜¯æ­£å¸¸çš„ã€‚</span><br><br>kubeadm åˆå§‹åŒ–master <br> kubeadm init \<br>--apiserver-advertise-address=<span class="hljs-number">192.168</span>.<span class="hljs-number">223.132</span> \<br>--image-repository registry.aliyuncs.com/google_containers \<br>--kubernetes-version v1.<span class="hljs-number">17.3</span> \<br>--service-cidr=<span class="hljs-number">10.96</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">12</span> \<br>--pod-network-cidr=<span class="hljs-number">10.244</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">16</span><br></code></pre></td></tr></table></figure><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-meta"># workeråŠ å…¥é›†ç¾¤</span><br><br><span class="hljs-meta">#1ã€ä½¿ç”¨åˆšæ‰masteræ‰“å°çš„ä»¤ç‰Œå‘½ä»¤åŠ å…¥</span><br>kubeadm join <span class="hljs-number">172.26</span><span class="hljs-number">.248</span><span class="hljs-number">.150</span>:<span class="hljs-number">6443</span> --<span class="hljs-built_in">token</span> ktnvuj.tgldo613ejg5a3x4 \<br>    --discovery-<span class="hljs-built_in">token</span>-ca-cert-hash sha256:f66c496cf7eb8aa06e1a7cdb9b6be5b013c613cdcf5d1bbd88a6ea19a2b454ec<br><br><span class="hljs-meta">#2ã€å¦‚æœè¶…è¿‡2å°æ—¶å¿˜è®°äº†ä»¤ç‰Œ, å¯ä»¥è¿™æ ·åš</span><br>kubeadm <span class="hljs-built_in">token</span> <span class="hljs-keyword">create</span> --<span class="hljs-keyword">print</span>-join-command <span class="hljs-meta">#æ‰“å°æ–°ä»¤ç‰Œ</span><br>kubeadm <span class="hljs-built_in">token</span> <span class="hljs-keyword">create</span> --ttl <span class="hljs-number">0</span> --<span class="hljs-keyword">print</span>-join-command <span class="hljs-meta">#åˆ›å»ºä¸ªæ°¸ä¸è¿‡æœŸçš„ä»¤ç‰Œ</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>K8S</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>K8S yaml</title>
    <link href="/2022/01/01/K8S/yaml/"/>
    <url>/2022/01/01/K8S/yaml/</url>
    
    <content type="html"><![CDATA[<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># yamlæ ¼å¼çš„podå®šä¹‰æ–‡ä»¶å®Œæ•´å†…å®¹ï¼š</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>       <span class="hljs-comment">#å¿…é€‰, ç‰ˆæœ¬å·, ä¾‹å¦‚v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span>       <span class="hljs-comment">#å¿…é€‰, Pod</span><br><span class="hljs-attr">metadata:</span>       <span class="hljs-comment">#å¿…é€‰, å…ƒæ•°æ®</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>       <span class="hljs-comment">#å¿…é€‰, Podåç§°</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">string</span>    <span class="hljs-comment">#å¿…é€‰, Podæ‰€å±çš„å‘½åç©ºé—´</span><br>  <span class="hljs-attr">labels:</span>      <span class="hljs-comment">#è‡ªå®šä¹‰æ ‡ç­¾</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#è‡ªå®šä¹‰æ ‡ç­¾åå­—</span><br>  <span class="hljs-attr">annotations:</span>       <span class="hljs-comment">#è‡ªå®šä¹‰æ³¨é‡Šåˆ—è¡¨</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br><span class="hljs-attr">spec:</span>         <span class="hljs-comment">#å¿…é€‰, Podä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span><br>  <span class="hljs-attr">containers:</span>      <span class="hljs-comment">#å¿…é€‰, Podä¸­å®¹å™¨åˆ—è¡¨</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#å¿…é€‰, å®¹å™¨åç§°</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">string</span>    <span class="hljs-comment">#å¿…é€‰, å®¹å™¨çš„é•œåƒåç§°</span><br>    <span class="hljs-attr">imagePullPolicy:</span> [<span class="hljs-string">Always</span> <span class="hljs-string">|</span> <span class="hljs-string">Never</span> <span class="hljs-string">|</span> <span class="hljs-string">IfNotPresent</span>] <span class="hljs-comment">#è·å–é•œåƒçš„ç­–ç•¥ Alawysè¡¨ç¤ºä¸‹è½½é•œåƒ IfnotPresentè¡¨ç¤ºä¼˜å…ˆä½¿ç”¨æœ¬åœ°é•œåƒ, å¦åˆ™ä¸‹è½½é•œåƒ, Nerverè¡¨ç¤ºä»…ä½¿ç”¨æœ¬åœ°é•œåƒ</span><br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">string</span>]    <span class="hljs-comment">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨, å¦‚ä¸æŒ‡å®š, ä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span><br>    <span class="hljs-attr">args:</span> [<span class="hljs-string">string</span>]     <span class="hljs-comment">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨</span><br>    <span class="hljs-attr">workingDir:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#å®¹å™¨çš„å·¥ä½œç›®å½•</span><br>    <span class="hljs-attr">volumeMounts:</span>    <span class="hljs-comment">#æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°, éœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span><br>      <span class="hljs-attr">mountPath:</span> <span class="hljs-string">string</span>    <span class="hljs-comment">#å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„, åº”å°‘äº512å­—ç¬¦</span><br>      <span class="hljs-attr">readOnly:</span> <span class="hljs-string">boolean</span>    <span class="hljs-comment">#æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span><br>    <span class="hljs-attr">ports:</span>       <span class="hljs-comment">#éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#ç«¯å£å·åç§°</span><br>      <span class="hljs-attr">containerPort:</span> <span class="hljs-string">int</span>   <span class="hljs-comment">#å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span><br>      <span class="hljs-attr">hostPort:</span> <span class="hljs-string">int</span>    <span class="hljs-comment">#å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·, é»˜è®¤ä¸Containerç›¸åŒ</span><br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#ç«¯å£åè®®, æ”¯æŒTCPå’ŒUDP, é»˜è®¤TCP</span><br>    <span class="hljs-attr">env:</span>       <span class="hljs-comment">#å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#ç¯å¢ƒå˜é‡åç§°</span><br>      <span class="hljs-attr">value:</span> <span class="hljs-string">string</span>    <span class="hljs-comment">#ç¯å¢ƒå˜é‡çš„å€¼</span><br>    <span class="hljs-attr">resources:</span>       <span class="hljs-comment">#èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span><br>      <span class="hljs-attr">limits:</span>      <span class="hljs-comment">#èµ„æºé™åˆ¶çš„è®¾ç½®</span><br>        <span class="hljs-attr">cpu:</span> <span class="hljs-string">string</span>    <span class="hljs-comment">#Cpuçš„é™åˆ¶, å•ä½ä¸ºcoreæ•°, å°†ç”¨äºdocker run --cpu-shareså‚æ•°</span><br>        <span class="hljs-attr">memory:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#å†…å­˜é™åˆ¶, å•ä½å¯ä»¥ä¸ºMib/Gib, å°†ç”¨äºdocker run --memoryå‚æ•°</span><br>      <span class="hljs-attr">requests:</span>      <span class="hljs-comment">#èµ„æºè¯·æ±‚çš„è®¾ç½®</span><br>        <span class="hljs-attr">cpu:</span> <span class="hljs-string">string</span>    <span class="hljs-comment">#Cpuè¯·æ±‚, å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span><br>        <span class="hljs-attr">memory:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#å†…å­˜æ¸…æ¥š, å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span><br>    <span class="hljs-attr">livenessProbe:</span>     <span class="hljs-comment">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®, å½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨, æ£€æŸ¥æ–¹æ³•æœ‰execã€httpGetå’ŒtcpSocket, å¯¹ä¸€ä¸ªå®¹å™¨åªéœ€è®¾ç½®å…¶ä¸­ä¸€ç§æ–¹æ³•å³å¯</span><br>      <span class="hljs-attr">exec:</span>      <span class="hljs-comment">#å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">string</span>]  <span class="hljs-comment">#execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬</span><br>      <span class="hljs-attr">httpGet:</span>       <span class="hljs-comment">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGet, éœ€è¦åˆ¶å®šPathã€port</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-string">number</span><br>        <span class="hljs-attr">host:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">scheme:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">HttpHeaders:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">value:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">tcpSocket:</span>     <span class="hljs-comment">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼</span><br>         <span class="hljs-attr">port:</span> <span class="hljs-string">number</span><br>       <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">0</span>  <span class="hljs-comment">#å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´, å•ä½ä¸ºç§’</span><br>       <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">0</span>   <span class="hljs-comment">#å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´, å•ä½ç§’, é»˜è®¤1ç§’</span><br>       <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">0</span>    <span class="hljs-comment">#å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®, å•ä½ç§’, é»˜è®¤10ç§’ä¸€æ¬¡</span><br>       <span class="hljs-attr">successThreshold:</span> <span class="hljs-number">0</span><br>       <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">0</span><br>       <span class="hljs-attr">securityContext:</span><br>         <span class="hljs-string">privileged:false</span><br>    <span class="hljs-attr">restartPolicy:</span> [<span class="hljs-string">Always</span> <span class="hljs-string">|</span> <span class="hljs-string">Never</span> <span class="hljs-string">|</span> <span class="hljs-string">OnFailure</span>]<span class="hljs-comment">#Podçš„é‡å¯ç­–ç•¥, Alwaysè¡¨ç¤ºä¸€æ—¦ä¸ç®¡ä»¥ä½•ç§æ–¹å¼ç»ˆæ­¢è¿è¡Œ, kubeletéƒ½å°†é‡å¯, OnFailureè¡¨ç¤ºåªæœ‰Podä»¥é0é€€å‡ºç é€€å‡ºæ‰é‡å¯, Nerverè¡¨ç¤ºä¸å†é‡å¯è¯¥Pod</span><br>    <span class="hljs-attr">nodeSelector:</span> <span class="hljs-string">obeject</span>  <span class="hljs-comment">#è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š, ä»¥keyï¼švalueçš„æ ¼å¼æŒ‡å®š</span><br>    <span class="hljs-attr">imagePullSecrets:</span>    <span class="hljs-comment">#Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°, ä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>    <span class="hljs-string">hostNetwork:false</span>      <span class="hljs-comment">#æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼, é»˜è®¤ä¸ºfalse, å¦‚æœè®¾ç½®ä¸ºtrue, è¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span><br>    <span class="hljs-attr">volumes:</span>       <span class="hljs-comment">#åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span><br>      <span class="hljs-attr">emptyDir:</span> &#123;&#125;     <span class="hljs-comment">#ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·, ä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span><br>      <span class="hljs-attr">hostPath:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·, è¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">string</span>     <span class="hljs-comment">#Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•, å°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span><br>      <span class="hljs-attr">secret:</span>      <span class="hljs-comment">#ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·, æŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secreå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span><br>        <span class="hljs-attr">scretname:</span> <span class="hljs-string">string</span>  <br>        <span class="hljs-attr">items:</span>     <br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">configMap:</span>     <span class="hljs-comment">#ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·, æŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">string</span><br>        <span class="hljs-attr">items:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">string</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>K8S</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®æœåŠ¡æ¡†æ¶ go-micro ä»£ç† proxy æ¥å—æ¶ˆæ¯å€¼æœ€å¤§ä¿®æ”¹</title>
    <link href="/2021/08/06/blog/golang/go_micro_MaxCallRecvMsgSize/"/>
    <url>/2021/08/06/blog/golang/go_micro_MaxCallRecvMsgSize/</url>
    
    <content type="html"><![CDATA[<h3 id="center-å¾®æœåŠ¡æ¡†æ¶-go-micro-ä»£ç†-proxy-æ¥å—æ¶ˆæ¯å€¼æœ€å¤§ä¿®æ”¹-center"><center> å¾®æœåŠ¡æ¡†æ¶ go-micro ä»£ç† proxy æ¥å—æ¶ˆæ¯å€¼æœ€å¤§ä¿®æ”¹ </center></h3><p>keyword: MaxCallRecvMsgSize</p><p>go-micro æ¡†æ¶è‡ªå¸¦äº† proxy ç”¨æ¥ä»£ç†å¾®æœåŠ¡ä¹‹é—´çš„rpcè¯·æ±‚,å› ä¸ºæ¡†æ¶å†…éƒ¨å°è£…å¥½äº† client(æœ¬è´¨æ˜¯æœåŠ¡å¯¹æœåŠ¡ç›´æ¥è¯·æ±‚) å¯ä»¥åœ¨golangç«¯è½»æ¾ä¿®æ”¹ clientGrpc.MaxRecvMsgSize,clientGrpc.MaxSendMsgSize æ¥è®¾ç½®è¯·æ±‚æ•°æ®</p><p>go-micro æ¡†æ¶é»˜è®¤æœåŠ¡é—´æœ€å¤§å“åº”å€¼æ˜¯4M.</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># å¯åŠ¨ proxy</span><br><span class="hljs-built_in">set</span> <span class="hljs-attribute">MICRO_REGISTRY</span>=etcd<br><span class="hljs-built_in">set</span> <span class="hljs-attribute">MICRO_REGISTRY_ADDRESS</span>=127.0.0.1:2379<br>micro proxy<br></code></pre></td></tr></table></figure><p>ç„¶è€Œåœ¨ micro proxy ä¸­è¿™ä¸¤ä¸ªå‚æ•°æ˜¯å¤±æ•ˆçš„,å¯¼è‡´å…¬å¸C++å®¢æˆ·ç«¯è¿›è¡Œrpcè°ƒç”¨çš„æ—¶å€™ä¸èƒ½è¯·æ±‚ä¸€äº›å¤§å‹çš„æ•°æ®å†…å®¹,è¿½äº†ä¸€ä¸‹æºç ,å‘ç°grpcå®˜æ–¹å·²ç»æŠŠ4Må›ºå®šæ­»,ä½†æ˜¯è¿˜æ˜¯ç•™äº†å£å­è®©æˆ‘ä»¬é€šè¿‡CallOptionæ”¹åŠ¨å¯¹åº”çš„å€¼</p><p>å‰ç½®æ¡ä»¶:</p><p>æ‰€æœ‰çš„ service å¿…é¡»ä¿®æ”¹ DefaultMaxMsgSize</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-keyword">import</span> (<br>    ...<br>    serverGrpc <span class="hljs-string">&quot;github.com/micro/go-micro/v2/server/grpc&quot;</span><br>    <br>)<br><br><span class="hljs-keyword">const</span> maxMsgSize <span class="hljs-type">int</span> = <span class="hljs-number">8</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span>  &#123;<br>    serverGrpc.DefaultMaxMsgSize = maxMsgSize<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ„å»ºproxy</p><p>æ”¹åŠ¨ç‚¹æœ‰ä¸¤ä¸ª</p><ol><li><p>init æ–¹æ³•ä¸­å¿…é¡»è¦æŠŠ micro server çš„ DefaultMaxMsgSizeæ”¹æ‰</p></li><li><p>ç„¶åå°±æ˜¯ Client.Init å»åˆå§‹åŒ– CallOption</p></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// proxy.go</span><br><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;github.com/micro/go-micro/v2&quot;</span><br>    <span class="hljs-string">&quot;github.com/micro/go-micro/v2/client&quot;</span><br>    clientGrpc <span class="hljs-string">&quot;github.com/micro/go-micro/v2/client/grpc&quot;</span><br>    serverGrpc <span class="hljs-string">&quot;github.com/micro/go-micro/v2/server/grpc&quot;</span><br>    <span class="hljs-string">&quot;github.com/micro/micro/v2/cmd&quot;</span><br>    <span class="hljs-string">&quot;google.golang.org/grpc&quot;</span><br>)<br><br><span class="hljs-keyword">const</span> maxMsgSize <span class="hljs-type">int</span> = <span class="hljs-number">8</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span>  &#123;<br>    serverGrpc.DefaultMaxMsgSize = maxMsgSize<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  &#123;<br><br>    cmd.Init(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(options *micro.Options)</span></span> &#123;<br>        err := options.Client.Init(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(options *client.Options)</span></span> &#123;<br>            clientGrpc.CallOptions(grpc.MaxCallRecvMsgSize(maxMsgSize))(&amp;options.CallOptions)<br>        &#125;)<br>        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>            <span class="hljs-built_in">panic</span>(err)<br>        &#125;<br>    &#125;)<br>&#125;<br><br><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># å¯åŠ¨ proxy</span><br><span class="hljs-built_in">set</span> <span class="hljs-attribute">MICRO_REGISTRY</span>=etcd<br><span class="hljs-built_in">set</span> <span class="hljs-attribute">MICRO_REGISTRY_ADDRESS</span>=127.0.0.1:2379<br>go <span class="hljs-built_in">run</span> proxy.go proxy<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
      <tag>go-micro</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Golang é”™è¯¯çš„åˆå§‹åŒ– Slice, ç—›ç—›ç—›</title>
    <link href="/2021/07/06/blog/golang/error_init_slice/"/>
    <url>/2021/07/06/blog/golang/error_init_slice/</url>
    
    <content type="html"><![CDATA[<h3 id="center-é”™è¯¯çš„åˆå§‹åŒ–-Slice-ç—›ç—›ç—›-center"><center>é”™è¯¯çš„åˆå§‹åŒ– Slice, ç—›ç—›ç—›</center></h3><p>å…ˆä¸Šä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>s := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>&#125;<br><br>ns1 := newSlice1(s)<br>ns2 := newSlice2(s)<br><br>fmt.Printf(<span class="hljs-string">&quot;value = %+v, %p \n&quot;</span>, s, s)     <span class="hljs-comment">//value = [A2 B C], 0xc00007a330</span><br>fmt.Printf(<span class="hljs-string">&quot;value = %+v, %p \n&quot;</span>, ns1, ns1) <span class="hljs-comment">//value = [A2], 0xc00007a330</span><br>fmt.Printf(<span class="hljs-string">&quot;value = %+v, %p \n&quot;</span>, ns2, ns2) <span class="hljs-comment">//value = [A2], 0xc00007a330</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newSlice1</span><span class="hljs-params">(s []<span class="hljs-type">string</span>)</span></span> []<span class="hljs-type">string</span> &#123;<br>ns := s[:<span class="hljs-number">0</span>]<br>ns = <span class="hljs-built_in">append</span>(ns, <span class="hljs-string">&quot;A1&quot;</span>)<br><span class="hljs-keyword">return</span> ns<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newSlice2</span><span class="hljs-params">(s []<span class="hljs-type">string</span>)</span></span> []<span class="hljs-type">string</span> &#123;<br>ns := s[:<span class="hljs-number">0</span>]<br>ns = <span class="hljs-built_in">append</span>(ns, <span class="hljs-string">&quot;A2&quot;</span>)<br><span class="hljs-keyword">return</span> ns<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡æ„æ—§ä»£ç çš„æ—¶å€™, å‘ç°äº†ä¸€äº›functioné‡Œä½¿ç”¨ç±»ä¼¼ä¸Šé¢<br><code>ns := s[:0]</code><br>æ¥å‡ºåˆ›å»ºæ–°çš„Slice, å°±æ˜¯ä¸æƒ³å¯¼å…¥åŒ…, æˆ–å°‘å†™ä¸€äº›ä»£ç </p><p>æœ¬ä»¥ä¸ºè¿˜æœ‰æˆ‘æ²¡å­¦ä¹ åˆ°çš„å¥‡æŠ€æ·«å·§, ç„¶è€Œå‘ç°åªè¦å¯¹è¿™ç§æ–°åˆ›å»ºçš„åˆ‡ç‰‡åšä¿®æ”¹æ“ä½œ, æ‰€æœ‰å…³è”ä½¿ç”¨çš„åœ°æ–¹éƒ½ä¼šå‡ºç°ä¿®æ”¹</p><p><strong>æœ¬è´¨è¿™äº›åˆ›å»ºçš„åˆ‡ç‰‡æŒ‡å‘çš„è¿˜æ˜¯åŒä¸€ç‰‡å†…å­˜ç©ºé—´</strong></p><p>å› ä¸ºé¡¹ç›®ä½¿ç”¨åªæ˜¯å¯¹åˆ‡ç‰‡åšä¸€äº›è¿‡æ»¤, ç„¶åè¿”å›å‡ºå», è¿™ç§é—®é¢˜è¢«è‡ªç„¶è§„é¿æ‰äº†</p>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‘å¸ƒè‡ªå·± golang package</title>
    <link href="/2021/04/22/blog/golang/%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1go%E5%8C%85/"/>
    <url>/2021/04/22/blog/golang/%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1go%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h4 id="center-å‘å¸ƒè‡ªå·±-golang-package-center"><center>å‘å¸ƒè‡ªå·± golang package</center></h4><p>(1) ä»£ç æäº¤åˆ°è‡ªå·±çš„githubé¡¹ç›®åº“ å¹¶ä¸”ä¸Štag</p><p>ä¾‹å¦‚: <code>github.com/maocatooo/thin</code></p>   <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> tag v0.<span class="hljs-number">0</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">git</span> push origin v0.<span class="hljs-number">0</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>(2) å‘Šè¯‰golang ä»£ç†æœåŠ¡å™¨æ›´æ–°å…¶ç´¢å¼•</p><ol><li><p>è®¿é—® <a href="https://pkg.go.dev/github.com/maocatooo/thin">https://pkg.go.dev/github.com/maocatooo/thin</a> æäº¤è‡ªå·±é¡¹ç›®é“¾æ¥</p></li><li> <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> <span class="hljs-attribute">GOPROXY</span>=proxy.golang.org<br>go list -m github.com/maocatooo/thin@v0.0.1<br></code></pre></td></tr></table></figure><p>ç„¶è€Œå› ä¸ºä»£ç†é—®é¢˜å¤§æ¦‚ç‡æ˜¯ä¼šè¶…æ—¶çš„,</p><p>è§£å†³åŠæ³•:åœ¨æµè§ˆå™¨æ‰“å¼€ <a href="https://proxy.golang.org/github.com/maocatooo/thin/@v/v0.0.1.info">https://proxy.golang.org/github.com/maocatooo/thin/@v/v0.0.1.info</a>&quot;</p></li></ol><p>(3) ç­‰å¾…ä¸€æ®µæ—¶é—´å°±å¥½</p>]]></content>
    
    
    
    <tags>
      
      <tag>Golang</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿä¸€äº›æ¦‚å¿µ</title>
    <link href="/2020/04/22/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    <url>/2020/04/22/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<h3 id="è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«">è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</h3><p>åšä¸ªç®€å•çš„æ¯”å–»ï¼šè¿›ç¨‹=ç«è½¦, çº¿ç¨‹=è½¦å¢</p><ul><li>çº¿ç¨‹åœ¨è¿›ç¨‹ä¸‹è¡Œè¿›ï¼ˆå•çº¯çš„è½¦å¢æ— æ³•è¿è¡Œï¼‰</li><li>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼ˆä¸€è¾†ç«è½¦å¯ä»¥æœ‰å¤šä¸ªè½¦å¢ï¼‰</li><li>ä¸åŒè¿›ç¨‹é—´æ•°æ®å¾ˆéš¾å…±äº«ï¼ˆä¸€è¾†ç«è½¦ä¸Šçš„ä¹˜å®¢å¾ˆéš¾æ¢åˆ°å¦å¤–ä¸€è¾†ç«è½¦, æ¯”å¦‚ç«™ç‚¹æ¢ä¹˜ï¼‰</li><li>åŒä¸€è¿›ç¨‹ä¸‹ä¸åŒçº¿ç¨‹é—´æ•°æ®å¾ˆæ˜“å…±äº«ï¼ˆAè½¦å¢æ¢åˆ°Bè½¦å¢å¾ˆå®¹æ˜“ï¼‰</li><li>è¿›ç¨‹è¦æ¯”çº¿ç¨‹æ¶ˆè€—æ›´å¤šçš„è®¡ç®—æœºèµ„æºï¼ˆé‡‡ç”¨å¤šåˆ—ç«è½¦ç›¸æ¯”å¤šä¸ªè½¦å¢æ›´è€—èµ„æºï¼‰</li><li>è¿›ç¨‹é—´ä¸ä¼šç›¸äº’å½±å“, ä¸€ä¸ªçº¿ç¨‹æŒ‚æ‰å°†å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æŒ‚æ‰ï¼ˆä¸€åˆ—ç«è½¦ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€åˆ—ç«è½¦, ä½†æ˜¯å¦‚æœä¸€åˆ—ç«è½¦ä¸Šä¸­é—´çš„ä¸€èŠ‚è½¦å¢ç€ç«äº†, å°†å½±å“åˆ°æ‰€æœ‰è½¦å¢ï¼‰</li><li>è¿›ç¨‹å¯ä»¥æ‹“å±•åˆ°å¤šæœº, è¿›ç¨‹æœ€å¤šé€‚åˆå¤šæ ¸ï¼ˆä¸åŒç«è½¦å¯ä»¥å¼€åœ¨å¤šä¸ªè½¨é“ä¸Š, åŒä¸€ç«è½¦çš„è½¦å¢ä¸èƒ½åœ¨è¡Œè¿›çš„ä¸åŒçš„è½¨é“ä¸Šï¼‰</li><li>è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€ï¼ˆæ´—æ‰‹é—´ï¼‰å¯ä»¥ä¸Šé”, å³ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æŸäº›å…±äº«å†…å­˜æ—¶, å…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å®ƒç»“æŸ, æ‰èƒ½ä½¿ç”¨è¿™ä¸€å—å†…å­˜ã€‚ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„æ´—æ‰‹é—´ï¼‰ï¼â€œäº’æ–¥é”â€</li><li>è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€å¯ä»¥é™å®šä½¿ç”¨é‡ï¼ˆæ¯”å¦‚ç«è½¦ä¸Šçš„é¤å…, æœ€å¤šåªå…è®¸å¤šå°‘äººè¿›å…¥, å¦‚æœæ»¡äº†éœ€è¦åœ¨é—¨å£ç­‰, ç­‰æœ‰äººå‡ºæ¥äº†æ‰èƒ½è¿›å»ï¼‰ï¼â€œä¿¡å·é‡â€</li></ul><p>è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºè°ƒåº¦å’Œåˆ†é…çš„åŸºæœ¬å•ä½â€”â€”ã€‹å®ç°æ“ä½œç³»ç»Ÿçš„å¹¶å‘</p><p>çº¿ç¨‹æ˜¯cpuè°ƒåº¦çš„åŸºæœ¬å•ä½â€”â€”ã€‰å®ç°è¿›ç¨‹å†…éƒ¨çš„å¹¶å‘</p><h3 id="åŒæ­¥ä¸äº’æ–¥">åŒæ­¥ä¸äº’æ–¥</h3><p>äº’æ–¥å°±æ˜¯çº¿ç¨‹Aè®¿é—®äº†ä¸€ç»„æ•°æ®, çº¿ç¨‹BCDå°±ä¸èƒ½åŒæ—¶è®¿é—®è¿™äº›æ•°æ®, ç›´åˆ°Aåœæ­¢è®¿é—®äº†<br>åŒæ­¥å°±æ˜¯ABCDè¿™äº›çº¿ç¨‹è¦çº¦å®šä¸€ä¸ªæ‰§è¡Œçš„åè°ƒé¡ºåºã€‚æ¯”å¦‚Dè¦æ‰§è¡Œ, Bå’ŒCå¿…é¡»éƒ½å¾—åšå®Œ, è€ŒBå’ŒCè¦å¼€å§‹, Aå¿…é¡»å…ˆå¾—åšå®Œ</p><h3 id="æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶">æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶</h3><p>äº§ç”Ÿæ­»é”çš„çš„å››ä¸ªæ¡ä»¶å¦‚ä¸‹ï¼šäº’è¯·ä¸å¾ª<br>1ã€äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼›<br>2ã€è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶, å¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ï¼›<br>3ã€ä¸å‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹å·²è·å¾—çš„èµ„æº, åœ¨æ²¡ä½¿ç”¨å®Œä¹‹å‰, ä¸èƒ½å¼ºè¡Œå‰¥å¤ºï¼›<br>4ã€å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šå¤šä¸ªè¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§äº’ç›¸å¾ªç¯ç­‰å¾…èµ„æºçš„å…³ç³»ã€‚<br>å¹¶å‘å¸¦æ¥å‹åŠ›, æœ‰çš„äººæˆ–æœ‰çš„ç¨‹åº, ä¼šå› ä¸ºæ‰¿å—ä¸ä½å‹åŠ›è€Œå´©æºƒ, æƒ…ç»ªå´©æºƒå’Œç¨‹åºå´©æºƒæ²¡ä»€ä¹ˆä¸¤æ ·ã€‚å½“ç„¶, ä¸è®ºæ˜¯åšäººè¿˜æ˜¯å†™ç¨‹åº, é¢å¯¹é—®é¢˜æ—¶, æ­£ç¡®çš„åšæ³•éƒ½åº”æ˜¯é‡‡å–ç­–ç•¥, è§£é™¤æ­»é”</p><h3 id="è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°">è®¡ç®—æœºç³»ç»Ÿæ¦‚è¿°</h3><p>1ã€æ“ä½œç³»ç»Ÿæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æ“ä½œç³»ç»Ÿæ˜¯è®¡ç®—æœºèµ„æºçš„ç®¡ç†è€…, æ¯”å¦‚æœ‰å¤„ç†æœºç®¡ç†ã€å­˜å‚¨å™¨ç®¡ç†ã€æ–‡ä»¶ç®¡ç†ã€è®¾å¤‡ç®¡ç†</p><p>2ã€ä¸­æ–­ä¸å¼‚å¸¸ï¼Ÿ</p><p>ä¸­æ–­ï¼šä¹Ÿç§°å¤–ä¸­æ–­, æŒ‡æ¥è‡ªCPUæ‰§è¡ŒæŒ‡ä»¤ä»¥å¤–çš„äº‹ä»¶å‘ç”Ÿ, å¦‚è®¾å¤‡å‘å‡ºçš„I/Oç»“æŸä¸­æ–­, é€šå¸¸æ˜¯ä¸å½“å‰æ‰§è¡ŒæŒ‡ä»¤æ— å…³çš„äº‹ä»¶</p><p>å¼‚å¸¸ï¼šä¹Ÿç§°å†…ä¸­æ–­, æ¯”å¦‚ç¨‹åºåœ°å€è¶Šç•Œ , æœ‰å…³ã€‚</p><p>3ã€å¤§å†…æ ¸ä¸å¾®å†…æ ¸åŒºåˆ«ï¼Ÿ</p><p>ï¼ˆè”æƒ³å•ä½“æ¶æ„å’Œå¾®æœåŠ¡çš„åŒºåˆ«ï¼‰</p><p>å¤§å†…æ ¸çš„æ€§èƒ½æ¯”å¾®å†…æ ¸é«˜</p><p>å› ä¸ºå¾®å†…æ ¸è¿™ä¸ªæ¨¡å—è¿è¡Œåœ¨å†…æ ¸æ€, å…¶ä½™æ¨¡å—è¿è¡Œåœ¨ç”¨æˆ·æ€, åœ¨å°±å¯¼è‡´éœ€è¦ç»å¸¸å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢, å¯¼è‡´ä¸€å®šçš„æ€§èƒ½æŸå¤±</p><h3 id="è¿›ç¨‹ç®¡ç†">è¿›ç¨‹ç®¡ç†</h3><p>ä»€ä¹ˆæ˜¯é¥¥é¥¿, ä¸æ­»é”æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ</p><p>é¥¥é¥¿ï¼šç­‰å¾…æ—¶é—´å¯¹è¿›ç¨‹çš„æ¨è¿›å’Œå“åº”å¸¦æ¥æ˜æ˜¾çš„å°±æ˜¯è¿›ç¨‹é¥¥é¥¿</p><p>ä¸æ­»é”çš„åŒºåˆ«ï¼Ÿ</p><ol><li><p>è¿›å…¥é¥¥é¥¿çš„è¿›ç¨‹å¯ä»¥åªæœ‰1ä¸ª, è€Œæ­»é”è¦å¤§äºç­‰äºä¸¤ä¸ª</p></li><li><p>é¥¥é¥¿è¿›ç¨‹å¯ä»¥æ˜¯å°±ç»ªçŠ¶æ€, è€Œæ­»é”å¿…é¡»æ˜¯é˜»å¡çŠ¶æ€</p></li></ol><p>Windows ä¸‹çš„å†…å­˜æ˜¯å¦‚ä½•ç®¡ç†çš„ï¼Ÿ</p><p>åˆ†é¡µç®¡ç†</p><p>ä»€ä¹ˆæ˜¯å†…å­˜ç®¡ç†ï¼Ÿ</p><p>å†…å­˜ç®¡ç†çš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯ä¸ºå¾…è¿è¡Œçš„ç¨‹åºåˆ†é…å†…å­˜, å¹¶åœ¨ä½¿ç”¨ç»“æŸåå›æ”¶è¿™äº›å†…å­˜</p><p>åˆ†åŒºæ³•æ˜¯ä¸€ç§ç®€å•çš„å†…å­˜ç®¡ç†æ–¹å¼, åˆ†ä¸ºå›ºå®šåˆ†åŒºæ³•ã€åŠ¨æ€åˆ†åŒºæ³•<br>å›ºå®šåˆ†åŒºæ³•ï¼šä¸€æ—¦åˆ†åŒºåˆ†å¥½, åˆ†åŒºçš„ä¸ªæ•°å’Œå¤§å°éƒ½ä¸å†æ”¹å˜<br>åŠ¨æ€åˆ†åŒºæ³•ï¼šæ ¹æ®ä½œä¸šçš„å†…å­˜å®¹é‡éœ€æ±‚, åŠ¨æ€ä¸ºä½œä¸šåˆ’åˆ†ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´(åˆ†åŒº)</p><h3 id="ä¸€ä¸ªç¨‹åºä»å¼€å§‹è¿è¡Œåˆ°ç»“æŸçš„å®Œæ•´è¿‡ç¨‹ï¼ˆå››ä¸ªè¿‡ç¨‹ï¼‰">ä¸€ä¸ªç¨‹åºä»å¼€å§‹è¿è¡Œåˆ°ç»“æŸçš„å®Œæ•´è¿‡ç¨‹ï¼ˆå››ä¸ªè¿‡ç¨‹ï¼‰</h3><p>é¢„å¤„ç†ï¼šæ¡ä»¶ç¼–è¯‘, å¤´æ–‡ä»¶åŒ…å«, å®æ›¿æ¢çš„å¤„ç†, ç”Ÿæˆ.iæ–‡ä»¶ã€‚</p><p>ç¼–è¯‘ï¼šå°†é¢„å¤„ç†åçš„æ–‡ä»¶è½¬æ¢æˆæ±‡ç¼–è¯­è¨€, ç”Ÿæˆ.sæ–‡ä»¶</p><p>æ±‡ç¼–ï¼šæ±‡ç¼–å˜ä¸ºç›®æ ‡ä»£ç (æœºå™¨ä»£ç )ç”Ÿæˆ.oçš„æ–‡ä»¶</p><p>é“¾æ¥ï¼šè¿æ¥ç›®æ ‡ä»£ç ,ç”Ÿæˆå¯æ‰§è¡Œç¨‹åº</p><h3 id="çº¿ç¨‹æ¨¡å‹">çº¿ç¨‹æ¨¡å‹</h3><p>è¿™é‡Œä»¥Linuxä¸ºä¾‹ã€‚Linuxå†å²ä¸Š, æœ€å¼€å§‹ä½¿ç”¨çš„çº¿ç¨‹æ˜¯LinuxThreads, ä½†LinuxThreadsæœ‰äº›æ–¹é¢å—é™äºå†…æ ¸çš„ç‰¹æ€§, ä»è€Œè¿èƒŒäº†SUSV3 Pthreadsæ ‡å‡†ã€‚å³å®ƒè¦æ ¹æ®å†…æ ¸çš„ç‰¹æ€§æ¥å®ç°çº¿ç¨‹, æœ‰äº›åœ°æ–¹æ²¡æœ‰éµå¾ªç»Ÿä¸€çš„æ ‡å‡†ã€‚åæ¥IBMå¼€å‘äº†NGPT(Next Generation POSIX Threads), æ€§èƒ½æ˜æ˜¾ä¼˜äºLinuxThreads, äººä»¬æ›¾æŠŠå®ƒå½“ä½œLinuxThreadsçš„ç»§ä»»è€…ã€‚ä½†æœ€å, åˆæœ‰ä¸€ä¸ªé¡¹ç›®NPTL(Native POSIX Threads Library)å‡ºæ¥å, æ€§èƒ½æ›´ä¼˜äºNGPTã€‚2002å¹´NGPTé¡¹ç›®åœæ­¢å¼€å‘, æˆ‘ä»¬ç°åœ¨ç”¨çš„Linuxçº¿ç¨‹å°±æ˜¯NPTLã€‚</p><p>çº¿ç¨‹çš„å®ç°æ›¾æœ‰3ç§æ¨¡å‹ï¼š</p><p>1.å¤šå¯¹ä¸€(M:1)çš„ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹</p><p>2.ä¸€å¯¹ä¸€(1:1)çš„å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹</p><p>3.å¤šå¯¹å¤š(M:N)çš„ä¸¤çº§çº¿ç¨‹æ¨¡å‹</p><p>ä¸Šé¢çš„xå¯¹y(x:y)å³xä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”yä¸ªå†…æ ¸è°ƒåº¦å®ä½“(Kernel Scheduling Entity, è¿™ä¸ªæ˜¯å†…æ ¸åˆ†é…CPUçš„å¯¹è±¡å•ä½)ã€‚</p><p>LinuxThreadså’ŒNPTLéƒ½æ˜¯é‡‡ç”¨ä¸€å¯¹ä¸€çš„çº¿ç¨‹æ¨¡å‹, NGPTé‡‡ç”¨çš„æ˜¯å¤šå¯¹å¤šçš„çº¿ç¨‹æ¨¡å‹ï¼ï¼ï¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¿ç¨‹å’Œè¿›ç¨‹</title>
    <link href="/2020/04/22/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/"/>
    <url>/2020/04/22/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="çº¿ç¨‹å’Œè¿›ç¨‹">çº¿ç¨‹å’Œè¿›ç¨‹</h2><p>çº¿ç¨‹å’Œè¿›ç¨‹çš„å…³ç³»ï¼šçº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬æ‰§è¡Œå•å…ƒ, ä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡, å¿…é¡»å¾—æœ‰çº¿ç¨‹, è¿›ç¨‹è‡³å°‘è¦æœ‰ä¸€æ¡çº¿ç¨‹</p><ul><li><p>åŒºåˆ«ï¼š</p><p>åœ°å€ç©ºé—´ï¼šåŒä¸€è¿›ç¨‹çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´, è€Œè¿›ç¨‹ä¹‹é—´åˆ™æ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚</p><p>èµ„æºæ‹¥æœ‰ï¼šåŒä¸€è¿›ç¨‹å†…çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„èµ„æºå¦‚å†…å­˜ã€I/Oã€cpuç­‰, ä½†æ˜¯è¿›ç¨‹ä¹‹é—´çš„èµ„æºæ˜¯ç‹¬ç«‹çš„</p></li></ul><h3 id="è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼æœ‰ï¼š">è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼æœ‰ï¼š</h3><p>ä¸€ã€ç®¡é“</p><p>ç®¡é“, é€šå¸¸æŒ‡æ— åç®¡é“, æ˜¯ UNIX ç³»ç»ŸIPCæœ€å¤è€çš„å½¢å¼ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><p>å®ƒæ˜¯åŠåŒå·¥çš„ï¼ˆå³æ•°æ®åªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ï¼‰, å…·æœ‰å›ºå®šçš„è¯»ç«¯å’Œå†™ç«¯ã€‚</p><p>å®ƒåªèƒ½ç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼ˆä¹Ÿæ˜¯çˆ¶å­è¿›ç¨‹æˆ–è€…å…„å¼Ÿè¿›ç¨‹ä¹‹é—´ï¼‰ã€‚</p><p>å®ƒå¯ä»¥çœ‹æˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶, å¯¹äºå®ƒçš„è¯»å†™ä¹Ÿå¯ä»¥ä½¿ç”¨æ™®é€šçš„readã€write ç­‰å‡½æ•°ã€‚ä½†æ˜¯å®ƒä¸æ˜¯æ™®é€šçš„æ–‡ä»¶, å¹¶ä¸å±äºå…¶ä»–ä»»ä½•æ–‡ä»¶ç³»ç»Ÿ, å¹¶ä¸”åªå­˜åœ¨äºå†…å­˜ä¸­ã€‚</p><p>äºŒã€FIFO</p><p>FIFO, ä¹Ÿç§°ä¸ºå‘½åç®¡é“, å®ƒæ˜¯ä¸€ç§æ–‡ä»¶ç±»å‹ã€‚</p><p>1ã€ç‰¹ç‚¹</p><p>FIFOå¯ä»¥åœ¨æ— å…³çš„è¿›ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®, ä¸æ— åç®¡é“ä¸åŒã€‚</p><p>FIFOæœ‰è·¯å¾„åä¸ä¹‹ç›¸å…³è”, å®ƒä»¥ä¸€ç§ç‰¹æ®Šè®¾å¤‡æ–‡ä»¶å½¢å¼å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p><p>ä¸‰ã€æ¶ˆæ¯é˜Ÿåˆ—</p><p>æ¶ˆæ¯é˜Ÿåˆ—, æ˜¯æ¶ˆæ¯çš„é“¾æ¥è¡¨, å­˜æ”¾åœ¨å†…æ ¸ä¸­ã€‚ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ç”±ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼ˆå³é˜Ÿåˆ—IDï¼‰æ¥æ ‡è¯†ã€‚</p><p>ç‰¹ç‚¹</p><p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯é¢å‘è®°å½•çš„, å…¶ä¸­çš„æ¶ˆæ¯å…·æœ‰ç‰¹å®šçš„æ ¼å¼ä»¥åŠç‰¹å®šçš„ä¼˜å…ˆçº§ã€‚</p><p>æ¶ˆæ¯é˜Ÿåˆ—ç‹¬ç«‹äºå‘é€ä¸æ¥æ”¶è¿›ç¨‹ã€‚è¿›ç¨‹ç»ˆæ­¢æ—¶, æ¶ˆæ¯é˜Ÿåˆ—åŠå…¶å†…å®¹å¹¶ä¸ä¼šè¢«åˆ é™¤ã€‚</p><p>æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°æ¶ˆæ¯çš„éšæœºæŸ¥è¯¢,æ¶ˆæ¯ä¸ä¸€å®šè¦ä»¥å…ˆè¿›å…ˆå‡ºçš„æ¬¡åºè¯»å–,ä¹Ÿå¯ä»¥æŒ‰æ¶ˆæ¯çš„ç±»å‹è¯»å–ã€‚</p><p>å››ã€ä¿¡å·é‡</p><p>ä¿¡å·é‡ï¼ˆsemaphoreï¼‰ä¸å·²ç»ä»‹ç»è¿‡çš„ IPC ç»“æ„ä¸åŒ, å®ƒæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ã€‚ä¿¡å·é‡ç”¨äºå®ç°è¿›ç¨‹é—´çš„äº’æ–¥ä¸åŒæ­¥, è€Œä¸æ˜¯ç”¨äºå­˜å‚¨è¿›ç¨‹é—´é€šä¿¡æ•°æ®ã€‚</p><p>ç‰¹ç‚¹</p><p>ä¿¡å·é‡ç”¨äºè¿›ç¨‹é—´åŒæ­¥, è‹¥è¦åœ¨è¿›ç¨‹é—´ä¼ é€’æ•°æ®éœ€è¦ç»“åˆå…±äº«å†…å­˜ã€‚</p><p>ä¿¡å·é‡åŸºäºæ“ä½œç³»ç»Ÿçš„ PV æ“ä½œ, ç¨‹åºå¯¹ä¿¡å·é‡çš„æ“ä½œéƒ½æ˜¯åŸå­æ“ä½œã€‚</p><p>æ¯æ¬¡å¯¹ä¿¡å·é‡çš„ PV æ“ä½œä¸ä»…é™äºå¯¹ä¿¡å·é‡å€¼åŠ  1 æˆ–å‡ 1, è€Œä¸”å¯ä»¥åŠ å‡ä»»æ„æ­£æ•´æ•°ã€‚</p><p>æ”¯æŒä¿¡å·é‡ç»„ã€‚</p><p>äº”ã€å…±äº«å†…å­˜</p><p>å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰, æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªç»™å®šçš„å­˜å‚¨åŒºã€‚</p><p>ç‰¹ç‚¹</p><p>å…±äº«å†…å­˜æ˜¯æœ€å¿«çš„ä¸€ç§ IPC, å› ä¸ºè¿›ç¨‹æ˜¯ç›´æ¥å¯¹å†…å­˜è¿›è¡Œå­˜å–ã€‚</p><p>å› ä¸ºå¤šä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶æ“ä½œ, æ‰€ä»¥éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚</p><p>ä¿¡å·é‡+å…±äº«å†…å­˜é€šå¸¸ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨, ä¿¡å·é‡ç”¨æ¥åŒæ­¥å¯¹å…±äº«å†…å­˜çš„è®¿é—®ã€‚</p><p>è¿›ç¨‹æœ‰äº”ç§çŠ¶æ€ï¼š</p><ul><li>åˆ›å»ºçŠ¶æ€ï¼šè¿›ç¨‹åœ¨åˆ›å»ºæ—¶éœ€è¦ç”³è¯·ä¸€ä¸ªç©ºç™½PCB, å‘å…¶ä¸­å¡«å†™æ§åˆ¶å’Œç®¡ç†è¿›ç¨‹çš„ä¿¡æ¯, å®Œæˆèµ„æºåˆ†é…ã€‚å¦‚æœåˆ›å»ºå·¥ä½œæ— æ³•å®Œæˆ, æ¯”å¦‚èµ„æºæ— æ³•æ»¡è¶³, å°±æ— æ³•è¢«è°ƒåº¦è¿è¡Œ, æŠŠæ­¤æ—¶è¿›ç¨‹æ‰€å¤„çŠ¶æ€ç§°ä¸ºåˆ›å»ºçŠ¶æ€</li><li>å°±ç»ªçŠ¶æ€ï¼šè¿›ç¨‹å·²ç»å‡†å¤‡å¥½, å·²åˆ†é…åˆ°æ‰€éœ€èµ„æº, åªè¦åˆ†é…åˆ°CPUå°±èƒ½å¤Ÿç«‹å³è¿è¡Œ</li><li>æ‰§è¡ŒçŠ¶æ€ï¼šè¿›ç¨‹å¤„äºå°±ç»ªçŠ¶æ€è¢«è°ƒåº¦å, è¿›ç¨‹è¿›å…¥æ‰§è¡ŒçŠ¶æ€</li><li>é˜»å¡çŠ¶æ€ï¼šæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ç”±äºæŸäº›äº‹ä»¶ï¼ˆI/Oè¯·æ±‚, ç”³è¯·ç¼“å­˜åŒºå¤±è´¥ï¼‰è€Œæš‚æ—¶æ— æ³•è¿è¡Œ, è¿›ç¨‹å—åˆ°é˜»å¡ã€‚åœ¨æ»¡è¶³è¯·æ±‚æ—¶è¿›å…¥å°±ç»ªçŠ¶æ€ç­‰å¾…ç³»ç»Ÿè°ƒç”¨</li><li>ç»ˆæ­¢çŠ¶æ€ï¼šè¿›ç¨‹ç»“æŸ, æˆ–å‡ºç°é”™è¯¯, æˆ–è¢«ç³»ç»Ÿç»ˆæ­¢, è¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚æ— æ³•å†æ‰§è¡Œ</li></ul><p>çŠ¶æ€è½¬æ¢</p><p><img src="/asset/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/images/1.jpg" alt="çŠ¶æ€è½¬æ¢"></p><h3 id="çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹">çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹</h3><p>æ­£å¸¸æƒ…å†µä¸‹, å­è¿›ç¨‹æ˜¯é€šè¿‡çˆ¶è¿›ç¨‹åˆ›å»ºçš„, å­è¿›ç¨‹å†åˆ›å»ºæ–°çš„å­è¿›ç¨‹ã€‚ä½†æ˜¯å­è¿›ç¨‹çš„ç»“æŸå’Œçˆ¶è¿›ç¨‹çš„è¿è¡Œæ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹, å³çˆ¶è¿›ç¨‹æ°¸è¿œæ— æ³•é¢„æµ‹å­è¿›ç¨‹åˆ°åº•ä»€ä¹ˆæ—¶å€™ç»“æŸã€‚å½“ä¸€ä¸ªè¿›ç¨‹å®Œæˆå®ƒçš„å·¥ä½œç»ˆæ­¢ä¹‹å, å®ƒçš„çˆ¶è¿›ç¨‹éœ€è¦è°ƒç”¨wait()æˆ–è€…waitpid()ç³»ç»Ÿè°ƒç”¨å–å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€</p><h3 id="åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹">åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹</h3><h4 id="åƒµå°¸è¿›ç¨‹">åƒµå°¸è¿›ç¨‹</h4><p>å½“ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸè¿è¡Œï¼ˆä¸€èˆ¬æ˜¯è°ƒç”¨exitã€è¿è¡Œæ—¶å‘ç”Ÿè‡´å‘½é”™è¯¯æˆ–æ”¶åˆ°ç»ˆæ­¢ä¿¡å·æ‰€å¯¼è‡´ï¼‰æ—¶, å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼ˆè¿”å›å€¼ï¼‰ä¼šå›æŠ¥ç»™æ“ä½œç³»ç»Ÿ, ç³»ç»Ÿåˆ™ä»¥SIGCHLDä¿¡å·å°†å­è¿›ç¨‹è¢«ç»“æŸçš„äº‹ä»¶å‘ŠçŸ¥çˆ¶è¿›ç¨‹, æ­¤æ—¶å­è¿›ç¨‹çš„è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ä»é©»ç•™åœ¨å†…å­˜ä¸­ã€‚ä¸€èˆ¬æ¥è¯´, æ”¶åˆ°SIGCHLDå, çˆ¶è¿›ç¨‹ä¼šä½¿ç”¨waitç³»ç»Ÿè°ƒç”¨ä»¥è·å–å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€, ç„¶åå†…æ ¸å°±å¯ä»¥ä»å†…å­˜ä¸­é‡Šæ”¾å·²ç»“æŸçš„å­è¿›ç¨‹çš„PCBï¼›è€Œå¦‚è‹¥çˆ¶è¿›ç¨‹æ²¡æœ‰è¿™ä¹ˆåšçš„è¯, å­è¿›ç¨‹çš„PCBå°±ä¼šä¸€ç›´é©»ç•™åœ¨å†…å­˜ä¸­, ä¹Ÿå³æˆä¸ºåƒµå°¸è¿›ç¨‹</p><h4 id="å­¤å„¿è¿›ç¨‹">å­¤å„¿è¿›ç¨‹</h4><p>å­¤å„¿è¿›ç¨‹åˆ™æ˜¯æŒ‡å½“ä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡º, è€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œ, é‚£ä¹ˆé‚£äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹å°†è¢«initè¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…», å¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œ</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç»œ DNSè§£æè¿‡ç¨‹</title>
    <link href="/2020/04/21/%E7%BD%91%E7%BB%9C/DNS%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B/"/>
    <url>/2020/04/21/%E7%BD%91%E7%BB%9C/DNS%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<ol><li>å®¢æˆ·ç«¯æŸ¥æœ¬åœ°hostsæ–‡ä»¶</li><li>DNSæœ¬åœ°æœåŠ¡ç¼“å­˜ DNS localcache</li><li>DNS server (recursion(é€’å½’)è¯·æ±‚)</li></ol><ul><li>å°±æ˜¯DNSæœåŠ¡å™¨è‡ªå·±è´Ÿè´£è§£æçš„åŸŸï¼šç›´æ¥æŸ¥è¯¢æ•°æ®åº“å¹¶è¿”å›ç»“æœ</li><li>ä¸æ˜¯è‡ªå·±è´Ÿè´£çš„åŸŸ:<ul><li>server cache:æ‰¾åˆ°è¿”å›</li><li>iteration(è¿­ä»£) ç”±æ ¹æ‰¾é¡¶çº§åŸŸå†æ‰¾äºŒçº§åŸŸâ€¦ å®Œæˆè§£æè¯·æ±‚</li></ul></li></ul><p>è¿”å›çš„ç»“æœï¼š</p><ul><li>è‚¯å®šç­”æ¡ˆï¼šç¡®å®šç»“æœ(å¯ä»¥ç¼“å­˜)</li><li>å¦å®šç­”æ¡ˆï¼šä¸å­˜åœ¨æŸ¥è¯¢çš„é”®, æ‰€ä»¥ä¸å­˜åœ¨ç”±é”®æŸ¥è¯¢çš„å€¼(ä¹Ÿä¼šç¼“å­˜)</li><li>æƒå¨ç­”æ¡ˆï¼šæœ‰å°±æ˜¯æœ‰, æ²¡æœ‰å°±æ˜¯æ²¡æœ‰</li><li>éæƒå¨ç­”æ¡ˆï¼šè‚¯èƒ½serverç«¯åˆšå‘ç»™å®¢æˆ·ç«¯æ²¡æœ‰çš„ç»“æœ, è‡ªå·±å°±æ›´æ–°äº†</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç»œ http https</title>
    <link href="/2020/04/21/%E7%BD%91%E7%BB%9C/http_https/"/>
    <url>/2020/04/21/%E7%BD%91%E7%BB%9C/http_https/</url>
    
    <content type="html"><![CDATA[<h2 id="http">http</h2><p>HTTPæ˜¯ä¸€ä¸ªåŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®ï¼ˆHTML æ–‡ä»¶, å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æœç­‰ï¼‰</p><h3 id="http1-0">http1.0</h3><p>HTTP 1.0è§„å®šæµè§ˆå™¨ä¸æœåŠ¡å™¨åªä¿æŒçŸ­æš‚çš„è¿æ¥, æµè§ˆå™¨çš„æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥, æœåŠ¡å™¨å®Œæˆè¯·æ±‚å¤„ç†åç«‹å³æ–­å¼€TCPè¿æ¥, æœåŠ¡å™¨ä¸è·Ÿè¸ªæ¯ä¸ªå®¢æˆ·ä¹Ÿä¸è®°å½•è¿‡å»çš„è¯·æ±‚</p><h3 id="http1-1">http1.1</h3><p>åœ¨1.0çš„åŸºç¡€ä¸Šå˜åŠ¨äº†ä»¥ä¸‹ç‰¹æ€§ï¼š</p><p><strong>ç¼“å­˜å¤„ç†</strong> , åœ¨HTTP1.0ä¸­ä¸»è¦ä½¿ç”¨headeré‡Œçš„If-Modified-Since,Expiresæ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†, HTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ä¾‹å¦‚Entity tag, If-Unmodified-Since, If-Match, If-None-Matchç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</p><p><strong>å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥çš„ä½¿ç”¨</strong>, HTTP1.0ä¸­, å­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡, ä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†, è€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†, å¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½, HTTP1.1åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº†rangeå¤´åŸŸ, å®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†, å³è¿”å›ç æ˜¯206ï¼ˆPartial Contentï¼‰, è¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚</p><p><strong>é”™è¯¯é€šçŸ¥çš„ç®¡ç†</strong>, åœ¨HTTP1.1ä¸­æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç , å¦‚409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚</p><p><strong>Hostå¤´å¤„ç†</strong>, åœ¨HTTP1.0ä¸­è®¤ä¸ºæ¯å°æœåŠ¡å™¨éƒ½ç»‘å®šä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€, å› æ­¤, è¯·æ±‚æ¶ˆæ¯ä¸­çš„URLå¹¶æ²¡æœ‰ä¼ é€’ä¸»æœºåï¼ˆhostnameï¼‰ã€‚ä½†éšç€è™šæ‹Ÿä¸»æœºæŠ€æœ¯çš„å‘å±•, åœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼ˆMulti-homed Web Serversï¼‰, å¹¶ä¸”å®ƒä»¬å…±äº«ä¸€ä¸ªIPåœ°å€ã€‚HTTP1.1çš„è¯·æ±‚æ¶ˆæ¯å’Œå“åº”æ¶ˆæ¯éƒ½åº”æ”¯æŒHostå¤´åŸŸ, ä¸”è¯·æ±‚æ¶ˆæ¯ä¸­å¦‚æœæ²¡æœ‰Hostå¤´åŸŸä¼šæŠ¥å‘Šä¸€ä¸ªé”™è¯¯ï¼ˆ400 Bad Requestï¼‰ã€‚</p><p><strong>é•¿è¿æ¥</strong>, HTTP 1.1æ”¯æŒé•¿è¿æ¥ï¼ˆPersistentConnectionï¼‰å’Œè¯·æ±‚çš„æµæ°´çº¿ï¼ˆPipeliningï¼‰å¤„ç†, åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸Šå¯ä»¥ä¼ é€å¤šä¸ªHTTPè¯·æ±‚å’Œå“åº”, å‡å°‘äº†å»ºç«‹å’Œå…³é—­è¿æ¥çš„æ¶ˆè€—å’Œå»¶è¿Ÿ, åœ¨HTTP1.1ä¸­é»˜è®¤å¼€å¯Connectionï¼š keep-alive, ä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥äº†HTTP1.0æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ›å»ºè¿æ¥çš„ç¼ºç‚¹</p><h3 id="http2-0">http2.0</h3><h4 id="ä»€ä¹ˆæ˜¯SPDYåè®®">ä»€ä¹ˆæ˜¯SPDYåè®®</h4><p>SPDYæ˜¯Speedyçš„æ˜µéŸ³, æ„ä¸ºâ€œæ›´å¿«â€ã€‚å®ƒæ˜¯Googleå¼€å‘çš„åŸºäºTCPåè®®çš„åº”ç”¨å±‚åè®®ã€‚ç›®æ ‡æ˜¯ä¼˜åŒ–HTTPåè®®çš„æ€§èƒ½, é€šè¿‡å‹ç¼©ã€å¤šè·¯å¤ç”¨å’Œä¼˜å…ˆçº§ç­‰æŠ€æœ¯, ç¼©çŸ­ç½‘é¡µçš„åŠ è½½æ—¶é—´å¹¶æé«˜å®‰å…¨æ€§ã€‚SPDYåè®®çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°½é‡å‡å°‘TCPè¿æ¥æ•°ã€‚SPDYå¹¶ä¸æ˜¯ä¸€ç§ç”¨äºæ›¿ä»£HTTPçš„åè®®, è€Œæ˜¯å¯¹HTTPåè®®çš„å¢å¼º</p><h4 id="HTTP2-0ï¼šSPDYçš„å‡çº§ç‰ˆ">HTTP2.0ï¼šSPDYçš„å‡çº§ç‰ˆ</h4><p>HTTP2.0å¯ä»¥è¯´æ˜¯SPDYçš„å‡çº§ç‰ˆï¼ˆå…¶å®åŸæœ¬ä¹Ÿæ˜¯åŸºäºSPDYè®¾è®¡çš„ï¼‰, ä½†æ˜¯, HTTP2.0 è·Ÿ SPDY ä»æœ‰ä¸åŒçš„åœ°æ–¹, å¦‚ä¸‹ï¼š</p><h4 id="HTTP2-0å’ŒSPDYçš„åŒºåˆ«ï¼š">HTTP2.0å’ŒSPDYçš„åŒºåˆ«ï¼š</h4><p>HTTP2.0 æ”¯æŒæ˜æ–‡ HTTP ä¼ è¾“, è€Œ SPDY å¼ºåˆ¶ä½¿ç”¨ HTTPS</p><p>HTTP2.0 æ¶ˆæ¯å¤´çš„å‹ç¼©ç®—æ³•é‡‡ç”¨ HPACK <a href="http://http2.github.io/http2-spec/compression.html">http://http2.github.io/http2-spec/compression.html</a>, è€Œé SPDY é‡‡ç”¨çš„ DEFLATE <a href="http://zh.wikipedia.org/wiki/DEFLATE">http://zh.wikipedia.org/wiki/DEFLATE</a></p><h4 id="HTTP2-0å’ŒHTTP1-Xç›¸æ¯”çš„æ–°ç‰¹æ€§">HTTP2.0å’ŒHTTP1.Xç›¸æ¯”çš„æ–°ç‰¹æ€§</h4><p><strong>æ–°çš„äºŒè¿›åˆ¶æ ¼å¼ï¼ˆBinary Formatï¼‰</strong>, HTTP1.xçš„è§£ææ˜¯åŸºäºæ–‡æœ¬ã€‚åŸºäºæ–‡æœ¬åè®®çš„æ ¼å¼è§£æå­˜åœ¨å¤©ç„¶ç¼ºé™·, æ–‡æœ¬çš„è¡¨ç°å½¢å¼æœ‰å¤šæ ·æ€§, è¦åšåˆ°å¥å£®æ€§è€ƒè™‘çš„åœºæ™¯å¿…ç„¶å¾ˆå¤š, äºŒè¿›åˆ¶åˆ™ä¸åŒ, åªè®¤0å’Œ1çš„ç»„åˆã€‚åŸºäºè¿™ç§è€ƒè™‘HTTP2.0çš„åè®®è§£æå†³å®šé‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼, å®ç°æ–¹ä¾¿ä¸”å¥å£®ã€‚</p><p><strong>å¤šè·¯å¤ç”¨ï¼ˆMultiPlexingï¼‰</strong>, å³è¿æ¥å…±äº«, å³æ¯ä¸€ä¸ªrequestéƒ½æ˜¯æ˜¯ç”¨ä½œè¿æ¥å…±äº«æœºåˆ¶çš„ã€‚ä¸€ä¸ªrequestå¯¹åº”ä¸€ä¸ªid, è¿™æ ·ä¸€ä¸ªè¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ªrequest, æ¯ä¸ªè¿æ¥çš„requestå¯ä»¥éšæœºçš„æ··æ‚åœ¨ä¸€èµ·, æ¥æ”¶æ–¹å¯ä»¥æ ¹æ®requestçš„ idå°†requestå†å½’å±åˆ°å„è‡ªä¸åŒçš„æœåŠ¡ç«¯è¯·æ±‚é‡Œé¢ã€‚</p><p><strong>headerå‹ç¼©</strong>, å¦‚ä¸Šæ–‡ä¸­æ‰€è¨€, å¯¹å‰é¢æåˆ°è¿‡HTTP1.xçš„headerå¸¦æœ‰å¤§é‡ä¿¡æ¯, è€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€, HTTP2.0ä½¿ç”¨encoderæ¥å‡å°‘éœ€è¦ä¼ è¾“çš„headerå¤§å°, é€šè®¯åŒæ–¹å„è‡ªcacheä¸€ä»½header fieldsè¡¨, æ—¢é¿å…äº†é‡å¤headerçš„ä¼ è¾“, åˆå‡å°äº†éœ€è¦ä¼ è¾“çš„å¤§å°ã€‚</p><p>æœåŠ¡ç«¯æ¨é€ï¼ˆserver pushï¼‰, åŒSPDYä¸€æ ·, HTTP2.0ä¹Ÿå…·æœ‰server pushåŠŸèƒ½</p><h3 id="å¹‚ç­‰-Idempotence">å¹‚ç­‰ Idempotence</h3><p>HTTPæ–¹æ³•çš„å¹‚ç­‰æ€§æ˜¯æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºåº”è¯¥å…·æœ‰åŒæ ·çš„<strong>å‰¯ä½œç”¨</strong></p><p>get æ˜¯å¹‚ç­‰çš„,  postä¸æ˜¯(ä¸ä¸€å®šæ˜¯)</p><h2 id="https">https</h2><p>HTTPS åè®®æ˜¯ç”± HTTP åŠ ä¸Š TLS/SSL åè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®, ä¸»è¦é€šè¿‡æ•°å­—è¯ä¹¦ã€åŠ å¯†ç®—æ³•ã€éå¯¹ç§°å¯†é’¥ç­‰æŠ€æœ¯å®Œæˆäº’è”ç½‘æ•°æ®ä¼ è¾“åŠ å¯†, å®ç°äº’è”ç½‘ä¼ è¾“å®‰å…¨ä¿æŠ¤ã€‚è®¾è®¡ç›®æ ‡ä¸»è¦æœ‰ä¸‰ä¸ªã€‚</p><p>ï¼ˆ1ï¼‰æ•°æ®ä¿å¯†æ€§ï¼šä¿è¯æ•°æ®å†…å®¹åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­ä¸ä¼šè¢«ç¬¬ä¸‰æ–¹æŸ¥çœ‹ã€‚å°±åƒå¿«é€’å‘˜ä¼ é€’åŒ…è£¹ä¸€æ ·, éƒ½è¿›è¡Œäº†å°è£…, åˆ«äººæ— æ³•è·çŸ¥é‡Œé¢è£…äº†ä»€ä¹ˆ</p><p>ï¼ˆ2ï¼‰æ•°æ®å®Œæ•´æ€§ï¼šåŠæ—¶å‘ç°è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹çš„ä¼ è¾“å†…å®¹ã€‚å°±åƒå¿«é€’å‘˜è™½ç„¶ä¸çŸ¥é“åŒ…è£¹é‡Œè£…äº†ä»€ä¹ˆä¸œè¥¿, ä½†ä»–æœ‰å¯èƒ½ä¸­é€”æ‰åŒ…, æ•°æ®å®Œæ•´æ€§å°±æ˜¯æŒ‡å¦‚æœè¢«æ‰åŒ…, æˆ‘ä»¬èƒ½è½»æ¾å‘ç°å¹¶æ‹’æ”¶</p><p>ï¼ˆ3ï¼‰èº«ä»½æ ¡éªŒå®‰å…¨æ€§ï¼šä¿è¯æ•°æ®åˆ°è¾¾ç”¨æˆ·æœŸæœ›çš„ç›®çš„åœ°ã€‚å°±åƒæˆ‘ä»¬é‚®å¯„åŒ…è£¹æ—¶, è™½ç„¶æ˜¯ä¸€ä¸ªå°è£…å¥½çš„æœªæ‰åŒ…çš„åŒ…è£¹, ä½†å¿…é¡»ç¡®å®šè¿™ä¸ªåŒ…è£¹ä¸ä¼šé€é”™åœ°æ–¹, é€šè¿‡èº«ä»½æ ¡éªŒæ¥ç¡®ä¿é€å¯¹äº†åœ°æ–¹</p><h4 id="åŒå‘çš„èº«ä»½è®¤è¯">åŒå‘çš„èº«ä»½è®¤è¯</h4><ul><li><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åœ¨ä¼ è¾“æ•°æ®ä¹‹å‰,ä¼šé€šè¿‡åŸºäºè¯ä¹¦å¯¹åŒæ–¹è¿›è¡Œèº«ä»½è®¤è¯ ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ :</p></li><li><p>å®¢æˆ·ç«¯å‘èµ· SSL æ¡æ‰‹æ¶ˆæ¯ç»™æœåŠ¡ç«¯è¦æ±‚è¿æ¥ã€‚</p></li><li><p>æœåŠ¡ç«¯å°†è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p></li><li><p>å®¢æˆ·ç«¯æ£€æŸ¥æœåŠ¡ç«¯è¯ä¹¦, ç¡®è®¤æ˜¯å¦ç”±è‡ªå·±ä¿¡ä»»çš„è¯ä¹¦ç­¾å‘æœºæ„ç­¾å‘ã€‚ å¦‚æœä¸æ˜¯, å°†æ˜¯å¦ç»§ç»­é€šè®¯çš„å†³å®šæƒäº¤ç»™ç”¨æˆ·é€‰æ‹© ( æ³¨æ„, è¿™é‡Œå°†æ˜¯ä¸€ä¸ªå®‰å…¨ç¼ºé™· )ã€‚å¦‚æœæ£€æŸ¥æ— è¯¯æˆ–è€…ç”¨æˆ·é€‰æ‹©ç»§ç»­, åˆ™å®¢æˆ·ç«¯è®¤å¯æœåŠ¡ç«¯çš„èº«ä»½ã€‚</p></li><li><p>æœåŠ¡ç«¯è¦æ±‚å®¢æˆ·ç«¯å‘é€è¯ä¹¦, å¹¶æ£€æŸ¥æ˜¯å¦é€šè¿‡éªŒè¯ã€‚å¤±è´¥åˆ™å…³é—­è¿æ¥, è®¤è¯æˆåŠŸåˆ™ä»å®¢æˆ·ç«¯è¯ä¹¦ä¸­è·å¾—å®¢æˆ·ç«¯çš„å…¬é’¥, ä¸€èˆ¬ä¸º1024ä½æˆ–è€… 2048ä½ã€‚åˆ°æ­¤, æœåŠ¡å™¨å®¢æˆ·ç«¯åŒæ–¹çš„èº«ä»½è®¤è¯ç»“æŸ, åŒæ–¹ç¡®ä¿èº«ä»½éƒ½æ˜¯çœŸå®å¯é çš„</p></li></ul><h3 id="cookieå’Œsession">cookieå’Œsession</h3><table><thead><tr><th></th><th>Cookie</th><th>Session</th></tr></thead><tbody><tr><td>å‚¨å­˜ä½ç½®</td><td>å®¢æˆ·ç«¯</td><td>æœåŠ¡å™¨ç«¯</td></tr><tr><td>ç›®çš„</td><td>è·Ÿè¸ªä¼šè¯, ä¹Ÿå¯ä»¥ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®æˆ–è€…ä¿å­˜ç”¨æˆ·åå¯†ç ç­‰</td><td>è·Ÿè¸ªä¼šè¯</td></tr><tr><td>å®‰å…¨æ€§</td><td>ä¸å®‰å…¨</td><td>å®‰å…¨</td></tr></tbody></table><p>sessionæŠ€æœ¯æ˜¯è¦ä½¿ç”¨åˆ°cookieçš„, ä¹‹æ‰€ä»¥å‡ºç°sessionæŠ€æœ¯, ä¸»è¦æ˜¯ä¸ºäº†å®‰å…¨</p><h3 id="GETå’ŒPOST">GETå’ŒPOST</h3><ul><li>urlå¯è§æ€§<ul><li>get, å‚æ•°urlå¯è§</li><li>post, urlå‚æ•°ä¸å¯è§</li></ul></li><li>æ•°æ®ä¼ è¾“ä¸Š<ul><li>get é€šè¿‡æ‹¼æ¥urlè¿›è¡Œä¼ é€’å‚æ•°ï¼›</li><li>post é€šè¿‡bodyä½“ä¼ è¾“å‚æ•°</li></ul></li><li>ç¼“å­˜æ€§<ul><li>getè¯·æ±‚æ˜¯å¯ä»¥ç¼“å­˜çš„</li><li>postè¯·æ±‚ä¸å¯ä»¥ç¼“å­˜</li></ul></li><li>ä¼ è¾“æ•°æ®çš„å¤§å°<ul><li>getä¸€èˆ¬ä¼ è¾“æ•°æ®å¤§å°ä¸è¶…è¿‡2k-4kï¼ˆæ ¹æ®æµè§ˆå™¨ä¸åŒ, é™åˆ¶ä¸ä¸€æ ·, ä½†ç›¸å·®ä¸å¤§ï¼‰</li><li>postè¯·æ±‚ä¼ è¾“æ•°æ®çš„å¤§å°ä¸é™åˆ¶æƒ…å†µä¸‹å¯ä»¥æ— é™å¤§</li></ul></li><li>å®‰å…¨æ€§<ul><li>è¿™ä¸ªä¹Ÿæ˜¯æœ€ä¸å¥½åˆ†æçš„, åŸåˆ™ä¸Špostè‚¯å®šè¦æ¯”getå®‰å…¨, æ¯•ç«Ÿä¼ è¾“å‚æ•°æ—¶urlä¸å¯è§, ä½†ä¹ŸæŒ¡ä¸ä½éƒ¨åˆ†äººé—²çš„æ²¡äº‹åœ¨é‚£æŠ“åŒ…ç©ã€‚å®‰å…¨æ€§ä¸ªäººè§‰å¾—æ˜¯æ²¡å¤šå¤§åŒºåˆ«çš„, é˜²å›å­ä¸é˜²å°äººå°±æ˜¯è¿™ä¸ªé“ç†ã€‚å¯¹ä¼ é€’çš„å‚æ•°è¿›è¡ŒåŠ å¯†, å…¶å®éƒ½ä¸€æ ·</li></ul></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç»œ TCP UDP</title>
    <link href="/2020/04/21/%E7%BD%91%E7%BB%9C/tcp_udp/"/>
    <url>/2020/04/21/%E7%BD%91%E7%BB%9C/tcp_udp/</url>
    
    <content type="html"><![CDATA[<h3 id="TCPä¸‰æ¬¡æ¡æ‰‹">TCPä¸‰æ¬¡æ¡æ‰‹</h3><ol><li><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ˆSYNï¼‰ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªSYNï¼ˆåŒæ­¥ï¼‰è¯·æ±‚ï¼Œè¯·æ±‚å»ºç«‹è¿æ¥ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å¤„äºSYN_SENDçŠ¶æ€ã€‚</p></li><li><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ˆSYN+ACKï¼‰ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNè¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªSYN+ACKï¼ˆåŒæ­¥+ç¡®è®¤ï¼‰å“åº”ï¼Œè¡¨ç¤ºå·²ç»æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å‡†å¤‡å¥½å»ºç«‹è¿æ¥ã€‚æ­¤æ—¶æœåŠ¡å™¨å¤„äºSYN_RECVçŠ¶æ€ã€‚</p></li><li><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ˆACKï¼‰ï¼šå®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKå“åº”åï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªACKï¼ˆç¡®è®¤ï¼‰å“åº”ï¼Œè¡¨ç¤ºå·²ç»æ”¶åˆ°äº†æœåŠ¡å™¨çš„ç¡®è®¤ï¼Œå¹¶å‡†å¤‡å¥½ä¼ è¾“æ•°æ®ã€‚æ­¤æ—¶å®¢æˆ·ç«¯å¤„äºESTABLISHEDçŠ¶æ€ï¼ŒæœåŠ¡å™¨ä¹Ÿå¤„äºESTABLISHEDçŠ¶æ€ï¼Œè¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹ã€‚</p></li></ol><p>å»ºç«‹è¿æ¥çš„æ—¶å€™, å‘é€çš„åŒ…éƒ½ä¸åŒ…å«ä»»ä½•æ•°æ®, å»ºç«‹è¿æ¥åæ‰å‘é€æ•°æ®, ç†æƒ³çŠ¶æ€ä¸‹, TCPä¸€æ—¦åˆ›å»º, åœ¨é€šä¿¡åŒæ–¹ä¸­çš„ä»»ä½•ä¸€æ–¹ä¸»åŠ¨å…³é—­è¿æ¥ä¹‹å‰, TCPéƒ½ä¼šä¸€ç›´è¿æ¥ä¸‹å»</p><p>ä¼˜ç‚¹ï¼š</p><ol><li><p>å¯ä»¥å»ºç«‹å¯é è¿æ¥ï¼šç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯è¿æ¥å¯é çš„</p></li><li><p>é¿å…èµ„æºæµªè´¹ï¼šå¯ä»¥é¿å…æ— æ•ˆè¿æ¥å¯¼è‡´çš„èµ„æºæµªè´¹</p></li><li><p>å®‰å…¨æ€§é«˜ï¼šåªæœ‰åœ¨å»ºç«‹è¿æ¥åæ‰èƒ½ä¼ è¾“æ•°æ®</p></li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li><p>å»ºç«‹è¿æ¥é€Ÿåº¦æ…¢ï¼šéœ€è¦3æ¬¡ç¡®è®¤æ‰èƒ½å»ºç«‹è¿æ¥</p></li><li><p>å ç”¨èµ„æºï¼š3æ¬¡æ¡æ‰‹éœ€è¦å ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯èµ„æºï¼Œå¦‚å¸¦å®½ï¼Œcpuç­‰</p></li><li><p>å¯èƒ½è¢«æ”»å‡»ï¼šæ¡æ‰‹è¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¢«åˆ©ç”¨è¿›è¡Œæ”»å‡»ï¼Œä¾‹å¦‚SYNæ´ªæ³›æ”»å‡»ï¼ŒSYNæ³„éœ²æ”»å‡»ç­‰ï¼Œè¿™ä¼šå¯¼è‡´æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ— æ³•æ­£å¸¸è¿æ¥ï¼Œå½±å“ç½‘ç»œçš„æ­£å¸¸è¿è¡Œ</p></li></ol><h4 id="ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡">ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡</h4><p>TCP åè®®çš„ä½œç”¨æ˜¯, ä¿è¯æ•°æ®é€šä¿¡çš„å®Œæ•´æ€§å’Œå¯é æ€§, é˜²æ­¢ä¸¢åŒ…</p><p>TCPä½œä¸ºä¸€ç§å¯é ä¼ è¾“æ§åˆ¶åè®®, å…¶æ ¸å¿ƒæ€æƒ³ï¼šæ—¢è¦ä¿è¯æ•°æ®å¯é ä¼ è¾“, åˆè¦æé«˜ä¼ è¾“çš„æ•ˆç‡, è€Œç”¨ä¸‰æ¬¡æ°æ°å¯ä»¥æ»¡è¶³ä»¥ä¸Šä¸¤æ–¹é¢çš„éœ€æ±‚</p><h4 id="ä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡">ä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡</h4><p>å¦‚æœåªæ˜¯ä¸¤æ¬¡æ¡æ‰‹, è‡³å¤šåªæœ‰è¿æ¥å‘èµ·æ–¹çš„èµ·å§‹åºåˆ—å·èƒ½è¢«ç¡®è®¤, å¦ä¸€æ–¹é€‰æ‹©çš„åºåˆ—å·åˆ™å¾—ä¸åˆ°ç¡®è®¤</p><h4 id="tcpå¦‚ä½•ä¿è¯å¯é ä¼ è¾“">tcpå¦‚ä½•ä¿è¯å¯é ä¼ è¾“</h4><p>TCPä¸»è¦æä¾›äº†ä¸€ä¸‹å‡ ç§å®‰å…¨æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œå¯é æ€§</p><ol><li><p>æ£€éªŒå’Œ</p><p>TCPåè®®åœ¨å‘é€æ•°æ®å‰ä¼šå¯¹æ•°æ®è¿›è¡Œæ ¡éªŒå’Œè®¡ç®—ï¼Œç”Ÿæˆä¸€ä¸ªæ ¡éªŒå’Œï¼Œå°†è¿™ä¸ªæ ¡éªŒå’Œé™„åŠ åœ¨æ•°æ®åŒ…çš„å¤´éƒ¨ã€‚æ¥æ”¶æ–¹åœ¨æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œä¹Ÿä¼šè®¡ç®—æ ¡éªŒå’Œï¼Œç„¶åå°†è®¡ç®—å¾—åˆ°çš„æ ¡éªŒå’Œä¸æ¥æ”¶åˆ°çš„æ ¡éªŒå’Œè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ä¸ä¸€è‡´ï¼Œåˆ™è¯´æ˜æ•°æ®å¯èƒ½å·²ç»è¢«ç ´åæˆ–è€…å‘ç”Ÿäº†é”™è¯¯ï¼Œæ¥æ”¶æ–¹ä¼šä¸¢å¼ƒè¿™ä¸ªæ•°æ®åŒ…å¹¶å‘é€é‡ä¼ è¯·æ±‚ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒTCPåè®®å¯ä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œå¯é æ€§</p></li><li><p>åºåˆ—å·/ç¡®è®¤åº”ç­”</p><p>TCPåè®®ä¼šä¸ºæ¯ä¸ªæ•°æ®åŒ…åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„åºåˆ—å·ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åï¼Œä¼šå‘é€ä¸€ä¸ªç¡®è®¤åº”ç­”ACKï¼Œä»¥é€šçŸ¥å‘é€æ–¹æ•°æ®å·²ç»æ­£ç¡®æ¥æ”¶ã€‚å¦‚æœå‘é€æ–¹æ²¡æœ‰æ”¶åˆ°ç¡®è®¤åº”ç­”ACKï¼Œåˆ™ä¼šé‡å‘æ•°æ®åŒ…ï¼Œç›´åˆ°æ”¶åˆ°ç¡®è®¤åº”ç­”ACKä¸ºæ­¢</p></li><li><p>è¶…æ—¶é‡ä¼ </p><p>å¦‚æœå‘é€æ–¹æ²¡æœ‰æ”¶åˆ°ç¡®è®¤åº”ç­”ACKï¼Œåˆ™ä¼šå®šæ—¶é‡å‘æ•°æ®åŒ…ï¼Œç›´åˆ°æ”¶åˆ°ç¡®è®¤åº”ç­”ACKä¸ºæ­¢</p></li><li><p>æ»‘åŠ¨çª—å£æ§åˆ¶(æµé‡æ§åˆ¶)</p><p>TCPåè®®åœ¨å‘é€æ•°æ®æ—¶ï¼Œä¼šæ ¹æ®æ¥æ”¶æ–¹çš„æ¥æ”¶èƒ½åŠ›è®¾ç½®ä¸€ä¸ªæ»‘åŠ¨çª—å£å¤§å°ã€‚å‘é€æ–¹åœ¨å‘é€æ•°æ®æ—¶ï¼Œéœ€è¦ç­‰å¾…æ¥æ”¶æ–¹çš„ç¡®è®¤åº”ç­”ï¼Œç¡®è®¤æ¥æ”¶åˆ°äº†æ•°æ®åŒ…å¹¶æä¾›äº†ä¸‹ä¸€ä¸ªæœŸæœ›æ¥æ”¶çš„åºåˆ—å·ï¼Œæ‰èƒ½ç»§ç»­å‘é€ä¸‹ä¸€ä¸ªæ•°æ®åŒ…ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿æ¥æ”¶æ–¹å¯ä»¥å¤„ç†è‡ªå·±èƒ½å¤Ÿå¤„ç†çš„æ•°æ®åŒ…ï¼Œå¹¶ä¸”å¯ä»¥é¿å…æ•°æ®åŒ…çš„ä¸¢å¤±æˆ–è€…è¶…æ—¶ç­‰é—®é¢˜</p></li><li><p>æ‹¥å¡æ§åˆ¶</p><p>TCPåè®®é€šè¿‡æ‹¥å¡æ§åˆ¶æœºåˆ¶æ¥é¿å…ç½‘ç»œæ‹¥å¡ï¼Œä¿è¯ç½‘ç»œçš„å¯é æ€§å’Œå…¬å¹³æ€§ã€‚å‘é€æ–¹ä¼šæ ¹æ®ç½‘ç»œçš„æ‹¥å¡æƒ…å†µæ¥è°ƒæ•´å‘é€é€Ÿåº¦ï¼Œé¿å…é€ æˆç½‘ç»œæ‹¥å¡</p></li></ol><h3 id="å››æ¬¡æŒ¥æ‰‹">å››æ¬¡æŒ¥æ‰‹</h3><ol><li>ç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€FINæŠ¥æ–‡, è¯·æ±‚æ–­å¼€è¿æ¥, åºå·ä¸ºxã€‚æ­¤æ—¶TCPæ•°æ®åŒ…çš„æ ‡å¿—ä½ä¸ºFINã€‚</li><li>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ACKæŠ¥æ–‡, è¡¨ç¤ºæ”¶åˆ°äº†å®¢æˆ·ç«¯å‘é€çš„æ–­å¼€è¿æ¥è¯·æ±‚çš„æ•°æ®åŒ…, åºå·ä¸ºy, ç¡®è®¤åºå·ä¸ºx+1ã€‚æ­¤æ—¶TCPæ•°æ®åŒ…çš„æ ‡å¿—ä½ACKè¢«è®¾ç½®ä¸º1</li><li>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€FINåŒ…, è¡¨ç¤ºæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ç»“æŸè¯·æ±‚åŒ…, åºå·ä¸ºy, ç¡®è®¤åºå·ä¸ºx+1</li><li>ç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ACKæŠ¥æ–‡, è¡¨ç¤ºæ”¶åˆ°æœåŠ¡å™¨çš„ç»“æŸè¯·æ±‚åŒ…, åˆ°è¿™é‡Œæ‰€æœ‰æµç¨‹èµ°å®Œ, æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯, æ­£å¼æ–­å¼€è¿æ¥, TCPæ•°æ®åŒ…çš„åºå·ä¸ºx+1, ç¡®è®¤å·ä¸ºy+1</li></ol><p><img src="/asset/%E7%BD%91%E7%BB%9C/images/1.png" alt="123"><br>TIME_WAIT ï¼šTCP å››æ¬¡æ¡æ‰‹ç»“æŸå, è¿æ¥åŒæ–¹éƒ½ä¸å†äº¤æ¢æ¶ˆæ¯, ä½†ä¸»åŠ¨å…³é—­çš„ä¸€æ–¹ä¿æŒè¿™ä¸ªè¿æ¥åœ¨ä¸€æ®µæ—¶é—´ï¼ˆ2MSLä¸¤ä¸ªæœ€å¤§æŠ¥æ–‡ç”Ÿå‘½å‘¨æœŸæ—¶é—´ï¼‰å†…ä¸å¯ç”¨ã€‚</p><p>åŸå› ï¼š</p><p>ç¡®ä¿æœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾ï¼ˆå¦‚æœBæ²¡æ”¶åˆ°Aå‘é€æ¥çš„ç¡®è®¤æŠ¥æ–‡, é‚£ä¹ˆå°±ä¼šé‡æ–°å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚æŠ¥æ–‡, Aç­‰å¾…ä¸€æ®µæ—¶é—´å°±æ˜¯ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼‰<br>é¿å…æ–°æ—§é“¾æ¥æ··æ·†ã€‚ï¼ˆç­‰å¾…2MSLå¯ä»¥è®©æœ¬è¿æ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡éƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±, ä½¿å¾—ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥è¯·æ±‚ä¸ä¼šå‡ºç°æ—§çš„è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼‰</p><p>ä¼˜ç‚¹:</p><ol><li><p>å¯ä»¥é˜²æ­¢æ—§è¿æ¥æ•°æ®åŒ…è¢«é”™è¯¯åœ°è®¤ä¸ºæ˜¯æ–°è¿æ¥çš„æ•°æ®åŒ…ï¼Œä»è€Œä¿è¯è¿æ¥çš„å¯é æ€§ã€‚</p></li><li><p>å¯ä»¥ç¡®ä¿åœ¨TCPè¿æ¥å…³é—­åï¼ŒåŒæ–¹çš„æ‰€æœ‰æ•°æ®åŒ…éƒ½è¢«å®Œå…¨ä¼ è¾“ï¼Œé˜²æ­¢æ•°æ®çš„ä¸¢å¤±å’Œæ··ä¹±ã€‚</p></li><li><p>å¯ä»¥ç¡®ä¿è¿æ¥è¢«å½»åº•å…³é—­ï¼Œé¿å…å‡ºç°ç±»ä¼¼äºåŠå¼€è¿æ¥çš„æƒ…å†µï¼Œä»è€Œä¿è¯ç½‘ç»œçš„ç¨³å®šæ€§</p></li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li><p>TIME_WAITçŠ¶æ€ä¼šå ç”¨è¿æ¥èµ„æºï¼Œé™ä½ç³»ç»Ÿçš„æ€§èƒ½å’Œååé‡ã€‚</p></li><li><p>å¦‚æœåŒæ—¶æ‰“å¼€çš„TCPè¿æ¥æ•°å¾ˆå¤šï¼ŒTIME_WAITçŠ¶æ€çš„è¿æ¥ä¼šå ç”¨å¤§é‡çš„è¿æ¥èµ„æºï¼Œä»è€Œå¯¼è‡´è¿æ¥æ± è€—å°½å’Œè¿æ¥çš„å»¶è¿Ÿã€‚</p></li><li><p>TIME_WAITçŠ¶æ€çš„æ—¶é•¿è¾ƒé•¿ï¼ˆé€šå¸¸ä¸º2MSLï¼‰ï¼Œå¯èƒ½ä¼šå¯¹ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œå“åº”æ—¶é—´é€ æˆå½±å“ã€‚</p></li></ol><h3 id="TCP-Keepalive">TCP Keepalive</h3><p>TCP Keepaliveæ˜¯ä¸€ç§TCP/IPåè®®ä¸­çš„æœºåˆ¶ï¼Œå®ƒç”¨äºæ£€æµ‹è¿æ¥æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚åœ¨TCPè¿æ¥ç©ºé—²ä¸€æ®µæ—¶é—´åï¼Œå¦‚æœæ²¡æœ‰æ•°æ®åŒ…ä¼ è¾“ï¼Œåˆ™Keepaliveæœºåˆ¶ä¼šå®šæœŸå‘å¯¹ç«¯å‘é€ä¸€ä¸ªç©ºçš„ACKæ•°æ®åŒ…ï¼Œä»¥æ£€æµ‹è¿æ¥æ˜¯å¦ä»ç„¶å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚å¦‚æœå¯¹ç«¯æœªèƒ½åŠæ—¶å“åº”ï¼ŒTCPä¼šåœ¨ä¸€å®šæ—¶é—´åå…³é—­è¿æ¥ï¼Œä»¥é¿å…æ— ç”¨çš„è¿æ¥å ç”¨ç³»ç»Ÿèµ„æº</p><h3 id="UDP">UDP</h3><p>é¢å‘æ— è¿æ¥çš„ä¼ è¾“å±‚åè®®ï¼Œå®ƒä¸ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ï¼Œä¹Ÿä¸ä¿è¯æ•°æ®æŠ¥æ–‡çš„é¡ºåºã€‚UDPä¸»è¦ç”¨äºéŸ³è§†é¢‘æµåª’ä½“ã€åœ¨çº¿æ¸¸æˆç­‰å¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨åœºæ™¯</p><h4 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h4><p>æ— è¿æ¥ï¼šUDPä¸åƒTCPé‚£æ ·éœ€è¦åœ¨å»ºç«‹è¿æ¥ä¹‹åå†ä¼ è¾“æ•°æ®ï¼Œå› æ­¤å¯ä»¥æ›´å¿«åœ°ä¼ è¾“æ•°æ®ã€‚</p><p>ä¸å¯é ï¼šUDPä¸ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œå› æ­¤åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‘ç”Ÿä¸¢åŒ…ã€é‡å¤ã€é”™è¯¯ç­‰é—®é¢˜ã€‚</p><p>ç®€å•ï¼šUDPåè®®çš„å¤´éƒ¨å¾ˆçŸ­ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œç›¸æ¯”ä¹‹ä¸‹TCPåè®®çš„å¤´éƒ¨å°±è¦å¤æ‚å¾—å¤š</p><h4 id="tpc-å’Œ-udp-çš„åŒºåˆ«">tpc å’Œ udp çš„åŒºåˆ«?</h4><ol><li><p>è¿æ¥æ€§ï¼šTCPæ˜¯ä¸€ç§é¢å‘è¿æ¥çš„åè®®ï¼Œè€ŒUDPåˆ™æ˜¯æ— è¿æ¥çš„ã€‚åœ¨TCPåè®®ä¸­ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œç„¶åæ‰èƒ½è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚è€Œåœ¨UDPåè®®ä¸­ï¼Œå‘é€æ–¹ç›´æ¥å°†æ•°æ®æŠ¥å‘é€åˆ°æ¥æ”¶æ–¹ï¼Œä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ã€‚</p></li><li><p>å¯é æ€§ï¼šTCPæ˜¯ä¸€ç§å¯é æ€§è¾ƒé«˜çš„åè®®ï¼Œå®ƒé€šè¿‡åºå·ã€ç¡®è®¤åº”ç­”ã€é‡ä¼ ç­‰æœºåˆ¶æ¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„å¯é æ€§ã€‚è€ŒUDPåè®®åˆ™æ˜¯ä¸å¯é çš„ï¼Œå®ƒä¸ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ï¼Œä¹Ÿä¸ä¿è¯æ•°æ®æŠ¥æ–‡çš„é¡ºåºã€‚</p></li><li><p>ä¼ è¾“æ•ˆç‡ï¼šç”±äºTCPåè®®éœ€è¦å»ºç«‹è¿æ¥ã€ä¿è¯å¯é æ€§ç­‰æœºåˆ¶ï¼Œå› æ­¤ä¼ è¾“æ•ˆç‡ç›¸å¯¹è¾ƒä½ã€‚è€ŒUDPåè®®åˆ™æ²¡æœ‰è¿™äº›æœºåˆ¶ï¼Œä¼ è¾“æ•ˆç‡ç›¸å¯¹è¾ƒé«˜ã€‚</p></li><li><p>æ•°æ®å¤§å°ï¼šTCPåè®®æ²¡æœ‰æ•°æ®å¤§å°çš„é™åˆ¶ï¼Œè€ŒUDPåè®®åˆ™æœ‰ä¸€ä¸ª64Kçš„é™åˆ¶ã€‚å› æ­¤ï¼Œå½“éœ€è¦ä¼ è¾“è¾ƒå¤§çš„æ•°æ®æ—¶ï¼Œåº”è¯¥ä½¿ç”¨TCPåè®®ã€‚</p></li><li><p>åº”ç”¨åœºæ™¯ï¼šç”±äºTCPåè®®å…·æœ‰å¯é æ€§è¾ƒé«˜ã€ä¼ è¾“æ•ˆç‡è¾ƒä½çš„ç‰¹ç‚¹ï¼Œé€‚åˆäºä¼ è¾“é‡è¦æ•°æ®ã€æ–‡ä»¶ä¸‹è½½ç­‰éœ€è¦ä¿è¯æ•°æ®å¯é æ€§çš„åº”ç”¨åœºæ™¯ã€‚è€ŒUDPåè®®åˆ™é€‚åˆäºå®æ—¶æ€§è¦æ±‚é«˜ã€æ•°æ®ä¼ è¾“é‡è¾ƒå°çš„åº”ç”¨ï¼Œå¦‚åœ¨çº¿æ¸¸æˆã€è¯­éŸ³é€šè¯ã€è§†é¢‘ç›´æ’­ç­‰</p></li><li><p>TCPçš„é€»è¾‘é€šä¿¡ä¿¡é“æ˜¯å…¨åŒå·¥çš„å¯é ä¿¡é“, UDPåˆ™æ˜¯ä¸å¯é ä¿¡é“</p></li></ol><h3 id="OSI-ä¸ƒå±‚åè®®">OSI ä¸ƒå±‚åè®®</h3><ol><li>åº”ç”¨å±‚(æ•°æ®): ç¡®å®šè¿›ç¨‹ä¹‹é—´é€šä¿¡çš„æ€§è´¨ä»¥æ»¡è¶³ç”¨æˆ·éœ€è¦ä»¥åŠæä¾›ç½‘ç»œä¸ç”¨æˆ·åº”ç”¨</li><li>è¡¨ç¤ºå±‚(æ•°æ®): ä¸»è¦è§£å†³æ‹¥æŠ¤ä¿¡æ¯çš„è¯­æ³•è¡¨ç¤ºé—®é¢˜, å¦‚åŠ å¯†è§£å¯†</li><li>ä¼šè¯å±‚(æ•°æ®): æä¾›åŒ…æ‹¬è®¿é—®éªŒè¯å’Œä¼šè¯ç®¡ç†åœ¨å†…çš„å»ºç«‹å’Œç»´æŠ¤åº”ç”¨ä¹‹é—´é€šä¿¡çš„æœºåˆ¶, å¦‚æœåŠ¡å™¨éªŒè¯ç”¨æˆ·ç™»å½•ä¾¿æ˜¯ç”±ä¼šè¯å±‚å®Œæˆçš„</li><li>è¿è¾“å±‚(æ®µ): å®ç°ç½‘ç»œä¸åŒä¸»æœºä¸Šç”¨æˆ·è¿›ç¨‹ä¹‹é—´çš„æ•°æ®é€šä¿¡, å¯é ä¸ä¸å¯é çš„ä¼ è¾“, ä¼ è¾“å±‚çš„é”™è¯¯æ£€æµ‹, æµé‡æ§åˆ¶ç­‰</li><li>ç½‘ç»œå±‚(åŒ…): æä¾›é€»è¾‘åœ°å€ï¼ˆIPï¼‰ã€é€‰è·¯, æ•°æ®ä»æºç«¯åˆ°ç›®çš„ç«¯çš„ä¼ è¾“</li><li>æ•°æ®é“¾è·¯å±‚(å¸§): å°†ä¸Šå±‚æ•°æ®å°è£…æˆå¸§, ç”¨MACåœ°å€è®¿é—®åª’ä»‹, é”™è¯¯æ£€æµ‹ä¸ä¿®æ­£</li><li>ç‰©ç†å±‚ï¼ˆæ¯”ç‰¹æµï¼‰ï¼šè®¾å¤‡ä¹‹é—´æ¯”ç‰¹æµçš„ä¼ è¾“, ç‰©ç†æ¥å£, ç”µæ°”ç‰¹æ€§ç­‰</li></ol><h3 id="TCP-IP-å››å±‚åè®®">TCP/IP å››å±‚åè®®</h3><ol><li>åº”ç”¨å±‚ï¼ˆTELNETã€FTPã€SMTPã€HTTPï¼‰</li><li>è¿è¾“å±‚ï¼ˆTCPã€UDPï¼‰</li><li>ç½‘é™…å±‚ï¼ˆIPã€ICMPï¼‰</li><li>ç½‘ç»œæ¥å£å±‚ï¼ˆPPPï¼‰</li></ol><h3 id="socket">socket</h3><p>Socketæ˜¯ä»€ä¹ˆ</p><p>Socketæ˜¯åº”ç”¨å±‚ä¸TCP/IPåè®®æ—é€šä¿¡çš„ä¸­é—´è½¯ä»¶æŠ½è±¡å±‚, å®ƒæ˜¯ä¸€ç»„æ¥å£ã€‚åœ¨è®¾è®¡æ¨¡å¼ä¸­, Socketå…¶å®å°±æ˜¯ä¸€ä¸ªé—¨é¢æ¨¡å¼, å®ƒæŠŠå¤æ‚çš„TCP/IPåè®®æ—éšè—åœ¨Socketæ¥å£åé¢, å¯¹ç”¨æˆ·æ¥è¯´, ä¸€ç»„ç®€å•çš„æ¥å£å°±æ˜¯å…¨éƒ¨, è®©Socketå»ç»„ç»‡æ•°æ®, ä»¥ç¬¦åˆæŒ‡å®šçš„åè®®</p><p><img src="/asset/%E7%BD%91%E7%BB%9C/images/2.png" alt="socket"></p><p>Socket=Ip address+ TCP/UDP + port</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç»œ æµè§ˆå™¨è¾“å…¥urlçš„å…¨è¿‡ç¨‹</title>
    <link href="/2020/04/21/%E7%BD%91%E7%BB%9C/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BE%93%E5%85%A5url%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B/"/>
    <url>/2020/04/21/%E7%BD%91%E7%BB%9C/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BE%93%E5%85%A5url%E7%9A%84%E5%85%A8%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h3 id="æµè§ˆå™¨è¾“å…¥urlçš„å…¨è¿‡ç¨‹">æµè§ˆå™¨è¾“å…¥urlçš„å…¨è¿‡ç¨‹</h3><p><img src=".//image/3.jpg" alt=""></p><ol><li>DNS åŸŸåè§£æ</li><li>å»ºç«‹ TCP è¿æ¥</li><li>å‘é€ HTTP è¯·æ±‚</li><li>æœåŠ¡å™¨å¤„ç†è¯·æ±‚</li><li>æœåŠ¡å™¨è¿”å›å“åº”ç»“æœ</li><li>å…³é—­ TCP è¿æ¥</li><li>æµè§ˆå™¨è§£æ HTML</li><li>æµè§ˆå™¨æ¸²æŸ“å¸ƒå±€</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL InnoDB</title>
    <link href="/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/InnoDB/"/>
    <url>/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/InnoDB/</url>
    
    <content type="html"><![CDATA[<h3 id="è¡Œé”">è¡Œé”</h3><p>InnoDB çš„è¡Œé”æ¨¡å¼å¥¹ä¸æ—¦å®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”</p><p>å…±äº«é”ï¼ˆ S ) ï¼šåˆç§°ä¸ºè¯»é”, ç®€ç§° S é”, å…±äº«é”å°±æ˜¯å¤šä¸ªäº‹åŠ¡å¯¹äºåŒä¸€æ•°æ®å¯ä»¥å…±äº«ä¸€æŠŠé”, éƒ½èƒ½è®¿é—®åˆ°æ•°æ®, ä½†æ˜¯åªèƒ½è¯»ä¸èƒ½ä¿®æ”¹</p><p>æ’ä»–é”ï¼ˆ X ) ï¼šåˆç§°ä¸ºå†™é”, ç®€ç§° X é”, æ’ä»–é”å°±æ˜¯ä¸èƒ½ä¸å…¶ä»–é”å¹¶å­˜, å¦‚ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€ä¸ªæ•°æ®è¡Œçš„æ’ä»–é”, å…¶ä»–äº‹åŠ¡å°±ä¸èƒ½å†è·å–è¯¥è¡Œçš„å…¶ä»–é”, åŒ…æ‹¬å…±äº«é”å’Œæ’ä»–é”, ä½†æ˜¯è·å–æ’ä»–é”çš„äº‹åŠ¡æ˜¯å¯ä»¥å°±è¡Œè¯»å–å’Œä¿®æ”¹</p><p>å¯¹äº UPDATE ã€DELETE å’Œ INSERT è¯­å¥, InnoDBä¼šè‡ªåŠ¨ç»™æ¶‰åŠæ•°æ®åŠ æ’ä»–é”ï¼ˆ x ) ;</p><p>å¯¹äºæ™®é€š SELECT è¯­å¥, InnoDB ä¸ä¼šåŠ ä»»ä½•é”,</p><p>æ˜¾ç¤ºæ·»åŠ é”</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">LOCK <span class="hljs-keyword">IN</span> SHARE MODE; # å…±äº«é” S<br><br><span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>; # æ’ä»–é” X<br><br><br></code></pre></td></tr></table></figure><h3 id="è¡Œé”å‡çº§ä¸ºè¡¨é”">è¡Œé”å‡çº§ä¸ºè¡¨é”</h3><p>WHERE æ¡ä»¶åé¢æ²¡æœ‰ä½¿ç”¨ç´¢å¼•, æˆ–è€…ç´¢å¼•å¤±æ•ˆ, è¡Œé”ä¼šå‡çº§ä¸ºè¡¨é”</p><h3 id="é—´éš™é”">é—´éš™é”</h3><p>å½“ä½¿ç”¨èŒƒå›´æ¡ä»¶æ—¶, è€Œä¸æ˜¯ä½¿ç”¨ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®, å¹¶è¯·æ±‚å…±äº«æˆ–æ’å®ƒé”æ—¶, InnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®åŠ é”, å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†ä¸å­˜åœ¨çš„è®°å½•, å«åš â€œé—´éš™(GAP)â€, InnoDB ä¹Ÿä¼šå¯¹è¿™ä¸ª â€œé—´éš™â€ åŠ é”, è¿™ç§é”æœºåˆ¶å«é—´éš™é”(Next-Keyé”)</p><h3 id="è¡Œé”äº‰ç”¨æƒ…å†µæŸ¥çœ‹">è¡Œé”äº‰ç”¨æƒ…å†µæŸ¥çœ‹</h3><pre><code class="hljs">show status like 'innodb_row_lock_%';   </code></pre><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/5.png" alt="è¡Œé”äº‰ç”¨æƒ…å†µæŸ¥çœ‹"></p><p>Innodb_row_lock_current_waits:å½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡<br>Innodb_row_lock_time:ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦<br>Innodb_row_lock_time_avg: æ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é•¿<br>Innodb_row_lock_time_max:ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€é•¿çš„ä¸€æ¬¡æ—¶é—´<br>Innodb_row_lock_waits:ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨æ€»å…±ç­‰å¾…æ¬¡æ•°</p><p>æ€»ç»“ï¼š<br>å°½é‡ä½¿ç”¨ç´¢å¼•æ¥æ£€ç´¢æ•°æ®, é¿å…è¡Œé”å‡çº§ä¸ºè¡¨é”<br>åˆç†è®¾è®¡ç´¢å¼•, å°½é‡å‡å°‘é”çš„ä½¿ç”¨èŒƒå›´<br>å°½å¯èƒ½å‡å°‘ç´¢å¼•æ¡ä»¶, ä»¥åŠç´¢å¼•èŒƒå›´, é¿å…é—´éš™é”<br>å°½é‡æ§åˆ¶äº‹åŠ¡å¤§å°, å‡å°‘é”å®šèµ„æºé‡å’Œæ—¶é—´é•¿åº¦<br>å°½å¯èƒ½ä½¿ç”¨ä½çº§åˆ«çš„äº‹åŠ¡éš”ç¦»</p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL MyISAM</title>
    <link href="/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/MyISAM/"/>
    <url>/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/MyISAM/</url>
    
    <content type="html"><![CDATA[<h3 id="InnoDB-å’Œ-MyISAM-çš„é”">InnoDB å’Œ MyISAM çš„é”</h3><p>MyISAM åªæ”¯æŒè¡¨é”</p><p>MyISAM åœ¨ SELECT çš„æ—¶å€™ä¼šè‡ªåŠ¨ç»™è¡¨åŠ ä¸Šè¯»é”, åœ¨æ‰§è¡Œ UPDATE, DELETE, INSERT çš„æ—¶å€™ä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„è¡¨åŠ ä¸Šå†™é”, åœ¨æ“ä½œå®Œæˆæ˜¯ä¼šé‡Šæ”¾é”ã€‚</p><h4 id="å½“å‰ä¼šè¯-çº¿ç¨‹-å¯¹è¡¨åŠ ä¸Šè¯»é”-å¿…é¡»è§£é”åæ‰èƒ½æ“ä½œå…¶ä»–è¡¨-å¯¹å…¶ä»–ä¼šè¯æ— å½±å“">å½“å‰ä¼šè¯(çº¿ç¨‹)å¯¹è¡¨åŠ ä¸Šè¯»é”, å¿…é¡»è§£é”åæ‰èƒ½æ“ä½œå…¶ä»–è¡¨, å¯¹å…¶ä»–ä¼šè¯æ— å½±å“</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><br>å¯¹ MyISAM æ˜¾ç¤ºåŠ é”<br><br># è¯»é”<br>lock <span class="hljs-keyword">table</span> table_bane read;<br><br># å†™é”<br>lock <span class="hljs-keyword">table</span> table_name write;<br><br># è§£é”<br>unlock tables;<br><br></code></pre></td></tr></table></figure><p>è¯»é”ä¼šé˜»å¡å†™æ“ä½œ, ä½†æ˜¯ä¸ä¼šé˜»å¡è¯»æ“ä½œ, å†™é”, è¯»å†™æ“ä½œéƒ½ä¼šé˜»å¡</p><p>æŸ¥çœ‹é”çš„äº‰ç”¨æƒ…å†µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">open</span> tables;<br></code></pre></td></tr></table></figure><p>In_useï¼š è¡¨çš„ä½¿ç”¨æ¬¡æ•°</p><p>Name_locked: è¡¨åé”å®š,  ç”¨äºå–æ¶ˆè¡¨è·å–å¯¹è¡¨è¿›è¡Œé‡å‘½åç­‰æ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> status <span class="hljs-keyword">like</span> &quot;Tabke_lock%&quot;;<br></code></pre></td></tr></table></figure><p>Table_locks_immediate : æŒ‡çš„æ˜¯èƒ½å¤Ÿç«‹å³è·å¾—è¡¨é”çš„æ¬¡æ•°, æ¯ç«‹å³è·å¾—é”, ä¾¿+1</p><p>Table_locks_waited ï¼šæŒ‡çš„æ˜¯ä¸èƒ½å¤Ÿç«‹å³è·å¾—è¡¨é”çš„æ¬¡æ•°, æ¯ç­‰å¾…ä¸€æ¬¡, ä¾¿+1,  å€¼è¶Šé«˜è¯´æ˜äº‰æŠ¢æƒ…å†µä¸¥é‡</p><p>MyISAM é€‚åˆå¤§é‡è¯»æ“ä½œ</p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL MyISAM</title>
    <link href="/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/json/"/>
    <url>/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/json/</url>
    
    <content type="html"><![CDATA[<p>JSONæ•°æ®åœ¨ä¸åŒå­—æ®µçš„å¤„ç†æ–¹å¼ï¼š</p><table><thead><tr><th></th><th>å¤§å°</th><th>å­—ç¬¦é›†</th><th>æ ¡éªŒ</th><th>ç´¢å¼•</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>varchar(N)</td><td>N</td><td>è¡¨çš„å­—ç¬¦é›†</td><td>é•¿åº¦é™åˆ¶,å­—ç¬¦é›†,æ’åºè§„åˆ™</td><td>æ™®é€šç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•</td><td>è¡¨æ€»å’Œä¸èƒ½è¶…è¿‡65535ä¸ªå­—ç¬¦(é™¤å»text,JSON, blobç±»å‹)</td></tr><tr><td>text</td><td>65535ä¸ªå­—ç¬¦</td><td>è¡¨çš„å­—ç¬¦é›†</td><td>é•¿åº¦é™åˆ¶,å­—ç¬¦é›†,æ’åºè§„åˆ™</td><td>æ™®é€šç´¢å¼•,å…¨æ–‡ç´¢å¼•</td><td></td></tr><tr><td>JSON</td><td>64MB(é»˜è®¤, å¯ä¿®æ”¹)</td><td>utf8mb4</td><td>å¤§å°,å­—ç¬¦é›†çš„æ ¡éªŒ,æ·±åº¦é™åˆ¶(100å±‚),JSONæ ¼å¼æ ¡éªŒ</td><td>åˆ©ç”¨è™šæ‹Ÿåˆ—æå–JSONå­—æ®µä½œä¸ºç´¢å¼•,å¤šå€¼ç´¢å¼•(ç±»ä¼¼æ™®é€šç´¢å¼•)</td><td></td></tr></tbody></table><p>ï¼ï¼ï¼æ³¨æ„NULLå’ŒJSONçš„nullå€¼ä¸åŒï¼ŒNULLè¡¨ç¤ºå­—æ®µå€¼ä¸ºç©ºï¼ŒJSONçš„nullå€¼è¡¨ç¤ºå­—æ®µå€¼æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡</p><h3 id="åŸºç¡€ï¼š">åŸºç¡€ï¼š</h3><ol><li>æ’å…¥</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `tt1` (`id`, `varchar1`, `JSON1`, `text1`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;&#123;\&quot;a\&quot;:\&quot;GXjc0C4hOU\&quot;,\&quot;b\&quot;:5262145246&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;\&quot;a\&quot;: \&quot;GXjc0C4hOU\&quot;, \&quot;b\&quot;: 5262145246&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;\&quot;a\&quot;:\&quot;GXjc0C4hOU\&quot;,\&quot;b\&quot;:5262145246&#125;&#x27;</span>);<br></code></pre></td></tr></table></figure><p>å¯ä»¥ç†è§£ä¸ºæ’å…¥çš„æ•°æ®å®é™…ä¸Šæ˜¯JSONå­—ç¬¦ä¸²ï¼Œåœ¨æ’å…¥æ—¶ä¼šè‡ªåŠ¨è§£æä¸ºJSONå¯¹è±¡ï¼Œç„¶åå­˜å‚¨åˆ°JSONå­—æ®µä¸­ã€‚</p><ol start="2"><li>ä¿®æ”¹</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"># ç›´æ¥ä¿®æ”¹JSONå­—æ®µ<br><span class="hljs-keyword">UPDATE</span> `tt1` <span class="hljs-keyword">SET</span> `JSON1` <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&#123;\&quot;a\&quot;: \&quot;GXjc0C4hOU\&quot;, \&quot;b\&quot;: 5262145246&#125;&#x27;</span> <span class="hljs-keyword">WHERE</span> `id` <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br># ç›´æ¥ä¿®æ”¹JSONå­—æ®µçš„æŸä¸ªå€¼<br><span class="hljs-keyword">UPDATE</span> `tt1` <span class="hljs-keyword">SET</span> `JSON1` <span class="hljs-operator">=</span> JSON_SET(JSON1, <span class="hljs-string">&#x27;$.b&#x27;</span>, <span class="hljs-number">31</span>) <span class="hljs-keyword">WHERE</span> `id` <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br># ç›´æ¥ä¿®æ”¹JSONæ•°ç»„<br><span class="hljs-keyword">UPDATE</span> `tt1` <span class="hljs-keyword">SET</span> `JSON_arr` <span class="hljs-operator">=</span> JSON_SET(JSON_arr, <span class="hljs-string">&#x27;$[0]&#x27;</span>, &quot;3&quot;) <span class="hljs-keyword">WHERE</span> `id` <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br># åµŒå¥—ä¿®æ”¹<br><span class="hljs-keyword">UPDATE</span> `tt1` <span class="hljs-keyword">SET</span> `text1` <span class="hljs-operator">=</span> JSON_SET(text1, <span class="hljs-string">&#x27;$.c.d&#x27;</span>, <span class="hljs-number">31</span>) <span class="hljs-keyword">WHERE</span> `id` <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><ol start="3"><li>æŸ¥è¯¢(ï¼ï¼ï¼ä½¿ç”¨JSONå‡½æ•°ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ä¼šèµ°å…¨è¡¨æ‰«æ)</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> JSON_UNQUOTE(JSON_EXTRACT(JSON1, &quot;$.a&quot;)) <span class="hljs-keyword">as</span> JSON1  <span class="hljs-keyword">FROM</span> `tt1` <span class="hljs-keyword">WHERE</span> JSON_UNQUOTE(JSON_EXTRACT(JSON1, &quot;$.a&quot;)) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;123&#x27;</span> ;<br></code></pre></td></tr></table></figure><h3 id="å¸¸ç”¨JSONå‡½æ•°ï¼š">å¸¸ç”¨JSONå‡½æ•°ï¼š</h3><pre><code class="hljs">- JSON_EXTRACT(json_column, path)ï¼šä»json_columnä¸­æå–pathæŒ‡å®šçš„JSONå¯¹è±¡ï¼Œè¿”å›JSONå¯¹è±¡ã€‚- JSON_UNQUOTE(json_column)ï¼šå°†json_columnä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²ç±»å‹çš„å€¼éƒ½è½¬æ¢ä¸ºæ™®é€šå­—ç¬¦ä¸²ã€‚- JSON_VALUE(json_column, path)ï¼šä»json_columnä¸­æå–pathæŒ‡å®šçš„JSONå¯¹è±¡çš„å€¼ï¼Œè¿”å›JSONå¯¹è±¡çš„å€¼ã€‚- JSON_SET(json_column, path, value)ï¼šåœ¨json_columnä¸­è®¾ç½®pathæŒ‡å®šçš„JSONå¯¹è±¡çš„å€¼ä¸ºvalueï¼Œè¿”å›ä¿®æ”¹åçš„json_columnã€‚- JSON_REMOVE(json_column, path)ï¼šåœ¨json_columnä¸­åˆ é™¤pathæŒ‡å®šçš„JSONå¯¹è±¡ï¼Œè¿”å›ä¿®æ”¹åçš„json_columnã€‚- JSON_MERGE_PRESERVE(json_column1, json_column2)ï¼šå°†json_column2åˆå¹¶åˆ°json_column1ä¸­ï¼Œå¦‚æœjson_column1ä¸­æœ‰ç›¸åŒçš„keyï¼Œåˆ™è¦†ç›–json_column1ä¸­çš„å€¼ã€‚- JSON_MERGE_PATCH(json_column1, json_column2)ï¼šå°†json_column2åˆå¹¶åˆ°json_column1ä¸­ï¼Œå¦‚æœjson_column1ä¸­æœ‰ç›¸åŒçš„keyï¼Œåˆ™ä¿ç•™json_column1ä¸­çš„å€¼ã€‚- JSON_QUERY(json_column, path)ï¼šä»json_columnä¸­æå–pathæŒ‡å®šçš„JSONå¯¹è±¡ï¼Œè¿”å›JSONå¯¹è±¡ã€‚- JSON_LENGTH(json_column)ï¼šè¿”å›json_columnçš„é•¿åº¦ã€‚- JSON_TYPE(json_column)ï¼šè¿”å›json_columnçš„ç±»å‹ã€‚- JSON_VALID(json_column)ï¼šåˆ¤æ–­json_columnæ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„JSONå­—ç¬¦ä¸²ã€‚- JSON_ARRAY_LENGTH(json_column)ï¼šè¿”å›json_columnçš„æ•°ç»„é•¿åº¦ã€‚- JSON_OVERLAPS(json_column1, json_column2)ï¼šåˆ¤æ–­json_column1å’Œjson_column2æ˜¯å¦æœ‰äº¤é›†ã€‚ã€- JSON_CONTAINS(json_column1, json_column2)ï¼šåˆ¤æ–­json_column1æ˜¯å¦åŒ…å«json_column2ã€‚</code></pre><h3 id="æ€§èƒ½ï¼š">æ€§èƒ½ï¼š</h3><pre><code class="hljs">æµ‹è¯•ç¯å¢ƒï¼š 1000Wæ¡æ•°æ®CREATE TABLE `tt1` (`id` int NOT NULL AUTO_INCREMENT,`varchar1` varchar(2047) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_as_cs DEFAULT NULL,`JSON1` JSON DEFAULT NULL,`text1` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_as_cs,`JSON_arr` JSON DEFAULT NULL,PRIMARY KEY (`id`)) ENGINE=InnoDB  DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_as_cs;SET profiling = 1;SELECT JSON_UNQUOTE(JSON_EXTRACT(varchar1, '$.a') ) as varchar1  FROM `tt1` ;SELECT JSON_UNQUOTE(JSON_EXTRACT(JSON1, &quot;$.a&quot;)) as JSON1  FROM `tt1` ;SELECT JSON_UNQUOTE(JSON_EXTRACT(text1, &quot;$.a&quot;)) as text1  FROM `tt1` ;SHOW PROFILES;</code></pre><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/json1.png" alt="æ‰§è¡Œé€Ÿåº¦"></p><p>JSONè€—æ—¶æ¯”å…¶ä»–ç±»å‹å°‘, MYSQLå¯¹JSONå­—æ®µæœ‰å•ç‹¬ä¼˜åŒ–,å› ä¸ºåœ¨æ’å…¥å¾—æ—¶å€™å·²ç»è§£æä¸ºJSONå¯¹è±¡äº†,å…¶ä»–ç±»å‹éœ€è¦é¢å¤–è½¬æ¢</p><h3 id="JSON-ç´¢å¼•">JSON-ç´¢å¼•</h3><p>JSONå­—æ®µåˆ›å»ºç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> tt1 <span class="hljs-keyword">add</span> index idx_ttt_JSON1_a( (<span class="hljs-built_in">cast</span>(JSON_UNQUOTE(JSON_EXTRACT(JSON1, &quot;$.a&quot;)) <span class="hljs-keyword">as</span> <span class="hljs-type">char</span>(<span class="hljs-number">255</span>) )) );<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> JSON_UNQUOTE(JSON_EXTRACT(JSON1, &quot;$.a&quot;)) <span class="hljs-keyword">as</span> JSON1  <span class="hljs-keyword">FROM</span> `tt2` <span class="hljs-keyword">WHERE</span> (<span class="hljs-built_in">cast</span>(JSON_UNQUOTE(JSON_EXTRACT(JSON1, &quot;$.a&quot;)) <span class="hljs-keyword">as</span> <span class="hljs-type">char</span>(<span class="hljs-number">255</span>) ))<span class="hljs-operator">=</span><span class="hljs-string">&#x27;123&#x27;</span>;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š<br><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/json2.png" alt="æ‰§è¡Œé€Ÿåº¦"></p><p>æ•°ç»„å½¢å¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> tt1 <span class="hljs-keyword">add</span> index idx_ttt_JSON1_a( (<span class="hljs-built_in">cast</span>(JSON_UNQUOTE(JSON_EXTRACT(JSON1, &quot;$.a&quot;)) <span class="hljs-keyword">as</span> <span class="hljs-type">char</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">ARRAY</span> )) );<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ï¼Œæä¾›äº†ä¸‰ä¸ªæŸ¥è¯¢å‡½æ•°</p><p>MEMBER OF() æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸä¸€å€¼ï¼ˆå¦‚æœæ˜¯å”¯ä¸€åŒ¹é…æŸ¥è¯¢å»ºè®®ç”¨è¿™ç§å¦åˆ™é€‰ä¸‹é¢ä¸¤ç§ï¼‰</p><p>JSON_CONTAINS() æ•°ç»„ä¸­æ˜¯å¦åŒ…å«æŸäº›å€¼ï¼Œäº¤é›†(å¿…é¡»éƒ½åŒ…å«ï¼Œæ­¤å¤„æ³¨æ„mysqlç‰ˆæœ¬å¿…é¡»æ˜¯8.024ä»¥ä¸Šå¦åˆ™ä½¿ç”¨å¯èƒ½ä¼šå¤±æ•ˆ)</p><p>JSON_OVERLAPS() æ•°ç»„ä¸­æ˜¯å¦åŒ…å«æŸäº›å€¼ï¼Œå¹¶é›†(åªè¦åŒ…å«ä¸€ä¸ªå°±è¡Œçœçš„ç”¨JSON_CONTAINSä¸€ç›´OR)</p><h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹ï¼š</p><ol><li>çµæ´»çš„æ•°æ®ç»“æ„ï¼šJSONå­—æ®µå¯ä»¥å­˜å‚¨å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¦‚æ•°ç»„ã€å¯¹è±¡ã€å­—ç¬¦ä¸²ç­‰ã€‚</li><li>å­˜å‚¨ç©ºé—´ï¼šJSONå­—æ®µçš„å­˜å‚¨ç©ºé—´æ¯”å…¶ä»–ç±»å‹æ›´å¤§ã€‚</li><li>æä¾›äº†JSONçš„æ ¡éªŒåŠŸèƒ½ï¼šJSONå­—æ®µå¯ä»¥å¯¹æ•°æ®ç»“æ„è¿›è¡Œæ ¡éªŒï¼Œç¡®ä¿æ•°æ®ç¬¦åˆè¦æ±‚ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>æ€§èƒ½ï¼šJSONå­—æ®µçš„æ€§èƒ½æ¯”å…¶ä»–ç±»å‹æ›´å·®,å°¤å…¶æ˜¯åœ¨æŸ¥è¯¢æ—¶ã€‚</li><li>ç»“æ„å¯èƒ½ä¼šæ··ä¹±,å¦‚å­—ç¬¦ä¸²å’Œæ•°å­—å¯ä»¥æ··åˆ,éœ€è¦æ’å…¥çš„äººä¿è¯ç»“æ„ä¸€è‡´æ€§ã€‚å¦‚ï¼šrow1.JSON_field = {â€œaâ€: â€œ123â€} row2.JSON_field = {â€œaâ€: 456}</li><li>æ•°æ®æ›´æ–°ä¸æ–¹ä¾¿ï¼šJSONå­—æ®µçš„æ›´æ–°æ¯”è¾ƒéº»çƒ¦,éœ€è¦å…ˆè§£æJSON,ç„¶åå†æ›´æ–°ã€‚(å¦‚ä¹‹å‰å‘ç”Ÿçš„æ‰‹æœºå·è½¬æ¢,zipcodeè½¬æ¢åœ°å€ç­‰)</li></ol><h3 id="ä½¿ç”¨å»ºè®®">ä½¿ç”¨å»ºè®®??</h3><p>ä½œä¸ºä¸€äº›ä¸å¿…è¦æŸ¥è¯¢ï¼Œä¿®æ”¹çš„å¤æ‚æ•°æ®ç»“æ„ï¼Œä½¿ç”¨JSONï¼Œå¯ä»¥å­˜å‚¨æ›´å¤šçš„å†…å®¹,ä¹Ÿå¯ä»¥é¿å…ä½¿ç”¨æ–°çš„å…³è”è¡¨æ¥å­˜å‚¨æ•°æ®,å‡å°‘æ•°æ®åº“çš„è€¦åˆæ€§,æé«˜å¼€å‘æ•ˆç‡</p><p>ä½†æ˜¯ä¸€æ¶‰åŠåˆ°æ•°æ®çš„æŸ¥è¯¢å’Œä¿®æ”¹ï¼Œéƒ½éœ€è¦æ³¨æ„JSONçš„æ€§èƒ½é—®é¢˜, æ²¡æœ‰ç´¢å¼•ä½¿ç”¨JSONç›¸å…³çš„å¤„ç†å‡½æ•°ä¼šå¯¼è‡´å…¨è¡¨æ‰«ææ•°æ®,å¯¼è‡´æ€§èƒ½ä¸‹é™,è€Œä½¿ç”¨äº†JSONç›¸å…³çš„ç´¢å¼•,åˆ™éœ€è¦ç»´æŠ¤æ•°æ®çš„çš„ç»“æ„å’Œç±»å‹ï¼Œé¿å…å‡ºç°æ•°æ®ç±»å‹ä¸ä¸€è‡´çš„æƒ…å†µ</p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL äº‹åŠ¡</title>
    <link href="/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E4%BA%8B%E5%8A%A1/"/>
    <url>/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E4%BA%8B%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h3 id="äº‹åŠ¡">äº‹åŠ¡</h3><p>MySQL äº‹åŠ¡ä¸»è¦ç”¨äºå¤„ç†æ“ä½œé‡å¤§, å¤æ‚åº¦é«˜çš„æ•°æ®ã€‚æ¯”å¦‚è¯´, åœ¨äººå‘˜ç®¡ç†ç³»ç»Ÿä¸­, ä½ åˆ é™¤ä¸€ä¸ªäººå‘˜, ä½ æ—¢éœ€è¦åˆ é™¤äººå‘˜çš„åŸºæœ¬èµ„æ–™, ä¹Ÿè¦åˆ é™¤å’Œè¯¥äººå‘˜ç›¸å…³çš„ä¿¡æ¯, å¦‚ä¿¡ç®±, æ–‡ç« ç­‰ç­‰, è¿™æ ·, è¿™äº›æ•°æ®åº“æ“ä½œè¯­å¥å°±æ„æˆä¸€ä¸ªäº‹åŠ¡ï¼</p><p>åœ¨ MySQL ä¸­åªæœ‰ä½¿ç”¨äº† Innodb æ•°æ®åº“å¼•æ“çš„æ•°æ®åº“æˆ–è¡¨æ‰æ”¯æŒäº‹åŠ¡ã€‚</p><p>äº‹åŠ¡å¤„ç†å¯ä»¥ç”¨æ¥ç»´æŠ¤æ•°æ®åº“çš„å®Œæ•´æ€§, ä¿è¯æˆæ‰¹çš„ SQL è¯­å¥è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œ, è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚</p><p>äº‹åŠ¡ç”¨æ¥ç®¡ç† insert,update,delete è¯­å¥</p><p>ä¸€èˆ¬æ¥è¯´, äº‹åŠ¡æ˜¯å¿…é¡»æ»¡è¶³4ä¸ªæ¡ä»¶ï¼ˆACIDï¼‰ï¼š</p><ul><li>åŸå­æ€§ï¼ˆAtomicity, æˆ–ç§°ä¸å¯åˆ†å‰²æ€§ï¼‰ã€</li><li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€</li><li>éš”ç¦»æ€§ï¼ˆIsolation, åˆç§°ç‹¬ç«‹æ€§ï¼‰ã€</li><li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ã€‚</li></ul><p>åŸå­æ€§ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œ, è¦ä¹ˆå…¨éƒ¨å®Œæˆ, è¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆ, ä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯, ä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€, å°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</p><p>ä¸€è‡´æ€§ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥å, æ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™, è¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚</p><p>éš”ç¦»æ€§ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›, éš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«, åŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚</p><p>æŒä¹…æ€§ï¼šäº‹åŠ¡å¤„ç†ç»“æŸå, å¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„, å³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/2.png" alt="äº‹åŠ¡"></p><h3 id="å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜">å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜</h3><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/3.png" alt="å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜"></p><h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«">äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/4.png" alt="å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜"></p><p>Read uncommitted è¯»æœªæäº¤</p><p>Read committed   è¯»å·²æäº¤</p><p>Repeatable read  å¯é‡å¤è¯»</p><p>Serializable     ä¸²è¡ŒåŒ–</p><p>InnoDB é»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯ Repeatable read;</p><p>æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«</p><pre><code class="hljs">show variables like &quot;tx_isolation&quot;;</code></pre><p>mysql ç‰ˆæœ¬ &gt;= 8.0</p><pre><code class="hljs">select @@transaction_isolation;set session transaction isolation level serializable;</code></pre><h3 id="äº‹åŠ¡éš”ç¦»å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶-MVCC">äº‹åŠ¡éš”ç¦»å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ MVCC</h3><p>MVCCåœ¨MySQL InnoDBä¸­çš„å®ç°ä¸»è¦æ˜¯ä¸ºäº†æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½, ç”¨æ›´å¥½çš„æ–¹å¼å»å¤„ç†è¯»-å†™å†²çª, åšåˆ°å³ä½¿æœ‰è¯»å†™å†²çªæ—¶, ä¹Ÿèƒ½åšåˆ°ä¸åŠ é”, éé˜»å¡å¹¶å‘è¯»</p><ul><li><p>å¿«ç…§è¯»</p><p>åƒä¸åŠ é”çš„selectæ“ä½œå°±æ˜¯å¿«ç…§è¯», å³ä¸åŠ é”çš„éé˜»å¡è¯»ï¼›å¿«ç…§è¯»çš„å‰ææ˜¯éš”ç¦»çº§åˆ«ä¸æ˜¯ä¸²è¡Œçº§åˆ«, ä¸²è¡Œçº§åˆ«ä¸‹çš„å¿«ç…§è¯»ä¼šé€€åŒ–æˆå½“å‰è¯»ï¼›ä¹‹æ‰€ä»¥å‡ºç°å¿«ç…§è¯»çš„æƒ…å†µ, æ˜¯åŸºäºæé«˜å¹¶å‘æ€§èƒ½çš„è€ƒè™‘, å¿«ç…§è¯»çš„å®ç°æ˜¯åŸºäºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶, å³MVCC,å¯ä»¥è®¤ä¸ºMVCCæ˜¯è¡Œé”çš„ä¸€ä¸ªå˜ç§, ä½†å®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹, é¿å…äº†åŠ é”æ“ä½œ, é™ä½äº†å¼€é”€ï¼›æ—¢ç„¶æ˜¯åŸºäºå¤šç‰ˆæœ¬, å³å¿«ç…§è¯»å¯èƒ½è¯»åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬, è€Œæœ‰å¯èƒ½æ˜¯ä¹‹å‰çš„å†å²ç‰ˆæœ¬</p></li></ul><p>è¯´ç™½äº†MVCCå°±æ˜¯ä¸ºäº†å®ç°è¯»-å†™å†²çªä¸åŠ é”, è€Œè¿™ä¸ªè¯»æŒ‡çš„å°±æ˜¯å¿«ç…§è¯», è€Œéå½“å‰è¯», å½“å‰è¯»å®é™…ä¸Šæ˜¯ä¸€ç§åŠ é”çš„æ“ä½œ, æ˜¯æ‚²è§‚é”çš„å®ç°</p><p>åœ¨Mysqlçš„InnoDBå¼•æ“ä¸­å°±æ˜¯æŒ‡åœ¨å·²æäº¤è¯»(READ COMMITTD)å’Œå¯é‡å¤è¯»(REPEATABLE READ)è¿™ä¸¤ç§éš”ç¦»çº§åˆ«ä¸‹çš„äº‹åŠ¡å¯¹äºSELECTæ“ä½œä¼šè®¿é—®ç‰ˆæœ¬é“¾ä¸­çš„è®°å½•çš„è¿‡ç¨‹ã€‚</p><p>è¿™å°±ä½¿å¾—åˆ«çš„äº‹åŠ¡å¯ä»¥ä¿®æ”¹è¿™æ¡è®°å½•, åæ­£æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šåœ¨ç‰ˆæœ¬é“¾ä¸­è®°å½•ã€‚SELECTå¯ä»¥å»ç‰ˆæœ¬é“¾ä¸­æ‹¿è®°å½•, è¿™å°±å®ç°äº†è¯»-å†™, å†™-è¯»çš„å¹¶å‘æ‰§è¡Œ, æå‡äº†ç³»ç»Ÿçš„æ€§èƒ½</p><h4 id="ç‰ˆæœ¬é“¾">ç‰ˆæœ¬é“¾</h4><p>åœ¨InnoDBå¼•æ“è¡¨ä¸­, å®ƒçš„èšç°‡ç´¢å¼•è®°å½•ä¸­æœ‰ä¸¤ä¸ªå¿…è¦çš„éšè—åˆ—ï¼š</p><p>trx_id</p><p>è¿™ä¸ªidç”¨æ¥å­˜å‚¨çš„æ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œä¿®æ”¹çš„æ—¶å€™çš„äº‹åŠ¡idã€‚</p><p>roll_pointer</p><p>æ¯æ¬¡å¯¹å“ªæ¡èšç°‡ç´¢å¼•è®°å½•æœ‰ä¿®æ”¹çš„æ—¶å€™, éƒ½ä¼šæŠŠè€ç‰ˆæœ¬å†™å…¥undoæ—¥å¿—ä¸­ã€‚è¿™ä¸ªroll_pointerå°±æ˜¯å­˜äº†ä¸€ä¸ªæŒ‡é’ˆ, å®ƒæŒ‡å‘è¿™æ¡èšç°‡ç´¢å¼•è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ä½ç½®, é€šè¿‡å®ƒæ¥è·å¾—ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„è®°å½•ä¿¡æ¯ã€‚(æ³¨æ„æ’å…¥æ“ä½œçš„undoæ—¥å¿—æ²¡æœ‰è¿™ä¸ªå±æ€§, å› ä¸ºå®ƒæ²¡æœ‰è€ç‰ˆæœ¬)</p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL å¸¸ç”¨æŠ€å·§</title>
    <link href="/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    <url>/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
    
    <content type="html"><![CDATA[<p>ç¼–å†™é¡ºåº</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span><br>    <span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> list<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">FROM</span><br>    <span class="hljs-operator">&lt;</span><span class="hljs-keyword">left</span> <span class="hljs-keyword">table</span><span class="hljs-operator">&gt;</span><span class="hljs-operator">&lt;</span><span class="hljs-keyword">join</span> type<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">JOIN</span><br>    <span class="hljs-operator">&lt;</span>right_table<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">&lt;</span>join_condition<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">WHERE</span><br>    <span class="hljs-operator">&lt;</span>where_condition<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <br>    <span class="hljs-operator">&lt;</span>group_by_list<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">HAVING</span>  <br>    <span class="hljs-operator">&lt;</span>having_condition<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>  <br>    <span class="hljs-operator">&lt;</span>order_by_condition<span class="hljs-operator">&gt;</span><br>LIMIT<br>    <span class="hljs-operator">&lt;</span>limit_params<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œé¡ºåº</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">FROM</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">left</span> <span class="hljs-keyword">table</span><span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">ON</span> <span class="hljs-operator">&lt;</span>join_condition<span class="hljs-operator">&gt;</span><br><span class="hljs-operator">&lt;</span><span class="hljs-keyword">join</span> type<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-operator">&lt;</span>right_table<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">WHERE</span> <span class="hljs-operator">&lt;</span>where_condition<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>  <span class="hljs-operator">&lt;</span>group_by_list<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">HAVING</span> <span class="hljs-operator">&lt;</span>having_condition<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>  <span class="hljs-operator">&lt;</span><span class="hljs-keyword">select</span> list<span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>  <span class="hljs-operator">&lt;</span>order_by_condition<span class="hljs-operator">&gt;</span><br>LIMIT <span class="hljs-operator">&lt;</span>limit_params<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>æ­£åˆ™è¡¨è¾¾å¼ regexp</p><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/6.png" alt="æ­£åˆ™è¡¨è¾¾å¼"></p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL æ—¥å¿—</title>
    <link href="/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E6%97%A5%E5%BF%97/"/>
    <url>/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E6%97%A5%E5%BF%97/</url>
    
    <content type="html"><![CDATA[<h3 id="é”™è¯¯æ—¥å¿—">é”™è¯¯æ—¥å¿—</h3><p>è®°å½•æœåŠ¡å™¨å¯åŠ¨, è¿è¡Œç›¸å…³å‘ç”Ÿçš„ä¸¥é‡çš„é”™è¯¯ä¿¡æ¯</p><pre><code class="hljs">show variables like &quot;log_error%&quot;ï¼›</code></pre><h3 id="binlog">binlog</h3><p>è®°å½•äº†æ‰€æœ‰DDL(æ•°æ®å®šä¹‰è¯­è¨€)è¯­å¥å’ŒDML(æ•°æ®æ“ä½œè¯­è¨€)è¯­å¥, ä½†æ˜¯ä¸åŒ…æ‹¬æŸ¥è¯¢è¯­å¥, å¯¹å®¹ç¾æ¢å¤, ä¸»ä»å¤åˆ¶æœ‰ä½œç”¨</p><p>é»˜è®¤ä¸å¼€å¯</p><p>éœ€è¦åœ¨my.confä¸­é…ç½®</p><pre><code class="hljs"># æ—¥å¿—å‰ç¼€ mysqlbin.00001 mysqlbin.00002log_bin=mysqlbinbin_log_format=STATMENT</code></pre><h4 id="æ—¥å¿—æ ¼å¼">æ—¥å¿—æ ¼å¼</h4><h5 id="STATMENT">STATMENT</h5><p>è®°å½•çš„éƒ½æ˜¯SQL(ä¸åŒ…æ‹¬æŸ¥è¯¢)è¯­å¥ é€šè¿‡ mysqlbinlog å·¥å…·å¯ä»¥è§£æå‡ºSQLè¯­å¥</p><h5 id="ROW">ROW</h5><p>è®°å½•çš„éƒ½æ˜¯æ¯ä¸€è¡Œæ•°æ®çš„å˜æ›´è€Œä¸æ˜¯SQLè¯­å¥</p><h5 id="MIXED">MIXED</h5><p>Mysql é»˜è®¤çš„æ—¥å¿—æ ¼å¼<br>é›†æˆäº†STATMENT, ROW, é»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨STATMENT,  ç‰¹æ®Šæƒ…å†µä¸‹é‡‡ç”¨ROW<br>å°½é‡åˆ©ç”¨ä»–ä»¬çš„æœ‰ç‚¹, é¿å…å…¶ç¼ºç‚¹</p><p>mysqlbinlog å·¥å…·å¯ä»¥æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶</p><p>STATMENTæ ¼å¼ä¸‹å°±å¯ä»¥æŸ¥çœ‹çš„æ‰§è¡Œçš„SQLè¯­å¥</p><pre><code class="hljs">mysqlbinlog log-file</code></pre><p>ROWæ ¼å¼ä¸‹å°±å¯ä»¥æŸ¥çœ‹çš„æ‰§è¡Œçš„SQLå˜æ›´æƒ…å†µ</p><pre><code class="hljs">mysqlbinlog -vv log-file</code></pre><h4 id="æ¸…é™¤æ—¥å¿—">æ¸…é™¤æ—¥å¿—</h4><ol><li><p>åˆ é™¤å…¨éƒ¨binlogæ—¥å¿—, æ—¥å¿—ç¼–å·ä»xxx.000001å¼€å§‹</p><p>mysql&gt; Reset Master</p></li><li><p><code>mysql&gt; purge master logs to &quot;xxxx.00000x&quot;</code> åˆ é™¤æ—¥å¿—00000xä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—</p></li><li><p><code>mysql&gt; purge master logs before &quot;yyyy-mm-dd hh24:mi:ss&quot;</code> åˆ é™¤æ—¥å¿—yyyy-mm-dd hh24:mi:ssä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—</p></li><li><p>â€“expire_logs_days=xx,æ—¥å¿—è¿‡æœŸæ—¶é—´ åœ¨my.confé…ç½®</p></li></ol><h3 id="æŸ¥è¯¢æ—¥å¿—">æŸ¥è¯¢æ—¥å¿—</h3><p>æ˜æ–‡æ˜¾ç¤ºæ•°æ®åº“æŸ¥è¯¢æ—¥å¿—</p><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/7.png" alt="avatar"></p><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—">æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡å‚æ•° long_query_time è®¾ç½®å€¼, å¹¶ä¸”æ‰«æè®°å½•ä¸å°äºmin_examined_wor_limitçš„æ‰€æœ‰çš„SQLè¯­å¥çš„æ—¥å¿—</p><p>long_query_time é»˜è®¤æ˜¯10s, å¯ä»¥ç²¾ç¡®åˆ°å¾®ç§’</p><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/8.png" alt="avatar"></p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL ç´¢å¼•</title>
    <link href="/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E7%B4%A2%E5%BC%95/"/>
    <url>/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E7%B4%A2%E5%BC%95/</url>
    
    <content type="html"><![CDATA[<h4 id="èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•b-æ ‘å®ç°æœ‰ä»€ä¹ˆåŒºåˆ«">èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•b+æ ‘å®ç°æœ‰ä»€ä¹ˆåŒºåˆ«</h4><p>åˆ†ä¸ºèšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ï¼ˆæœ‰æ—¶ä¹Ÿç§°è¾…åŠ©ç´¢å¼•æˆ–äºŒçº§ç´¢å¼•ï¼‰</p><p>èšç°‡æ˜¯ä¸ºäº†æé«˜æŸä¸ªå±æ€§(æˆ–å±æ€§ç»„)çš„æŸ¥è¯¢é€Ÿåº¦, æŠŠè¿™ä¸ªæˆ–è¿™äº›å±æ€§(ç§°ä¸ºèšç°‡ç )ä¸Šå…·æœ‰ç›¸åŒå€¼çš„å…ƒç»„é›†ä¸­å­˜æ”¾åœ¨è¿ç»­çš„ç‰©ç†å—ã€‚</p><p>èšç°‡ç´¢å¼•ï¼ˆclustered indexï¼‰ä¸æ˜¯å•ç‹¬çš„ä¸€ç§ç´¢å¼•ç±»å‹, è€Œæ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ã€‚è¿™ç§å­˜å‚¨æ–¹å¼æ˜¯ä¾é B+æ ‘æ¥å®ç°çš„, æ ¹æ®è¡¨çš„ä¸»é”®æ„é€ ä¸€æ£µB+æ ‘ä¸”B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„éƒ½æ˜¯è¡¨çš„è¡Œè®°å½•æ•°æ®æ—¶, æ–¹å¯ç§°è¯¥ä¸»é”®ç´¢å¼•ä¸ºèšç°‡ç´¢å¼•<br>ã€‚èšç°‡ç´¢å¼•ä¹Ÿå¯ç†è§£ä¸ºå°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°äº†ä¸€å—, æ‰¾åˆ°ç´¢å¼•ä¹Ÿå°±æ‰¾åˆ°äº†æ•°æ®ã€‚</p><p>éèšç°‡ç´¢å¼•ï¼šæ•°æ®å’Œç´¢å¼•æ˜¯åˆ†å¼€çš„, B+æ ‘å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ä¸æ˜¯æ•°æ®è¡¨çš„è¡Œè®°å½•</p><p>è™½ç„¶InnoDBå’ŒMyISAMå­˜å‚¨å¼•æ“éƒ½é»˜è®¤ä½¿ç”¨B+æ ‘ç»“æ„å­˜å‚¨ç´¢å¼•, ä½†æ˜¯åªæœ‰InnoDBçš„ä¸»é”®ç´¢å¼•æ‰æ˜¯èšç°‡ç´¢å¼•,  InnoDBä¸­çš„è¾…åŠ©ç´¢å¼•ä»¥åŠMyISAMä½¿ç”¨çš„éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚æ¯å¼ è¡¨æœ€å¤šåªèƒ½æ‹¥æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚</p><h4 id="é€»è¾‘åˆ†ç±»">é€»è¾‘åˆ†ç±»</h4><p>keyï¼šç­‰ä»·æ™®é€šç´¢å¼• key é”®å (åˆ—)</p><p>ä¸»é”®ç´¢å¼•primary keyï¼š</p><ul><li>çº¦æŸä½œç”¨ï¼ˆconstraintï¼‰, ä¸»é”®çº¦æŸï¼ˆunique, not null, ä¸€è¡¨ä¸€ä¸»é”®, å”¯ä¸€æ ‡è¯†è®°å½•ï¼‰, è§„èŒƒå­˜å‚¨ä¸»é”®å’Œå¼ºè°ƒå”¯ä¸€æ€§<br>ä¸ºè¿™ä¸ªkeyå»ºç«‹ä¸»é”®ç´¢å¼•</li></ul><p>å•å€¼(æ™®é€š)ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—, ä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•</p><p>å”¯ä¸€ç´¢å¼•ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€, ä½†å…è®¸æœ‰ç©ºå€¼</p><p>å¤åˆç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•å¯ä»¥åŒ…å«å¤šä¸ªåˆ—</p><p>å…¨æ–‡ç´¢å¼•</p><p>æœ€å·¦å‰ç¼€æ³•åˆ™(è”åˆç´¢å¼•)<br>æŒ‡çš„æ˜¯, æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹, ä¸å¾—è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—</p><p>å’Œ where åé¢çš„å…ˆåæ¡ä»¶æ²¡æœ‰å…³ç³»</p><pre><code class="hljs">1,2,3where 1=xxx and 2=xxx, 3=xxx, åªèµ°1, 2, 3 çš„ç´¢å¼•where 1=xxx and 3=xxx,  åªèµ°1, çš„ç´¢å¼•where 1=xxx and 2=xxx   åªèµ°1, 2çš„ç´¢å¼•where 1=xxx             åªèµ°1, çš„ç´¢å¼•where 2=xxx and 3 =xxx  åªèµ°2, 3 çš„ç´¢å¼•where 2=xxx             åªèµ°2, çš„ç´¢å¼•where 3=xxx             åªèµ°3, çš„ç´¢å¼•</code></pre><p>ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ</p><ol><li><p>èŒƒå›´æŸ¥è¯¢å³è¾¹çš„åˆ—, ä¸ä½¿ç”¨ç´¢å¼•<br><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/9.png" alt="avatar"></p></li><li><p>ä¸èƒ½åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œ</p><p>ä¾‹å¦‚ where substring(name, 3, 2) = â€œxxxâ€ å³ä½¿åˆ›å»ºäº†nameçš„ç´¢å¼•, ç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆ</p></li><li><p>å­—ç¬¦ä¸²ä¸åŠ å¼•å·, ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ<br>where name = 1</p></li><li><p>å°½é‡é¿å¼€select(*), å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•, é¿å…ä¸å¿…è¦çš„å›è¡¨æŸ¥è¯¢</p></li><li><p>ç”¨ or å‰é¢çš„æ¡ä»¶æœ‰ç´¢å¼•, åé¢çš„æ²¡æœ‰ç´¢å¼•, ç´¢å¼•å…¨éƒ¨å¤±æ•ˆ</p></li><li><p>ä»¥%å¼€å¤´çš„like è¯­å¥ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</p></li><li><p>å¦‚æœä½¿ç”¨ç´¢å¼•æ¯”æ‰«æå…¨è¡¨æ›´æ…¢, åˆ™ä¸ä¼šèµ°ç´¢å¼•</p></li><li><p>æ•°æ®é‡å¤§å°æƒ…å†µ,  is NULL, is not NULL ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</p></li><li><p>å°½é‡ä½¿ç”¨å¤åˆç´¢å¼•, å°‘ä½¿ç”¨å•åˆ—ç´¢å¼•</p></li></ol><h4 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</h4><p>hashï¼šæ˜¯æ— åºçš„å€¼, æ²¡æœ‰ä¸èƒ½æ’åºä¸èƒ½èŒƒå›´æŸ¥æ‰¾, å“ˆå¸Œå†²çªä¸‹, éœ€è¦æ¯”å¯¹, ä¼šå½±å“é€Ÿåº¦</p><p>å¹³è¡¡äºŒå‰æ ‘,  é™¤å¶å­èŠ‚ç‚¹å¤–, å…¶ä»–èŠ‚ç‚¹å¿…å®šæ˜¯æ»¡çš„, å·¦å­æ ‘, å³å­æ ‘å±‚çº§å·®ä¸ä¼šè¶…è¿‡1,  æ ‘è¶Šé«˜æŸ¥æ‰¾é€Ÿåº¦è¶Šæ…¢, èŒƒå›´æŸ¥æ‰¾ä¸‹, å›æ—‹æŸ¥æ‰¾æ•ˆç‡éå¸¸æ…¢</p><p>Bæ ‘</p><p>èŒƒå›´æŸ¥æ‰¾ä¸‹, å›æ—‹æŸ¥æ‰¾æ•ˆç‡éå¸¸æ…¢<br><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/10.png" alt="avatar"></p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL é”</title>
    <link href="/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E9%94%81/"/>
    <url>/2020/04/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h4 id="é”æ¦‚è¿°">é”æ¦‚è¿°</h4><p>é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ï¼ˆé¿å…äº‰æŠ¢ï¼‰</p><h4 id="é”åˆ†ç±»">é”åˆ†ç±»</h4><p>ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†ï¼š</p><ol><li><p>è¡¨é”ï¼š æ“ä½œæ—¶, é”å®šæ•´å¼ è¡¨</p></li><li><p>è¡Œé”ï¼š æ“ä½œæ—¶, é”å®šå½“å‰æ“ä½œè¡Œ</p></li></ol><p>ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹åˆ†ï¼š</p><ol><li><p>è¯»é”(å…±äº«é”)ï¼šæ­£å¯¹åŒä¸€ä»½æ•°æ®, å¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œäº’ä¸å½±å“</p></li><li><p>å†™é”(æ’å®ƒé”)ï¼šå½“å‰æ“ä½œæ²¡å®Œæˆä¹‹å‰, ä¼šé˜»å¡å…¶ä»–è¯»å†™æ“ä½œ</p></li></ol><h4 id="äº’æ–¥é”">äº’æ–¥é”</h4><p>äº’æ–¥é”ç‰¹ç‚¹ï¼š<br>ä¸€æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰äº’æ–¥é”, å…¶ä»–çº¿ç¨‹åªæœ‰ç­‰å¾…</p><h4 id="Mysqlé”">Mysqlé”</h4><p><img src="/asset/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/images/1.png" alt="avatar"></p><ul><li><a href="MyISAM.md">MyISAM</a></li><li><a href="InnoDB.md">InnoDB</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python GIL</title>
    <link href="/2020/04/15/Python/GIL/"/>
    <url>/2020/04/15/Python/GIL/</url>
    
    <content type="html"><![CDATA[<p>GILæ˜¯ä»€ä¹ˆï¼Ÿ</p><hr><p>GIL(å…¨å±€è§£é‡Šå™¨é”)æ˜¯ Global Interpreter Lock çš„ç¼©å†™, å…¶ä½œç”¨æ˜¯, åœ¨Pythonä½¿ç”¨å¤šçº¿ç¨‹çš„æ—¶å€™, æ‰€æœ‰çš„çº¿ç¨‹å»æŠ¢ä¸€ä¸ªé”, æŠ¢åˆ°äº†é”çš„çº¿ç¨‹å°±å¯ä»¥è·å¾—CPUæ—¶é—´ã€‚<br>ä½¿ç”¨GILçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–Pythonè§£é‡Šå™¨çš„å®ç°ï¼ˆPythonä¸­çš„æ ‡å‡†åº“é‡Œ, å¦‚æ— å£°æ˜, å¤§éƒ¨åˆ†åº“éƒ½ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼‰, è€Œç¼ºç‚¹å°±æ˜¯æ— æ³•å……åˆ†çš„åˆ©ç”¨æœºå™¨çš„å¤šæ ¸</p><p>Pythonä¸­å¦‚ä½•ä½¿ç”¨å¤šä¸ªCPUæ ¸å¿ƒï¼Ÿ</p><hr><p>åº”ä¸ºGILçš„å­˜åœ¨, ä¸ºäº†ä½¿ç”¨å¤šæ ¸, å°±å¿…é¡»æ‘†è„± GIL çš„é™åˆ¶, é€šå¸¸æœ‰è¿™ä¹ˆå‡ ç§æ–¹å¼ï¼š</p><p>ä½¿ç”¨å¤šè¿›ç¨‹è€Œä¸æ˜¯å¤šçº¿ç¨‹ï¼šå¯¹äºCPUå¯†é›†å‹ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨multiprocessingæ¨¡å—åˆ›å»ºå¤šä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„è§£é‡Šå™¨å’Œç‹¬ç«‹çš„GILã€‚</p><p>ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹ï¼šå¯¹äºI/Oå¯†é›†å‹ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨åç¨‹å’Œå¼‚æ­¥ç¼–ç¨‹åº“ï¼ˆå¦‚asyncioï¼‰æ¥é¿å…GILçš„é™åˆ¶ï¼Œå› ä¸ºåç¨‹åœ¨ç­‰å¾…I/Oæ—¶å¯ä»¥é‡Šæ”¾GILã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶GILåœ¨æŸäº›æƒ…å†µä¸‹ä¼šé™åˆ¶Pythonå¤šçº¿ç¨‹çš„æ€§èƒ½ï¼Œä½†å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå¹¶ä¸ä¼šæˆä¸ºç“¶é¢ˆã€‚Pythonä¸­çš„è®¸å¤šæ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹åº“éƒ½å¯ä»¥é€šè¿‡å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹æˆ–å¼‚æ­¥ç¼–ç¨‹æ¥å®ç°å¹¶å‘ï¼Œå¹¶åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸­æ‰¾åˆ°åˆé€‚çš„è§£å†³æ–¹æ¡ˆã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>is å’Œ == çš„åŒºåˆ«</title>
    <link href="/2020/04/15/Python/is_or_==/"/>
    <url>/2020/04/15/Python/is_or_==/</url>
    
    <content type="html"><![CDATA[<hr><p>éƒ½æ˜¯å¯¹è±¡çš„æ¯”è¾ƒ</p><p>is æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;&gt;&gt;<span class="hljs-number">1</span> <span class="hljs-keyword">is</span> <span class="hljs-number">1</span><br><span class="hljs-literal">True</span><br>&gt;&gt;&gt;[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>] <span class="hljs-keyword">is</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]<br><span class="hljs-literal">False</span><br><span class="hljs-comment"># å› ä¸º id([1, 2]) éƒ½ä¸åŒ</span><br></code></pre></td></tr></table></figure><p>== æ˜¯ä¸¤ä¸ªå¯¹è±¡çš„__eq__æ–¹æ³•è¿”å›çš„å€¼è¿›è¡Œæ¯”è¾ƒ</p><p>å› æ­¤å¯ä»¥é‡è½½__eq__æ¥å®ç°ä¸åŒå¯¹è±¡çš„æ¯”è¾ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NewInt</span>(<span class="hljs-title class_ inherited__">int</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(self) == <span class="hljs-built_in">str</span>(other)<br><br><br>ni = NewInt(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(ni == <span class="hljs-string">&quot;1&quot;</span>) <span class="hljs-comment"># True</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python ä¸€äº›é¢˜ç›®</title>
    <link href="/2020/04/15/Python/%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/"/>
    <url>/2020/04/15/Python/%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<ul><li><a href="#%E7%BB%9F%E8%AE%A1%E9%A2%91%E6%AC%A1">ç»Ÿè®¡é¢‘æ¬¡</a></li><li><a href="#%E5%B0%8F%E5%86%85%E5%AD%98%E5%A4%84%E7%90%86%E5%A4%A7%E6%96%87%E4%BB%B6">å°å†…å­˜å¤„ç†å¤§æ–‡ä»¶</a></li><li><a href="#%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E9%97%AE%E9%A2%98">é»˜è®¤å‚æ•°é—®é¢˜</a></li><li><a href="#%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F%E8%A7%84%E5%88%99">å˜é‡ä½œç”¨åŸŸè§„åˆ™</a></li></ul><h3 id="ç»Ÿè®¡é¢‘æ¬¡">ç»Ÿè®¡é¢‘æ¬¡</h3><p>å¦‚ä½•ç»Ÿè®¡ä¸€ç¯‡æ–‡ç« ä¸­å•è¯çš„å‡ºç°æ¬¡æ•°ï¼Ÿ</p><p>ä½¿ç”¨ Counter, ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>In [<span class="hljs-number">1</span>]: a = <span class="hljs-string">&quot;hello world hello world world hello this that&quot;</span>                                                                                                                  <br><br>In [<span class="hljs-number">2</span>]: <span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter                                                                                                                                      <br><br>In [<span class="hljs-number">3</span>]: counter = Counter(a.split(<span class="hljs-string">&quot; &quot;</span>))                                                                                                                                      <br><br>In [<span class="hljs-number">4</span>]: counter                                                                                                                                                              <br>Out[<span class="hljs-number">4</span>]: Counter(&#123;<span class="hljs-string">&#x27;hello&#x27;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;world&#x27;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;this&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;that&#x27;</span>: <span class="hljs-number">1</span>&#125;)<br><br></code></pre></td></tr></table></figure><h3 id="å°å†…å­˜å¤„ç†å¤§æ–‡ä»¶">å°å†…å­˜å¤„ç†å¤§æ–‡ä»¶</h3><p>Pythonä¸­å¦‚ä½•è¯»å–ä¸€ä¸ªå¤§å°ä¸º1Gçš„çº¯æ–‡æœ¬çš„å†…å®¹</p><p>è¿™ä¸ªé¢˜ç›®ä¸»è¦æ˜¯ä¸ºäº†è€ƒå¯Ÿ, Pythonä¸­å¦‚ä½•æ‰“å¼€å¤§æ–‡ä»¶ã€‚æ‰“å¼€æ–‡ä»¶çš„æ—¶å€™, å¦‚æœç›´æ¥è¯»å–æ‰€æœ‰æ–‡ä»¶å†…å®¹, é‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®ç»“æ„ä¾‹å¦‚ list æˆ–è€… str æ¥å­˜å‚¨æ–‡ä»¶é‡Œçš„å†…å®¹, è¿™å¯¹äºå¾ˆå¤šå°å†…å­˜çš„è®¾å¤‡å¾€å¾€æ˜¯ä¸å¯è¡Œçš„ã€‚å› æ­¤, æ­¤å¤„é¢è¯•å®˜éšå«äº†ä¸€ä¸ªæ¡ä»¶, å°±æ˜¯è€ƒå¯Ÿä½ æ˜¯å¦èƒ½è€ƒè™‘åˆ°èŠ‚çœå†…å­˜ã€‚</p><p>å› æ­¤, é¦–å…ˆä½ éœ€è¦è·Ÿé¢è¯•å®˜ç¡®è®¤, æˆ‘éœ€è¦è€ƒè™‘å†…å­˜å ç”¨å¯¹å—ï¼Ÿ</p><p>ç„¶å, ä¸€èˆ¬é¢è¯•å®˜ä¼šç»™ä½ è‚¯å®šçš„å›ç­”ã€‚ä¹‹åå°±åˆ°äº†æˆ‘ä»¬æå‡ºè§£å†³æ–¹æ¡ˆçš„æ—¶å€™, æ—¢ç„¶ä¸€æ¬¡æ€§è¯»å–å¤§æ–‡ä»¶éå¸¸è€—è´¹å†…å­˜, è§£å†³æ–¹æ¡ˆå°±æ˜¯åˆ†è€Œæ²»ä¹‹, ä¾‹å¦‚, é€è¡Œè¯»å–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;demo.txt&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    line = f.readline()<br>    <span class="hljs-keyword">while</span> line:<br>        <span class="hljs-built_in">print</span>(line)<br>        line = f.readline()<br></code></pre></td></tr></table></figure><p>æˆ–è€…æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª ç”Ÿæˆå™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            line = f.readline()<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> line:<br>                <span class="hljs-keyword">break</span><br><br>            <span class="hljs-keyword">yield</span> line<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> read(<span class="hljs-string">&quot;demo.txt&quot;</span>):<br>    <span class="hljs-built_in">print</span>(i)<br><br></code></pre></td></tr></table></figure><h3 id="é»˜è®¤å‚æ•°é—®é¢˜">é»˜è®¤å‚æ•°é—®é¢˜</h3><p>è¿™æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">a=[]</span>):<br>    a.append(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(a)<br><br><br>foo()<br>foo()<br>foo()<br><br></code></pre></td></tr></table></figure><pre><code class="hljs">[1, 1][1, 1, 1]</code></pre><p>åŸå› æ˜¯, Pythonä¸­çš„é»˜è®¤å‚æ•°åªä¼šåˆå§‹åŒ–ä¸€æ¬¡, å¹¶ä¸”ä¼šå…±äº«åŒä¸€ä¸ªå¯¹è±¡ã€‚å› æ­¤, è¿™é‡Œæ¯æ¬¡è°ƒç”¨ foo , å…¶å®éƒ½æ˜¯æ“ä½œåŒä¸€ä¸ªåˆ—è¡¨, å› æ­¤ä¼šäº§ç”Ÿä¸Šè¿°è¾“å‡ºã€‚</p><h3 id="å˜é‡ä½œç”¨åŸŸè§„åˆ™">å˜é‡ä½œç”¨åŸŸè§„åˆ™</h3><p>è§£æï¼š</p><p>Pythonä¸­çš„å˜é‡ä½œç”¨åŸŸè§„åˆ™éµå¾ª L-E-G-B çš„é¡ºåºã€‚å…¶ä¸­ï¼š</p><ol><li>L æ˜¯æŒ‡ Local, æŒ‡æœ¬åœ°å˜é‡, ä¾‹å¦‚ def æˆ–è€… lambda å®šä¹‰çš„å‡½æ•°ä½“å†…çš„å˜é‡</li><li>E æ˜¯æŒ‡ Enclosing-function locals, å³é—­åŒ…å˜é‡</li><li>G æ˜¯æŒ‡ Global, å…¨å±€å˜é‡</li><li>B æ˜¯æŒ‡ Built-in å³Pythonè§£é‡Šå™¨æä¾›çš„å†…ç½®å‡½æ•°å’Œå˜é‡</li></ol><p>ç”¨ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹å„ä¸ªå˜é‡å±äºä»€ä¹ˆå˜é‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>hello = <span class="hljs-string">&quot;hello&quot;</span>  <span class="hljs-comment"># helloæ˜¯å…¨å±€å˜é‡</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>():<br>    <span class="hljs-built_in">print</span>(hello)  <span class="hljs-comment"># è¿™é‡Œçš„helloæ˜¯å¼•ç”¨äº†å…¨å±€å˜é‡</span><br>    world = <span class="hljs-string">&quot;world&quot;</span>  <span class="hljs-comment"># è¿™é‡Œçš„worldæ˜¯å±€éƒ¨å˜é‡</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bar</span>():<br>        message = <span class="hljs-string">&quot;message&quot;</span>  <span class="hljs-comment"># è¿™é‡Œçš„messageä¹Ÿæ˜¯å±€éƒ¨å˜é‡</span><br>        <span class="hljs-built_in">print</span>(world)  <span class="hljs-comment"># è¿™é‡Œçš„worldæ˜¯é—­åŒ…å˜é‡</span><br><br>    bar()<br><br>    <span class="hljs-comment"># ä¸Šé¢çš„ print å‡½æ•°æ˜¯builtiné‡Œæä¾›çš„</span><br><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ‰§è¡Œä¼šæŠ¥é”™å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">hello = <span class="hljs-string">&quot;hello&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>():<br>    <span class="hljs-built_in">print</span>(hello)<br>    hello = <span class="hljs-string">&quot;world&quot;</span><br>    <span class="hljs-built_in">print</span>(hello)<br><br>foo()<br></code></pre></td></tr></table></figure><p>ä¼šæŠ¥é”™, å¦‚ä¸‹</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vim">$ <span class="hljs-keyword">python</span> demo.<span class="hljs-keyword">py</span><br>    Traceback (most recent <span class="hljs-keyword">call</span> <span class="hljs-keyword">last</span>):<br>    File <span class="hljs-string">&quot;demo.py&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">10</span>, in <span class="hljs-symbol">&lt;module&gt;</span><br>        foo()<br>    File <span class="hljs-string">&quot;demo.py&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">5</span>, in foo<br>        <span class="hljs-keyword">print</span>(hello)<br>    UnboundLocalError: local variable <span class="hljs-string">&#x27;hello&#x27;</span> referenced before assignment<br><br></code></pre></td></tr></table></figure><p>åŸå› æ˜¯åœ¨Pythonä¸­, åªè¦å‡ºç°èµ‹å€¼è¯­å¥, é‚£ä¹ˆå˜é‡å°±ä¼šåœ¨ä¸èµ‹å€¼è¯­å¥æ‰€åœ¨çš„åŒçº§ä½œç”¨åŸŸæŸ¥æ‰¾, å…¶ä¸­èµ‹å€¼è¯­å¥åŒ…æ‹¬ =, def, class, import, del, for, asã€‚è€Œä¸Šé¢çš„ä¾‹å­ä¸­, ç¬¬ä¸€ä¸ª print(hello) æ‰§è¡Œæ—¶, hello è¿™ä¸ªå˜é‡ä¼šåœ¨æœ¬çº§ä½œç”¨åŸŸæŸ¥æ‰¾, ä½†æ˜¯è¿™ä¸ª print æ‰§è¡Œçš„æ—¶å€™, hello è¿˜æ²¡æœ‰è¢«èµ‹å€¼, æ‰€ä»¥æ‰¾ä¸åˆ°è¿™ä¸ªå˜é‡</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†…å­˜ç®¡ç†ä¸åƒåœ¾å›æ”¶æœºåˆ¶</title>
    <link href="/2020/04/15/Python/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/"/>
    <url>/2020/04/15/Python/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E4%B8%8E%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<p>å†…å­˜ç®¡ç†ä¸åƒåœ¾å›æ”¶æœºåˆ¶</p><hr><p>Python çš„å†…å­˜ç®¡ç†æœºåˆ¶åŠè°ƒä¼˜æ‰‹æ®µï¼Ÿ<br>å†…å­˜ç®¡ç†æœºåˆ¶ï¼šå¼•ç”¨è®¡æ•°ã€åƒåœ¾å›æ”¶ã€å†…å­˜æ± ã€‚</p><h3 id="å¼•ç”¨è®¡æ•°ï¼š">å¼•ç”¨è®¡æ•°ï¼š</h3><p>å¼•ç”¨è®¡æ•°æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„å†…å­˜ç®¡ç†æ‰‹æ®µ,  å½“ä¸€ä¸ª Python å¯¹è±¡è¢«å¼•ç”¨æ—¶å…¶å¼•ç”¨è®¡æ•°å¢åŠ  1,  å½“å…¶ä¸å†è¢«ä¸€ä¸ªå˜é‡å¼•ç”¨æ—¶åˆ™è®¡æ•°å‡ 1. å½“å¼•ç”¨è®¡æ•°ç­‰äº 0 æ—¶å¯¹è±¡è¢«åˆ é™¤ã€‚</p><h3 id="åƒåœ¾å›æ”¶-ï¼š">åƒåœ¾å›æ”¶ ï¼š</h3><h4 id="1-å¼•ç”¨è®¡æ•°">1.å¼•ç”¨è®¡æ•°</h4><p>å¼•ç”¨è®¡æ•°ä¹Ÿæ˜¯ä¸€ç§åƒåœ¾æ”¶é›†æœºåˆ¶, è€Œä¸”ä¹Ÿæ˜¯ä¸€ç§æœ€ç›´è§‚, æœ€ç®€å•çš„åƒåœ¾æ”¶é›†æŠ€æœ¯ã€‚å½“ Python çš„æŸä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°é™ä¸º 0 æ—¶, è¯´æ˜æ²¡æœ‰ä»»ä½•å¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡, è¯¥å¯¹è±¡å°±æˆä¸ºè¦è¢«å›æ”¶çš„åƒåœ¾äº†ã€‚æ¯”å¦‚æŸä¸ªæ–°å»ºå¯¹è±¡, å®ƒè¢«åˆ†é…ç»™æŸä¸ªå¼•ç”¨, å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º 1ã€‚å¦‚æœå¼•ç”¨è¢«åˆ é™¤, å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 0,  é‚£ä¹ˆè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶ã€‚ä¸è¿‡å¦‚æœå‡ºç°å¾ªç¯å¼•ç”¨çš„è¯, å¼•ç”¨è®¡æ•°æœºåˆ¶å°±ä¸å†èµ·æœ‰æ•ˆçš„ä½œç”¨äº†</p><h4 id="2-æ ‡è®°æ¸…é™¤">2.æ ‡è®°æ¸…é™¤</h4><p>å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°éƒ½ä¸º 1, ä½†æ˜¯ä»…ä»…å­˜åœ¨ä»–ä»¬ä¹‹é—´çš„å¾ªç¯å¼•ç”¨, é‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡éƒ½æ˜¯éœ€è¦è¢«å›æ”¶çš„, ä¹Ÿå°±æ˜¯è¯´, å®ƒä»¬çš„å¼•ç”¨è®¡æ•°è™½ç„¶è¡¨ç°ä¸ºé 0, ä½†å®é™…ä¸Šæœ‰æ•ˆçš„å¼•ç”¨è®¡æ•°ä¸º 0ã€‚æ‰€ä»¥å…ˆå°†å¾ªç¯å¼•ç”¨æ‘˜æ‰, å°±ä¼šå¾—å‡ºè¿™ä¸¤ä¸ªå¯¹è±¡çš„æœ‰æ•ˆè®¡æ•°ã€‚</p><h4 id="3-åˆ†ä»£å›æ”¶">3.åˆ†ä»£å›æ”¶</h4><p>ä»å‰é¢â€œæ ‡è®°-æ¸…é™¤â€è¿™æ ·çš„åƒåœ¾æ”¶é›†æœºåˆ¶æ¥çœ‹, è¿™ç§åƒåœ¾æ”¶é›†æœºåˆ¶æ‰€å¸¦æ¥çš„é¢å¤–æ“ä½œå®é™…ä¸Šä¸ç³»ç»Ÿä¸­æ€»çš„å†…å­˜å—çš„æ•°é‡æ˜¯ç›¸å…³çš„, å½“éœ€è¦å›æ”¶çš„å†…å­˜å—è¶Šå¤šæ—¶, åƒåœ¾æ£€æµ‹å¸¦æ¥çš„é¢å¤–æ“ä½œå°±è¶Šå¤š, è€Œåƒåœ¾å›æ”¶å¸¦æ¥çš„é¢å¤–æ“ä½œå°±è¶Šå°‘ï¼›åä¹‹, å½“éœ€å›æ”¶çš„å†…å­˜å—è¶Šå°‘æ—¶, åƒåœ¾æ£€æµ‹å°±å°†æ¯”åƒåœ¾å›æ”¶å¸¦æ¥æ›´å°‘çš„é¢å¤–æ“ä½œã€‚</p><h3 id="è°ƒä¼˜æ‰‹æ®µï¼ˆäº†è§£ï¼‰">è°ƒä¼˜æ‰‹æ®µï¼ˆäº†è§£ï¼‰</h3><ol><li>æ‰‹åŠ¨åƒåœ¾å›æ”¶</li><li>è°ƒé«˜åƒåœ¾å›æ”¶é˜ˆå€¼</li><li>é¿å…å¾ªç¯å¼•ç”¨ï¼ˆæ‰‹åŠ¨è§£å¾ªç¯å¼•ç”¨å’Œä½¿ç”¨å¼±å¼•ç”¨ï¼‰</li></ol><h3 id="å†…å­˜æ± ">å†…å­˜æ± </h3><p><img src="/asset/Python/images/12876717-bd79288a23142d3c.webp" alt="avatar"></p><p>Pythonçš„å†…å­˜æœºåˆ¶å‘ˆç°é‡‘å­—å¡”å½¢çŠ¶ï¼š</p><ol><li><p>-1, -2å±‚ä¸»è¦æœ‰æ“ä½œç³»ç»Ÿè¿›è¡Œæ“ä½œï¼›</p></li><li><p>ç¬¬0å±‚æ˜¯Cä¸­çš„malloc, freeç­‰å†…å­˜åˆ†é…å’Œé‡Šæ”¾å‡½æ•°è¿›è¡Œæ“ä½œï¼›</p></li><li><p>ç¬¬1å±‚å’Œç¬¬2å±‚æ˜¯å†…å­˜æ± , æœ‰Pythonçš„æ¥å£å‡½æ•°PyMem_Mallocå‡½æ•°å®ç°, å½“å¯¹è±¡å°äº256Kæ—¶æœ‰è¯¥å±‚ç›´æ¥åˆ†é…å†…å­˜ï¼›</p></li><li><p>ç¬¬3å±‚æ˜¯æœ€ä¸Šå±‚, ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯¹Pythonå¯¹è±¡çš„ç›´æ¥æ“ä½œï¼›</p></li></ol><h3 id="å†…å­˜æ³„éœ²æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ">å†…å­˜æ³„éœ²æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ</h3><p>æŒ‡ç”±äºç–å¿½æˆ–é”™è¯¯é€ æˆç¨‹åºæœªèƒ½é‡Šæ”¾å·²ç»ä¸å†ä½¿ç”¨çš„å†…å­˜çš„æƒ…å†µã€‚å†…å­˜æ³„æ¼å¹¶éæŒ‡å†…å­˜åœ¨ç‰©ç†ä¸Šçš„æ¶ˆå¤±, è€Œæ˜¯åº”ç”¨ç¨‹åºåˆ†é…æŸæ®µå†…å­˜å, ç”±äºè®¾è®¡é”™è¯¯, å¤±å»äº†å¯¹è¯¥æ®µå†…å­˜çš„æ§åˆ¶, å› è€Œé€ æˆäº†å†…å­˜çš„æµªè´¹ã€‚å¯¼è‡´ç¨‹åºè¿è¡Œé€Ÿåº¦å‡æ…¢ç”šè‡³ç³»ç»Ÿå´©æºƒç­‰ä¸¥é‡åæœã€‚</p><p>æœ‰ del () å‡½æ•°çš„å¯¹è±¡é—´çš„å¾ªç¯å¼•ç”¨æ˜¯å¯¼è‡´å†…å­˜æ³„æ¼çš„ä¸»å‡¶ã€‚</p><p>ä¸ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ä½¿ç”¨:del object æ¥åˆ é™¤ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å°±å¯ä»¥æœ‰æ•ˆé˜²æ­¢å†…å­˜æ³„æ¼é—®é¢˜ã€‚é€šè¿‡ Python æ‰©å±•æ¨¡å— gc æ¥æŸ¥çœ‹ä¸èƒ½å›æ”¶çš„å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>å¯ä»¥é€šè¿‡ sys.getrefcount(obj) æ¥è·å–å¯¹è±¡çš„å¼•ç”¨è®¡æ•°, å¹¶æ ¹æ®è¿”å›å€¼æ˜¯å¦ä¸º 0 æ¥åˆ¤æ–­æ˜¯å¦å†…å­˜æ³„æ¼</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åç¨‹å’Œçº¿ç¨‹</title>
    <link href="/2020/04/15/Python/%E5%8D%8F%E7%A8%8B/"/>
    <url>/2020/04/15/Python/%E5%8D%8F%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<hr><h3 id="è¿­ä»£å™¨">è¿­ä»£å™¨</h3><p>æ˜¯ä¸€ç§å¯ä»¥éå†çš„å¯¹è±¡ï¼Œå¯ä»¥ä½œç”¨äºnextï¼ˆï¼‰å‡½æ•°</p><h3 id="ç”Ÿæˆå™¨">ç”Ÿæˆå™¨</h3><p>Pythonä¸­ä¸€è¾¹å¾ªç¯ä¸€è¾¹è®¡ç®—çš„æœºåˆ¶ç§°ä¸ºç”Ÿæˆå™¨ æ¯”å¦‚ç”Ÿæˆå™¨å‡½æ•°ï¼ˆyield ï¼‰</p><h3 id="è£…é¥°å™¨">è£…é¥°å™¨</h3><p>å¯ä»¥ä½¿ç”¨è£…é¥°å™¨ï¼Œè£…é¥°è¯¥å‡½æ•°ï¼Œåœ¨ä¸æ”¹å˜åŸå‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¢åŠ åŠŸèƒ½</p><h3 id="è¿›ç¨‹-çº¿ç¨‹å’Œåç¨‹">è¿›ç¨‹,çº¿ç¨‹å’Œåç¨‹</h3><hr><p><strong>è¿›ç¨‹</strong>åœ¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„ä¸€ä¸ªç¨‹åº, æ“ä½œç³»ç»Ÿä»¥è¿›ç¨‹ä¸ºå•ä½åˆ†é…èµ„æº, æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ã€å†…å­˜ã€æ•°æ®æ ˆä»¥åŠå…¶ä»–ç”¨äºè·Ÿè¸ªè¿›ç¨‹æ‰§è¡Œçš„è¾…åŠ©æ•°æ®, æ“ä½œç³»ç»Ÿç®¡ç†æ‰€æœ‰è¿›ç¨‹çš„æ‰§è¡Œ, å¹¶ä¸ºè¿™äº›è¿›ç¨‹åˆç†çš„åˆ†é…èµ„æº</p><p><strong>çº¿ç¨‹</strong>æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½, è¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­, æ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ã€‚ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµ, ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹, æ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡</p><ul><li>è¿›ç¨‹æ˜¯èµ„æºï¼ˆåŒ…æ‹¬å†…å­˜ã€æ‰“å¼€çš„æ–‡ä»¶ç­‰ï¼‰åˆ†é…çš„å•ä½ï¼Œçº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„å•ä½</li><li>çº¿ç¨‹èƒ½å‡å°‘å¹¶å‘æ‰§è¡Œçš„æ—¶é—´å’Œç©ºé—´å¼€é”€</li><li>è¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„èµ„æºå¹³å°ï¼Œè€Œçº¿ç¨‹åªç‹¬äº«å¿…ä¸å¯å°‘çš„èµ„æºï¼Œå¦‚å¯„å­˜å™¨å’Œæ ˆ</li></ul><p><strong>åç¨‹</strong>çš„ä½œç”¨, æ˜¯åœ¨æ‰§è¡Œå‡½æ•°Aæ—¶, å¯ä»¥éšæ—¶ä¸­æ–­, å»æ‰§è¡Œå‡½æ•°B, ç„¶åä¸­æ–­ç»§ç»­æ‰§è¡Œå‡½æ•°Aï¼ˆå¯ä»¥è‡ªç”±åˆ‡æ¢ï¼‰ã€‚ä½†è¿™ä¸€è¿‡ç¨‹å¹¶ä¸æ˜¯å‡½æ•°è°ƒç”¨ï¼ˆæ²¡æœ‰è°ƒç”¨è¯­å¥ï¼‰, è¿™ä¸€æ•´ä¸ªè¿‡ç¨‹çœ‹ä¼¼åƒå¤šçº¿ç¨‹, ç„¶è€Œåç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p><h5 id="å¹¶å‘ä¸å¹¶è¡Œ">å¹¶å‘ä¸å¹¶è¡Œ</h5><p>å¹¶å‘é€šå¸¸æŒ‡æœ‰å¤šä¸ªä»»åŠ¡éœ€è¦åŒæ—¶è¿›è¡Œ, å¹¶è¡Œåˆ™æ˜¯åŒä¸€æ—¶åˆ»æœ‰å¤šä¸ªä»»åŠ¡æ‰§è¡Œã€‚ç”¨å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ã€åç¨‹æ¥è¯´, åç¨‹å®ç°å¹¶å‘, å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹å®ç°å¹¶è¡Œ</p><p>å¤šçº¿ç¨‹å¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´æ‰§è¡Œ</p><hr><h3 id="ç”Ÿæˆå™¨å˜ä¸ºåç¨‹">ç”Ÿæˆå™¨å˜ä¸ºåç¨‹</h3><hr><p>é€šè¿‡yieldå…³é”®å­—å’Œ.sendæ–¹æ³•, ç”¨æˆ·å¯ä»¥éšæ—¶ä¸­æ–­ä¸€ä¸ªå‡½æ•°æ‰§è¡Œè½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªå‡½æ•°, ç›¸å½“äºæ‰‹åŠ¨ä»ä¸€ä¸ªå­ç¨‹åºçš„æ‰§è¡Œåˆ‡æ¢åˆ°äº†å¦ä¸€ä¸ªå­ç¨‹åºçš„æ‰§è¡Œã€‚åœ¨è¿™ç§å­ç¨‹åºçš„åˆ‡æ¢è¿‡ç¨‹ä¸­æ²¡æœ‰æ¶‰åŠåˆ°çº¿ç¨‹çš„åˆ‡æ¢, æˆ‘ä»¬å°†ä¸€ä¸ªå­ç¨‹åºå’Œå®ƒè¢«æ‰§è¡Œä»¥åŠè¢«æŒ‚èµ·æ—¶çš„çŠ¶æ€ç§°ä¹‹ä¸ºä¸€ä¸ªåç¨‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">gg</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;a&#x27;</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        b = <span class="hljs-keyword">yield</span><br>        <span class="hljs-built_in">print</span>(b)<br>n = gg()<br>n.send(<span class="hljs-literal">None</span>) <span class="hljs-comment"># é¢„æ¿€æ´»åç¨‹,è®©å‡½æ•°ggè¿è¡Œåˆ°b = yieldè¿™ä¸€å¥</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-&#x27;</span>)<br>n.send(<span class="hljs-string">&#x27;b&#x27;</span>) <span class="hljs-comment"># ç»™å‡½æ•°ggä¸­çš„yieldä¼ å€¼</span><br>n.throw(Exception,<span class="hljs-string">&#x27;value error&#x27;</span>) <span class="hljs-comment"># è®©è°ƒç”¨æ–¹æŠ›å‡ºå¼‚å¸¸, åœ¨ç”Ÿæˆå™¨ä¸­å¤„ç†</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å­ç”Ÿæˆå™¨</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">average_gen</span>():<br>    total = <span class="hljs-number">0</span><br>    count = <span class="hljs-number">0</span><br>    average = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        new_num = <span class="hljs-keyword">yield</span> average<br>        <span class="hljs-built_in">print</span>(new_num)<br>        count += <span class="hljs-number">1</span><br>        total += new_num<br>        average = total/count<br><br><span class="hljs-comment"># å§”æ‰˜ç”Ÿæˆå™¨</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">proxy_gen</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> average_gen()<br><br><span class="hljs-comment"># è°ƒç”¨æ–¹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    calc_average = proxy_gen()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(calc_average) )           <span class="hljs-comment"># é¢„æ¿€ä¸‹ç”Ÿæˆå™¨</span><br>    <span class="hljs-built_in">print</span>(calc_average.send(<span class="hljs-number">10</span>))  <span class="hljs-comment"># æ‰“å°ï¼š10.0</span><br>    <span class="hljs-built_in">print</span>(calc_average.send(<span class="hljs-number">20</span>))  <span class="hljs-comment"># æ‰“å°ï¼š15.0</span><br>    <span class="hljs-built_in">print</span>(calc_average.send(<span class="hljs-number">30</span>))  <span class="hljs-comment"># æ‰“å°ï¼š20.0</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><hr><h3 id="asyncioå’Œfuture">asyncioå’Œfuture</h3><hr><p>futureå¯¹è±¡ç”±asyncioåˆ›å»º</p><p><font color=red>futureè¡¨ç¤ºç»ˆå°†å‘ç”Ÿçš„äº‹æƒ…, è€Œç¡®å®šæŸä»¶äº‹ä¼šå‘ç”Ÿçš„å”¯ä¸€æ–¹å¼å°±æ˜¯æ‰§è¡Œçš„æ—¶é—´å·²ç»æ’å®š</font></p><p>futureå¯¹è±¡</p><p>futureå¯¹è±¡æœ‰å››ä¸ªçŠ¶æ€ï¼šPendingã€Runningã€Doneã€Cancelledã€‚åˆ›å»ºfutureçš„æ—¶å€™, taskä¸ºpending, äº‹ä»¶å¾ªç¯è°ƒç”¨æ‰§è¡Œçš„æ—¶å€™å½“ç„¶å°±æ˜¯running, è°ƒç”¨å®Œæ¯•è‡ªç„¶å°±æ˜¯done, å¦‚æœéœ€è¦åœæ­¢äº‹ä»¶å¾ªç¯, å°±éœ€è¦å…ˆæŠŠtaskå–æ¶ˆ, å¯ä»¥ä½¿ç”¨asyncio.Taskè·å–äº‹ä»¶å¾ªç¯çš„task</p><p>asyncioåç¨‹å¦‚ä½•å®ç°å¹¶å‘</p><p>asyncioæƒ³è¦å®ç°å¹¶å‘, å°±éœ€è¦å¤šä¸ªåç¨‹æ¥å®Œæˆä»»åŠ¡, æ¯å½“æœ‰ä»»åŠ¡é˜»å¡çš„æ—¶å€™å°±await, ç„¶åå…¶ä»–åç¨‹ç»§ç»­å·¥ä½œ, è¿™éœ€è¦åˆ›å»ºå¤šä¸ªåç¨‹çš„åˆ—è¡¨, ç„¶åå°†è¿™äº›åç¨‹æ³¨å†Œåˆ°äº‹ä»¶å¾ªç¯ä¸­ã€‚è¿™é‡ŒæŒ‡çš„å¤šä¸ªåç¨‹, å¯ä»¥æ˜¯å¤šä¸ªåç¨‹å‡½æ•°, ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåç¨‹å‡½æ•°çš„å¤šä¸ªåç¨‹å¯¹è±¡</p><h3 id="å¤„ç†å¹¶å‘">å¤„ç†å¹¶å‘</h3><p>Pythonä¸­å¤„ç†å¹¶å‘ä¸å¤§å¤šæ•°è¯­è¨€ä¸€æ ·, ä½†ä¹Ÿæœ‰ä¸ä¸€æ ·çš„åœ°æ–¹ã€‚å¸¸è§çš„å¤„ç†å¹¶å‘çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><ol><li><p>ä½¿ç”¨è¿›ç¨‹æ± ã€‚å³, é¢„å…ˆforkå¥½ä¸€å®šæ•°é‡çš„è¿›ç¨‹, æ¯æ¥ä¸€ä¸ªè¯·æ±‚, å°±ä»è¿›ç¨‹æ± ä¸­åˆ†é…ä¸€ä¸ªè¿›ç¨‹å»å¤„ç†è¯¥è¯·æ±‚, å¤„ç†å®Œæˆä¹‹å, å†å°†è¯¥è¿›ç¨‹æ”¾å›è¿›ç¨‹æ± ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸, ä½†ç¼ºç‚¹åŒæ ·æ˜æ˜¾, å°±æ˜¯æ¯”è¾ƒæµªè´¹CPU, å› ä¸ºå¤šè¿›ç¨‹åˆ‡æ¢çš„æ—¶å€™ç”±äºè¦ä¿å­˜ä¸Šä¸‹æ–‡, éœ€è¦æ›´å¤šçš„æŒ‡ä»¤æ¥ä¿å­˜æ›´å¤šçš„æ•°æ®ã€‚è€Œä¸”è¿›ç¨‹æ¯”çº¿ç¨‹å ç”¨æ›´å¤šçš„å†…å­˜ã€‚</p></li><li><p>ä½¿ç”¨çº¿ç¨‹æ± ã€‚ä¸è¿›ç¨‹æ± å·¥ä½œåŸç†ç±»ä¼¼, ä½†æ˜¯æ¯æ¬¡æ˜¯ä½¿ç”¨çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚Pythonä¸­ä½¿ç”¨çº¿ç¨‹æ± æœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç¼ºç‚¹å°±æ˜¯Pythonæœ‰GIL, ä¹Ÿå°±æ„å‘³ç€, Pythonä½¿ç”¨çº¿ç¨‹æ± æ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸ã€‚</p></li><li><p>ä½¿ç”¨åç¨‹ã€‚å€ŸåŠ©geventè¿™ç±»å·¥å…·, Pythonå¯ä»¥è½»æ¾çš„ä»¥åŒæ­¥çš„æ–¹å¼å†™å‡ºå¼‚æ­¥çš„ä»£ç , ä»è€Œå¯ä»¥è½»æ¾çš„å¤„ç†å¹¶å‘é—®é¢˜, åŒæ—¶é…åˆä½¿ç”¨è¿›ç¨‹æ± , ä¾¿å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸, å¹¶ä¸”å€ŸåŠ©event loop, é«˜æ•ˆçš„å¤„ç†I/Oäº‹ä»¶, é€šå¸¸è¿™éƒ½æ˜¯Pythonä¸­çš„æœ€ä½³å®è·µæ–¹æ¡ˆã€‚</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é—­åŒ…</title>
    <link href="/2020/04/15/Python/%E9%97%AD%E5%8C%85/"/>
    <url>/2020/04/15/Python/%E9%97%AD%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<p>é—­åŒ…ä¸æ˜¯Pythonç‹¬æœ‰çš„æ¦‚å¿µ, é—­åŒ…æ˜¯æŒ‡åœ¨å‡½æ•°ä¸­å¯ä»¥ï¼ˆåµŒå¥—ï¼‰å®šä¹‰å¦ä¸€ä¸ªå‡½æ•°æ—¶, å¦‚æœå†…éƒ¨çš„å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨çš„å‡½æ•°çš„å˜é‡, åˆ™å¯èƒ½äº§ç”Ÿé—­åŒ…ã€‚è¿è¡Œæ—¶, ä¸€æ—¦å¤–éƒ¨çš„ å‡½æ•°è¢«æ‰§è¡Œ, ä¸€ä¸ªé—­åŒ…å°±å½¢æˆäº†, é—­åŒ…ä¸­åŒ…å«äº†å†…éƒ¨å‡½æ•°çš„ä»£ç , ä»¥åŠæ‰€éœ€å¤–éƒ¨å‡½æ•°ä¸­çš„å˜é‡çš„å¼•ç”¨ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´, åœ¨å‡½æ•°ä¸­å£°æ˜å¦ä¸€ä¸ªå‡½æ•°, é‡Œé¢çš„å‡½æ•°å¦‚æœå¼•ç”¨äº†å¤–å±‚å‡½æ•°ä¸­çš„å˜é‡, é‚£ä¹ˆå°±å½¢æˆäº†ä¸€ä¸ªé—­åŒ…ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">In [1]</span><span class="hljs-punctuation">:</span> <span class="hljs-string">def foo(): </span><br>   <span class="hljs-attribute">...</span><span class="hljs-punctuation">:</span> <span class="hljs-string">    a = 1 </span><br>   <span class="hljs-attribute">...</span><span class="hljs-punctuation">:</span> <span class="hljs-string">    def bar(): </span><br>   <span class="hljs-attribute">...</span><span class="hljs-punctuation">:</span> <span class="hljs-string">        print(a) </span><br>   <span class="hljs-attribute">...</span><span class="hljs-punctuation">:</span> <span class="hljs-string">    bar() </span><br>   <span class="hljs-attribute">...</span><span class="hljs-punctuation">:             </span><br><span class="hljs-attribute">In [2]</span><span class="hljs-punctuation">:</span> <span class="hljs-string">foo()                              </span><br>1<br><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­, barè¿™ä¸ªå‡½æ•°å°±æ˜¯é—­åŒ…å‡½æ•°, å®ƒå¼•ç”¨äº† foo å‡½æ•°ä¸­å£°æ˜çš„å˜é‡ a</p>]]></content>
    
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis ä¸€äº›é¢˜ç›®</title>
    <link href="/2020/04/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis/%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/"/>
    <url>/2020/04/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis/%E4%B8%80%E4%BA%9B%E9%A2%98%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h3 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</h3><h4 id="åŸºæœ¬ç±»å‹">åŸºæœ¬ç±»å‹</h4><pre><code class="hljs">string å­—ç¬¦ä¸²list åˆ—è¡¨set é›†åˆzset æœ‰åºé›†åˆhash å“ˆå¸Œè¡¨</code></pre><ul><li>Stringï¼šå¦‚æœå­˜å‚¨æ•°å­—çš„è¯ï¼Œæ˜¯ç”¨intç±»å‹çš„ç¼–ç ;å¦‚æœå­˜å‚¨éæ•°å­—ï¼Œå°äºç­‰äº39å­—èŠ‚çš„å­—ç¬¦ä¸²ï¼Œæ˜¯embstrï¼›å¤§äº39ä¸ªå­—èŠ‚ï¼Œåˆ™æ˜¯rawç¼–ç ã€‚</li><li>Listï¼šå¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº512ä¸ªï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº64å­—èŠ‚ï¼ˆé»˜è®¤ï¼‰ï¼Œä½¿ç”¨ziplistç¼–ç ï¼Œå¦åˆ™ä½¿ç”¨linkedlistç¼–ç </li><li>Hashï¼šå“ˆå¸Œç±»å‹å…ƒç´ ä¸ªæ•°å°äº512ä¸ªï¼Œæ‰€æœ‰å€¼å°äº64å­—èŠ‚çš„è¯ï¼Œä½¿ç”¨ziplistç¼–ç ,å¦åˆ™ä½¿ç”¨hashtableç¼–ç ã€‚</li><li>Setï¼šå¦‚æœé›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ ä¸ªæ•°å°äº512ä¸ªï¼Œä½¿ç”¨intsetç¼–ç ï¼Œå¦åˆ™ä½¿ç”¨hashtableç¼–ç ã€‚</li><li>Zsetï¼šå½“æœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº128ä¸ªï¼Œæ¯ä¸ªå…ƒç´ çš„å€¼å°äº64å­—èŠ‚æ—¶ï¼Œä½¿ç”¨ziplistç¼–ç ï¼Œå¦åˆ™ä½¿ç”¨skiplistï¼ˆè·³è·ƒè¡¨ï¼‰ç¼–ç </li></ul><h4 id="ç‰¹æ®Šç±»å‹">ç‰¹æ®Šç±»å‹</h4><pre><code class="hljs">bitmap ä½å›¾hyperloglog åŸºæ•°ç»Ÿè®¡geospatial åœ°ç†ä½ç½®stream æ¶ˆæ¯é˜Ÿåˆ—</code></pre><h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3><ul><li>åœ¨å†…å­˜æ“ä½œä¸€åˆ‡é€Ÿåº¦å¿«</li><li>å•çº¿ç¨‹, æ²¡æœ‰ä¸Šä¸‹æ–‡çš„åˆ‡æ¢</li></ul><h3 id="ç¼ºç‚¹">ç¼ºç‚¹</h3><ul><li>å› ä¸ºå•çº¿ç¨‹, ä¸èƒ½åˆ©ç”¨cpuå¤šæ ¸æ€§èƒ½</li></ul><h3 id="æŒä¹…åŒ–">æŒä¹…åŒ–</h3><ul><li><p>RDB</p><ul><li>è®°å½•å¿«ç…§çš„æ–¹å¼</li><li>forkå­è¿›ç¨‹-&gt; å®šæ—¶å¹¶ä¸”åˆ°è¾¾è§¦å‘ä¿®æ”¹æ¬¡æ•°å†™ç£ç›˜-&gt;dump.rdb</li><li>è®°å½•çš„æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå¿«ç…§æ¢å¤èˆ’æœå¿«ï¼Œå¯èƒ½ä¸¢å¤±æ•°æ®</li></ul></li><li><p>AOF</p><ul><li>è®°å½•è¿‡ç¨‹çš„æ–¹å¼</li><li>å®¢æˆ·ç«¯ä¿®æ”¹å‘½ä»¤-&gt;æ¯ç§’/æ¯ä¸ªå‘½ä»¤/ä¸åŒæ­¥-&gt;appendonly.aof</li><li>è®°å½•çš„æ˜¯rediså‘½ä»¤ï¼Œå‘½ä»¤è¿‡å¤šæ¢å¤æ¯”è¾ƒæ…¢ï¼Œæ¢å¤å®Œæ•´æ€§ä¸Šæ¯”RDBé«˜</li></ul></li></ul><p>redis4.0+ ä½¿ç”¨æ··åˆæ¨¡å¼é€šè¿‡ï¼ŒRDBå…¨é‡æŒä¹…åŒ–å†…å­˜æ•°æ®ï¼ŒAOFå¢é‡æŒä¹…åŒ–ä¿®æ”¹å‘½ä»¤ï¼Œä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§</p>]]></content>
    
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>gitæ‰‹å†Œ</title>
    <link href="/2020/03/04/git%E6%89%8B%E5%86%8C/git/"/>
    <url>/2020/03/04/git%E6%89%8B%E5%86%8C/git/</url>
    
    <content type="html"><![CDATA[<h3 id="æœ¬åœ°é¡¹ç›®å’Œè¿œç¨‹å…³è”">æœ¬åœ°é¡¹ç›®å’Œè¿œç¨‹å…³è”</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">git init<br><br>git remote add origin https://xxx/xx.git<br><br>git pull --rebase origin master<br></code></pre></td></tr></table></figure><h3 id="æ·»åŠ å¤šä¸ªä»“åº“å¹¶ä¸”æäº¤-æ‹‰å–ä»£ç ">æ·»åŠ å¤šä¸ªä»“åº“å¹¶ä¸”æäº¤,æ‹‰å–ä»£ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">// æ·»åŠ ä¸€ä¸ª remote=originçš„ä»“åº“åœ°å€<br>git remote add origin https://github.com/xx.git<br><br>// æ·»åŠ ä¸€ä¸ª remote=giteeçš„ä»“åº“åœ°å€<br>git remote add gitee https://gitee.com/xx.git<br><br>// æ‹‰å–remote=giteeçš„ä»£ç <br>git pull gitee master<br><br>// æäº¤remote=giteeçš„ä»£ç <br>git push gitee master<br></code></pre></td></tr></table></figure><h3 id="gitignoreå¿˜äº†æ·»åŠ å¿½ç•¥çš„æ–‡ä»¶å¯¼è‡´æäº¤äº†ä¸éœ€è¦çš„æ–‡ä»¶">.gitignoreå¿˜äº†æ·»åŠ å¿½ç•¥çš„æ–‡ä»¶å¯¼è‡´æäº¤äº†ä¸éœ€è¦çš„æ–‡ä»¶</h3><p><strong>.gitignoreæ·»åŠ å¿½ç•¥çš„æ–‡ä»¶å¤¹</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">// ä»gitä¸­åˆ é™¤ideaç¼“å­˜<br>git rm --cached -r .idea // -r è¡¨ç¤ºé€’å½’<br><br>// ç”Ÿæˆæ–°çš„æäº¤<br>git add .gitignore<br>git commit -m &quot;(gitignore commit and remove .idea)&quot;<br><br>// æäº¤<br>git push<br><br></code></pre></td></tr></table></figure><h3 id="ç”¨ä»£ç†æ‹‰githubä»£ç ">ç”¨ä»£ç†æ‹‰githubä»£ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">// æŒ‡å®š http ä»£ç† github<br>git config --global http.https://github.com.proxy http://127.0.0.1:4780<br><br>// æ‹‰å–ä»£ç æŒ‡å®š https ä»£ç† github<br>git clone https://github.com/xxxxx/xxxxx2.git --config http.proxy=http://127.0.0.1:4780<br><br>// åˆ é™¤ä»£ç†<br>git config --global --unset http.https://github.com.proxy<br></code></pre></td></tr></table></figure><h3 id="ä¿å­˜ç™»å½•çŠ¶æ€">ä¿å­˜ç™»å½•çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config --global credential.helper &#x27;store&#x27;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¼ºåˆ¶é‡ç½®å›æ»šæœ€æ–°çš„æäº¤">ä½¿ç”¨å¼ºåˆ¶é‡ç½®å›æ»šæœ€æ–°çš„æäº¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">git reset --hard HEAD^<br><br>//å›é€€æœ€è¿‘ä¸¤ä¸ªcommit,ä»£ç æ”¾å›åˆ°æš‚å­˜åŒº<br>git reset --soft HEAD~2<br></code></pre></td></tr></table></figure><h3 id="ä¿®æ”¹github-commitæäº¤æ—¶é—´">ä¿®æ”¹github commitæäº¤æ—¶é—´</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br>// æ–°æäº¤<br>GIT_COMMITTER_DATE=&quot;2023-01-01T12:00:00&quot; git commit -m &quot;update&quot;  --date=&quot;2023-01-01T12:00:00&quot;<br><br>// æœ€è¿‘ä¸€æ¬¡commit<br>GIT_COMMITTER_DATE=&quot;2023-01-01T12:00:00&quot; git commit --amend --date=&quot;2023-01-01T12:00:00&quot; --no-edit<br><br></code></pre></td></tr></table></figure><h3 id="git-é‡åš">git é‡åš</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ³¨æ„å…ˆåé¡ºåº</span><br>git revert HEAD<br></code></pre></td></tr></table></figure><h3 id="å¿½ç•¥æäº¤æ–‡ä»¶">å¿½ç•¥æäº¤æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">git update-index --assume-unchanged etc/config_test.yaml<br><br>// å–æ¶ˆ<br>git update-index --no-assume-unchanged etc/config_test.yaml<br></code></pre></td></tr></table></figure><h3 id="git-å¿½ç•¥httpsè¯ä¹¦">git å¿½ç•¥httpsè¯ä¹¦</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">set GIT_SSL_NO_VERIFY=true<br></code></pre></td></tr></table></figure><h3 id="git-ä¿®æ”¹å½“å‰é¡¹ç›®çš„é‚®ç®±å’Œç”¨æˆ·å">git ä¿®æ”¹å½“å‰é¡¹ç›®çš„é‚®ç®±å’Œç”¨æˆ·å</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git config user.name &quot;maocatooo&quot;<br><br>git config user.email &quot;maocatzk@gmail.com&quot;<br></code></pre></td></tr></table></figure><h3 id="å½“å‰åˆ†æ”¯æ‹‰å–æŒ‡å®šcommitçš„ä»£ç ">å½“å‰åˆ†æ”¯æ‹‰å–æŒ‡å®šcommitçš„ä»£ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git cherry-pick &lt;commit-id&gt;<br></code></pre></td></tr></table></figure><h3 id="ç»™åˆ†æ”¯å•ç‹¬æ‹‰å‡ºæ¥åˆ›å»ºé¡¹ç›®ç›®å½•">ç»™åˆ†æ”¯å•ç‹¬æ‹‰å‡ºæ¥åˆ›å»ºé¡¹ç›®ç›®å½•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git worktree add &lt;dir-name&gt; &lt;branch-name&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>gitæ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
